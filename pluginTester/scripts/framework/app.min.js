"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},postMaster={controlPluginAPI:null,widgetPluginAPI:null,launcherPluginAPI:null,servicePluginAPIs:{},postMessageHandler:function(e){if(e.data){if("object"==_typeof(e.data))e.packet=e.data;else try{e.packet=JSON.parse(e.data)}catch(t){return void console.log("!! Post Master:: Ignore Invalid packet",t,e.data)}postMaster._acceptRequest(e)}},_acceptRequest:function(t){if(t&&t.packet&&t.packet.cmd){var e=!1;if(!(e=n(postMaster.widgetPluginAPI,t))&&(postMaster.widgetPluginAPI!=postMaster.launcherPluginAPI&&(e=n(postMaster.launcherPluginAPI,t)),!e&&!(e=n(postMaster.controlPluginAPI,t)))){for(var s in postMaster.servicePluginAPIs)if(e=n(postMaster.servicePluginAPIs[s],t))return;e||console.warn("no home for this packet (sad face) ")}}function n(t,e){if(!t||!t.postMessageHandler||!e)return!1;try{return t.postMessageHandler(e)}catch(t){return console.error("postMessageHandler error:",t),!1}}},broadcast:function(e,s){function t(t){t&&(s&&t.context.instanceId!=s||t.sendMessage(null,e))}for(var n in t(postMaster.controlPluginAPI),postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI!=postMaster.launcherPluginAPI&&t(postMaster.widgetPluginAPI),postMaster.widgetPluginAPI==postMaster.launcherPluginAPI&&(e.fid=postMaster.launcherPluginAPI.iFrameId),t(postMaster.launcherPluginAPI),postMaster.servicePluginAPIs)t(postMaster.servicePluginAPIs[n])},attachService:function(t,e){this.servicePluginAPIs[t]=e},dettachService:function(t){delete this.servicePluginAPIs[t]},isLauncherPluginActive:function(){return null==postMaster.widgetPluginAPI||postMaster.widgetPluginAPI==postMaster.launcherPluginAPI}};window.addEventListener("message",postMaster.postMessageHandler,!1);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,a,e,E){function h(t,e,i){return setTimeout(u(t,i),e)}function i(t,e,i){return!!Array.isArray(t)&&(r(t,i[e],i),!0)}function r(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==E)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function s(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)(!i||i&&t[n[r]]===E)&&(t[n[r]]=e[n[r]]),r++;return t}function n(t,e){return s(t,e,!0)}function o(t,e,i){var n,r=e.prototype;(n=t.prototype=Object.create(r)).constructor=t,n._super=r,i&&s(n,i)}function u(t,e){return function(){return t.apply(e,arguments)}}function c(t,e){return(void 0===t?"undefined":_typeof(t))==K?t.apply(e&&e[0]||E,e):t}function l(t,e){return t===E?e:t}function p(e,t,i){r(v(t),function(t){e.addEventListener(t,i,!1)})}function f(e,t,i){r(v(t),function(t){e.removeEventListener(t,i,!1)})}function I(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function d(t,e){return-1<t.indexOf(e)}function v(t){return t.trim().split(/\s+/g)}function m(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function g(t){return Array.prototype.slice.call(t,0)}function y(t,i,e){for(var n=[],r=[],s=0;s<t.length;){var o=i?t[s][i]:t[s];m(r,o)<0&&n.push(t[s]),r[s]=o,s++}return e&&(n=i?n.sort(function(t,e){return t[i]>e[i]}):n.sort()),n}function T(t,e){for(var i,n,r=e[0].toUpperCase()+e.slice(1),s=0;s<B.length;){if((n=(i=B[s])?i+r:e)in t)return n;s++}return E}function _(t){var e=t.ownerDocument;return e.defaultView||e.parentWindow}function A(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){c(e.options.enable,[e])&&i.handler(t)},this.init()}function S(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,s=e&ht&&n-r==0,o=e&(ut|ct)&&n-r==0;i.isFirst=!!s,i.isFinal=!!o,s&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=b(e)),1<r&&!i.firstMultiple?i.firstMultiple=b(e):1===r&&(i.firstMultiple=!1);var s=i.firstInput,o=i.firstMultiple,a=o?o.center:s.center,h=e.center=D(n);e.timeStamp=tt(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=R(a,h),e.distance=C(a,h),f=i,d=e,v=d.center,m=f.offsetDelta||{},g=f.prevDelta||{},y=f.prevInput||{},(d.eventType===ht||y.eventType===ut)&&(g=f.prevDelta={x:y.deltaX||0,y:y.deltaY||0},m=f.offsetDelta={x:v.x,y:v.y}),d.deltaX=g.x+(v.x-m.x),d.deltaY=g.y+(v.y-m.y),e.offsetDirection=w(e.deltaX,e.deltaY),e.scale=o?(l=o.pointers,p=n,C(p[0],p[1],Et)/C(l[0],l[1],Et)):1,e.rotation=o?(u=o.pointers,c=n,R(c[1],c[0],Et)-R(u[1],u[0],Et)):0,function(t,e){var i,n,r,s,o=t.lastInterval||e,a=e.timeStamp-o.timeStamp;if(e.eventType!=ct&&(at<a||o.velocity===E)){var h=o.deltaX-e.deltaX,u=o.deltaY-e.deltaY,c={x:h/(l=a)||0,y:u/l||0};n=c.x,r=c.y,i=$(c.x)>$(c.y)?c.x:c.y,s=w(h,u),t.lastInterval=e}else i=o.velocity,n=o.velocityX,r=o.velocityY,s=o.direction;var l;e.velocity=i,e.velocityX=n,e.velocityY=r,e.direction=s}(i,e);var u,c;var l,p;var f,d,v,m,g,y;var T=t.element;I(e.srcEvent.target,T)&&(T=e.srcEvent.target),e.target=T}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function b(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:Q(t.pointers[i].clientX),clientY:Q(t.pointers[i].clientY)},i++;return{timeStamp:tt(),pointers:e,center:D(e),deltaX:t.deltaX,deltaY:t.deltaY}}function D(t){var e=t.length;if(1===e)return{x:Q(t[0].clientX),y:Q(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:Q(i/e),y:Q(n/e)}}function w(t,e){return t===e?lt:$(t)>=$(e)?0<t?pt:ft:0<e?dt:vt}function C(t,e,i){i||(i=Tt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function R(t,e,i){i||(i=Tt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}function z(){this.evEl=_t,this.evWin=At,this.allow=!0,this.pressed=!1,A.apply(this,arguments)}function N(){this.evEl=Dt,this.evWin=wt,A.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function P(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,A.apply(this,arguments)}function M(){this.evTarget=zt,this.targetIds={},A.apply(this,arguments)}function O(){A.apply(this,arguments);var t=u(this.handler,this);this.touch=new M(this.manager,t),this.mouse=new z(this.manager,t)}function x(t,e){this.manager=t,this.set(e)}function X(t){this.id=et++,this.manager=null,this.options=n(t||{},this.defaults),this.options.enable=l(this.options.enable,!0),this.state=Ft,this.simultaneous={},this.requireFail=[]}function Y(t){return t==vt?"down":t==dt?"up":t==pt?"left":t==ft?"right":""}function F(t,e){var i=e.manager;return i?i.get(t):t}function W(){X.apply(this,arguments)}function q(){W.apply(this,arguments),this.pX=null,this.pY=null}function L(){W.apply(this,arguments)}function H(){X.apply(this,arguments),this._timer=null,this._input=null}function k(){W.apply(this,arguments)}function U(){W.apply(this,arguments)}function G(){X.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function V(t,e){return(e=e||{}).recognizers=l(e.recognizers,V.defaults.preset),new j(t,e)}function j(t,e){var i;e=e||{},this.options=n(e,V.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=new((i=this).options.inputClass||(nt?N:rt?M:it?O:z))(i,S),this.touchAction=new x(this,this.options.touchAction),Z(this,!0),r(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function Z(t,i){var n=t.element;r(t.options.cssProps,function(t,e){n.style[T(n.style,e)]=i?t:""})}var B=["","webkit","moz","MS","ms","o"],J=a.createElement("div"),K="function",Q=Math.round,$=Math.abs,tt=Date.now,et=1,it="ontouchstart"in t,nt=T(t,"PointerEvent")!==E,rt=it&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),st="touch",ot="mouse",at=25,ht=1,ut=4,ct=8,lt=1,pt=2,ft=4,dt=8,vt=16,mt=pt|ft,gt=dt|vt,yt=mt|gt,Tt=["x","y"],Et=["clientX","clientY"];A.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(_(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&f(this.element,this.evEl,this.domHandler),this.evTarget&&f(this.target,this.evTarget,this.domHandler),this.evWin&&f(_(this.element),this.evWin,this.domHandler)}};var It={mousedown:ht,mousemove:2,mouseup:ut},_t="mousedown",At="mousemove mouseup";o(z,A,{handler:function(t){var e=It[t.type];e&ht&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=ut),this.pressed&&this.allow&&(e&ut&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:ot,srcEvent:t}))}});var St={pointerdown:ht,pointermove:2,pointerup:ut,pointercancel:ct,pointerout:ct},bt={2:st,3:"pen",4:ot,5:"kinect"},Dt="pointerdown",wt="pointermove pointerup pointercancel";t.MSPointerEvent&&(Dt="MSPointerDown",wt="MSPointerMove MSPointerUp MSPointerCancel"),o(N,A,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=St[n],s=bt[t.pointerType]||t.pointerType,o=s==st,a=m(e,t.pointerId,"pointerId");r&ht&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):r&(ut|ct)&&(i=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:s,srcEvent:t}),i&&e.splice(a,1))}});var Ct={touchstart:ht,touchmove:2,touchend:ut,touchcancel:ct};o(P,A,{handler:function(t){var e=Ct[t.type];if(e===ht&&(this.started=!0),this.started){var i=function(t,e){var i=g(t.touches),n=g(t.changedTouches);return e&(ut|ct)&&(i=y(i.concat(n),"identifier",!0)),[i,n]}.call(this,t,e);e&(ut|ct)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:st,srcEvent:t})}}});var Rt={touchstart:ht,touchmove:2,touchend:ut,touchcancel:ct},zt="touchstart touchmove touchend touchcancel";o(M,A,{handler:function(t){var e=Rt[t.type],i=function(t,e){var i=g(t.touches),n=this.targetIds;if(e&(2|ht)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,s,o=g(t.changedTouches),a=[],h=this.target;if(s=i.filter(function(t){return I(t.target,h)}),e===ht)for(r=0;r<s.length;)n[s[r].identifier]=!0,r++;for(r=0;r<o.length;)n[o[r].identifier]&&a.push(o[r]),e&(ut|ct)&&delete n[o[r].identifier],r++;return a.length?[y(s.concat(a),"identifier",!0),a]:void 0}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:st,srcEvent:t})}}),o(O,A,{handler:function(t,e,i){var n=i.pointerType==st,r=i.pointerType==ot;if(n)this.mouse.allow=!1;else if(r&&!this.mouse.allow)return;e&(ut|ct)&&(this.mouse.allow=!0),this.callback(t,e,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Nt=T(J.style,"touchAction"),Pt=Nt!==E,Mt="compute",Ot="manipulation",xt="none",Xt="pan-x",Yt="pan-y";x.prototype={set:function(t){t==Mt&&(t=this.compute()),Pt&&(this.manager.element.style[Nt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return r(this.manager.recognizers,function(t){c(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(t){if(d(t,xt))return xt;var e=d(t,Xt),i=d(t,Yt);return e&&i?Xt+" "+Yt:e||i?e?Xt:Yt:d(t,Ot)?Ot:"auto"}(e.join(" "))},preventDefaults:function(t){if(!Pt){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var n=this.actions,r=d(n,xt),s=d(n,Yt),o=d(n,Xt);return r||s&&i&mt||o&&i&gt?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Ft=1,Wt=2,qt=4,Lt=8,Ht=Lt,kt=16;X.prototype={defaults:{},set:function(t){return s(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(i(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=F(t,this)).id]||(e[t.id]=t).recognizeWith(this),this},dropRecognizeWith:function(t){return i(t,"dropRecognizeWith",this)||(t=F(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(i(t,"requireFailure",this))return this;var e=this.requireFail;return-1===m(e,t=F(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(i(t,"dropRequireFailure",this))return this;t=F(t,this);var e=m(this.requireFail,t);return-1<e&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(i){function t(t){var e;n.manager.emit(n.options.event+(t?(e=r)&kt?"cancel":e&Lt?"end":e&qt?"move":e&Wt?"start":"":""),i)}var n=this,r=this.state;r<Lt&&t(!0),t(),Lt<=r&&t(!0)},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=32)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Ft)))return!1;t++}return!0},recognize:function(t){var e=s({},t);return c(this.options.enable,[this,e])?(this.state&(Ht|kt|32)&&(this.state=Ft),this.state=this.process(e),void(this.state&(Wt|qt|Lt|kt)&&this.tryEmit(e))):(this.reset(),void(this.state=32))},process:function(){},getTouchAction:function(){},reset:function(){}},o(W,X,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(Wt|qt),r=this.attrTest(t);return n&&(i&ct||!r)?e|kt:n||r?i&ut?e|Lt:e&Wt?e|qt:Wt:32}}),o(q,W,{defaults:{event:"pan",threshold:10,pointers:1,direction:yt},getTouchAction:function(){var t=this.options.direction,e=[];return t&mt&&e.push(Yt),t&gt&&e.push(Xt),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,s=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&mt?(r=0===s?lt:s<0?pt:ft,i=s!=this.pX,n=Math.abs(t.deltaX)):(r=0===o?lt:o<0?dt:vt,i=o!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return W.prototype.attrTest.call(this,t)&&(this.state&Wt||!(this.state&Wt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Y(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),o(L,W,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[xt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Wt)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),o(H,X,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(ut|ct)&&!r)this.reset();else if(t.eventType&ht)this.reset(),this._timer=h(function(){this.state=Ht,this.tryEmit()},e.time,this);else if(t.eventType&ut)return Ht;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Ht&&(t&&t.eventType&ut?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=tt(),this.manager.emit(this.options.event,this._input)))}}),o(k,W,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[xt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Wt)}}),o(U,W,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:mt|gt,pointers:1},getTouchAction:function(){return q.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(mt|gt)?e=t.velocity:i&mt?e=t.velocityX:i&gt&&(e=t.velocityY),this._super.attrTest.call(this,t)&&i&t.direction&&t.distance>this.options.threshold&&$(e)>this.options.velocity&&t.eventType&ut},emit:function(t){var e=Y(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),o(G,X,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Ot]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&ht&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=ut)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||C(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&s?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=h(function(){this.state=Ht,this.tryEmit()},e.interval,this),Wt):Ht}return 32},failTimeout:function(){return this._timer=h(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ht&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),V.VERSION="2.0.4",V.defaults={domEvents:!1,touchAction:Mt,enable:!0,inputTarget:null,inputClass:null,preset:[[k,{enable:!1}],[L,{enable:!1},["rotate"]],[U,{direction:mt}],[q,{direction:mt},["swipe"]],[G],[G,{event:"doubletap",taps:2},["tap"]],[H]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};j.prototype={set:function(t){return s(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&Ht)&&(r=e.curRecognizer=null);for(var s=0;s<n.length;)i=n[s],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(Wt|qt|Lt)&&(r=e.curRecognizer=i),s++}},get:function(t){if(t instanceof X)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(i(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),(t.manager=this).touchAction.update(),t},remove:function(t){if(i(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(m(e,t),1),this.touchAction.update(),this},on:function(t,e){var i=this.handlers;return r(v(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},off:function(t,e){var i=this.handlers;return r(v(t),function(t){e?i[t].splice(m(i[t],e),1):delete i[t]}),this},emit:function(t,e){var i,n,r;this.options.domEvents&&(i=t,n=e,(r=a.createEvent("Event")).initEvent(i,!0,!0),(r.gesture=n).target.dispatchEvent(r));var s=this.handlers[t]&&this.handlers[t].slice();if(s&&s.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var o=0;o<s.length;)s[o](e),o++}},destroy:function(){this.element&&Z(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},s(V,{INPUT_START:ht,INPUT_MOVE:2,INPUT_END:ut,INPUT_CANCEL:ct,STATE_POSSIBLE:Ft,STATE_BEGAN:Wt,STATE_CHANGED:qt,STATE_ENDED:Lt,STATE_RECOGNIZED:Ht,STATE_CANCELLED:kt,STATE_FAILED:32,DIRECTION_NONE:lt,DIRECTION_LEFT:pt,DIRECTION_RIGHT:ft,DIRECTION_UP:dt,DIRECTION_DOWN:vt,DIRECTION_HORIZONTAL:mt,DIRECTION_VERTICAL:gt,DIRECTION_ALL:yt,Manager:j,Input:A,TouchAction:x,TouchInput:M,MouseInput:z,PointerEventInput:N,TouchMouseInput:O,SingleTouchInput:P,Recognizer:X,AttrRecognizer:W,Tap:G,Pan:q,Swipe:U,Pinch:L,Rotate:k,Press:H,on:p,off:f,each:r,merge:n,extend:s,inherit:o,bindFn:u,prefixed:T}),("undefined"==typeof define?"undefined":_typeof(define))==K&&define.amd?define(function(){return V}):"undefined"!=typeof module&&module.exports?module.exports=V:t.Hammer=V}(window,document);
"use strict";var WebPullToRefresh=function(){var e="content",r="ptr",o=70,a=!1,s=2.5,i={},n={enabled:!1,distance:0,startingPositionY:0},c=document.body.classList,d=function(t){n.startingPositionY=document.body.scrollTop,0===n.startingPositionY&&(n.enabled=!0)},l=function(t){n.enabled&&(t.preventDefault(),n.distance=t.distance/i.resistance,u(),m())},f=function(t){n.enabled&&0!==n.distance&&(t.preventDefault(),n.distance<t.distance/i.resistance?n.distance=0:n.distance=t.distance/i.resistance,u(),m())},u=function(){i.contentEl.style.transform=i.contentEl.style.webkitTransform="translate3d( 0, "+n.distance+"px, 0 )",i.ptrEl.style.transform=i.ptrEl.style.webkitTransform="translate3d( 0, "+(n.distance-i.ptrEl.offsetHeight)+"px, 0 )"},m=function(){n.distance>i.distanceToRefresh?c.add("ptr-refresh"):c.remove("ptr-refresh")},p=function(t){n.enabled&&(t.preventDefault(),i.contentEl.style.transform=i.contentEl.style.webkitTransform="",i.ptrEl.style.transform=i.ptrEl.style.webkitTransform="",document.body.classList.contains("ptr-refresh")?E():b(),n.distance=0,n.enabled=!1)},E=function(){if(c.add("ptr-loading"),!i.loadingFunction)return b();var t=i.loadingFunction();setTimeout(function(){t.then(b)},1e3)},b=function(){c.remove("ptr-loading"),c.remove("ptr-refresh"),c.add("ptr-reset");document.body.addEventListener("transitionend",function t(){c.remove("ptr-reset"),document.body.removeEventListener("transitionend",t,!1)},!1)};return{init:function(t){if(!(i={contentEl:(t=t||{}).contentEl||document.getElementById(e),ptrEl:t.ptrEl||document.getElementById(r),distanceToRefresh:t.distanceToRefresh||o,loadingFunction:t.loadingFunction||a,resistance:t.resistance||s}).contentEl||!i.ptrEl)return!1;var n=new Hammer(i.contentEl);n.get("pan").set({direction:Hammer.DIRECTION_VERTICAL}),n.on("panstart",d),n.on("pandown",l),n.on("panup",f),n.on("panend",p)},disable:function(){if(i&&i.contentEl){var t=new Hammer(i.contentEl);t&&t.get("pan").set({enable:!1})}},enable:function(){if(i&&i.contentEl){var t=new Hammer(i.contentEl);t&&t.get("pan").set({enable:!0})}}}}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.PhotoSwipe=t()}(void 0,function(){return function(m,i,e,t){var f={features:null,bind:function(e,t,n,i){var o=(i?"remove":"add")+"EventListener";t=t.split(" ");for(var a=0;a<t.length;a++)t[a]&&e[o](t[a],n,!1)},isArray:function(e){return e instanceof Array},createEl:function(e,t){var n=document.createElement(t||"div");return e&&(n.className=e),n},getScrollY:function(){var e=window.pageYOffset;return void 0!==e?e:document.documentElement.scrollTop},unbind:function(e,t,n){f.bind(e,t,n,!0)},removeClass:function(e,t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},addClass:function(e,t){f.hasClass(e,t)||(e.className+=(e.className?" ":"")+t)},hasClass:function(e,t){return e.className&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},getChildByClass:function(e,t){for(var n=e.firstChild;n;){if(f.hasClass(n,t))return n;n=n.nextSibling}},arraySearch:function(e,t,n){for(var i=e.length;i--;)if(e[i][n]===t)return i;return-1},extend:function(e,t,n){for(var i in t)if(t.hasOwnProperty(i)){if(n&&e.hasOwnProperty(i))continue;e[i]=t[i]}},easing:{sine:{out:function(e){return Math.sin(e*(Math.PI/2))},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},cubic:{out:function(e){return--e*e*e+1}}},detectFeatures:function(){if(f.features)return f.features;var e=f.createEl().style,t="",n={};if(n.oldIE=document.all&&!document.addEventListener,n.touch="ontouchstart"in window,window.requestAnimationFrame&&(n.raf=window.requestAnimationFrame,n.caf=window.cancelAnimationFrame),n.pointerEvent=navigator.pointerEnabled||navigator.msPointerEnabled,!n.pointerEvent){var i=navigator.userAgent;if(/iP(hone|od)/.test(navigator.platform)){var o=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);o&&0<o.length&&1<=(o=parseInt(o[1],10))&&o<8&&(n.isOldIOSPhone=!0)}var a=i.match(/Android\s([0-9\.]*)/),r=a?a[1]:0;1<=(r=parseFloat(r))&&(r<4.4&&(n.isOldAndroid=!0),n.androidVersion=r),n.isMobileOpera=/opera mini|opera mobi/i.test(i)}for(var l,s,u=["transform","perspective","animationName"],c=["","webkit","Moz","ms","O"],d=0;d<4;d++){t=c[d];for(var p=0;p<3;p++)l=u[p],s=t+(t?l.charAt(0).toUpperCase()+l.slice(1):l),!n[l]&&s in e&&(n[l]=s);t&&!n.raf&&(t=t.toLowerCase(),n.raf=window[t+"RequestAnimationFrame"],n.raf&&(n.caf=window[t+"CancelAnimationFrame"]||window[t+"CancelRequestAnimationFrame"]))}if(!n.raf){var m=0;n.raf=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-m)),i=window.setTimeout(function(){e(t+n)},n);return m=t+n,i},n.caf=function(e){clearTimeout(e)}}return n.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,f.features=n}};f.detectFeatures(),f.features.oldIE&&(f.bind=function(e,t,n,i){t=t.split(" ");for(var o,a=(i?"detach":"attach")+"Event",r=function(){n.handleEvent.call(n)},l=0;l<t.length;l++)if(o=t[l])if("object"==(void 0===n?"undefined":_typeof(n))&&n.handleEvent){if(i){if(!n["oldIE"+o])return!1}else n["oldIE"+o]=r;e[a]("on"+o,n["oldIE"+o])}else e[a]("on"+o,n)});var h=this,y={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.75,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(e){return"A"===e.tagName},getDoubleTapZoom:function(e,t){return e?1:t.initialZoomLevel<.7?1:1.33},maxSpreadZoom:1.33,modal:!0,scaleMode:"fit"};f.extend(y,t);var s,o,a,v,r,l,u,c,d,x,p,g,w,b,I,D,C,S,M,T,A,E,O,k,R,Z,F,P,L,_,z,N,U,H,Y,B,W,G,X,V,K,q,$,j,J,Q,ee,te,ne,ie,oe,ae,re,le,n,se={x:0,y:0},ue={x:0,y:0},ce={x:0,y:0},de={},pe=0,me={},fe={x:0,y:0},he=0,ye=!0,ve=[],xe={},ge=!1,we=function(e,t){f.extend(h,t.publicMethods),ve.push(e)},be=function(e){var t=zt();return t-1<e?e-t:e<0?t+e:e},Ie={},De=function(e,t){return Ie[e]||(Ie[e]=[]),Ie[e].push(t)},Ce=function(e){var t=Ie[e];if(t){var n=Array.prototype.slice.call(arguments);n.shift();for(var i=0;i<t.length;i++)t[i].apply(h,n)}},Se=function(){return(new Date).getTime()},Me=function(e){re=e,h.bg.style.opacity=e*y.bgOpacity},Te=function(e,t,n,i,o){(!ge||o&&o!==h.currItem)&&(i/=o?o.fitRatio:h.currItem.fitRatio),e[E]=g+t+"px, "+n+"px"+w+" scale("+i+")"},Ae=function(e){te&&(e&&(x>h.currItem.fitRatio?ge||(Vt(h.currItem,!1,!0),ge=!0):ge&&(Vt(h.currItem),ge=!1)),Te(te,ce.x,ce.y,x))},Ee=function(e){e.container&&Te(e.container.style,e.initialPosition.x,e.initialPosition.y,e.initialZoomLevel,e)},Oe=function(e,t){t[E]=g+e+"px, 0px"+w},ke=function(e,t){if(!y.loop&&t){var n=v+(fe.x*pe-e)/fe.x,i=Math.round(e-ut.x);(n<0&&0<i||n>=zt()-1&&i<0)&&(e=ut.x+i*y.mainScrollEndFriction)}ut.x=e,Oe(e,r)},Re=function(e,t){var n=ct[e]-me[e];return ue[e]+se[e]+n-n*(t/p)},Ze=function(e,t){e.x=t.x,e.y=t.y,t.id&&(e.id=t.id)},Fe=function(e){e.x=Math.round(e.x),e.y=Math.round(e.y)},Pe=null,Le=function e(){Pe&&(f.unbind(document,"mousemove",e),f.addClass(m,"pswp--has_mouse"),y.mouseUsed=!0,Ce("mouseUsed")),Pe=setTimeout(function(){Pe=null},100)},_e=function(e,t){var n=Bt(h.currItem,de,e);return t&&(ee=n),n},ze=function(e){return e||(e=h.currItem),e.initialZoomLevel},Ne=function(e){return e||(e=h.currItem),0<e.w?y.maxSpreadZoom:1},Ue=function(e,t,n,i){return i===h.currItem.initialZoomLevel?(n[e]=h.currItem.initialPosition[e],!0):(n[e]=Re(e,i),n[e]>t.min[e]?(n[e]=t.min[e],!0):n[e]<t.max[e]&&(n[e]=t.max[e],!0))},He=function(e){var t="";y.escKey&&27===e.keyCode?t="close":y.arrowKeys&&(37===e.keyCode?t="prev":39===e.keyCode&&(t="next")),t&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(e.preventDefault?e.preventDefault():e.returnValue=!1,h[t]()))},Ye=function(e){e&&(K||V||ne||B)&&(e.preventDefault(),e.stopPropagation())},Be=function(){h.setScrollOffset(0,f.getScrollY())},We={},Ge=0,Xe=function(e){We[e]&&(We[e].raf&&Z(We[e].raf),Ge--,delete We[e])},Ve=function(e){We[e]&&Xe(e),We[e]||(Ge++,We[e]={})},Ke=function(){for(var e in We)We.hasOwnProperty(e)&&Xe(e)},qe=function(t,n,i,o,a,r,l){var s,u=Se();Ve(t),function e(){if(We[t]){if(s=Se()-u,o<=s)return Xe(t),r(i),void(l&&l());r((i-n)*a(s/o)+n),We[t].raf=R(e)}}()},$e={shout:Ce,listen:De,viewportSize:de,options:y,isMainScrollAnimating:function(){return ne},getZoomLevel:function(){return x},getCurrentIndex:function(){return v},isDragging:function(){return G},isZooming:function(){return J},setScrollOffset:function(e,t){me.x=e,_=me.y=t,Ce("updateScrollOffset",me)},applyZoomPan:function(e,t,n,i){ce.x=t,ce.y=n,x=e,Ae(i)},init:function(){if(!s&&!o){var e;h.framework=f,h.template=m,h.bg=f.getChildByClass(m,"pswp__bg"),F=m.className,s=!0,z=f.detectFeatures(),R=z.raf,Z=z.caf,E=z.transform,L=z.oldIE,h.scrollWrap=f.getChildByClass(m,"pswp__scroll-wrap"),h.container=f.getChildByClass(h.scrollWrap,"pswp__container"),r=h.container.style,h.itemHolders=D=[{el:h.container.children[0],wrap:0,index:-1},{el:h.container.children[1],wrap:0,index:-1},{el:h.container.children[2],wrap:0,index:-1}],D[0].el.style.display=D[2].el.style.display="none",function(){if(E){var e=z.perspective&&!k;return g="translate"+(e?"3d(":"("),w=z.perspective?", 0px)":")"}E="left",f.addClass(m,"pswp--ie"),Oe=function(e,t){t.left=e+"px"},Ee=function(e){var t=1<e.fitRatio?1:e.fitRatio,n=e.container.style,i=t*e.w,o=t*e.h;n.width=i+"px",n.height=o+"px",n.left=e.initialPosition.x+"px",n.top=e.initialPosition.y+"px"},Ae=function(){if(te){var e=te,t=h.currItem,n=1<t.fitRatio?1:t.fitRatio,i=n*t.w,o=n*t.h;e.width=i+"px",e.height=o+"px",e.left=ce.x+"px",e.top=ce.y+"px"}}}(),d={resize:h.updateSize,scroll:Be,keydown:He,click:Ye};var t=z.isOldIOSPhone||z.isOldAndroid||z.isMobileOpera;for(z.animationName&&z.transform&&!t||(y.showAnimationDuration=y.hideAnimationDuration=0),e=0;e<ve.length;e++)h["init"+ve[e]]();i&&(h.ui=new i(h,f)).init(),Ce("firstUpdate"),v=v||y.index||0,(isNaN(v)||v<0||v>=zt())&&(v=0),h.currItem=_t(v),(z.isOldIOSPhone||z.isOldAndroid)&&(ye=!1),m.setAttribute("aria-hidden","false"),y.modal&&(ye?m.style.position="fixed":(m.style.position="absolute",m.style.top=f.getScrollY()+"px")),void 0===_&&(Ce("initialLayout"),_=P=f.getScrollY());var n="pswp--open ";for(y.mainClass&&(n+=y.mainClass+" "),y.showHideOpacity&&(n+="pswp--animate_opacity "),n+=k?"pswp--touch":"pswp--notouch",n+=z.animationName?" pswp--css_animation":"",n+=z.svg?" pswp--svg":"",f.addClass(m,n),h.updateSize(),l=-1,he=null,e=0;e<3;e++)Oe((e+l)*fe.x,D[e].el.style);L||f.bind(h.scrollWrap,c,h),De("initialZoomInEnd",function(){h.setContent(D[0],v-1),h.setContent(D[2],v+1),D[0].el.style.display=D[2].el.style.display="block",y.focus&&m.focus(),f.bind(document,"keydown",h),z.transform&&f.bind(h.scrollWrap,"click",h),y.mouseUsed||f.bind(document,"mousemove",Le),f.bind(window,"resize scroll",h),Ce("bindEvents")}),h.setContent(D[1],v),h.updateCurrItem(),Ce("afterInit"),ye||(b=setInterval(function(){Ge||G||J||x!==h.currItem.initialZoomLevel||h.updateSize()},1e3)),f.addClass(m,"pswp--visible")}},close:function(){s&&(o=!(s=!1),Ce("close"),f.unbind(window,"resize",h),f.unbind(window,"scroll",d.scroll),f.unbind(document,"keydown",h),f.unbind(document,"mousemove",Le),z.transform&&f.unbind(h.scrollWrap,"click",h),G&&f.unbind(window,u,h),Ce("unbindEvents"),Nt(h.currItem,null,!0,h.destroy))},destroy:function(){Ce("destroy"),Zt&&clearTimeout(Zt),m.setAttribute("aria-hidden","true"),m.className=F,b&&clearInterval(b),f.unbind(h.scrollWrap,c,h),f.unbind(window,"scroll",h),mt(),Ke(),Ie=null},panTo:function(e,t,n){n||(e>ee.min.x?e=ee.min.x:e<ee.max.x&&(e=ee.max.x),t>ee.min.y?t=ee.min.y:t<ee.max.y&&(t=ee.max.y)),ce.x=e,ce.y=t,Ae()},handleEvent:function(e){e=e||window.event,d[e.type]&&d[e.type](e)},goTo:function(e){var t=(e=be(e))-v;he=t,v=e,h.currItem=_t(v),pe-=t,ke(fe.x*pe),Ke(),ne=!1,h.updateCurrItem()},next:function(){h.goTo(v+1)},prev:function(){h.goTo(v-1)},updateCurrZoomItem:function(e){if(e&&Ce("beforeChange",0),D[1].el.children.length){var t=D[1].el.children[0];te=f.hasClass(t,"pswp__zoom-wrap")?t.style:null}else te=null;ee=h.currItem.bounds,p=x=h.currItem.initialZoomLevel,ce.x=ee.center.x,ce.y=ee.center.y,e&&Ce("afterChange")},invalidateCurrItems:function(){I=!0;for(var e=0;e<3;e++)D[e].item&&(D[e].item.needsUpdate=!0)},updateCurrItem:function(e){if(0!==he){var t,n=Math.abs(he);if(!(e&&n<2)){h.currItem=_t(v),ge=!1,Ce("beforeChange",he),3<=n&&(l+=he+(0<he?-3:3),n=3);for(var i=0;i<n;i++)0<he?(t=D.shift(),D[2]=t,Oe((++l+2)*fe.x,t.el.style),h.setContent(t,v-n+i+1+1)):(t=D.pop(),D.unshift(t),Oe(--l*fe.x,t.el.style),h.setContent(t,v+n-i-1-1));if(te&&1===Math.abs(he)){var o=_t(C);o.initialZoomLevel!==x&&(Bt(o,de),Vt(o),Ee(o))}he=0,h.updateCurrZoomItem(),C=v,Ce("afterChange")}}},updateSize:function(e){if(!ye&&y.modal){var t=f.getScrollY();if(_!==t&&(m.style.top=t+"px",_=t),!e&&xe.x===window.innerWidth&&xe.y===window.innerHeight)return;xe.x=window.innerWidth,xe.y=window.innerHeight,m.style.height=xe.y+"px"}if(de.x=h.scrollWrap.clientWidth,de.y=h.scrollWrap.clientHeight,Be(),fe.x=de.x+Math.round(de.x*y.spacing),fe.y=de.y,ke(fe.x*pe),Ce("beforeResize"),void 0!==l){for(var n,i,o,a=0;a<3;a++)n=D[a],Oe((a+l)*fe.x,n.el.style),o=v+a-1,y.loop&&2<zt()&&(o=be(o)),(i=_t(o))&&(I||i.needsUpdate||!i.bounds)?(h.cleanSlide(i),h.setContent(n,o),1===a&&(h.currItem=i,h.updateCurrZoomItem(!0)),i.needsUpdate=!1):-1===n.index&&0<=o&&h.setContent(n,o),i&&i.container&&(Bt(i,de),Vt(i),Ee(i));I=!1}p=x=h.currItem.initialZoomLevel,(ee=h.currItem.bounds)&&(ce.x=ee.center.x,ce.y=ee.center.y,Ae(!0)),Ce("resize")},zoomTo:function(t,e,n,i,o){e&&(p=x,ct.x=Math.abs(e.x)-ce.x,ct.y=Math.abs(e.y)-ce.y,Ze(ue,ce));var a=_e(t,!1),r={};Ue("x",a,r,t),Ue("y",a,r,t);var l=x,s=ce.x,u=ce.y;Fe(r);var c=function(e){1===e?(x=t,ce.x=r.x,ce.y=r.y):(x=(t-l)*e+l,ce.x=(r.x-s)*e+s,ce.y=(r.y-u)*e+u),o&&o(e),Ae(1===e)};n?qe("customZoomTo",0,1,n,i||f.easing.sine.inOut,c):c(1)}},je={},Je={},Qe={},et={},tt={},nt=[],it={},ot=[],at={},rt=0,lt={x:0,y:0},st=0,ut={x:0,y:0},ct={x:0,y:0},dt={x:0,y:0},pt=function(e,t){return at.x=Math.abs(e.x-t.x),at.y=Math.abs(e.y-t.y),Math.sqrt(at.x*at.x+at.y*at.y)},mt=function(){q&&(Z(q),q=null)},ft={},ht=function(e,t){return ft.prevent=!function e(t,n){return!(!t||t===document)&&!(t.getAttribute("class")&&-1<t.getAttribute("class").indexOf("pswp__scroll-wrap"))&&(n(t)?t:e(t.parentNode,n))}(e.target,y.isClickableElement),Ce("preventDragEvent",e,t,ft),ft.prevent},yt=function(e,t){return t.x=e.pageX,t.y=e.pageY,t.id=e.identifier,t},vt=function(e,t,n){n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y)},xt=function(){var e=ce.y-h.currItem.initialPosition.y;return 1-Math.abs(e/(de.y/2))},gt={},wt={},bt=[],It=function(e){for(;0<bt.length;)bt.pop();return O?(n=0,nt.forEach(function(e){0===n?bt[0]=e:1===n&&(bt[1]=e),n++})):-1<e.type.indexOf("touch")?e.touches&&0<e.touches.length&&(bt[0]=yt(e.touches[0],gt),1<e.touches.length&&(bt[1]=yt(e.touches[1],wt))):(gt.x=e.pageX,gt.y=e.pageY,gt.id="",bt[0]=gt),bt},Dt=function(e,t){var n,i,o,a,r=ce[e]+t[e],l=0<t[e],s=ut.x+t.x,u=ut.x-it.x;return n=r>ee.min[e]||r<ee.max[e]?y.panEndFriction:1,r=ce[e]+t[e]*n,!y.allowPanToNext&&x!==h.currItem.initialZoomLevel||(te?"h"!==ie||"x"!==e||V||(l?(r>ee.min[e]&&(n=y.panEndFriction,ee.min[e],i=ee.min[e]-ue[e]),(i<=0||u<0)&&1<zt()?(a=s,u<0&&s>it.x&&(a=it.x)):ee.min.x!==ee.max.x&&(o=r)):(r<ee.max[e]&&(n=y.panEndFriction,ee.max[e],i=ue[e]-ee.max[e]),(i<=0||0<u)&&1<zt()?(a=s,0<u&&s<it.x&&(a=it.x)):ee.min.x!==ee.max.x&&(o=r))):a=s,"x"!==e)?void(ne||$||x>h.currItem.fitRatio&&(ce[e]+=t[e]*n)):(void 0!==a&&(ke(a,!0),$=a!==it.x),ee.min.x!==ee.max.x&&(void 0!==o?ce.x=o:$||(ce.x+=t.x*n)),void 0!==a)},Ct=function(e){if(!("mousedown"===e.type&&0<e.button)){if(Lt)return void e.preventDefault();if(!W||"mousedown"!==e.type){if(ht(e,!0)&&e.preventDefault(),Ce("pointerDown"),O){var t=f.arraySearch(nt,e.pointerId,"id");t<0&&(t=nt.length),nt[t]={x:e.pageX,y:e.pageY,id:e.pointerId}}var n=It(e),i=n.length;j=null,Ke(),G&&1!==i||(G=oe=!0,f.bind(window,u,h),Y=le=ae=B=$=K=X=V=!1,ie=null,Ce("firstTouchStart",n),Ze(ue,ce),se.x=se.y=0,Ze(et,n[0]),Ze(tt,et),it.x=fe.x*pe,ot=[{x:et.x,y:et.y}],U=N=Se(),_e(x,!0),mt(),function e(){G&&(q=R(e),Mt())}()),!J&&1<i&&!ne&&!$&&(p=x,J=X=!(V=!1),se.y=se.x=0,Ze(ue,ce),Ze(je,n[0]),Ze(Je,n[1]),vt(je,Je,dt),ct.x=Math.abs(dt.x)-ce.x,ct.y=Math.abs(dt.y)-ce.y,Q=pt(je,Je))}}},St=function(e){if(e.preventDefault(),O){var t=f.arraySearch(nt,e.pointerId,"id");if(-1<t){var n=nt[t];n.x=e.pageX,n.y=e.pageY}}if(G){var i=It(e);if(ie||K||J)j=i;else if(ut.x!==fe.x*pe)ie="h";else{var o=Math.abs(i[0].x-et.x)-Math.abs(i[0].y-et.y);10<=Math.abs(o)&&(ie=0<o?"h":"v",j=i)}}},Mt=function(){if(j){var e=j.length;if(0!==e)if(Ze(je,j[0]),Qe.x=je.x-et.x,Qe.y=je.y-et.y,J&&1<e){if(et.x=je.x,et.y=je.y,!Qe.x&&!Qe.y&&(s=j[1],u=Je,s.x===u.x&&s.y===u.y))return;Ze(Je,j[1]),V||(V=!0,Ce("zoomGestureStarted"));var t=pt(je,Je),n=kt(t);n>h.currItem.initialZoomLevel+h.currItem.initialZoomLevel/15&&(le=!0);var i=1,o=ze(),a=Ne();if(n<o)if(y.pinchToClose&&!le&&p<=h.currItem.initialZoomLevel){var r=1-(o-n)/(o/1.2);Me(r),Ce("onPinchClose",r),ae=!0}else 1<(i=(o-n)/o)&&(i=1),n=o-i*(o/3);else a<n&&(1<(i=(n-a)/(6*o))&&(i=1),n=a+i*o);i<0&&(i=0),vt(je,Je,lt),se.x+=lt.x-dt.x,se.y+=lt.y-dt.y,Ze(dt,lt),ce.x=Re("x",n),ce.y=Re("y",n),Y=x<n,x=n,Ae()}else{if(!ie)return;if(oe&&(oe=!1,10<=Math.abs(Qe.x)&&(Qe.x-=j[0].x-tt.x),10<=Math.abs(Qe.y)&&(Qe.y-=j[0].y-tt.y)),et.x=je.x,et.y=je.y,0===Qe.x&&0===Qe.y)return;if("v"===ie&&y.closeOnVerticalDrag&&"fit"===y.scaleMode&&x===h.currItem.initialZoomLevel){se.y+=Qe.y,ce.y+=Qe.y;var l=xt();return B=!0,Ce("onVerticalDrag",l),Me(l),void Ae()}(function(e,t,n){if(50<e-U){var i=2<ot.length?ot.shift():{};i.x=t,i.y=n,ot.push(i),U=e}})(Se(),je.x,je.y),K=!0,ee=h.currItem.bounds,Dt("x",Qe)||(Dt("y",Qe),Fe(ce),Ae())}}var s,u},Tt=function(e){if(z.isOldAndroid){if(W&&"mouseup"===e.type)return;-1<e.type.indexOf("touch")&&(clearTimeout(W),W=setTimeout(function(){W=0},600))}var t;if(Ce("pointerUp"),ht(e,!1)&&e.preventDefault(),O){var n=f.arraySearch(nt,e.pointerId,"id");-1<n&&(t=nt.splice(n,1)[0],navigator.pointerEnabled?t.type=e.pointerType||"mouse":(t.type={4:"mouse",2:"touch",3:"pen"}[e.pointerType],t.type||(t.type=e.pointerType||"mouse")))}var i,o=It(e),a=o.length;if("mouseup"===e.type&&(a=0),2===a)return!(j=null);1===a&&Ze(tt,o[0]),0!==a||ie||ne||(t||("mouseup"===e.type?t={x:e.pageX,y:e.pageY,type:"mouse"}:e.changedTouches&&e.changedTouches[0]&&(t={x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY,type:"touch"})),Ce("touchRelease",e,t));var r=-1;if(0===a&&(G=!1,f.unbind(window,u,h),mt(),J?r=0:-1!==st&&(r=Se()-st)),st=1===a?Se():-1,i=-1!==r&&r<150?"zoom":"swipe",J&&a<2&&(J=!1,1===a&&(i="zoomPointerUp"),Ce("zoomGestureEnded")),j=null,K||V||ne||B)if(Ke(),H||(H=At()),H.calculateSwipeSpeed("x"),B)if(xt()<y.verticalDragRange)h.close();else{var l=ce.y,s=re;qe("verticalDrag",0,1,300,f.easing.cubic.out,function(e){ce.y=(h.currItem.initialPosition.y-l)*e+l,Me((1-s)*e+s),Ae()}),Ce("onVerticalDrag",1)}else{if(($||ne)&&0===a){if(Ot(i,H))return;i="zoomPointerUp"}if(!ne)return"swipe"!==i?void Rt():void(!$&&x>h.currItem.fitRatio&&Et(H))}},At=function(){var t,n,i={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(e){1<ot.length?(t=Se()-U+50,n=ot[ot.length-2][e]):(t=Se()-N,n=tt[e]),i.lastFlickOffset[e]=et[e]-n,i.lastFlickDist[e]=Math.abs(i.lastFlickOffset[e]),20<i.lastFlickDist[e]?i.lastFlickSpeed[e]=i.lastFlickOffset[e]/t:i.lastFlickSpeed[e]=0,Math.abs(i.lastFlickSpeed[e])<.1&&(i.lastFlickSpeed[e]=0),i.slowDownRatio[e]=.95,i.slowDownRatioReverse[e]=1-i.slowDownRatio[e],i.speedDecelerationRatio[e]=1},calculateOverBoundsAnimOffset:function(t,e){i.backAnimStarted[t]||(ce[t]>ee.min[t]?i.backAnimDestination[t]=ee.min[t]:ce[t]<ee.max[t]&&(i.backAnimDestination[t]=ee.max[t]),void 0!==i.backAnimDestination[t]&&(i.slowDownRatio[t]=.7,i.slowDownRatioReverse[t]=1-i.slowDownRatio[t],i.speedDecelerationRatioAbs[t]<.05&&(i.lastFlickSpeed[t]=0,i.backAnimStarted[t]=!0,qe("bounceZoomPan"+t,ce[t],i.backAnimDestination[t],e||300,f.easing.sine.out,function(e){ce[t]=e,Ae()}))))},calculateAnimOffset:function(e){i.backAnimStarted[e]||(i.speedDecelerationRatio[e]=i.speedDecelerationRatio[e]*(i.slowDownRatio[e]+i.slowDownRatioReverse[e]-i.slowDownRatioReverse[e]*i.timeDiff/10),i.speedDecelerationRatioAbs[e]=Math.abs(i.lastFlickSpeed[e]*i.speedDecelerationRatio[e]),i.distanceOffset[e]=i.lastFlickSpeed[e]*i.speedDecelerationRatio[e]*i.timeDiff,ce[e]+=i.distanceOffset[e])},panAnimLoop:function(){if(We.zoomPan&&(We.zoomPan.raf=R(i.panAnimLoop),i.now=Se(),i.timeDiff=i.now-i.lastNow,i.lastNow=i.now,i.calculateAnimOffset("x"),i.calculateAnimOffset("y"),Ae(),i.calculateOverBoundsAnimOffset("x"),i.calculateOverBoundsAnimOffset("y"),i.speedDecelerationRatioAbs.x<.05&&i.speedDecelerationRatioAbs.y<.05))return ce.x=Math.round(ce.x),ce.y=Math.round(ce.y),Ae(),void Xe("zoomPan")}};return i},Et=function(e){return e.calculateSwipeSpeed("y"),ee=h.currItem.bounds,e.backAnimDestination={},e.backAnimStarted={},Math.abs(e.lastFlickSpeed.x)<=.05&&Math.abs(e.lastFlickSpeed.y)<=.05?(e.speedDecelerationRatioAbs.x=e.speedDecelerationRatioAbs.y=0,e.calculateOverBoundsAnimOffset("x"),e.calculateOverBoundsAnimOffset("y"),!0):(Ve("zoomPan"),e.lastNow=Se(),void e.panAnimLoop())},Ot=function(e,t){var n,i,o;if(ne||(rt=v),"swipe"===e){var a=et.x-tt.x,r=t.lastFlickDist.x<10;30<a&&(r||20<t.lastFlickOffset.x)?i=-1:a<-30&&(r||t.lastFlickOffset.x<-20)&&(i=1)}i&&((v+=i)<0?(v=y.loop?zt()-1:0,o=!0):v>=zt()&&(v=y.loop?0:zt()-1,o=!0),o&&!y.loop||(he+=i,pe-=i,n=!0));var l,s=fe.x*pe,u=Math.abs(s-ut.x);return n||s>ut.x==0<t.lastFlickSpeed.x?(l=0<Math.abs(t.lastFlickSpeed.x)?u/Math.abs(t.lastFlickSpeed.x):333,l=Math.min(l,400),l=Math.max(l,250)):l=333,rt===v&&(n=!1),ne=!0,Ce("mainScrollAnimStart"),qe("mainScroll",ut.x,s,l,f.easing.cubic.out,ke,function(){Ke(),ne=!1,rt=-1,(n||rt!==v)&&h.updateCurrItem(),Ce("mainScrollAnimComplete")}),n&&h.updateCurrItem(!0),n},kt=function(e){return 1/Q*e*p},Rt=function(){var e=x,t=ze(),n=Ne();x<t?e=t:n<x&&(e=n);var i,o=re;return ae&&!Y&&!le&&x<t?h.close():(ae&&(i=function(e){Me((1-o)*e+o)}),h.zoomTo(e,0,200,f.easing.cubic.out,i)),!0};we("Gestures",{publicMethods:{initGestures:function(){var e=function(e,t,n,i,o){S=e+t,M=e+n,T=e+i,A=o?e+o:""};(O=z.pointerEvent)&&z.touch&&(z.touch=!1),O?navigator.pointerEnabled?e("pointer","down","move","up","cancel"):e("MSPointer","Down","Move","Up","Cancel"):z.touch?(e("touch","start","move","end","cancel"),k=!0):e("mouse","down","move","up"),u=M+" "+T+" "+A,c=S,O&&!k&&(k=1<navigator.maxTouchPoints||1<navigator.msMaxTouchPoints),h.likelyTouchDevice=k,d[S]=Ct,d[M]=St,d[T]=Tt,A&&(d[A]=d[T]),z.touch&&(c+=" mousedown",u+=" mousemove mouseup",d.mousedown=d[S],d.mousemove=d[M],d.mouseup=d[T]),k||(y.allowPanToNext=!1)}}});var Zt,Ft,Pt,Lt,_t,zt,Nt=function(r,e,l,t){var s;Zt&&clearTimeout(Zt),Pt=Lt=!0,r.initialLayout?(s=r.initialLayout,r.initialLayout=null):s=y.getThumbBoundsFn&&y.getThumbBoundsFn(v);var u,c,d=l?y.hideAnimationDuration:y.showAnimationDuration,p=function(){Xe("initialZoom"),l?(h.template.removeAttribute("style"),h.bg.removeAttribute("style")):(Me(1),e&&(e.style.display="block"),f.addClass(m,"pswp--animated-in"),Ce("initialZoom"+(l?"OutEnd":"InEnd"))),t&&t(),Lt=!1};if(!d||!s||void 0===s.x)return Ce("initialZoom"+(l?"Out":"In")),x=r.initialZoomLevel,Ze(ce,r.initialPosition),Ae(),m.style.opacity=l?0:1,Me(1),void(d?setTimeout(function(){p()},d):p());u=a,c=!h.currItem.src||h.currItem.loadError||y.showHideOpacity,r.miniImg&&(r.miniImg.style.webkitBackfaceVisibility="hidden"),l||(x=s.w/r.w,ce.x=s.x,ce.y=s.y-P,h[c?"template":"bg"].style.opacity=.001,Ae()),Ve("initialZoom"),l&&!u&&f.removeClass(m,"pswp--animated-in"),c&&(l?f[(u?"remove":"add")+"Class"](m,"pswp--animate_opacity"):setTimeout(function(){f.addClass(m,"pswp--animate_opacity")},30)),Zt=setTimeout(function(){if(Ce("initialZoom"+(l?"Out":"In")),l){var t=s.w/r.w,n=ce.x,i=ce.y,o=x,a=re,e=function(e){1===e?(x=t,ce.x=s.x,ce.y=s.y-_):(x=(t-o)*e+o,ce.x=(s.x-n)*e+n,ce.y=(s.y-_-i)*e+i),Ae(),c?m.style.opacity=1-e:Me(a-e*a)};u?qe("initialZoom",0,1,d,f.easing.cubic.out,e,p):(e(1),Zt=setTimeout(p,d+20))}else x=r.initialZoomLevel,Ze(ce,r.initialPosition),Ae(),Me(1),c?m.style.opacity=1:Me(1),Zt=setTimeout(p,d+20)},l?25:90)},Ut={},Ht=[],Yt={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return Ft.length}},Bt=function(e,t,n){if(e.src&&!e.loadError){var i=!n;if(i&&(e.vGap||(e.vGap={top:0,bottom:0}),Ce("parseVerticalMargin",e)),Ut.x=t.x,Ut.y=t.y-e.vGap.top-e.vGap.bottom,i){var o=Ut.x/e.w,a=Ut.y/e.h;e.fitRatio=o<a?o:a;var r=y.scaleMode;"orig"===r?n=1:"fit"===r&&(n=e.fitRatio),1<n&&(n=1),e.initialZoomLevel=n,e.bounds||(e.bounds={center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}})}if(!n)return;return s=(l=e).w*n,u=e.h*n,(c=l.bounds).center.x=Math.round((Ut.x-s)/2),c.center.y=Math.round((Ut.y-u)/2)+l.vGap.top,c.max.x=s>Ut.x?Math.round(Ut.x-s):c.center.x,c.max.y=u>Ut.y?Math.round(Ut.y-u)+l.vGap.top:c.center.y,c.min.x=s>Ut.x?0:c.center.x,c.min.y=u>Ut.y?l.vGap.top:c.center.y,i&&n===e.initialZoomLevel&&(e.initialPosition=e.bounds.center),e.bounds}var l,s,u,c;return e.w=e.h=0,e.initialZoomLevel=e.fitRatio=1,e.bounds={center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}},e.initialPosition=e.bounds.center,e.bounds},Wt=function(e,t,n,i,o,a){t.loadError||i&&(t.imageAppended=!0,Vt(t,i,t===h.currItem&&ge),n.appendChild(i),a&&setTimeout(function(){t&&t.loaded&&t.placeholder&&(t.placeholder.style.display="none",t.placeholder=null)},500))},Gt=function(e){e.loading=!0,e.loaded=!1;var t=e.img=f.createEl("pswp__img","img"),n=function(){e.loading=!1,e.loaded=!0,e.loadComplete?e.loadComplete(e):e.img=null,t.onload=t.onerror=null,t=null};return t.onload=n,t.onerror=function(){e.loadError=!0,n()},t.src=e.src,t},Xt=function(e,t){if(e.src&&e.loadError&&e.container)return t&&(e.container.innerHTML=""),e.container.innerHTML=y.errorMsg.replace("%url%",e.src),!0},Vt=function(e,t,n){if(e.src){t||(t=e.container.lastChild);var i=n?e.w:Math.round(e.w*e.fitRatio),o=n?e.h:Math.round(e.h*e.fitRatio);if(e.hasFlippedDimensions){var a=i;i=o,o=a}e.rotationDeg&&f.addClass(t,"pswp__rotate"+e.rotationDeg),e.placeholder&&!e.loaded&&(e.placeholder.style.width=i+"px",e.placeholder.style.height=o+"px"),t.style.width=i+"px",t.style.height=o+"px"}},Kt=function(){if(Ht.length){for(var e,t=0;t<Ht.length;t++)(e=Ht[t]).holder.index===e.index&&Wt(e.index,e.item,e.baseDiv,e.img,0,e.clearPlaceholder);Ht=[]}};we("Controller",{publicMethods:{lazyLoadItem:function(e){e=be(e);var t=_t(e);t&&(!t.loaded&&!t.loading||I)&&(Ce("gettingData",e,t),t.src&&Gt(t))},initController:function(){f.extend(y,Yt,!0),function(e){for(var t={3:180,6:90,8:270},n=0;n<e.length;++n){var i=e[n],o=i.exif_orientation;if(o){var a=t[o=parseInt(o)];if((i.rotationDeg=a)&&a%180==90&&!i.hasFlippedDimensions){var r=i.w;i.w=i.h,i.h=r,i.hasFlippedDimensions=!0}}}}(e),h.items=Ft=e,_t=h.getItemAt,zt=y.getNumItemsFn,y.loop,zt()<3&&(y.loop=!1),De("beforeChange",function(e){var t,n=y.preload,i=null===e||0<=e,o=Math.min(n[0],zt()),a=Math.min(n[1],zt());for(t=1;t<=(i?a:o);t++)h.lazyLoadItem(v+t);for(t=1;t<=(i?o:a);t++)h.lazyLoadItem(v-t)}),De("initialLayout",function(){h.currItem.initialLayout=y.getThumbBoundsFn&&y.getThumbBoundsFn(v)}),De("mainScrollAnimComplete",Kt),De("initialZoomInEnd",Kt),De("destroy",function(){for(var e,t=0;t<Ft.length;t++)(e=Ft[t]).container&&(e.container=null),e.placeholder&&(e.placeholder=null),e.img&&(e.img=null),e.preloader&&(e.preloader=null),e.loadError&&(e.loaded=e.loadError=!1);Ht=null})},getItemAt:function(e){return 0<=e&&void 0!==Ft[e]&&Ft[e]},allowProgressiveImg:function(){return y.forceProgressiveLoading||!k||y.mouseUsed||1200<screen.width},setContent:function(t,n){y.loop&&(n=be(n));var e=h.getItemAt(t.index);e&&(e.container=null);var i,o=h.getItemAt(n);if(o){Ce("gettingData",n,o),t.index=n;var a=(t.item=o).container=f.createEl("pswp__zoom-wrap");if(!o.src&&o.html&&(o.html.tagName?a.appendChild(o.html):a.innerHTML=o.html),Xt(o),Bt(o,de),!o.src||o.loadError||o.loaded)o.src&&!o.loadError&&((i=f.createEl("pswp__img","img")).style.opacity=1,i.src=o.src,Vt(o,i),Wt(0,o,a,i));else{if(o.loadComplete=function(e){if(s){if(t&&t.index===n){if(Xt(e,!0))return e.loadComplete=e.img=null,Bt(e,de),Ee(e),void(t.index===v&&h.updateCurrZoomItem());e.imageAppended?!Lt&&e.placeholder&&(e.placeholder.style.display="none",e.placeholder=null):z.transform&&(ne||Lt)?Ht.push({item:e,baseDiv:a,img:e.img,index:n,holder:t,clearPlaceholder:!0}):Wt(0,e,a,e.img,0,!0)}e.loadComplete=null,e.img=null,Ce("imageLoadComplete",n,e)}},f.features.transform){var r="pswp__img pswp__img--placeholder";r+=o.msrc?"":" pswp__img--placeholder--blank";var l=f.createEl(r,o.msrc?"img":"");o.msrc&&(l.src=o.msrc),Vt(o,l),a.appendChild(l),o.placeholder=l}o.loading||Gt(o),h.allowProgressiveImg()&&(!Pt&&z.transform?Ht.push({item:o,baseDiv:a,img:o.img,index:n,holder:t}):Wt(0,o,a,o.img,0,!0))}Pt||n!==v?Ee(o):(te=a.style,Nt(o,i||o.img)),t.el.innerHTML="",t.el.appendChild(a)}else t.el.innerHTML=""},cleanSlide:function(e){e.img&&(e.img.onload=e.img.onerror=null),e.loaded=e.loading=e.img=e.imageAppended=!1}}});var qt,$t,jt={},Jt=function(e,t,n){var i=document.createEvent("CustomEvent"),o={origEvent:e,target:e.target,releasePoint:t,pointerType:n||"touch"};i.initCustomEvent("pswpTap",!0,!0,o),e.target.dispatchEvent(i)};we("Tap",{publicMethods:{initTap:function(){De("firstTouchStart",h.onTapStart),De("touchRelease",h.onTapRelease),De("destroy",function(){jt={},qt=null})},onTapStart:function(e){1<e.length&&(clearTimeout(qt),qt=null)},onTapRelease:function(e,t){if(t&&!K&&!X&&!Ge){var n=t;if(qt&&(clearTimeout(qt),qt=null,i=n,o=jt,Math.abs(i.x-o.x)<25&&Math.abs(i.y-o.y)<25))return void Ce("doubleTap",n);if("mouse"===t.type)return void Jt(e,t,"mouse");if("BUTTON"===e.target.tagName.toUpperCase()||f.hasClass(e.target,"pswp__single-tap"))return void Jt(e,t);Ze(jt,n),qt=setTimeout(function(){Jt(e,t),qt=null},300)}var i,o}}}),we("DesktopZoom",{publicMethods:{initDesktopZoom:function(){L||(k?De("mouseUsed",function(){h.setupDesktopZoom()}):h.setupDesktopZoom(!0))},setupDesktopZoom:function(e){$t={};var t="wheel mousewheel DOMMouseScroll";De("bindEvents",function(){f.bind(m,t,h.handleMouseWheel)}),De("unbindEvents",function(){$t&&f.unbind(m,t,h.handleMouseWheel)}),h.mouseZoomedIn=!1;var n,i=function(){h.mouseZoomedIn&&(f.removeClass(m,"pswp--zoomed-in"),h.mouseZoomedIn=!1),x<1?f.addClass(m,"pswp--zoom-allowed"):f.removeClass(m,"pswp--zoom-allowed"),o()},o=function(){n&&(f.removeClass(m,"pswp--dragging"),n=!1)};De("resize",i),De("afterChange",i),De("pointerDown",function(){h.mouseZoomedIn&&(n=!0,f.addClass(m,"pswp--dragging"))}),De("pointerUp",o),e||i()},handleMouseWheel:function(e){if(x<=h.currItem.fitRatio)return y.modal&&(!y.closeOnScroll||Ge||G?e.preventDefault():E&&2<Math.abs(e.deltaY)&&(a=!0,h.close())),!0;if(e.stopPropagation(),$t.x=0,"deltaX"in e)1===e.deltaMode?($t.x=18*e.deltaX,$t.y=18*e.deltaY):($t.x=e.deltaX,$t.y=e.deltaY);else if("wheelDelta"in e)e.wheelDeltaX&&($t.x=-.16*e.wheelDeltaX),e.wheelDeltaY?$t.y=-.16*e.wheelDeltaY:$t.y=-.16*e.wheelDelta;else{if(!("detail"in e))return;$t.y=e.detail}_e(x,!0);var t=ce.x-$t.x,n=ce.y-$t.y;(y.modal||t<=ee.min.x&&t>=ee.max.x&&n<=ee.min.y&&n>=ee.max.y)&&e.preventDefault(),h.panTo(t,n)},toggleDesktopZoom:function(e){e=e||{x:de.x/2+me.x,y:de.y/2+me.y};var t=y.getDoubleTapZoom(!0,h.currItem),n=x===t;h.mouseZoomedIn=!n,h.zoomTo(n?h.currItem.initialZoomLevel:t,e,333),f[(n?"remove":"add")+"Class"](m,"pswp--zoomed-in")}}});var Qt,en,tn,nn,on,an,rn,ln,sn,un,cn,dn,pn={history:!0,galleryUID:1},mn=function(){return cn.hash.substring(1)},fn=function(){Qt&&clearTimeout(Qt),tn&&clearTimeout(tn)},hn=function(){var e=mn(),t={};if(e.length<5)return t;var n,i=e.split("&");for(n=0;n<i.length;n++)if(i[n]){var o=i[n].split("=");o.length<2||(t[o[0]]=o[1])}if(y.galleryPIDs){var a=t.pid;for(n=t.pid=0;n<Ft.length;n++)if(Ft[n].pid===a){t.pid=n;break}}else t.pid=parseInt(t.pid,10)-1;return t.pid<0&&(t.pid=0),t},yn=function e(){if(tn&&clearTimeout(tn),Ge||G)tn=setTimeout(e,500);else{nn?clearTimeout(en):nn=!0;var t=v+1,n=_t(v);n.hasOwnProperty("pid")&&(t=n.pid);var i=rn+"&gid="+y.galleryUID+"&pid="+t;ln||-1===cn.hash.indexOf(i)&&(un=!0);var o=cn.href.split("#")[0]+"#"+i;dn?"#"+i!==window.location.hash&&history[ln?"replaceState":"pushState"]("",document.title,o):ln?cn.replace(o):cn.hash=i,ln=!0,en=setTimeout(function(){nn=!1},60)}};we("History",{publicMethods:{initHistory:function(){if(f.extend(y,pn,!0),y.history){cn=window.location,ln=sn=un=!1,rn=mn(),dn="pushState"in history,-1<rn.indexOf("gid=")&&(rn=(rn=rn.split("&gid=")[0]).split("?gid=")[0]),De("afterChange",h.updateURL),De("unbindEvents",function(){f.unbind(window,"hashchange",h.onHashChange)});var e=function(){an=!0,sn||(un?history.back():rn?cn.hash=rn:dn?history.pushState("",document.title,cn.pathname+cn.search):cn.hash=""),fn()};De("unbindEvents",function(){a&&e()}),De("destroy",function(){an||e()}),De("firstUpdate",function(){v=hn().pid});var t=rn.indexOf("pid=");-1<t&&"&"===(rn=rn.substring(0,t)).slice(-1)&&(rn=rn.slice(0,-1)),setTimeout(function(){s&&f.bind(window,"hashchange",h.onHashChange)},40)}},onHashChange:function(){return mn()===rn?(sn=!0,void h.close()):void(nn||(on=!0,h.goTo(hn().pid),on=!1))},updateURL:function(){fn(),on||(ln?Qt=setTimeout(yn,800):yn())}}}),f.extend(h,$e)}});
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.PhotoSwipeUI_Default=t()}(void 0,function(){return function(r,s){var n,a,l,i,t,o,u,c,p,e,d,m,f,h,w,b,v,g,_=this,C=!1,T=!0,I=!0,E={barsSize:{top:44,bottom:"auto"},closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:4e3,timeToIdleOutside:1e3,loadingIndicatorDelay:1e3,addCaptionHTMLFn:function(e,t){return e.title?(t.children[0].innerHTML=e.title,!0):(t.children[0].innerHTML="",!1)},closeEl:!0,captionEl:!0,fullscreenEl:!0,zoomEl:!0,shareEl:!0,counterEl:!0,arrowEl:!0,preloaderEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,shareButtons:[{id:"facebook",label:"Share on Facebook",url:"https://www.facebook.com/sharer/sharer.php?u={{url}}"},{id:"twitter",label:"Tweet",url:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}"},{id:"pinterest",label:"Pin it",url:"http://www.pinterest.com/pin/create/button/?url={{url}}&media={{image_url}}&description={{text}}"},{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}],getImageURLForShare:function(){return r.currItem.src||""},getPageURLForShare:function(){return window.location.href},getTextForShare:function(){return r.currItem.title||""},indexIndicatorSep:" / ",fitControlsWidth:1200},F=function(e){if(b)return!0;e=e||window.event,w.timeToIdle&&w.mouseUsed&&!p&&z();for(var t,n,o=(e.target||e.srcElement).getAttribute("class")||"",r=0;r<P.length;r++)(t=P[r]).onTap&&-1<o.indexOf("pswp__"+t.name)&&(t.onTap(),n=!0);if(n){e.stopPropagation&&e.stopPropagation(),b=!0;var l=s.features.isOldAndroid?600:30;setTimeout(function(){b=!1},l)}},x=function(e,t,n){s[(n?"add":"remove")+"Class"](e,"pswp__"+t)},S=function(){var e=1===w.getNumItemsFn();e!==h&&(x(a,"ui--one-slide",e),h=e)},y=function(){x(u,"share-modal--hidden",I)},k=function(){return(I=!I)?(s.removeClass(u,"pswp__share-modal--fade-in"),setTimeout(function(){I&&y()},300)):(y(),setTimeout(function(){I||s.addClass(u,"pswp__share-modal--fade-in")},30)),I||L(),!1},K=function(e){var t=(e=e||window.event).target||e.srcElement;return r.shout("shareLinkClick",e,t),!(!t.href||!t.hasAttribute("download")&&(window.open(t.href,"pswp_share","scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,top=100,left="+(window.screen?Math.round(screen.width/2-275):100)),I||k(),1))},L=function(){for(var e,t,n,o,r="",l=0;l<w.shareButtons.length;l++)e=w.shareButtons[l],t=w.getImageURLForShare(e),n=w.getPageURLForShare(e),o=w.getTextForShare(e),r+='<a href="'+e.url.replace("{{url}}",encodeURIComponent(n)).replace("{{image_url}}",encodeURIComponent(t)).replace("{{raw_image_url}}",t).replace("{{text}}",encodeURIComponent(o))+'" target="_blank" class="pswp__share--'+e.id+'"'+(e.download?"download":"")+">"+e.label+"</a>",w.parseShareButtonOut&&(r=w.parseShareButtonOut(e,r));u.children[0].innerHTML=r,u.children[0].onclick=K},O=function(e){for(var t=0;t<w.closeElClasses.length;t++)if(s.hasClass(e,"pswp__"+w.closeElClasses[t]))return!0},R=0,z=function(){clearTimeout(g),R=0,p&&_.setIdle(!1)},M=function(e){var t=(e=e||window.event).relatedTarget||e.toElement;t&&"HTML"!==t.nodeName||(clearTimeout(g),g=setTimeout(function(){_.setIdle(!0)},w.timeToIdleOutside))},D=function(e){m!==e&&(x(d,"preloader--active",!e),m=e)},A=function(e){var t=e.vGap;if(!r.likelyTouchDevice||w.mouseUsed||screen.width>w.fitControlsWidth){var n=w.barsSize;if(w.captionEl&&"auto"===n.bottom)if(i||((i=s.createEl("pswp__caption pswp__caption--fake")).appendChild(s.createEl("pswp__caption__center")),a.insertBefore(i,l),s.addClass(a,"pswp__ui--fit")),w.addCaptionHTMLFn(e,i,!0)){var o=i.clientHeight;t.bottom=parseInt(o,10)||44}else t.bottom=n.top;else t.bottom="auto"===n.bottom?0:n.bottom;t.top=n.top}else t.top=t.bottom=0},P=[{name:"caption",option:"captionEl",onInit:function(e){l=e}},{name:"share-modal",option:"shareEl",onInit:function(e){u=e},onTap:function(){k()}},{name:"button--share",option:"shareEl",onInit:function(e){o=e},onTap:function(){k()}},{name:"button--zoom",option:"zoomEl",onTap:r.toggleDesktopZoom},{name:"counter",option:"counterEl",onInit:function(e){t=e}},{name:"button--close",option:"closeEl",onTap:r.close},{name:"button--arrow--left",option:"arrowEl",onTap:r.prev},{name:"button--arrow--right",option:"arrowEl",onTap:r.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){n.isFullscreen()?n.exit():n.enter()}},{name:"preloader",option:"preloaderEl",onInit:function(e){d=e}}];_.init=function(){var t;s.extend(r.options,E,!0),w=r.options,a=s.getChildByClass(r.scrollWrap,"pswp__ui"),(e=r.listen)("onVerticalDrag",function(e){T&&e<.95?_.hideControls():!T&&.95<=e&&_.showControls()}),e("onPinchClose",function(e){T&&e<.9?(_.hideControls(),t=!0):t&&!T&&.9<e&&_.showControls()}),e("zoomGestureEnded",function(){(t=!1)&&!T&&_.showControls()}),e("beforeChange",_.update),e("doubleTap",function(e){var t=r.currItem.initialZoomLevel;r.getZoomLevel()!==t?r.zoomTo(t,e,333):r.zoomTo(w.getDoubleTapZoom(!1,r.currItem),e,333)}),e("preventDragEvent",function(e,t,n){var o=e.target||e.srcElement;o&&o.getAttribute("class")&&-1<e.type.indexOf("mouse")&&(0<o.getAttribute("class").indexOf("__caption")||/(SMALL|STRONG|EM)/i.test(o.tagName))&&(n.prevent=!1)}),e("bindEvents",function(){s.bind(a,"pswpTap click",F),s.bind(r.scrollWrap,"pswpTap",_.onGlobalTap),r.likelyTouchDevice||s.bind(r.scrollWrap,"mouseover",_.onMouseOver)}),e("unbindEvents",function(){I||k(),v&&clearInterval(v),s.unbind(document,"mouseout",M),s.unbind(document,"mousemove",z),s.unbind(a,"pswpTap click",F),s.unbind(r.scrollWrap,"pswpTap",_.onGlobalTap),s.unbind(r.scrollWrap,"mouseover",_.onMouseOver),n&&(s.unbind(document,n.eventK,_.updateFullscreen),n.isFullscreen()&&(w.hideAnimationDuration=0,n.exit()),n=null)}),e("destroy",function(){w.captionEl&&(i&&a.removeChild(i),s.removeClass(l,"pswp__caption--empty")),u&&(u.children[0].onclick=null),s.removeClass(a,"pswp__ui--over-close"),s.addClass(a,"pswp__ui--hidden"),_.setIdle(!1)}),w.showAnimationDuration||s.removeClass(a,"pswp__ui--hidden"),e("initialZoomIn",function(){w.showAnimationDuration&&s.removeClass(a,"pswp__ui--hidden")}),e("initialZoomOut",function(){s.addClass(a,"pswp__ui--hidden")}),e("parseVerticalMargin",A),function(){var r,l,i,e=function(e){if(e)for(var t=e.length,n=0;n<t;n++){r=e[n],l=r.className;for(var o=0;o<P.length;o++)i=P[o],-1<l.indexOf("pswp__"+i.name)&&(w[i.option]?(s.removeClass(r,"pswp__element--disabled"),i.onInit&&i.onInit(r)):s.addClass(r,"pswp__element--disabled"))}};e(a.children);var t=s.getChildByClass(a,"pswp__top-bar");t&&e(t.children)}(),w.shareEl&&o&&u&&(I=!0),S(),w.timeToIdle&&e("mouseUsed",function(){s.bind(document,"mousemove",z),s.bind(document,"mouseout",M),v=setInterval(function(){2==++R&&_.setIdle(!0)},w.timeToIdle/2)}),w.fullscreenEl&&!s.features.isOldAndroid&&(n||(n=_.getFullscreenAPI()),n?(s.bind(document,n.eventK,_.updateFullscreen),_.updateFullscreen(),s.addClass(r.template,"pswp--supports-fs")):s.removeClass(r.template,"pswp--supports-fs")),w.preloaderEl&&(D(!0),e("beforeChange",function(){clearTimeout(f),f=setTimeout(function(){r.currItem&&r.currItem.loading?(!r.allowProgressiveImg()||r.currItem.img&&!r.currItem.img.naturalWidth)&&D(!1):D(!0)},w.loadingIndicatorDelay)}),e("imageLoadComplete",function(e,t){r.currItem===t&&D(!0)}))},_.setIdle=function(e){x(a,"ui--idle",p=e)},_.update=function(){T&&r.currItem?(_.updateIndexIndicator(),w.captionEl&&(w.addCaptionHTMLFn(r.currItem,l),x(l,"caption--empty",!r.currItem.title)),C=!0):C=!1,I||k(),S()},_.updateFullscreen=function(e){e&&setTimeout(function(){r.setScrollOffset(0,s.getScrollY())},50),s[(n.isFullscreen()?"add":"remove")+"Class"](r.template,"pswp--fs")},_.updateIndexIndicator=function(){w.counterEl&&(t.innerHTML=r.getCurrentIndex()+1+w.indexIndicatorSep+w.getNumItemsFn())},_.onGlobalTap=function(e){var t=(e=e||window.event).target||e.srcElement;if(!b)if(e.detail&&"mouse"===e.detail.pointerType){if(O(t))return void r.close();s.hasClass(t,"pswp__img")&&(1===r.getZoomLevel()&&r.getZoomLevel()<=r.currItem.fitRatio?w.clickToCloseNonZoomable&&r.close():r.toggleDesktopZoom(e.detail.releasePoint))}else if(w.tapToToggleControls&&(T?_.hideControls():_.showControls()),w.tapToClose&&(s.hasClass(t,"pswp__img")||O(t)))return void r.close()},_.onMouseOver=function(e){var t=(e=e||window.event).target||e.srcElement;x(a,"ui--over-close",O(t))},_.hideControls=function(){s.addClass(a,"pswp__ui--hidden"),T=!1},_.showControls=function(){T=!0,C||_.update(),s.removeClass(a,"pswp__ui--hidden")},_.supportsFullscreen=function(){var e=document;return!!(e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen)},_.getFullscreenAPI=function(){var e,t=document.documentElement,n="fullscreenchange";return t.requestFullscreen?e={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:n}:t.mozRequestFullScreen?e={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+n}:t.webkitRequestFullscreen?e={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+n}:t.msRequestFullscreen&&(e={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),e&&(e.enter=function(){return c=w.closeOnScroll,w.closeOnScroll=!1,"webkitRequestFullscreen"!==this.enterK?r.template[this.enterK]():void r.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT)},e.exit=function(){return w.closeOnScroll=c,document[this.exitK]()},e.isFullscreen=function(){return document[this.elementK]}),e}}});
"use strict";!function(){function e(t){return this.promise=new Promise(t),this.promise.success=function(t){return this.then(t),this},this.promise.error=function(t){return this.then(null,t),this},this.promise}function o(){}console.log("httpClient is loading"),o.get=function(t,e){return o.request("GET",t,void 0,e)},o.post=function(t,e,n){return o.request("POST",t,e)},o.put=function(t,e,n){return o.request("PUT",t,e)},o.jsonp=function(t,e,n){var o={url:t,data:e,config:n};throw new Error("jsonp not ready, req: "+JSON.stringify(o))},o.request=function(o,r,s,t){return console.log("httpClient create request for url: ",r," using method: ",o),new e(function(e,t){var n=new XMLHttpRequest;n.onload=function(){console.log("httpClient read response for url: ",r," using method: ",o);n.status,n.statusText;var t="response"in n?n.response:n.responseText;e(t?JSON.parse(t):null)},n.onerror=function(){console.log("httpClient failed for url: ",r," using method: ",o),t(new TypeError("Network request failed"))},n.ontimeout=function(){console.log("httpClient timed out for url: ",r," using method: ",o),t(new TypeError("Network request failed"))},console.log("httpClient requesting for url: ",r," using method: ",o),n.open(o,r,!0),n.send(s)})},window.httpClient=o}();
"use strict";var bfUtils={get deviceOnline(){return"undefined"==typeof navigator||(navigator.connection&&navigator.connection.type?"none"!=navigator.connection.type:void 0===navigator.onLine||navigator.onLine)},get isMobileDevice(){return window.location.protocol.indexOf("http")<0},get isAndroid(){return window.location.protocol.indexOf("http")<0&&"undefined"!=typeof device&&"Android"==device.platform},get isIOS(){return window.location.protocol.indexOf("http")<0&&"undefined"!=typeof device&&"iOS"==device.platform},get isPwaAndroid(){return!!navigator.userAgent.match(/Android/i)},get isPwaiOS(){return"standalone"in window.navigator&&!window.navigator.standalone},get isAppHtml5Version(){return window.self==window.top},get isEmulatorCP(){return window.top&&window.top!=window&&0==window.location.protocol.indexOf("http")},tryParseJSON:function(n){try{return JSON.parse(n)}catch(t){return void console.error("Cannot parse data :: "+n,t.message,t.stack)}},get http(){return window.$http?window.$http:window.httpClient}};
"use strict";var userTags={get isUserTaggingEnabled(){return window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&window.appContext.currentApp.config.userTagging&&"hidden"!=window.appContext.currentApp.config.userTagging&&"disabled"!=window.appContext.currentApp.config.userTagging},init:function(){setTimeout(function(){userTags.isUserTaggingEnabled&&userTags.refreshUserTags()},1e3)},refreshUserTags:function(){authAPI.getCurrentUser(function(e,n){if(e)return console.error(e),void callback(e,null);if(n){var r={skip:0,limit:1,name:[]};r.name.push(n.email),bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/userSearch/"+window.appContext.currentApp.appId+"/",r).success(function(e){e.users[0]&&(n.tags=e.users[0].tags,authAPI._setCurrentUser(n))}).error(function(e){console.error(e)})}})},checkPluginAccessSettings:function(e,a){var u=e.accessSettings;!bfUtils.isEmulatorCP&&e.requiresLogin?authAPI.getCurrentUser(function(e,n){if(e)return console.error(e),void a(e,null);if(n){if(!userTags.isUserTaggingEnabled||"enabled"!=window.appContext.currentApp.config.advancedPluginAccessSettings)return void a(null,!0);if(!u)return void a(null,!0);if(!u.requiresTags)return void a(null,!0);if(!u.requiredTags||0==u.requiredTags.length)return void a(null,!0);if(u.giveAccessWhen)if(n.tags&&n.tags[window.appContext.currentApp.appId]&&0<n.tags[window.appContext.currentApp.appId].length){var r=n.tags[window.appContext.currentApp.appId];if("matchAllTags"==u.giveAccessWhen){for(var i=0;i<u.requiredTags.length;i++){for(var t=!1,s=0;s<r.length;s++)if(r[s].tagName==u.requiredTags[i].name&&u.requiredTags[i].appliedCount<=r[s].appliedCount){t=!0;break}if(!t)return void a(null,!1)}a(null,!0)}else{for(i=0;i<u.requiredTags.length;i++)for(s=0;s<r.length;s++)if(r[s].tagName==u.requiredTags[i].name&&u.requiredTags[i].appliedCount<=r[s].appliedCount)return void a(null,!0);a(null,!1)}}else a(null,!1);else a(null,!1)}else a(null,!1)}):a(null,!0)},setBehavioralTags:function(r){bfUtils.isMobileDevice&&bfUtils.deviceOnline&&userTags.isUserTaggingEnabled&&authAPI.getCurrentUser(null,function(e,n){e?console.log(e):n&&bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/app/"+window.appContext.currentApp.appId+"/user/assignBehavioralTag",{instanceId:r,userToken:n.userToken}).success(function(e){}).error(function(e){console.log(e)})})}};userTags.init();
"use strict";function RemoteDatastore(t,e,r,i,s){this.appId=t,this.pluginId=e,this.instanceId=r,this.liveMode=i,this.dataStoreUrl=s}RemoteDatastore.prototype={createReadUrl:function(t,e,r){var i=this.dataStoreUrl+"/plugin/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"+this.liveMode+"/"+e;return r&&(i+="?withDynamicData=true"),i},createSearchUrl:function(t){return this.dataStoreUrl+"/plugin/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"+this.liveMode+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/plugin/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"},createCloneUrl:function(t){return this.dataStoreUrl+"/app/"+this.appId+"/plugin/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/clone/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/plugin/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/plugin/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/plugin/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/plugin/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"},createPublishUrl:function(){return this.dataStoreUrl+"/publish/"+this.appId},createServicesUrl:function(){return this.dataStoreUrl+"/app/"+this.appId+"/services/"+this.liveMode},createDeletePluginInstanceUrl:function(t){return this.dataStoreUrl+"/plugin/deletePluginInstance/"+this.appId+"/"+t},resolveTag:function(t){return null==t||null==t||""==t?"primary":t},_httpGet:function(t,e,n){"function"!=typeof e||n||(n=e,e=this),bfUtils.http?bfUtils.http.get(t).success(function(t){n.apply(e,[null,t])}).error(function(t,e,r,i){var s="datastore GET Error with URL: "+i.url;n(s),console.error("datastore GET Error: "+i.url,e)}):n("datastore GET Error:bfUtils.http is undefined. Try again later.")},_httpPost:function(t,e,n){bfUtils.http.post(t,e).success(function(t){n(null,t)}).error(function(t,e,r,i){var s="datastore POST Error with URL: "+i.url;n(s),console.error("datastore POST Result: ",e,i.url)})},_httpPut:function(t,e,n){bfUtils.http.put(t,e).success(function(t){n(null,t)}).error(function(t,e,r,i){var s="datastore PUT Error with URL: "+i.url;n(s),console.error("datastore PUT Result: ",e,i.url)})},get:function(t,e,r,i,s){return this._httpGet(this.createReadUrl(e,t,i),r,s),this},save:function(t,e,r){return this._httpPost(this.createSaveUrl(t),e,r),this},insert:function(t,e,r){return this._httpPost(this.createWriteUrl(t),e,r),this},clone:function(t,e,r){return this._httpPost(this.createCloneUrl(t),e,r),this},bulkInsert:function(t,e,r){return this._httpPost(this.createBulkInsertUrl(t),e,r),this},update:function(t,e,r){return this._httpPut(this.createWriteUrl(t),e,r),this},searchAndUpdate:function(t,e,r){return this._httpPost(this.createSearchAndUpdateUrl(t),e,r),this},delete:function(t,e,r,i){return this._httpPost(this.createDeleteUrl(t,e),r,i),this},search:function(t,e,r,i){return this._httpPost(this.createSearchUrl(t),r,i),this},publish:function(t,e){return this._httpPost(this.createPublishUrl(),t,e),this},getServices:function(t,e){return this._httpGet(this.createServicesUrl(),t,e),this},deletePluginInstance:function(t,e,r){return this._httpPost(this.createDeletePluginInstanceUrl(t),e,r),this}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function DatastoreAPI(t,e,n,i,r){if(window.appContext&&window.appContext.currentApp||console.warn("invalid appContext in datastore"),this.enableCache=window.location.protocol.indexOf("http")<0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,this._featureSecurityAccess=void 0,window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&(void 0===window.appContext.currentApp.config.featureSecurityAccess?"enterprise"==window.appContext.currentApp.config.type&&(this._featureSecurityAccess="enabled"):this._featureSecurityAccess=window.appContext.currentApp.config.featureSecurityAccess),"object"==(void 0===t?"undefined":_typeof(t))){var o=t;this.appId=o.appId,this.pluginId=o.pluginId,this.instanceId=o.instanceId,this.liveMode=o.liveMode,this.writeKey=o.writeKey||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null)}else this.appId=t,this.pluginId=e,this.instanceId=n,this.liveMode=i,r?this.writeKey=r:window.appContext.currentApp&&window.appContext.currentApp.keys&&window.appContext.currentApp.keys.datastoreKey?this.writeKey=window.appContext.currentApp.keys.datastoreKey:window.appContext.currentApp&&window.appContext.currentApp.datastoreWriteKey?this.writeKey=window.appContext.currentApp.datastoreWriteKey:this.writeKey=null;if("undefined"==typeof CustomEvent&&console.warn("Browser doesn't support CustomEvent"),"undefined"==typeof RemoteDatastore&&document.querySelector('script[src="scripts/overrides.js"]'))throw console.error("SDK is outdated. Please update to the most recent version."),"SDK is outdated. Please update to the most recent version.";var s=new RemoteDatastore(this.appId,this.pluginId,this.instanceId,this.liveMode,this.dataStoreUrl);this.enableCache&&"undefined"!=typeof OfflineDatastore?this._provider=new OfflineDatastore(this.appId,this.pluginId,this.instanceId,this.liveMode,s):this._provider=s}DatastoreAPI.prototype={deviceOnline:function(){return"undefined"==typeof navigator||!navigator.connection||!navigator.connection.type||"none"!=navigator.connection.type},onUpdate:function(t){},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t)},onRefresh:function(t){document.addEventListener("datastoreOnRefresh",t,!1)},triggerOnRefresh:function(t){var e=new CustomEvent("datastoreOnRefresh",{detail:t});document.dispatchEvent(e)},onDisableRefresh:function(t){document.addEventListener("datastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("datastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||null==t||""==t?"primary":t},get:function(t,r){if("function"==typeof r){var e,o=this,n="",s=!1;"object"==(void 0===t?"undefined":_typeof(t))?(e="string"==typeof t.tag?t.tag:"",n="string"==typeof t.id?t.id:"",s=t.withDynamicData):"string"==typeof t?e=t:null!=e&&null!=e||(e=""),"string"!=typeof e&&(e="");Date.now();return this._provider.get(n,e,{ds:this,obj:t},s,function(t,n){if(404==t)r(null,null);else if(t)r(t);else if(null==n)r(null,null);else{var i=n.tag;n.tag=e,s&&n&&n.data&&n.data._buildfire?o._dynamicDataSecurityFilter(n.data._buildfire,function(t,e){n.data._buildfire=e,r(null,n),n.tag=i}):(r(null,n),n.tag=i)}}),this}},save:function(n,i){if(window.toast&&window.toast("saving..."),this.writeKey){var r=n.tag,t=n.obj;"object"==(void 0===t?"undefined":_typeof(t))&&(t=this._cleanUp(t),t="undefined"!=typeof angular?angular.toJson({data:t,writeKey:this.writeKey,id:n.id}):JSON.stringify({data:t,writeKey:this.writeKey,id:n.id}));var o=this;return this._provider.save(r,t,function(t){if(404==t)window.toast&&window.toast("404","danger"),i(null,null);else if(t)window.toast&&window.toast("error saving","danger"),i(t);else{var e={id:n.id,data:n.obj,tag:r};i(null,e),o.triggerOnUpdate(e)}}),this}console.error("no write key has been provided")},insert:function(i,r){var o=i.tag,t=i.obj,e=i.checkDuplicate;"object"==(void 0===t?"undefined":_typeof(t))&&(t={data:t=this._cleanUp(t),writeKey:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var s=this;return this._provider.insert(o,t,function(t,e){if(404==t)r(null,null);else if(t)r(t);else{i.id=e.id;var n={id:e.id,data:i.obj,tag:o};r(null,n),s.triggerOnUpdate(n)}}),this},clone:function(i,r){var o=i.tag,t=i.obj,e=i.checkDuplicate;"object"==(void 0===t?"undefined":_typeof(t))&&(t={data:t=this._cleanUp(t),writeKey:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var s=this;return this._provider.clone(o,t,function(t,e){if(404==t)r(null,null);else if(t)r(t);else{i.id=e.id;var n={id:e.id,data:i.obj,tag:o};r(null,n),s.triggerOnUpdate(n)}}),this},bulkInsert:function(i,r){var o=i.tag,t=i.obj;"object"==(void 0===t?"undefined":_typeof(t))&&(t=this._cleanUp(t),t=JSON.stringify({data:t,writeKey:this.writeKey,checkDuplicate:!1}));var s=this;return this._provider.bulkInsert(o,t,function(t,e){if(404==t)r(null,null);else if(t)r(t);else{var n={data:i.obj,tag:o};r(null,n),s.triggerOnUpdate(n)}}),this},update:function(n,i){window.toast&&window.toast("saving...");var t=n.tag,e=n.obj;"object"==(void 0===e?"undefined":_typeof(e))&&(e=this._cleanUp(e),e=JSON.stringify({id:n.id,data:e,writeKey:this.writeKey}));var r=this;return this._provider.update(t,e,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(e.record.tag=n.tag,i(null,e.record),r.triggerOnUpdate(e.record))}),this},searchAndUpdate:function(t,n){window.toast&&window.toast("saving...");var e=t.tag,i=t.obj;"object"==(void 0===i?"undefined":_typeof(i))&&(i=this._cleanUp(i),i=JSON.stringify({search:t.search,data:i,writeKey:this.writeKey}));var r=this;return this._provider.searchAndUpdate(e,i,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(n(null,e),r.triggerOnUpdate(e))}),this},delete:function(n,i){var t=n.tag,e=JSON.stringify({writeKey:this.writeKey}),r=this;return this._provider.delete(t,n.id,e,function(t,e){404==t?i(null,null):t?i(t):(i(null,e),r.triggerOnUpdate(n))}),this},deletePluginInstance:function(n,i){var t=JSON.stringify({writeKey:this.writeKey}),r=this;return this._provider.deletePluginInstance(n.id,t,function(t,e){404==t?i(null,null):t?i(t):(i(null,e),r.triggerOnUpdate(n))}),this},search:function(t,n){var i=this,e=t.tag,r=t.obj;if("function"==typeof n)return"string"!=typeof e&&(e=""),"object"==(void 0===r?"undefined":_typeof(r))&&(r=JSON.stringify(r)),this._provider.search(e,t.obj,r,function(t,e){404==t?n(null,null):t?n(t):null==e?n(null,null):"string"==typeof e?n(null,bfUtils.tryParseJSON(e)):("pluginInstances"===i.pluginId&&"undefined"!=typeof userTags&&userTags.checkPluginAccessSettings&&e.result&&i._pluginInstancesSecurityFilter(e.result),n(null,e))}),this},publish:function(n){var t=JSON.stringify({publishKey:this.publishKey}),i=this;return this._provider.publish(t,function(t,e){404==t?n(null,null):t?n(t):(n(null,bfUtils.tryParseJSON(e)),i.triggerOnUpdate(obj))}),this},getServices:function(t,n){return this._provider.getServices(t,function(t,e){404==t?n(null,null):t?n(t):n(null,e)}),this},_cleanUp:function(t){if(t){var e=JSON.parse(JSON.stringify(t));return this._cleanUpTree(e),e}return t},_cleanUpTree:function(t){for(var e in t){var n=t[e];"_buildfire"==e&&n?(delete n.result,delete n.err):null!==n&&"object"==(void 0===n?"undefined":_typeof(n))&&this._cleanUpTree(t[e])}},_dynamicDataSecurityFilter:function(t,e){if("undefined"!=typeof userTags&&userTags.checkPluginAccessSettings)for(var n in t)if(n){var i=t[n];i&&i.result&&this._pluginInstancesSecurityFilter(i.result)}e(null,t)},_pluginInstancesSecurityFilter:function(t){var e=this;t&&t.forEach(function(n){n&&n.data&&(n.hasAccess=!0,"enabled"===e._featureSecurityAccess&&userTags.checkPluginAccessSettings(n.data,function(t,e){n.hasAccess=e}))})}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function UserDatastoreAPI(t,e,r,i,n){if(window.appContext&&window.appContext.currentApp){if(this.enableCache=!1,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,"object"==(void 0===t?"undefined":_typeof(t))){var s=t;this.appId=s.appId,this.pluginId=s.pluginId,this.instanceId=s.instanceId,this.isAppUser="control"!=s.type,this.isAppUser?this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null:this.writeKey=s.writeKey||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null)}else this.appId=t,this.pluginId=e,this.instanceId=r,this.isAppUser=i,this.isAppUser?this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null:this.writeKey=n||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null);"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")}else console.error("invalid appCOntext in userstore")}UserDatastoreAPI.prototype={onUpdate:function(t){},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t)},onRefresh:function(t){document.addEventListener("userDataOnRefresh",t,!1)},triggerOnRefresh:function(t){var e=new CustomEvent("userDataOnRefresh",{detail:t});document.dispatchEvent(e)},onDisableRefresh:function(t){document.addEventListener("userDatastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("userDatastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||null==t||""==t?"primary":t},createReadUrl:function(t,e,r){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"+e+"/"+r},createSearchUrl:function(t){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"},createWriteUrl:function(t,e){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"+e+"/"},createSearchAndUpdateUrl:function(t,e){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"+e+"/"},createDeleteUrl:function(t,e,r){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"+r+"/"+e},createSaveUrl:function(t,e){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"+e+"/"},createBulkInsertUrl:function(t,e){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"+e+"/"},_httpGet:function(r,i,n){"function"!=typeof i||n||(n=i,i=this),bfUtils.http.get(r).success(function(t){n.apply(i,[null,t])}).error(function(t,e){t=t||"http error with status: "+e,n.apply(i,[t]),console.error("user datastore GET Error: ",r,t)})},_httpPost:function(r,t,i){bfUtils.http.post(r,t).success(function(t){i(null,t)}).error(function(t,e){i(t=t||"http error with status: "+e),console.error("user datastore POST Result: ",r,t)})},_httpPut:function(r,t,i){bfUtils.http.put(r,t).success(function(t){i(null,t)}).error(function(t,e){i(t=t||"http error with status: "+e),console.error("user datastore PUT Result: ",r,t)})},get:function(t,n){if(console.log("user datastore: get "+JSON.stringify(t)),"function"==typeof n){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void n("no logged in user found",null);var e,r="";"object"==(void 0===t?"undefined":_typeof(t))?(e="string"==typeof t.tag?t.tag:"",r="string"==typeof t.id?t.id:""):"string"==typeof t?e=t:null!=e&&null!=e||(e=""),"string"!=typeof e&&(e="");var s=!1,o=null;try{if(this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),o=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(e),t.id))){console.log("data cache: found cache");var i=o;i.tag=t.tag,i.obj=t.obj,n(null,i),s=!0}}catch(t){console.error("dataDump error: "+t)}var a=Date.now();return this._httpGet(this.createReadUrl(e,this.writeKey,r,!1),{ds:this,isCallBackDone:s,obj:t,userDataDumpAPI:window.userDataDumpAPI},function(t,e){var r=this,i=Date.now()-a;if(console.log("user datastore: response time "+i),t)r.isCallBackDone||n(t);else if(404==t)r.isCallBackDone||n(null,null);else try{null==e?r.isCallBackDone||n(null,null):(r.ds.enableCache&&void 0!==r.userDataDumpAPI&&r.userDataDumpAPI.setData(r.ds.appId,r.ds.pluginId,r.ds.instanceId,r.ds.resolveTag(r.obj.tag),r.obj.id,e),e.tag=r.obj.tag,r.isCallBackDone?o&&o.lastUpdated!=e.lastUpdated&&(console.log("data cache: send updated object onUpdate"),r.ds.triggerOnUpdate(e)):n(null,e))}catch(t){s||n(t)}}),this}},save:function(i,n){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(n&&n("no logged in user found",null));var s=i.tag,t=i.obj,e=i.userToken?i.userToken:this.writeKey;"object"==(void 0===t?"undefined":_typeof(t))&&(t="undefined"!=typeof angular?this.isAppUser?angular.toJson({data:t,userToken:this.writeKey,id:i.id}):angular.toJson({data:t,writeKey:this.writeKey,id:i.id}):this.isAppUser?JSON.stringify({data:t,userToken:this.writeKey,id:i.id}):JSON.stringify({data:t,writeKey:this.writeKey,id:i.id}));var o=this;return this._httpPost(this.createSaveUrl(s,e),t,function(t,e){if(404==t)window.toast&&window.toast("404","danger"),n(null,null);else if(t)window.toast&&window.toast("error saving","danger"),n(t);else{var r={id:i.id,data:i.obj,tag:s};n(null,r),o.triggerOnUpdate(r)}}),this},insert:function(i,n){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(n&&n("no logged in user found",null));var s=i.tag,t=i.obj,e=i.checkDuplicate,r=i.userToken?i.userToken:this.writeKey;"object"==(void 0===t?"undefined":_typeof(t))&&(t=this.isAppUser?{data:t,userToken:this.writeKey}:{data:t,writeKey:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var o=this;return this._httpPost(this.createWriteUrl(s,r),t,function(t,e){if(404==t)n(null,null);else if(t)n(t);else{i.id=e.id;var r={id:e.id,data:i.obj,tag:s};n(null,r),o.triggerOnUpdate(r)}}),this},bulkInsert:function(i,n){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(n&&n("no logged in user found",null));var s=i.tag,t=i.obj,e=i.userToken?i.userToken:this.writeKey;"object"==(void 0===t?"undefined":_typeof(t))&&(t=this.isAppUser?JSON.stringify({data:t,userToken:this.writeKey,checkDuplicate:!1}):JSON.stringify({data:t,writeKey:this.writeKey,checkDuplicate:!1}));var o=this;return this._httpPost(this.createBulkInsertUrl(s,e),t,function(t,e){if(404==t)n(null,null);else if(t)n(t);else{var r={data:i.obj,tag:s};n(null,r),o.triggerOnUpdate(r)}}),this},update:function(r,i){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var t=r.tag,e=r.obj,n=r.userToken;"object"==(void 0===e?"undefined":_typeof(e))&&(e=this.isAppUser?JSON.stringify({id:r.id,data:e,userToken:this.writeKey}):JSON.stringify({id:r.id,data:e,writeKey:this.writeKey}));var s=this;return this._httpPut(this.createWriteUrl(t,n),e,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(e.record.tag=r.tag,i(null,e.record),s.triggerOnUpdate(e.record))}),this},searchAndUpdate:function(t,r){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var e=t.tag,i=t.obj,n=t.userToken;"object"==(void 0===i?"undefined":_typeof(i))&&(i=this.isAppUser?JSON.stringify({search:t.search,data:i,userToken:this.writeKey}):JSON.stringify({search:t.search,data:i,writeKey:this.writeKey}));var s=this;return this._httpPost(this.createSearchAndUpdateUrl(e,n),i,function(t,e){404==t?(window.toast&&window.toast("404"),r(null,null)):t?(window.toast&&window.toast("error updating"),r(t)):(r(null,e),s.triggerOnUpdate(e))}),this},delete:function(r,i){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var t=r.tag,e=r.userToken,n={};n=this.isAppUser?JSON.stringify({userToken:this.writeKey}):JSON.stringify({writeKey:this.writeKey});var s=this;return this._httpPost(this.createDeleteUrl(t,r.id,e),n,function(t,e){404==t?i(null,null):t?i(t):(i(null,e),s.triggerOnUpdate(r))}),this},search:function(t,r){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var e=t.tag,i=t.obj;return"function"==typeof r?("string"!=typeof e&&(e=""),"string"==typeof i&&(i=JSON.parse(i)),this.isAppUser?i.userToken=this.writeKey:i.writeKey=this.writeKey,"object"==(void 0===i?"undefined":_typeof(i))&&(i=JSON.stringify(i)),this._httpPost(this.createSearchUrl(e),i,function(t,e){404==t?r(null,null):t?r(t):r(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this):void 0},dataDump:function(r){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var i=this;return this._httpget(this.createDataDumpUrl(),function(t,e){404==t?r(null,null):t?r(t):(r(null,bfUtils.tryParseJSON(e)),i.triggerOnUpdate(obj))}),this}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function PublicDatastoreAPI(t,e,i){if(window.appContext&&window.appContext.currentApp){if(this.enableCache=!0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,"object"==(void 0===t?"undefined":_typeof(t))){var n=t;this.appId=n.appId,this.pluginId=n.pluginId,this.instanceId=n.instanceId,this.writeKey="public"}else this.appId=t,this.pluginId=e,this.instanceId=i,this.writeKey="public";"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")}else console.error("invalid appCOntext in publicdata")}PublicDatastoreAPI.prototype={onUpdate:function(t){document.addEventListener("publicDataOnUpdate",t,!1)},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t);var e=new CustomEvent("publicDataOnUpdate",{detail:t});document.dispatchEvent(e)},onRefresh:function(t){document.addEventListener("publicDataOnRefresh",t,!1)},triggerOnRefresh:function(t){var e=new CustomEvent("publicDataOnRefresh",{detail:t});document.dispatchEvent(e)},onDisableRefresh:function(t){document.addEventListener("publicDatastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("publicDatastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||null==t||""==t?"primary":t},createReadUrl:function(t,e){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/public/"+e},createSearchUrl:function(t){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/public/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/public/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/public/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/public/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+this.resolveTag(t)+"/public/"},_httpGet:function(e,i,n){"function"!=typeof i||n||(n=i,i=this),bfUtils.http.get(e).success(function(t){n.apply(i,[null,t])}).error(function(t){n.apply(i,[t]),console.error("public datastore GET Error: ",e,t)})},_httpPost:function(e,t,i){bfUtils.http.post(e,t).success(function(t){i(null,t)}).error(function(t){i(t),console.error("public datastore POST Result: ",e,t)})},_httpPut:function(e,t,i){bfUtils.http.put(e,t).success(function(t){i(null,t)}).error(function(t){i(t),console.error("public datastore PUT Result: ",e,t)})},get:function(t,r){if(console.log("public datastore: get "+JSON.stringify(t)),"function"==typeof r){if(this.writeKey){var e,i="";"object"==(void 0===t?"undefined":_typeof(t))?(e="string"==typeof t.tag?t.tag:"",i="string"==typeof t.id?t.id:""):"string"==typeof t?e=t:null!=e&&null!=e||(e=""),"string"!=typeof e&&(e="");var o=!1,s=null;try{if(this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),s=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(e),t.id))){console.log("data cache: found cache");var n=s;n.tag=t.tag,n.obj=t.obj,r(null,n),o=!0}}catch(t){console.error("dataDump error: "+t)}var a=Date.now();return this._httpGet(this.createReadUrl(e,i,!1),{ds:this,isCallBackDone:o,obj:t,userDataDumpAPI:window.userDataDumpAPI},function(t,e){var i=this,n=Date.now()-a;if(console.log("public datastore: response time "+n),t)i.isCallBackDone||r(t);else if(404==t)i.isCallBackDone||r(null,null);else try{null==e?i.isCallBackDone||r(null,null):(i.ds.enableCache&&void 0!==i.userDataDumpAPI&&i.userDataDumpAPI.setData(i.ds.appId,i.ds.pluginId,i.ds.instanceId,i.ds.resolveTag(i.obj.tag),i.obj.id,e),e.tag=i.obj.tag,i.isCallBackDone?s&&s.lastUpdated!=e.lastUpdated&&(console.log("data cache: send updated object onUpdate"),i.ds.triggerOnUpdate(e)):r(null,e))}catch(t){o||r(t)}}),this}console.error("no write key has been provided")}},save:function(n,r){if(window.toast&&window.toast("saving..."),this.writeKey){var o=n.tag,t=n.obj;"object"==(void 0===t?"undefined":_typeof(t))&&(t="undefined"!=typeof angular?angular.toJson({data:t,userToken:this.writeKey,id:n.id}):JSON.stringify({data:t,userToken:this.writeKey,id:n.id}));var s=this;return this._httpPost(this.createSaveUrl(o),t,function(t,e){if(404==t)window.toast&&window.toast("404","danger"),r(null,null);else if(t)window.toast&&window.toast("error saving","danger"),r(t);else{var i={id:n.id,data:n.obj,tag:o};r(null,i),s.triggerOnUpdate(i)}}),this}console.error("no write key has been provided")},insert:function(n,r){if(this.writeKey){var o=n.tag,t=n.obj,e=n.checkDuplicate;"object"==(void 0===t?"undefined":_typeof(t))&&(t={data:t,userToken:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var s=this;return this._httpPost(this.createWriteUrl(o),t,function(t,e){if(404==t)r(null,null);else if(t)r(t);else{n.id=e.id;var i={id:e.id,data:n.obj,tag:o};r(null,i),s.triggerOnUpdate(i)}}),this}console.error("no write key has been provided")},bulkInsert:function(n,r){if(this.writeKey){var o=n.tag,t=n.obj;"object"==(void 0===t?"undefined":_typeof(t))&&(t=JSON.stringify({data:t,userToken:this.writeKey,checkDuplicate:!1}));var s=this;return this._httpPost(this.createBulkInsertUrl(o),t,function(t,e){if(404==t)r(null,null);else if(t)r(t);else{var i={data:n.obj,tag:o};r(null,i),s.triggerOnUpdate(i)}}),this}console.error("no write key has been provided")},update:function(i,n){if(window.toast&&window.toast("saving..."),this.writeKey){var t=i.tag,e=i.obj;"object"==(void 0===e?"undefined":_typeof(e))&&(e=JSON.stringify({id:i.id,data:e,userToken:this.writeKey}));var r=this;return this._httpPut(this.createWriteUrl(t),e,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(e.record.tag=i.tag,n(null,e.record),r.triggerOnUpdate(e.record))}),this}console.error("no write key has been provided")},searchAndUpdate:function(t,i){if(window.toast&&window.toast("saving..."),this.writeKey){var e=t.tag,n=t.obj;"object"==(void 0===n?"undefined":_typeof(n))&&(n=JSON.stringify({search:t.search,data:n,userToken:this.writeKey}));var r=this;return this._httpPost(this.createSearchAndUpdateUrl(e),n,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(i(null,e),r.triggerOnUpdate(e))}),this}console.error("no write key has been provided")},delete:function(i,n){if(this.writeKey){var t=i.tag,e=JSON.stringify({userToken:this.writeKey}),r=this;return this._httpPost(this.createDeleteUrl(t,i.id),e,function(t,e){404==t?n(null,null):t?n(t):(n(null,e),r.triggerOnUpdate(i))}),this}console.error("no write key has been provided")},search:function(t,i){if(this.writeKey){var e=t.tag,n=t.obj;if("function"==typeof i)return"string"!=typeof e&&(e=""),"string"==typeof n&&(n=JSON.parse(n)),n.userToken=this.writeKey,"object"==(void 0===n?"undefined":_typeof(n))&&(n=JSON.stringify(n)),this._httpPost(this.createSearchUrl(e),n,function(t,e){404==t?i(null,null):t?i(t):i(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this}else console.error("no write key has been provided")},dataDump:function(i){if(this.writeKey){var n=this;return this._httpget(this.createDataDumpUrl(),function(t,e){404==t?i(null,null):t?i(t):(i(null,bfUtils.tryParseJSON(e)),n.triggerOnUpdate(obj))}),this}console.error("no write key has been provided")}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function AnalyticsAPI(e,t,n,s,a){if(this.analyticsHostUrl=siteConfig.endPoints.analyticsHost,"object"==(void 0===e?"undefined":_typeof(e))){var i=e;this.appId=i.appId,this.pluginId=i.pluginId,this.instanceId=i.instanceId,this.liveMode=i.liveMode,this.developerId=i.developerId}else this.appId=e,this.pluginId=t,this.instanceId=n,this.liveMode=s,this.developerId=a;this.source="undefined"!=typeof device&&device.platform?"app":"web",window.whitelabelContext&&window.whitelabelContext.whitelabelId&&(this.whitelabelId=window.whitelabelContext.whitelabelId),this._user=this._getUser(),window.appContext&&window.appContext.liveMode&&this._trackInstall()}AnalyticsAPI.prototype={_getIpInfo:function(e){function t(){var n=new XMLHttpRequest;n.open("GET","https://ipapi.co/json/",!0),n.onreadystatechange=function(){if(4==n.readyState){if(200<=n.status&&n.status<400){var e=null;if(n.responseText){var t={};try{t=JSON.parse(n.responseText)}catch(e){t={}}e={city:t.city,country:t.country_name,countryCode:t.country,lat:t.latitude,lon:t.longitude,regionName:t.region,timezone:t.timezone,zip:t.postal,ip:t.ip}}!function(e,t){if(t){var n={data:e,lastSyncDate:new Date};localStorage.setItem("analyticsUserIpInfo",JSON.stringify(n))}}(e,!0)}AnalyticsAPI.IPInfoCalled=!1}},n.send(null)}var n,s,a,i,o=localStorage.getItem("analyticsUserIpInfo");if(o){try{o=JSON.parse(o)}catch(e){o=null}var r=new Date,l=o&&o.lastSyncDate?new Date(o.lastSyncDate):new Date;n=r,s=l.getTime(),a=n.getTime(),i=Math.abs(a-s),Math.round(i/864e5)<=30&&o&&o.data?e&&e(o.data):(e&&e(o?o.data:null),AnalyticsAPI.IPInfoCalled||(AnalyticsAPI.IPInfoCalled=!0,t()))}else e&&e(),AnalyticsAPI.IPInfoCalled||(AnalyticsAPI.IPInfoCalled=!0,t())},_updateMetadata:function(e){var t=null,n=localStorage.user||localStorage.AUTH_CURRENT_USER;if(n)try{n=JSON.parse(n),t=localStorage.user?{userId:n.userToken,username:n.username,email:n.email||n.username,displayName:n.displayName,firstName:n.firstName,lastName:n.lastName}:{userId:n._id,username:n.username,email:n.email||n.username,displayName:n.displayName,firstName:n.firstName,lastName:n.lastName}}catch(e){console.warn("could not load analytics user"),t=null}e.user=t,"undefined"!=typeof push&&null!=push.deviceId&&(e.deviceId=push.deviceId)},_getUser:function(){if(localStorage.user)try{if(e=JSON.parse(localStorage.user))return{userId:e.username}}catch(e){return console.warn("could not load analytics user"),this._getAnonymousUser()}else{if(!localStorage.AUTH_CURRENT_USER)return"undefined"!=typeof push&&null!=push.deviceId?{userId:push.deviceId}:this._getAnonymousUser();try{var e;return(e=JSON.parse(localStorage.AUTH_CURRENT_USER))?{userId:e.username}:"undefined"!=typeof push&&null!=push.deviceId?{userId:push.deviceId}:this._getAnonymousUser()}catch(e){return console.warn("could not load analytics user"),"undefined"!=typeof push&&null!=push.deviceId?{userId:push.deviceId}:this._getAnonymousUser()}}},_getAnonymousUser:function(){var e,t,n,s=localStorage.getItem("analyticsUser");if(s)try{e=JSON.parse(s)}catch(e){console.log(e)}if(!e){var a=this._getCookie("ajs_anonymous_id");if(a)e={anonymousId:a.replace("%22","").replace("%22","")};else{var i=1;e={anonymousId:(t=new Date,n=t.getMilliseconds()+"",++t+n+(1e4==++i?i=1:i))};try{localStorage.setItem("analyticsUser",JSON.stringify(e))}catch(e){console.log(e)}}}return e},_getBrowserInfo:function(){return{path:document.location.pathname,referrer:document.referrer,url:document.location.href,title:document.title,platform:window.device&&window.device.platform?window.device.platform.toLowerCase():""}},_getCookie:function(e){for(var t=e+"=",n=document.cookie.split(";"),s=0;s<n.length;s++){for(var a=n[s];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""},_trackInstall:function(){localStorage.getItem("INSTALL_TRACKED")||(this.trackAction("app/installed",{appId:this.appId}),localStorage.setItem("INSTALL_TRACKED","true"))},trackAction:function(t,n,s){var a=this;if(n){var e=this._getBrowserInfo();for(var i in e)n[i]=e[i]}if((n=n||this._getBrowserInfo()).source=this.source,this._updateMetadata(n),this.analyticsHostUrl&&t){var o=!!n&&n.forceSync;n&&delete n.forceSync,this._getIpInfo(function(e){n.ipInfo=e,a._httpPost(a.analyticsHostUrl+"/event",{type:"action",value:t,metadata:n,context:{whitelabelId:a.whitelabelId,appId:a.appId,pluginId:a.pluginId,instanceId:a.instanceId,liveMode:a.liveMode,developerId:a.developerId?a.developerId:void 0},user:a._user},!o,function(e,t){s&&s()})})}return this},trackView:function(t,n,s){var a=this;if(n){var e=this._getBrowserInfo();for(var i in e)n[i]=e[i]}if((n=n||this._getBrowserInfo()).source=this.source,this._updateMetadata(n),this.analyticsHostUrl&&t){var o,r=this._getCookie("_ga");if(r)(o={}).clientId=r.substr(6);this._getIpInfo(function(e){n.ipInfo=e,a._httpPost(a.analyticsHostUrl+"/event",{type:"view",value:t,metadata:n,context:{whitelabelId:a.whitelabelId,appId:a.appId,pluginId:a.pluginId,instanceId:a.instanceId,liveMode:a.liveMode,developerId:a.developerId?a.developerId:void 0},segmentContext:{"Google Analytics":o},user:a._user},!0,function(e,t){s&&s()})})}return this},registerPluginEvent:function(s,a){if(s){s.data||(s.data={}),s.options||(s.options={});var n=s.data;if(n.key)if(n.title){n._titleLowerCase=n.title.toLowerCase();var e=this.instanceId+"_pluginEvents",i=new DatastoreAPI(this.appId,this.pluginId,e,this.liveMode);i.searchAndUpdate({tag:"events",obj:{$set:n},search:{key:n.key}},function(e,t){null==e&&t&&0==t.nModified?i.insert({tag:"events",obj:n,checkDuplicate:!1},function(e,t){var n=new CustomEvent("pluginAnalyticsRegisterEvent",{detail:{data:s.data,options:s.options}});document.dispatchEvent(n),a&&a(e,t)}):a&&a(e,t)})}else a&&a("Missing event title",null);else a&&a("Missing event key",null)}else a&&a("invalid params",null)},unregisterPluginEvent:function(e,s){if(e&&e.key){var t=this.instanceId+"_pluginEvents",a=new DatastoreAPI(this.appId,this.pluginId,t,this.liveMode);a.search({tag:"events",obj:{filter:{"$json.key":e.key}}},function(e,t){if(!e&&t&&0<t.length)for(var n=0;n<t.length;n++)a.delete({tag:"events",id:t[n].id},function(e,t){s&&s(e,t)});else s&&s(e,t)})}else s&&s("Missing event key",null)},getPluginEvents:function(e,n){var t=this.instanceId+"_pluginEvents",s=new DatastoreAPI(this.appId,this.pluginId,t,this.liveMode);e||(e={}),e.skip=e.skip||0,e.limit=e.limit||50,s.search({tag:"events",obj:e},function(e,t){n&&n(e,t)})},setUsername:function(e){this._user.userId=e,this._user.anonymousId&&(this._user.updateIdentity=!0)},setUserProperties:function(e){this._user.properties=e,this._user.updateIdentity=!0},_httpPost:function(e,t,n,s){if(!window.__$haultEvents){var a=new XMLHttpRequest;a.open("POST",e,n),a.setRequestHeader("Content-type","application/JSON");var i=this;t.user&&t.user.userId&&t.user.userId.userId&&(t.user=r(t.user),localStorage.setItem("analyticsUser",JSON.stringify(t.user))),a.onreadystatechange=function(){4==a.readyState&&(200<=a.status&&a.status<400?(i._user&&i._user.userId&&i._user.userId.userId&&(i._user=r(i._user)),i._user.updateIdentity&&(delete i._user.updateIdentity,delete i._user.properties,delete i._user.anonymousId),localStorage.setItem("analyticsUser",JSON.stringify(i._user)),s(null,a.responseText)):0==a.status?window.__$haultEvents=!0:s(a.status))};var o=null;try{o=JSON.stringify(t)}catch(e){console.error("error stringifying analytics data",t.context,t.type+":"+t.value,t.metadata,t,e)}if(o)try{a.send(o)}catch(e){e.code&&console.error("error sending analytics",e,t,t.context,t.type+":"+t.value,t.metadata,o,e)}}function r(e){return e&&"object"==_typeof(e.userId)?r(e.userId):e}}};
"use strict";function AppearanceAPI(e){this.pluginAPI=e}AppearanceAPI.prototype={getCSSFiles:function(e,t){return t(null,["https://bootswatch.com/cerulean/bootstrap.css"]),this},autosizeContainer:function(e,t){this.autosizeContainerHandler(e.height),t(null,null)},autosizeContainerHandler:function(){},setHeaderVisibility:function(e){var t=document.getElementById("pluginControlHeader"),n=document.getElementById("pluginControlHeaderTabs");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden")),n&&(e?n.classList.remove("hidden"):n.classList.add("hidden"))},beforeUpdate:function(e){document.addEventListener("appearanceBeforeUpdate",e,!1)},triggerBeforeUpdate:function(e){var t=new CustomEvent("appearanceBeforeUpdate");document.dispatchEvent(t)},onUpdate:function(e){document.addEventListener("appearanceOnUpdate",e,!1)},triggerOnUpdate:function(e){var t=new CustomEvent("appearanceOnUpdate");document.dispatchEvent(t)},titlebar:{show:function(){AppearanceAPI.prototype.titlebar.toggleVisibility(!0)},hide:function(){AppearanceAPI.prototype.titlebar.toggleVisibility(!1)},toggleVisibility:function(e){var t=document.getElementsByClassName("pluginFrame"),n=void 0;(n=t.length?angular.element(t[0]).scope():angular.element(document.getElementById("launcherPlugin")).scope()).disableAutomaticNavigationBar=!0,n.showNavigationBar=e,n.$$phase||n.$apply()}},ready:function(){window.spinner.hide(!0)}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function Track(a,e,t,i,r){this.title=a,this.url=e,this.image=t,this.album=i,this.artist=r,this.startAt=0,this.lastPosition=0}var audioPlayer={_audio:null,_allowPlay:!0,_interval:{time:5e3,id:null},get audio(){return null==this._audio&&("undefined"!=typeof Audio?this._audio=new Audio:this._audio={}),this._audio},_currentTrack:null,settings:{autoPlayNext:!1,loopPlaylist:!1,autoJumpToLastPosition:!1,shufflePlaylist:!1,volume:1},getSettings:function(a,e){e(null,this.settings)},setSettings:function(a){console.log("setSettings called"),a&&(this.audio&&this.settings&&(this.audio.volume=this.settings.volume),angular.extend(this.settings,a),this.save())},resetSettingsToDefault:function(){audioPlayer.settings={autoPlayNext:!1,loopPlaylist:!1,autoJumpToLastPosition:!1,shufflePlaylist:!1,volume:1}},isStream:function(){return!isFinite(audioPlayer.audio.duration)},isAndroid:function(){var a=!1;return window.device&&window.device.platform&&"android"===window.device.platform.toLowerCase()&&(a=!0),a},retryAllowed:function(){var a=!0;return audioPlayer.isStream()||(a=!1),a},retryAudio:function(){console.warn("retryAudio"),null==audioPlayer._interval.id&&(audioPlayer._interval.id=setInterval(function(){audioPlayer.resumePlay()},audioPlayer._interval.time))},cancelRetry:function(){null!=audioPlayer._interval.id&&(clearInterval(audioPlayer._interval.id),audioPlayer._interval.id=null)},resumePlay:function(){audioPlayer.audio.paused||(console.warn("restart audio",new Date),audioPlayer._allowPlay=!0,audioPlayer.play(audioPlayer._currentTrack))},init:function(){var e=this;try{this.audio&&this.audio.addEventListener&&this.audio.addEventListener("ended",function(){e.triggerOnEvent("audioEnded",e._currentTrack),e.settings.autoPlayNext&&e.next()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("stalled",function(){console.warn("audio stalled",new Date),audioPlayer.retryAllowed()&&audioPlayer.retryAudio()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("error",function(){console.warn("audio error",new Date),audioPlayer.retryAllowed()&&audioPlayer.retryAudio()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("playing",function(){console.warn("playing",new Date),audioPlayer.cancelRetry()})}catch(a){console.warn("error",a)}var a=0;this.audio&&this.audio.addEventListener&&this.audio.addEventListener("timeupdate",function(){e._currentTrack&&(e._currentTrack.lastPosition=e.audio.currentTime),5<Math.abs(a-e.audio.currentTime)&&(e.save(),a=e.audio.currentTime),e.triggerOnEvent("timeUpdate",{currentTime:e.audio.currentTime,duration:e.audio.duration,buffer:{start:e.audio.buffered.length?e.audio.buffered.start(0):0,end:e.audio.buffered.length?e.audio.buffered.end(0):0}})}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("error",function(a){e.triggerOnEvent("error",a)});var t=window.appContext;if(null!=t&&void 0!==t&&void 0!==t.currentApp&&void 0!==t.currentApp.appId){var i=window.localStorage.getItem("audioPlayer");if("{}"!=i)try{var r=JSON.parse(i);e.settings=r.settings,e.playlist=r.playlist,e._currentTrack=r._currentTrack,e.audio.volume=e.settings.volume}catch(a){console.warn("audioPlayer localStorage error",a)}}else console.warn("no app found for audioPlayer")},getCurrentTrack:function(a,e){return e&&e(this._currentTrack),this._currentTrack},onEvent:function(e){var a=function(a){e&&e(a.detail)};return document.addEventListener("audioPlayer.onEvent",a,!1),{clear:function(){document.removeEventListener("audioPlayer.onEvent",a,!1)}}},triggerOnEvent:function(a,e){a=new CustomEvent("audioPlayer.onEvent",{detail:{event:a,data:e}});document.dispatchEvent(a)},_tmrSave:null,save:function(){this._tmrSave&&clearTimeout(this._tmrSave),this._tmrSave=setTimeout(function(){try{var a={settings:audioPlayer.settings,playlist:audioPlayer.playlist,_currentTrack:audioPlayer._currentTrack};window.localStorage.setItem("audioPlayer",JSON.stringify(a))}catch(a){var e=a.message?a.message:"";console.error("Error with JSON.stringify. ",e)}},500)},play:function(a){if((!audioPlayer._currentTrack||a&&audioPlayer._currentTrack.url!=a.url)&&(audioPlayer._allowPlay=!0),audioPlayer._allowPlay){var e=void 0===a?"undefined":_typeof(a);if("string"==e)a={url:a};else if("number"==e){var t=this.playlist.tracks[a];if(!t)return;this.playlist.lastIndex=a,a=t,this.save()}else if(!a)return void(this.audio.paused&&(this.audio.play(),this.triggerOnEvent("resume",{track:this._currentTrack})));this.audio.src=a.url,this.audio.preload="auto",this._currentTrack=a,console.warn("this.audio.play()",new Date),this.audio.play(),this.triggerOnEvent("play",{track:a}),this.settings&&this.settings.autoJumpToLastPosition&&a.lastPosition&&this.skip(a.lastPosition),a.startAt&&this.skip(a.startAt),audioPlayer._allowPlay=!1}},skip:function(a){this.audio&&(this.audio.currentTime+a<0?this.audio.currentTime=0:this.audio.currentTime+a>this.audio.duration?this.audio.currentTime=this.audio.duration:this.audio.currentTime+=a,this.triggerOnEvent("skip",a))},pause:function(){audioPlayer.audio.pause(),audioPlayer._allowPlay=!0,audioPlayer.triggerOnEvent("pause")},isPaused:function(a,e){e&&e(null,audioPlayer.audio.paused)},loopTrack:function(a){audioPlayer.audio&&(audioPlayer.audio.loop=a)},next:function(){var a;if(audioPlayer.settings.shufflePlaylist?audioPlayer.playlist.lastIndex=Math.round((audioPlayer.playlist.tracks.length-1)*Math.random()):audioPlayer.playlist.lastIndex++,audioPlayer.playlist.lastIndex>=audioPlayer.playlist.tracks.length){if(!audioPlayer.settings.loopPlaylist||!audioPlayer.playlist.tracks.length)return audioPlayer.playlist.lastIndex=audioPlayer.playlist.tracks.length-1,null;audioPlayer.playlist.lastIndex=0}return a=audioPlayer.playlist.tracks[audioPlayer.playlist.lastIndex],audioPlayer.save(),audioPlayer.triggerOnEvent("next",{index:audioPlayer.playlist.lastIndex,track:a}),a&&audioPlayer.play(a),a},previous:function(){var a;if(audioPlayer.settings.shufflePlaylist?audioPlayer.playlist.lastIndex=Math.round((audioPlayer.playlist.tracks.length-1)*Math.random()):audioPlayer.playlist.lastIndex--,audioPlayer.playlist.lastIndex<0){if(!audioPlayer.settings.loopPlaylist||!audioPlayer.playlist.tracks.length)return audioPlayer.playlist.lastIndex=0,null;audioPlayer.playlist.lastIndex=audioPlayer.playlist.tracks.length-1}return a=audioPlayer.playlist.tracks[audioPlayer.playlist.lastIndex],audioPlayer.save(),audioPlayer.triggerOnEvent("previous",{index:audioPlayer.playlist.lastIndex,track:a}),a&&audioPlayer.play(a),a},removeFromPlaylist:function(a){if(!(a<0||a>=audioPlayer.playlist.tracks.length)){var e=audioPlayer.playlist.tracks.splice(a,1);a==audioPlayer.playlist.lastIndex?audioPlayer.playlist.lastIndex=-1:a<audioPlayer.playlist.lastIndex&&audioPlayer.playlist.lastIndex--,audioPlayer.triggerOnEvent("removeFromPlaylist",{index:a,track:e,newPlaylist:audioPlayer.playlist})}},addToPlaylist:function(a){audioPlayer.playlist.tracks.push(a),audioPlayer.save(),audioPlayer.triggerOnEvent("addToPlaylist",{track:a,newPlaylist:audioPlayer.playlist})},setTime:function(a){audioPlayer.audio.currentTime=a,audioPlayer._currentTrack.lastPosition=audioPlayer.audio.currentTime,audioPlayer.save(),audioPlayer.triggerOnEvent("timeUpdate",{currentTime:audioPlayer.audio.currentTime,duration:audioPlayer.audio.duration,buffer:{start:audioPlayer.audio.buffered.length?audioPlayer.audio.buffered.start(0):0,end:audioPlayer.audio.buffered.length?audioPlayer.audio.buffered.end(0):0}})},setVolume:function(a){a<0?a=0:1<a&&a<=100&&(a/=100),audioPlayer.settings&&(audioPlayer.settings.volume=a),audioPlayer.audio&&(audioPlayer.audio.volume=a),audioPlayer.triggerOnEvent("volumeChange",{volume:a}),audioPlayer.save()},playlist:{tracks:[],lastIndex:-1},getPlaylist:function(a,e){e(null,audioPlayer.playlist)}};"undefined"==typeof PluginAPI||PluginAPI.prototype.mediaAPI||(PluginAPI.prototype.mediaAPI={audioPlayer:window.audioPlayer}),window.addEventListener("load",function(){audioPlayer.init(),"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.backgroundMode&&(cordova.plugins.backgroundMode.setDefaults({text:"Background mode enabled"}),cordova.plugins.backgroundMode.enable(),audioPlayer.isAndroid()&&cordova.plugins.backgroundMode.disableWebViewOptimizations())});
"use strict";function NotificationsAPI(t){this.context=t}NotificationsAPI.prototype={alert:function(i){function t(t,n){return i.apply(this,arguments)}return t.toString=function(){return i.toString()},t}(function(t,n){t||(t={}),t.message?(t.okButton||(t.okButton={text:"Ok"}),t.okButton.text||(t.okButton.text="Ok"),window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.alert?navigator.notification.alert(t.message,n,t.title,t.okButton.text):(alert(t.message),n&&n())):n("invalid parameter, messing message")}),confirm:function(i){function t(t,n){return i.apply(this,arguments)}return t.toString=function(){return i.toString()},t}(function(t,n){if(t||(t={}),t.message)if(t.confirmButton||(t.confirmButton={text:"Confirm"}),t.confirmButton.text||(t.confirmButton.text="Confirm"),t.cancelButton||(t.cancelButton={text:"Cancel"}),t.cancelButton.text||(t.cancelButton.text="Cancel"),t.buttonLabels=[t.confirmButton.text,t.cancelButton.text],window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.confirm)navigator.notification.confirm(t.message,n,t.title,t.buttonLabels);else{var i=confirm(t.message);n&&n(i)}else n("invalid parameter, missing message",null)}),prompt:function(i){function t(t,n){return i.apply(this,arguments)}return t.toString=function(){return i.toString()},t}(function(t,n){if(window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.prompt)navigator.notification.prompt(t.message,n,t.title,t.buttonLabels,t.defaultText);else{var i=prompt(t.message);n&&n(i)}}),beep:function(t,n){console.log("calling NotificationsAPI.beep ..."),window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.beep&&navigator.notification.beep(t.times),n&&n()},vibrate:function(t,n){console.log("calling NotificationsAPI.vibrate ..."),window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.vibrate&&navigator.notification.vibrate(t.milliseconds),n&&n()}};
"use strict";function appAPI(t){this.appId=t.appId,this.liveMode=t.liveMode,this.appHost=t.endPoints.appHost,"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")}appAPI.prototype={getPluginInstances:function(t,n){var e=new DatastoreAPI(this.appId,"pluginInstances",1,this.liveMode,null);t||(t={}),t.pageIndex||(t.pageIndex=1);var a={obj:{filter:{"$json.title":{$regex:null!=t.title?t.title:""}},page:t.pageIndex-1,pageSize:t.pageSize,withDynamicData:!0,recordCount:!0},tag:""};e.search(a,function(t,e){t||n(null,{data:e.result,totals:e.totalRecord})})}};
"use strict";"undefined"==typeof ActionItemsAPI&&(window.ActionItemsAPI=function(e){this.templateUrl="pages/share/actionBuilder.html",this.listTemplateUrl=window._appRoot+"pages/templates/actionItemsListDialog.html",this.controller="actionItemsCtrl",this.context=e,this.init()}),ActionItemsAPI.prototype.init=function(){},ActionItemsAPI.prototype.list=function(e,t){var o={templateUrl:this.listTemplateUrl,controller:"actionItemsListDialogCtrl",size:"lg",data:e};window.openDialog(o,function(e){t&&t(null,e)})},ActionItemsAPI.prototype.openWebLink=function(e,t,o){if(e){var n=window.open(e,t,"location=no");o&&o(n?null:"failed to open window"),n||ActionItemsAPI.prototype.popUpCtrlScope.show(e)}},ActionItemsAPI.prototype.sendEmail=function(e,t,o){var n="mailto:"+(null!=e&&""!=e?e:"")+"?"+(null!=t&&""!=t?"subject="+t:"")+"&"+(null!=o&&""!=o?"body="+o:"");window.open(n,"_system")},ActionItemsAPI.prototype.navigateToAddress=function(e,t){if(e&&t){var o="https://maps.google.com/?q=";window.device&&null!=window.device.platform&&("android"==window.device.platform.toLowerCase()?o="geo:?q=":"ios"==window.device.platform.toLowerCase()&&(o="maps://maps.apple.com?q=")),window.open(o+e+","+t,"_system","location=no,menubar=no,titlebar=no,toolbar=no")}},ActionItemsAPI.prototype.callNumber=function(e){e&&window.open("tel:"+e,"_system","location=no,menubar=no,titlebar=no,toolbar=no")},ActionItemsAPI.prototype.sendSms=function(e){if(e)if(-1!=navigator.platform.indexOf("Android")||-1!=navigator.platform.indexOf("Linux")||null==navigator.platform){var t="sms:"+e;window.open(t,"_system")}else if(-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPad")){t="sms:"+e;window.open(t,"_system")}else console.error("This action can't be used on browser , it should be used on actual device")},ActionItemsAPI.prototype.linkToAppContent=function(e,l){var t=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),o={};o.obj={filter:{"$json.instanceId":e},pageSize:1,withDynamicData:!0},t.search(o,function(e,t){if(t&&t.length){var o=t[0].data.instanceId,n=t[0].data._buildfire.pluginType.result[0].token,i=t[0].data._buildfire.pluginType.result[0].folderName,a=t[0].data.title,s=window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI;s?s.navigation.navigateTo({pluginId:n,instanceId:o,title:a,folderName:i,pushToHistory:!0,queryString:l?l.queryString:null},null):console.warn("Plugin API is empty")}})},ActionItemsAPI.prototype.purchase=function(e,n,i,a,s){if(bfUtils.isMobileDevice)if("undefined"!=typeof inAppPurchaseAPI){var o=function(e,t){if(e){o={data:{title:" ",body:i,disableCancel:!0}};window.openDialog(o,function(){})}else if(t&&t.isApproved){var o={data:{title:" ",body:n,disableCancel:!0}};window.openDialog(o,function(){}),a&&ActionItemsAPI.prototype.linkToAppContent(a)}s(e,t)},l={productId:e};inAppPurchaseAPI.checkProduct(l,function(e,t){e&&console.error("error while checking product",e),t&&("approved"==t.state||t.owned)?(a&&ActionItemsAPI.prototype.linkToAppContent(a),s(null,{product:t,isApproved:!0})):inAppPurchaseAPI.purchase(l,o)})}else console.error("inAppPurchaseAPI is undefined");else alert("This action can't be used on browser , it should be used on actual device")},ActionItemsAPI.prototype.execute=function(e,t){var o=!1;switch(e.action){case"linkToApp":this.linkToAppContent(e.instanceId,{queryString:e.queryString});break;case"linkToWeb":o=!0,this.openWebLink(e.url,e.openIn,t);break;case"sendEmail":this.sendEmail(e.email,e.subject,e.body);break;case"callNumber":this.callNumber(e.phoneNumber);break;case"sendSms":this.sendSms(e.phoneNumber);break;case"navigateToAddress":this.navigateToAddress(e.lat,e.lng);break;case"linkToSocialGoogle":case"linkToSocialFacebook":case"linkToSocialInstagram":case"linkToSocialTwitter":case"linkToSocialLinkedIn":this.openWebLink(e.url,"_system");break;case"purchase":o=!0,this.purchase(e.productId,e.successMessage,e.successMessage,e.instanceId,t)}o||t(null,!0)},"undefined"!=typeof $app&&$app.controller("actionItemsListDialogCtrl",["$scope","$data","$dialog",function(e,t,n){e.actionItems=t.actionItems,e.executeItem=!0,e.close=function(){n.close(null)},t.options&&t.options.executeItem&&(e.executeItem=t.options.executeItem),e.openActionItem=function(o){e.executeItem?(window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI).actionItems.execute(o,function(e,t){n.close(o)}):n.close(o)}}]);
"use strict";function PluginInstanceAPI(t){this.templateUrl="pages/plugins/pluginInstanceDialog/pluginInstanceDialog.html",this.controller="pluginInstanceDialog",this.appId=t.appId,this.liveMode=t.liveMode,this.appHost=window.siteConfig.endPoints.appHost;var n=JSON.parse(JSON.stringify(t));n.pluginId="pluginInstances",n.instanceId=1,this.ds=new DatastoreAPI(n)}PluginInstanceAPI.prototype={showDialog:function(t,n){if(window.openDialog){var e={templateUrl:this.templateUrl,controller:this.controller,size:"lg",data:t};window.openDialog(e,function(t){n&&n(null,t)})}else console.error("openDialog isnt defined")},get:function(t,e){var n={};n.obj={filter:{"$json.instanceId":t},pageSize:1,withDynamicData:!0},this.ds.search(n,function(t,n){t?e(t,null):n&&n.length?e(null,n[0].data):e(null)})},_createReadUrl:function(){return this.appHost+"/api/appPluginInstances/getByIds/"+this.appId},_httpGet:function(t,n,e){bfUtils.http.get(t,{params:n}).success(function(t){e(null,t)}).error(function(t){e(t)})},search:function(t,n){var e;t.title&&(e={"$json.title":{$regex:t.title,$options:"-i"}});var i={obj:{filter:e,page:t.pageIndex,pageSize:t.pageSize,withDynamicData:!0,recordCount:!0},tag:""};this.ds.search(i,n)}};
"use strict";var deviceAPI={calendar:{addEvent:function(e,n){var t;if(window.plugins&&window.plugins.calendar&&(t=window.plugins.calendar),!t)return console.warn("cannot complete action add event to calendar. so fake it"),void(0<=window.location.protocol.indexOf("http")?alert("Adding to calendar requires native app."):console.error("Calendar feature not installed"));e.startDate instanceof Date||(e.startDate=new Date(e.startDate)),e.endDate instanceof Date||(e.endDate=new Date(e.endDate));var i,o=function(e){n(null,e)},a=function(e){n(e)};e.options?((i=t.getCalendarOptions()).firstReminderMinutes=e.options.firstReminderMinutes||i.firstReminderMinutes,i.secondReminderMinutes=e.options.secondReminderMinutes||i.secondReminderMinutes,i.recurrence=e.options.recurrence||i.recurrence,e.options.recurrenceEndDate&&(i.recurrenceEndDate=new Date(e.options.recurrenceEndDate)),t.createEventWithOptions(e.title,e.location,e.notes,e.startDate,e.endDate,i,o,a)):t.createEvent(e.title,e.location,e.notes,e.startDate,e.endDate,o,a)}},share:function(e,n){window.plugins&&window.plugins.socialsharing?window.plugins.socialsharing.share(e.text,e.subject,e.image,e.link):(console.warn("device sharing plugin not found. defaulting to email sending"),window.location="mailto:?subject="+encodeURIComponent(e.subject)+"&body="+encodeURIComponent(e.text+" "+e.link)),n(null,!0)},onAppBackgrounded:function(e){document.addEventListener("deviceAppBackgrounded",e,!1)},onAppResumed:function(e){document.addEventListener("deviceAppResumed",e,!1)}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function HistoryAPI(t,e,s,i){if("object"==(void 0===t?"undefined":_typeof(t))){var o=t;this.appId=o.appId,this.pluginId=o.pluginId,this.instanceId=o.instanceId,this.liveMode=o.liveMode}else this.appId=t,this.pluginId=e,this.instanceId=s,this.liveMode=i}HistoryAPI.prototype={historyItems:[],push:function(t,e){if("undefined"==typeof emulatorSync){if("plugin"!=t.source){var s=-1;if(1<this.historyItems.length){for(var i=1;i<this.historyItems.length;i++)if("plugin"==this.historyItems[i].source&&"control"==this.historyItems[i-1].source){s=i;break}0<=s&&this.historyItems.splice(s)}}t.uid=(new Date).getTime(),this.historyItems.push(t);var o=new CustomEvent("historyOnPush",{detail:{pushedItem:t}});document.dispatchEvent(o);var n=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});document.dispatchEvent(n)}else{var r=new Packet(null,"history.pushAppHistory",t);emulatorSync.sendMessage(r)}return e&&e(null,!0),this},get:function(t,e){if(t&&t.pluginBreadcrumbsOnly){for(var s=[],i=0;i<this.historyItems.length;i++)"plugin"==this.historyItems[i].source&&s.push(this.historyItems[i]);e(null,s)}else e(null,this.historyItems);return this},getNext:function(t){var e=null;if(this.historyItems)for(var s=0;s<this.historyItems.length;s++)if(this.historyItems[s]==t||this.historyItems[s].uid==t.uid){s<this.historyItems.length&&(e=this.historyItems[s+1]);break}return e},pop:function(t,e){if("undefined"==typeof emulatorSync){if(!t&&this.historyItems)if(1<this.historyItems.length){var s=this.historyItems[this.historyItems.length-1];s&&"plugin"==s.source&&(t=this.historyItems[this.historyItems.length-2])}else this.historyItems[0]&&"plugin"==this.historyItems[0].source&&(t=this.historyItems[0]);if(t){for(var i=-1,o=!1,n=0;n<this.historyItems.length;n++)if(this.historyItems[n]==t||this.historyItems[n].uid==t.uid){(i=n)+1<this.historyItems.length&&"plugin"==this.historyItems[n+1].source&&(o=!0);break}0<=i&&i<=this.historyItems.length&&this.historyItems.splice(i+1);var r=new CustomEvent("historyOnPop",{detail:{poppedItem:t}});document.dispatchEvent(r);var h=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});if(document.dispatchEvent(h),(o||"plugin"==t.source)&&postMaster){var u=new Packet(null,"history.triggerOnPop",t);postMaster.widgetPluginAPI?postMaster.widgetPluginAPI.sendMessage(null,u):postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.sendMessage(null,u)}}else if(e)return e("breadcrumb not found"),this}else{u=new Packet(null,"history.popAppHistory",t);emulatorSync.sendMessage(u)}return e&&e(null,!0),this},popToHome:function(){if(this.historyItems&&1<this.historyItems.length)for(var t=1;t<this.historyItems.length;t++)"control"==this.historyItems[t].source&&this.pop(this.historyItems[t-1])},popToPlugin:function(){if(this.historyItems&&1<this.historyItems.length)for(var t=this.historyItems.length-1;1<t&&"plugin"==this.historyItems[t].source;t--)this.pop(this.historyItems[t-1])},clear:function(t,e){var s=this.historyItems[0];this.historyItems.splice(0),e&&e(null);var i=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});if(document.dispatchEvent(i),s){var o=new CustomEvent("historyOnPop",{detail:{poppedItem:s}});document.dispatchEvent(o)}return this},triggerOnPop:function(t){var e=new CustomEvent("historyOnPop",{detail:{poppedItem:t}});return document.dispatchEvent(e),this},triggerOnUpdate:function(t){this.historyItems=t;var e=new CustomEvent("historyOnUpdate",{detail:{historyItems:t}});return document.dispatchEvent(e),this},onUpdate:function(e){var t=function(t){e&&e({historyItems:t.detail.historyItems})};return document.addEventListener("historyOnUpdate",t,!1),{clear:function(){document.removeEventListener("historyOnUpdate",t,!1)}}},onPop:function(e){var t=function(t){e&&e(t.detail)};return document.addEventListener("historyOnPop",t,!1),{clear:function(){document.removeEventListener("historyOnPop",t,!1)}}},onPush:function(e){var t=function(t){e&&e({historyItems:t.detail.historyItems,pushedItem:t.detail.pushedItem})};return document.addEventListener("historyOnPush",t,!1),{clear:function(){document.removeEventListener("historyOnPush",t,!1)}}}};
"use strict";function Packet(e,n,t,i){this.id=e,this.cmd=n,this.data=t,this.error=i,this.instanceId}var pluginCount=0;if(void 0===logger)var logger={log:function(){}};function PluginAPI(e,n,t,i,o,a,s){pluginCount++,this.datastore=this.analytics=this.appearance=null,this.iFrameId=e,this.iFrame=document.getElementById(e),this.init(n,t,i,o,a,s)}PluginAPI.prototype={getContentWindow:function(){return this.iFrame=document.getElementById(this.iFrameId),this.iFrame?this.iFrame.contentWindow:null},debugTag:null,init:function(e,n,t,i,o,a){if(window.appContext&&window.appContext.currentApp){var s=window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&window.appContext.currentApp.config.cpDomain?window.appContext.currentApp.config.cpDomain:window.siteConfig.endPoints.appHost;this.context={appId:e,pluginId:n,instanceId:t,liveMode:i||0,endPoints:window.siteConfig.endPoints,cpDomain:s,device:window.device,deviceId:"undefined"!=typeof push?push.deviceId:null,debugTag:this.debugTag,datastoreWriteKey:o||void 0,type:a,appTheme:PluginAPI.appTheme,configType:PluginAPI.configType};var r=localStorage.getItem("currentAppManifest");if(r){var c=null;try{c=JSON.parse(r)}catch(e){console.error("bad currentAppManifest",e)}this.context.offlineModeEnabled=c.offlineModeEnabled}if(this.context.device||(this.context.device={platform:"web"}),"undefined"!=typeof AppearanceAPI&&(this.appearance=new AppearanceAPI(this.context)),"undefined"!=typeof DatastoreAPI&&(this.datastore=new DatastoreAPI(this.context)),"undefined"!=typeof UserDatastoreAPI&&(this.userData=new UserDatastoreAPI(this.context)),"undefined"!=typeof AnalyticsAPI&&(this.analytics=new AnalyticsAPI(this.context)),"undefined"!=typeof ImageLibAPI&&(this.imageLib=new ImageLibAPI(this.context)),"undefined"!=typeof ColorLibAPI&&(this.colorLib=new ColorLibAPI(this.context),this.colorLib.onChange(function(e){l.sendMessage(null,new Packet(null,"colorLib._triggerOnChange",e))})),"undefined"!=typeof appAPI&&(this.appAPI=new appAPI(this.context)),"undefined"!=typeof ActionItemsAPI&&(this.actionItems=new ActionItemsAPI(this.context)),"undefined"!=typeof NotificationsAPI&&(this.notificationsAPI=new NotificationsAPI(this.context)),"undefined"!=typeof PopupLibAPI&&(this.notificationsAPI=PopupLibAPI),"undefined"!=typeof HistoryAPI&&(this.history=new HistoryAPI(this.context)),"undefined"!=typeof PluginInstanceAPI&&(this.pluginInstances=new PluginInstanceAPI(this.context)),"undefined"!=typeof inAppPurchaseAPI&&(this.inAppPurchase=inAppPurchaseAPI),"undefined"!=typeof barcodeScannerAPI&&(this.barcodeScanner=barcodeScannerAPI),"undefined"!=typeof PublicDatastoreAPI&&(this.publicData=new PublicDatastoreAPI(this.context)),"undefined"!=typeof iBeaconAPI&&(this.iBeacon=iBeaconAPI),"undefined"!=typeof localStorageAPI&&(this.localStorage=localStorageAPI),"undefined"!=typeof LocalNotificationsAPI&&(this.localNotifications=new LocalNotificationsAPI(this.context)),"undefined"!=typeof DeepLinkAPI&&(this.deepLink=new DeepLinkAPI(this.context)),"undefined"!=typeof deviceAPI&&(this.device=deviceAPI,this.device.onAppBackgrounded(function(e){l.sendMessage(null,new Packet(null,"device.triggerOnAppBackgrounded",e.detail))}),this.device.onAppResumed(function(e){l.sendMessage(null,new Packet(null,"device.triggerOnAppResumed",e.detail))})),"undefined"!=typeof geoAPI&&(this.geo=geoAPI),"undefined"!=typeof inputAPI&&(this.input=inputAPI),"undefined"!=typeof imagePreviewerAPI&&(this.imagePreviewer=imagePreviewerAPI),"undefined"!=typeof bluetoothAPI&&(this.bluetooth=bluetoothAPI),"undefined"!=typeof cameraAPI&&(this.camera=cameraAPI),"undefined"!=typeof fileManagerAPI&&(this.fileManager=fileManagerAPI),"undefined"!=typeof PushNotificationsAPI&&(this.pushNotifications=new PushNotificationsAPI(this.context)),"undefined"!=typeof FirebaseAPI&&(this.firebase=new FirebaseAPI(this.context)),"undefined"!=typeof authAPI){this.auth=authAPI,this.auth.init(this.context);var l=this;this.auth.onLogin(function(e){l.sendMessage(null,new Packet(null,"auth.triggerOnLogin",e.detail))}),this.auth.onLogout(function(){l.sendMessage(null,new Packet(null,"auth.triggerOnLogout"))})}l=this;this.mediaAPI=new Object,"undefined"!=typeof audioPlayer&&(this.mediaAPI.audioPlayer=audioPlayer,this.mediaAPI.audioPlayer.onEvent(function(e){l.sendMessage(null,new Packet(null,"services.media.audioPlayer.triggerOnEvent",e))})),this.analytics.trackActionCommand=function(e,n){return!!e&&l.analytics.trackAction(e.value,e.metadata,n)},this.analytics.trackViewCommand=function(e,n){return!!e&&l.analytics.trackView(e.value,e.metadata,n)},this.navigation.pluginAPI=this,"undefined"!=typeof PublicFilesAPI&&(this.publicFiles=new PublicFilesAPI(this.context),this.publicFiles.onProgress(function(e){l.sendMessage(null,new Packet(null,"services.publicFiles._triggerOnProgress",{file:e}))}),this.publicFiles.onComplete(function(e){l.sendMessage(null,new Packet(null,"services.publicFiles._triggerOnComplete",{file:e}))}))}else console.error("invalid appContext cant create pluginAPI")},postMessageHandler:function(i){if(!this.iFrameId)return!1;var o=void 0;try{o=i.packet||JSON.parse(i.data)}catch(e){return void console.warn("error parsing post message data.")}if(o&&o.cmd&&o.cmd.split&&(i.source==this.getContentWindow()||o.fid==this.iFrameId||this.context.instanceId==o.instanceId)){for(var a=this,e=o.cmd.split("."),n=this,t=this,s=0;s<e.length;s++){if(0<s&&(t=n),!n[e[s]])return!0;n=n[e[s]]}return n.apply(t,[o.data,function(e,n){e&&console.warn(i.data,e);var t=new Packet(o.id,o.cmd,n,e);a.sendMessage(null,t)}]),!0}},sendMessage:function(e,n){(e=this.getContentWindow())&&e.postMessage&&(n=JSON.parse(JSON.stringify(n)),e.postMessage(n,"*"))},getContext:function(e,n){return n(null,this.context),this},navigation:{displayPopUpInstructions:function(){window.location.hash="/popUp"},navigateTo:function(n,e){!1!==n.pushToHistory&&(n.pushToHistory=!0);var t=!1,i="/pluginContainer/"+n.pluginId+"/"+n.instanceId+"/"+encodeURIComponent(n.title)+"/"+n.folderName+"/"+n.pushToHistory,o=new HistoryAPI;if(n.pushToHistory||o.popToHome(),0==o.historyItems.length&&o.push({label:"Home",options:{pluginData:void 0},source:"home"}),1==o.historyItems.length&&postMaster.launcherPluginAPI&&n.instanceId==postMaster.launcherPluginAPI.context.instanceId&&n.pluginId==postMaster.launcherPluginAPI.context.pluginId);else{var a=o.historyItems[o.historyItems.length-1];if("control"==a.source)n.instanceId!=a.options.pluginData.instanceId||n.pluginId!=a.options.pluginData.pluginId?o.push({label:decodeURIComponent(n.title),options:{pluginData:n,context:window.location.href},source:"control"}):t=!0;else{var s;try{s=decodeURIComponent(n.title)}catch(e){console.error("BAD Title",n.title,e),s="TITLE"}o.push({label:s,options:{pluginData:n,context:window.location.href},source:"control"})}}n&&n.queryString&&(window.pluginControllerHelper.pluginPassThroughqueryString=n.queryString),n&&(n.dontTriggerHashChangeEvent||t)?cpSync.navigation.silentNavigation(i):window.location.hash=i,e&&e(null,{status:"completed"})},navigateToPluginInstance:function(a,s){var r=this;if(a&&a.instanceId){var e=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),n={};n.obj={filter:{"$json.instanceId":a.instanceId},pageSize:1,withDynamicData:!0},e.search(n,function(e,n){if(n&&n.length){var t=n[0].data._buildfire.pluginType.result[0].token,i=n[0].data._buildfire.pluginType.result[0].folderName,o=n[0].data.title;r.navigateTo({pluginId:t,instanceId:a.instanceId,title:o,folderName:i,pushToHistory:!1,query:a.queryString},s)}})}else s("Invalid parameters. Need to pass instanceId.")},navigateToAppearance:function(e){e&&e.dontTriggerHashChangeEvent?cpSync.navigation.silentNavigation("/appearanceSample"):window.location.hash="/appearanceSample"},navigateHome:function(e){e&&e.dontTriggerHashChangeEvent?cpSync.navigation.silentNavigation("/"):window.location.hash="/";var n=new HistoryAPI;n.clear(),n.push({label:"Home",options:{pluginData:void 0},source:"home"})},navigateBack:function(){var e=new HistoryAPI;if(e.historyItems&&1<e.historyItems.length){var n=e.historyItems[e.historyItems.length-1],t=e.historyItems[e.historyItems.length-2];if(t&&t.options)switch(t.source){case"control":var i=null;"plugin"==n.source?(e.pop(t),t.options.pluginData&&(i=JSON.parse(JSON.stringify(t.options.pluginData)),this.navigateTo(i))):(t.options.pluginData&&(i=JSON.parse(JSON.stringify(t.options.pluginData)),this.navigateTo(i)),e.pop(t));break;case"plugin":"control"==n.source?(window.location.protocol.indexOf("http")<0?e.pop(t):(e.clear(),e.push({label:"Home",options:{pluginData:void 0},source:"home"})),window.location.hash="/"):e.pop(t);break;case"home":if("plugin"==n.source){e.pop(t);break}default:e.clear(),e.push({label:"Home",options:{pluginData:void 0},source:"home"}),window.location.hash="/"}}else e.clear(),e.push({label:"Home",options:{pluginData:void 0},source:"home"}),window.location.hash="/"},scrollTop:function(e,n){document.body.scrollTop=e||0,n&&n()},navigateEmulator:function(){cordova&&cordova.file&&cordova.file.applicationDirectory?window.appContext&&window.appContext.environment?window.location.href.indexOf("http://")<0&&(window.location.href=cordova.file.applicationDirectory+"www/emulator/login.html?env="+window.appContext.environment+"&lastUrl="+encodeURIComponent(window.location.href)):console.log("Cant load emulator bc window.appContext.environment is undefined"):console.log("Cant load emulator bc cordova.file.applicationDirectory is undefined")},navigateToApp:function(e){window.location.search="?env="+window.appContext.environment+"&appId="+e.appId+"&mode="+window.appContext.currentApp.liveMode+"&lastUrl="+encodeURIComponent(window.location.href)}},messaging:{triggerOnNewControlMessage:function(e){console.warn("unhandled message [onNewControlMessage]")},triggerOnNewWidgetMessage:function(e){console.warn("unhandled message [onNewWidgetMessage]")}},spinner:{show:function(e,n){window.spinner&&window.spinner.show(),n&&n()},hide:function(e,n){window.spinner&&window.spinner.hide(),n&&n()}}};
"use strict";var geoAPI={convertPosition:function(o){return{coords:{latitude:o.coords.latitude,longitude:o.coords.longitude,altitude:o.coords.altitude,accuracy:o.coords.accuracy,altitudeAccuracy:o.coords.altitudeAccuracy,heading:o.coords.heading,speed:o.coords.speed},timestamp:o.timestamp,isBackground:!!o.isBackground&&o.isBackground}},convertBackGroundPosition:function(o){return{coords:{latitude:o.latitude,longitude:o.longitude,altitude:o.altitude,accuracy:o.accuracy,speed:o.speed},timestamp:o.time,isBackground:!0}},getCurrentPosition:function(o,t){return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){t(null,geoAPI.convertPosition(o))},t,o):console.error("navigator.geolocation is undefined"),this},isAndroid:!1,watchPosition:function(o,t){function n(o){(o=geoAPI.convertPosition(o)).watchId=a;var t="location: "+o.coords.latitude+","+o.coords.longitude+" ,isBackground: "+o.isBackground+" "+new Date;console.log(t);var n=new Packet(null,"geo.onPositionChange",o);postMaster.broadcast(n)}function i(o){console.log("Geo watchPosition: ",o.message),o.watchId=a,t(o)}var a;if(navigator.geolocation&&navigator.geolocation.watchPosition){a=navigator.geolocation.watchPosition(n,i,o);var e=function(o){n(geoAPI.convertBackGroundPosition(o))},c=function(o){console.error("Background geo error")};document.addEventListener("deviceready",function(){(-1!=navigator.platform.indexOf("Android")||-1!=navigator.platform.indexOf("Linux")||null==navigator.platform)&&"undefined"!=typeof backgroundGeolocation&&("undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.backgroundMode&&cordova.plugins.backgroundMode.on("activate",function(){cordova.plugins.backgroundMode.disableWebViewOptimizations()}),backgroundGeolocation.configure(e,c,{desiredAccuracy:0,stationaryRadius:1,distanceFilter:1,interval:1e3,locationProvider:backgroundGeolocation.provider.ANDROID_ACTIVITY_PROVIDER}),backgroundGeolocation.start())},!1)}else console.log("HTML5 position"),a=setInterval(function(){geoAPI.getCurrentPosition(o,function(o,t){o?i(o):n(t)})},o&&o.timeout?o.timeout:5e3);t()},clearWatch:function(o,t){navigator.geolocation&&navigator.geolocation.watchPosition?navigator.geolocation.clearWatch(o):clearInterval(o),t&&t()}};
"use strict";var inputAPI={initialized:!1,currentStepData:{},currentStepOptions:{},init:function(){var e=this;this.inputDialog?this.inputDialog.innerHTML="":(this.inputDialog=document.createElement("div"),this.inputDialog.style.display="none"),window.addEventListener("keyboardWillShow",function(){e.actionFooter.style.display="none"}),window.addEventListener("keyboardDidHide",function(){e.actionFooter.style.display="flex"}),0<=window.location.pathname.indexOf("pluginTester")?(this.inputDialog.style.height=document.getElementById("app").offsetHeight+"px",this.inputDialog.style.position="absolute"):(this.inputDialog.style.height="100vh",this.inputDialog.style.position="fixed"),this.inputDialog.id="inputDialog",this.inputDialog.className="primaryBackgroundTheme",this.inputDialog.className="backgroundColorTheme",this.dialogNav=document.createElement("div"),this.dialogNav.className="inputapi-nav titleBarBackgroundTheme",this.inputDialog.appendChild(this.dialogNav),this.dialogNavFlex=document.createElement("div"),this.dialogNavFlex.className="inputapi-nav-flex",this.dialogNav.appendChild(this.dialogNavFlex),this.currentUserContainer=document.createElement("div"),this.currentUserContainer.className="inputapi-user-container",this.inputDialog.appendChild(this.currentUserContainer),this.textarea=document.createElement("textarea"),this.textarea.className="inputapi-textarea",this.textarea.addEventListener("input",function(t){e.currentStepData.textValue=t.target.value,e.doneButton.disabled=!(!e.currentStepOptions.required||e.currentStepData.textValue.length)}),this.textarea.onfocus=function(t){document.body.scrollTop=0},this.inputDialog.appendChild(this.textarea),this.imageGallery=document.createElement("div"),this.imageGallery.id="imageGallery",this.inputDialog.appendChild(this.imageGallery),this.cancelButton=document.createElement("button"),this.cancelButton.className="inputapi-cancel titleBarTextAndIcons",this.dialogNavFlex.appendChild(this.cancelButton),this.title=document.createElement("h1"),this.title.className="inputapi-nav-title titleBarTextAndIcons",this.dialogNavFlex.appendChild(this.title),this.doneButton=document.createElement("button"),this.doneButton.className="inputapi-done titleBarTextAndIcons",this.dialogNavFlex.appendChild(this.doneButton),this.actionFooter=document.createElement("div"),this.actionFooter.className="inputapi-footer",this.inputDialog.appendChild(this.actionFooter),this.cameraBtn=document.createElement("span"),this.cameraBtn.className="glyphicon glyphicon-camera",this.cameraBtn.onclick=function(t){return e.showFileDialog()},this.actionFooter.appendChild(this.cameraBtn),0<=window.location.pathname.indexOf("pluginTester")?document.getElementById("app").appendChild(this.inputDialog):document.body.appendChild(this.inputDialog),this.initialized=!0},showFileDialog:function(){var i=this,t=new PublicFilesAPI({appId:"testAppId"});t._onComplete=function(t){if("success"===t.status){if(6<=i.currentStepData.images.length)return;i.currentStepData.images.push(t.url),i.updateImageGallery()}else console.error("Image upload failed - inputAPI",t)},t._onProgress=function(){window.spinner&&window.spinner.show(),i.doneButton.disabled=!0},t.showDialog({},function(t,e){window.spinner&&setTimeout(window.spinner.hide.bind(null,!0),300),i.doneButton.disabled=!(!i.currentStepOptions.required||!i.currentStepData.textValue||i.currentStepData.textValue.length)})},updateImageGallery:function(){var t=this.currentStepData.images.length-1,e=this.currentStepData.images[t];this.addImageToGallery(e,t),this.currentStepData.images.length&&this.currentStepData.images.length<6?this.addPlusToGallery():this.removePlusBtn(),6<=this.currentStepData.images.length?this.cameraBtn.style.color="#555 !important":this.cameraBtn.style.color=""},removePlusBtn:function(){this.plusBtn&&this.plusBtn.parentNode.removeChild(this.plusBtn)},addPlusToGallery:function(){var e=this;this.plusBtn||(this.plusBtn=document.createElement("span"),this.plusBtn.className="glyphicon glyphicon-plus",this.plusBtn.onclick=function(t){return e.showFileDialog()},this.imageGallery.appendChild(this.plusBtn))},addImageToGallery:function(t,e){var i=this,n=document.createElement("div");n.className="img-gallery-container animated fadeInUp";var a=document.createElement("span");a.className="galery-delete glyphicon glyphicon-remove-sign",a.onclick=function(){i.currentStepData.images.splice(e,1),i.imageGallery.removeChild(i.imageGallery.children[e])},n.appendChild(a),this.plusBtn&&(this.plusBtn.parentNode.removeChild(this.plusBtn),delete this.plusBtn);var s=document.createElement("img");s.setAttribute("src","https://czi3m2qn.cloudimg.io/crop/100x100/q50/"+t),s.className="img-gallery-item",n.appendChild(s),this.imageGallery.appendChild(n),this.addPlusToGallery()},renderStep:function(t,e,i){var n=this;window.Keyboard&&window.Keyboard.shrinkView&&(window.Keyboard.shrinkView(!0),window.Keyboard.disableScrollingInShrinkView(!0)),this.currentStepData={images:[]},this.currentStepOptions=t,this.title.innerHTML=t.title||"",this.actionFooter.style.display=t.attachments?"flex":"none",!t.required||t.defaultValue&&0<t.defaultValue.length?this.doneButton.disabled=!1:this.doneButton.disabled=!0,this.cameraBtn.style.display=this.currentStepOptions.attachments&&this.currentStepOptions.attachments.images&&this.currentStepOptions.attachments.images.enable&&this.currentStepData.images.length<6?"block":"none",this.currentUserContainer.innerHTML="";var a=authAPI.getCurrentUser();console.log("Renering inputAPI for user",a),this.userImage=document.createElement("img"),a&&a.imageUrl?this.userImage.src="https://czi3m2qn.cloudimg.io/crop/50x50/q70/"+a.imageUrl:this.userImage.src="https://pluginserver.buildfire.com/styles/media/avatar-placeholder.png",this.userImage.className="inputapi-user-image",this.currentUserContainer.appendChild(this.userImage),this.userTitle=document.createElement("h1"),this.userTitle.className="inputapi-user-title",a&&a.displayName&&(this.userTitle.innerHTML=a.displayName),this.currentUserContainer.appendChild(this.userTitle),this.textarea.placeholder=t.placeholder||"Type something...",this.textarea.maxlength=t.maxLength||1e4,this.textarea.value=t.defaultValue||"",this.cancelButton.innerHTML=t.cancelText||"Cancel",this.doneButton.innerHTML=t.saveText?t.saveText:t._buffer.length?"Next":"Done",this.doneButton.onclick=function(t){return i(n.currentStepData)},this.cancelButton.onclick=function(t){return e()}},showTextDialog:function(t,n){var a=this;if(t&&n){this.initialized||this.init();var s=Array.isArray(t)?t:[t],l=[],e=!1,i=!1,o=!1;if(s.forEach(function(t){t.cancelText&&9<t.cancelText.length&&(o=!0),t.saveText&&9<t.saveText.length&&(i=!0),t.title&&14<t.title.length&&(e=!0)}),e)return n(new Error("Title too long, max 14 chars"));if(i)return n(new Error("saveText too long, max 9 chars"));if(o)return n(new Error("cancelText too long, max 9 chars"));var r=function(){a.inputDialog.classList.remove("active"),n(null,{cancelled:!0,results:l}),setTimeout(c,600),setTimeout(function(){a.inputDialog.style.display="none",a.init()},500)},u=s.shift();u._buffer=s,this.renderStep(u,r,function t(e){l.push(e);var i=s.shift();i?(i._buffer=s,a.renderStep(i,r,t)):(a.inputDialog.classList.remove("active"),n(null,{cancelled:!1,results:l}),setTimeout(c,600),setTimeout(function(){a.inputDialog.style.display="none",a.init()},500))}),this.inputDialog.style.display="flex",setTimeout(function(){a.inputDialog.classList.add("active")},10)}function c(){window.Keyboard&&window.Keyboard.shrinkView&&(window.Keyboard.shrinkView(!1),window.Keyboard.disableScrollingInShrinkView(!1))}}};setTimeout(function(){inputAPI.init()},5e3);
"use strict";$app.controller("authCtrl",["$rootScope","$scope","Upload","$sce",function(a,c,s,r){c._appRoot=window._appRoot,c.registerClick=!1;var l,d=void 0;window.appContext.currentApp&&window.appContext.currentApp.config&&(void 0===window.appContext.currentApp.config.userLoginDomainSettings?"enterprise"==window.appContext.currentApp.config.type&&(d="enabled"):d=window.appContext.currentApp.config.userLoginDomainSettings);var o="Password must be at least 8 characters long, contains an upper case letter, a lower case letter, a number and a symbol.";c.loginTranslation="Log In",c.registerTranslation="Register",c.emailDoesNotExistTxt="Email does not exist in system.",c.updateLoginTranslations=function(e){console.log("emailDoesNotExist",e.emailDoesNotExist),e.passwordAtLeast8ComplexChars&&(o=e.passwordAtLeast8ComplexChars),e.loginTranslation&&(c.loginTranslation=e.loginTranslation),e.registerTranslation&&(c.registerTranslation=e.registerTranslation),e.emailDoesNotExist&&(c.emailDoesNotExistTxt=e.emailDoesNotExist)};window.authAPI.authCtrlScope=c,a.allowCancel=void 0===a.allowCancel||a.allowCancel,a.authShown=!1,c.secretCodeProvider=null,c.refWindow=null,c.errors={},c.invalidCredentials=!1,c.invalidReset=!1,c.invalidRegister=!1,c.msgError=null,c.msgSuccess=null,c.enableFacebook=!0,c.enableTwitter=!0,c.password="",c.userObj={username:"",email:""},c.loginCallback=null;var u="",p="",i="",w="",f="",g="",m="",t=window.appContext.currentApp.appId,e=window.appContext.currentApp.keys.datastoreKey,n={appId:t,pluginId:"authSettings",instanceId:"authSettings",liveMode:window.appContext.liveMode,writeKey:e};function C(e){e&&(e=window.loginUI.convertToCss(e)||"*{}",localStorage.loginUI=e);var o=e||localStorage.getItem("loginUI_"+t),n=document.getElementById("custom-login-ui");if(!n){var r=document.getElementsByClassName("login-holder")[0];(n=document.createElement("style")).id="custom-login-ui",r.appendChild(n)}n.innerHTML=o}c.updateLoginCss=function(){C()},C();var h=new DatastoreAPI(n);function v(e){return"boolean"!=typeof e||e}function b(){var e=JSON.parse(window.localStorage.getItem("SSO_USER"));if(e){(new Date).getTime()/1e3>e.ssoExpiresAt&&(c.invalidCredentials=!0,a.allowCancel=!1,a.showMenu=!1,c.showLogin(function(e,o){authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()}));var o=u;if("multipart/form-data"==m||"application/x-www-form-urlencoded"==m)var n={headers:{Authorization:"Bearer "+e.ssoUserToken,"Content-Type":"application/json"}};else{n={headers:{"Content-Type":"application/x-www-form-urlencoded"}};o=u+"?access_token="+e.ssoUserToken}window.bfUtils.http.get(o,n).success(function(e){console.log(e)}).error(function(e,o,n,r){c.invalidCredentials=!0,a.allowCancel=!1,a.showMenu=!1,c.showLogin(function(e,o){authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()})})}}c.SSOLogin=!1,h.get({tag:"authSettings"},function(e,o){e?console.error(e):o&&o.data?("SSOLogin"==o.data.signOnStrategy&&(c.SSOLogin=!0,"application/x-www-form-urlencoded"==(m=o.data.contentType)||"multipart/form-data"==m?(u=window.siteConfig.endPoints.hopHost+o.data.accessTokenAPI,p=window.siteConfig.endPoints.hopHost+o.data.loginAPI):(u=o.data.accessTokenAPI,p=o.data.loginAPI),c.enableFacebook=o.data.enableFacebook,c.enableTwitter=o.data.enableTwitter,w=o.data.signOnStrategy,i=o.data.resetPasswordAPI,f=o.data.clientId,g=o.data.clientSecret,setInterval(b,9e5)),c.enableFacebook=v(o.data.enableFacebook),c.enableTwitter=v(o.data.enableTwitter),w=o.data.signOnStrategy,"enabled"==d&&(l=o.data.domain),c.emailInputType=l?"text":"email"):(c.enableFacebook=!0,c.enableTwitter=!0)}),c.closeLogin=function(){c.loginCallback&&c.loginCallback(),a.allowCancel?c.hideLogin():S()},c.reset=function(){c.errors={},c.showProgressMessage=!1,c.invalidCredentials=!1,c.invalidReset=!1,c.invalidRegister=!1,c.allowToRegister=!1,c.uploadFile=null,c.userObj.email=null,c.userObj.username=null,c.password=null,c.secretCode=null,c.newPassword=null,c.confirmPassword=null,c.msgError=null,c.msgSuccess=null,c.uploadFile=null,c.firstName=null,c.lastName=null,c.secretCodeProvider=null,c.refWindow=null,c.acceptTOS=null,c.acceptPP=null,c.acceptedAppTerms=null};var y=function(){c.successShown=!1,c.registrationShown=!1,c.loginShown=!1,c.forgetPasswordShown=!1,c.resetPasswordShown=!1};function S(){c.reset(),y(),a.allowCancel=!c.loginOptions||!1!==c.loginOptions.allowCancel,a.showMenuOnAuth=!c.loginOptions||!1!==c.loginOptions.showMenu,c.loginShown=!0,a.authShown=!0,c.$$phase||c.$apply()}y(),c.openTermsAndConditions=function(){return window.open("https://support.appdocumentation.com/terms/","_system"),!1},c.registerUser=function(){if(c.registerClick=!0,!c.frmAuthRegister.$invalid)if(window.validator.validatePassword(c.password))c.register(),c.registerClick=!1;else{var e={data:{title:" ",body:o,disableCancel:!0}};window.openDialog(e,function(){})}},c.hideLogin=function(){c.reset(),y(),a.authShown=!1,c.loginCallback=null},c.showRegistration=function(){c.reset(),y(),c.registrationShown=!0,a.authShown=!0},c.showForgetPassword=function(){c.reset(),y(),c.forgetPasswordShown=!0,a.authShown=!0},c.showSuccess=function(e){y(),c.msgSuccess=e,c.successShown=!0},c.showResetPassword=function(e){c.reset(),y(),c.resetPasswordShown=!0,a.authShown=!0,c.loginCallback=e},c.updateLogin=function(e){e&&C(e),c.loginCallback=function(e,o){o?(window.authAPI._setCurrentUser(o),window.authAPI.triggerOnLogin(o)):console.error("authCtrl loginCallback error",e),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()},S()},c.updateLoginAuth=function(e){c.enableFacebook=v(e.enableFacebook),c.enableTwitter=v(e.enableTwitter),e.domain&&"enabled"==d&&(l=e.domain),c.$$phase||c.$apply()},c.returnToLogin=function(){c.showLogin(c.loginCallback)},c.showLogin=function(e){c.loginCallback=e,S()},c.resetPassword=function(){if(c.invalidReset=!1,c.msgError=null,c.newPassword!=c.confirmPassword)return c.invalidReset=!1,void(c.msgError="Make sure new password and confirm password are equal");var e={id:1,method:"users/changePassword",params:{email:c.email,secretCode:c.secretCode,password:c.newPassword}},o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result){c.showSuccess("Password reset successfully");var o={data:{title:" ",body:"Password reset successfully",disableCancel:!0}};window.openDialog(o,function(){})}else if(e&&e.error){o={data:{title:" ",body:e.error.message,disableCancel:!0}};window.openDialog(o,function(){}),console.error(e.error)}}).error(function(e,o,n,r){c.invalidCredentials=!0,console.error(e),callback&&callback(e,null)})},c.forgotPassword=function(e){if("SSOLogin"!=w){c.invalidCredentials=!1;var o={email:c.email,sendSecretCode:!0};e&&(o.email=e.email);var n={id:1,method:"users/forgotPassword",params:o},r=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(n));window.bfUtils.http.jsonp(r,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result)c.showResetPassword();else{var o={data:{title:" ",body:c.emailDoesNotExistTxt,disableCancel:!0}};window.openDialog(o,function(){}),e&&console.warn(e)}}).error(function(e,o,n,r){c.invalidCredentials=!0,console.error(e)})}else{var t=-1===i.indexOf("?")?"?":"&",s=i+t+"email="+c.email;window.bfUtils.http.get(s,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(){c.showLogin(function(e,o){authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,c.hideLogin(),c.$$phase||c.$apply()})}).error(function(e,o,n,r){e&&console.error(e)})}},c.showBackLogin=function(){authAPI.login()},c.login=function(e,t){window.spinner&&window.spinner.show&&window.spinner.show(!0),"SSOLogin"!=w?function(e,t){if(window.appContext&&window.appContext.currentApp){c.invalidCredentials=!1,t||(t=c.loginCallback);var o=null;o="undefined"==typeof push?{}:push;var n=c.userObj.email;"enabled"==d&&l&&!n.includes("@")&&(n+=l),console.warn("email",n);var r={email:n,password:c.password,deviceId:o.deviceId,osType:o.platform?o.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId};e&&(r.email=e.email,r.password=e.password);var s={id:1,method:"users/login",params:r},i=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(s));window.bfUtils.http.jsonp(i,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result&&e.result.userToken)authAPI._setCurrentUser(e.result),a.$broadcast("loginSuccessfully",e.result),t&&t(null,e.result);else{c.invalidCredentials=!0;var o=null;e&&e.error&&(console.warn("login error: ",e.error),o=e.error),o&&o.message?c.msgError=o.message:c.msgError="Invalid Email or Password",t&&t(o,null)}}).error(function(e,o,n,r){c.invalidCredentials=!0,console.error(e),t&&t(e,null)})}else console.error("invalid appContext")}(e,function(e,o){if(e||!o){var n=null;if(e)switch(e.code){case 1303:n=e.message;break;default:n="Invalid Login"}else n="To log in, please make sure you have a valid connection.";var r={data:{title:" ",body:n,disableCancel:!0}};window.openDialog(r,function(){}),console.error(e),t&&t(e,null)}else t||(t=c.loginCallback),t&&t(null,o);window.spinner&&window.spinner.hide&&window.spinner.hide(!0)}):function(e,i){var o={headers:{"Content-Type":"application/x-www-form-urlencoded"}},n=c.userObj.username;if("enabled"==d&&l&&!n.includes("@")&&(n+=l),"application/x-www-form-urlencoded"==m)var r=encodeURIComponent("grant_type")+"="+encodeURIComponent("password")+"&"+encodeURIComponent("username")+"="+encodeURIComponent(n)+"&"+encodeURIComponent("password")+"="+encodeURIComponent(c.password)+"&"+encodeURIComponent("client_id")+"="+encodeURIComponent(f)+"&"+encodeURIComponent("client_secret")+"="+encodeURIComponent(g);else"multipart/form-data"==m?(o={transformRequest:angular.identity,headers:{"Content-Type":void 0}},(r=new FormData).append("username",n),r.append("password",c.password)):r={grant_type:"password",username:n,password:c.password,client_id:f};window.bfUtils.http.post(p,r,o).success(function(e){if(!(o=JSON.parse(window.localStorage.getItem("SSO_USER"))))var o={};if("string"==typeof e)try{e=JSON.parse(e)}catch(e){console.warn("Unexpected parsing issue",e)}e&&e.access_token?o.ssoUserToken=e.access_token:o.ssoUserToken=e.replace(/["]+/g,""),e&&e.expires_in&&e.issued_at?o.ssoExpiresAt=e.issued_at+e.expires_in:o.ssoExpiresAt=1902608081e3,window.localStorage.setItem("SSO_USER",JSON.stringify(o));var n=null;n="undefined"==typeof push?{}:push;var r=u.replace(window.siteConfig.endPoints.hopHost,""),t={id:1,method:"users/loginSSO",params:{accessToken:o.ssoUserToken,accessTokenAPI:r,deviceId:n.deviceId,osType:n.platform?n.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId,loginProviderType:"SSO",email:c.userObj.username,contentType:m}},s=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(t));window.bfUtils.http.jsonp(s,{bypassInterceptorForStatus:404}).success(function(e){e&&e.result?(authAPI._setCurrentUser(JSON.stringify(e.result)),a.$broadcast("loginSuccessfully",e.result),i(null,e.result)):(c.invalidRegister=!0,e&&e.error?(c.msgError=e.error.message,c.invalidCredentials=!0,console.error(e.error)):(e="Could not retrieve profile info.")&&(c.msgError=e,c.invalidCredentials=!0,console.error(e)))}).error(function(e,o,n,r){console.error(e),i&&i(e,null)})}).error(function(e,o,n,r){c.invalidCredentials=!0,e&&e.error_description?(console.error(e),c.msgError=e.error_description):c.msgError="Login Failed",i&&i("Login Failed",null)})}(0,function(e,o){if(e){console.error(e);window.openDialog({data:{title:" ",body:"Invalid Login",disableCancel:!0}},function(){}),t&&t(e,null)}else t||(t=c.loginCallback),t(null,o);window.spinner&&window.spinner.hide&&window.spinner.hide(!0)})};c.loadGDPR=function(o){var e=c.userObj.email,n=siteConfig.endPoints.crmHost+"/documents/"+o+"/check?userKey="+e+"&withDetails=true";bfUtils.http.get(n).success(function(e){e&&(e[o].isAccepted||(c.GDPR_title=r.trustAsHtml(e[o].title),c.GDPR_subtitle=r.trustAsHtml(e[o].subtitle),c.GDPR_details=r.trustAsHtml(e[o].details),c.showGDPR=!0,a.$broadcast("hideNav"),c.$$phase||c.$apply()))}).error(function(e){console.error(e)})},c.hideGDPR=function(){a.$broadcast("displayNav"),c.showGDPR=!1,c.GDPR_title=null,c.GDPR_subtitle=null,c.GDPR_details=null},c.showTermsOfService=function(){c.loadGDPR("bf_terms_and_conditions")},c.showPrivacyPolicy=function(){c.loadGDPR("bf_privacy_policy")},c.showAppTerms=function(){window.open(appContext.currentApp.config.TermsOfUse,"_system")},c.shouldShowAppTerms=!!(appContext.currentApp&&appContext.currentApp.config&&appContext.currentApp.config.TermsOfUse)&&appContext.currentApp.config.TermsOfUse.indexOf("appdocumentation.com")<0,c.saveGDPR=function(){var n;n=function(e,o){var n={};o&&(n=o),n.appId=appContext.currentApp.appId;var r=siteConfig.endPoints.crmHost+"/documents/bf_terms_and_conditions/accept",t=siteConfig.endPoints.crmHost+"/documents/bf_privacy_policy/accept";bfUtils.http.post(r,{userKey:c.userObj.email,info:n,source:"app"}).success(function(e){bfUtils.http.post(t,{userKey:c.userObj.email,info:n,source:"app"}).success(function(e){window.location.hash="htmlBody"}).error(function(e){console.error(e)})}).error(function(e){console.error(e)})},window.$http.get("https://ipapi.co/json/").success(function(e){if(e){var o={ipInfo:{city:e.city,country:e.country_name,countryCode:e.country,lat:e.latitude,lon:e.longitude,regionName:e.region,timezone:e.timezone,zip:e.postal,ip:e.ip}};n(null,o)}else n(null,null)}).error(function(e){n(null,null)})},c.register=function(e,l){if(window.appContext&&window.appContext.currentApp){c.invalidRegister=!1,l||(l=c.loginCallback);var o=null;o="undefined"==typeof push?{}:push;var d={firstName:c.firstName||c.userObj.email,lastName:c.lastName||"",email:c.userObj.email,password:c.password,deviceId:o.deviceId,osType:o.platform?o.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId};e&&(d.email=e.email,d.password=e.password,d.firstName=e.firstName,d.lastName=e.lastName,e.loginProviderType&&(d.loginProviderType=e.loginProviderType));var n={id:1,method:"users/register",params:d},r=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(n));window.bfUtils.http.jsonp(r,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result)c.saveGDPR(function(e){if(e)return console.error(e)}),c.login({email:d.email,password:d.password},function(e,o){o&&o.userToken&&(c.upload(c.uploadFile,function(e,o){if(e)l&&l(e,null);else{var n=authAPI.getCurrentUser();if(o){var r={userToken:n.userToken,firstName:d.firstName,lastName:d.lastName,displayName:d.firstName+" "+d.lastName,imageUrl:o.result};s=l,i={id:1,method:"users/update",params:t=r},a=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(i)),window.bfUtils.http.jsonp(a,{bypassInterceptorForStatus:404}).success(function(e){if(e.error){var o=null;e&&e.error&&(console.error(e.error),o=e.error),s&&s(o,null)}else{var n=authAPI.getCurrentUser();null!=n&&(n.firstName=t.firstName,n.lastName=t.lastName,n.displayName=t.displayName,n.imageUrl=t.imageUrl,authAPI._setCurrentUser(n)),s&&s(null,n)}}).error(function(e,o,n,r){console.error(e),s&&s(e,null)})}else l&&l(null,n)}var t,s,i,a}),authAPI.trackRegister(o))});else{c.invalidRegister=!0;if(e&&e.error){var o={data:{title:" ",body:e.error.message,disableCancel:!0}};window.openDialog(o,function(){}),console.warn(e.error),e.error}}}).error(function(e,o,n,r){console.error(e)})}else console.error("invalid appContext")},c.upload=function(e,t){var o=authAPI.getCurrentUser();if(null!=o){var n=window.siteConfig.endPoints.authHost+"/src/server.js?method=users/uploadImage";if(e&&1==e.length){var r=e[0];s.upload({url:n,fields:{userToken:o.userToken},file:r}).progress(function(e){c.progressMessage=!0;var o=parseInt(100*e.loaded/e.total);console.log("progress: "+o+"% "+e.config.file.name)}).success(function(e,o,n,r){console.log("file "+r.file.name+"uploaded."),t&&t(null,e)}).error(function(e){c.msgError="",c.invalidRegister=!0,t&&t(e,null)})}else t&&t(null,null)}else t&&t({message:"Invalid user"},null)},c.requestLoginProvider=function(o){var e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"secretCode/request",params:{}}));c.refWindow&&!c.refWindow.closed||window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){if(null!=e&&null!=e.result&&e.result.code){c.secretCodeProvider=e.result.code,c.refWindow=window.open(window.siteConfig.endPoints.authHost+"/website/index.html?v=2.0&code="+encodeURIComponent(c.secretCodeProvider)+"&loginProviderType="+o,"_blank","location=no,enableViewportScale=yes"),c.refWindow&&c.refWindow.addEventListener&&c.refWindow.addEventListener("exit",function(){c.refWindow=null});setTimeout(P,1e3,120)}},function(e){console.log(JSON.stringify(e))})};var P=function n(r){if(window.appContext&&window.appContext.currentApp)if(0<r){var e={id:1,method:"users/secretCodeLogin",params:{code:c.secretCodeProvider,deviceId:push.deviceId,osType:push.platform?push.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId}},o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(e){if(e.error){var o=!1;1300==e.error.code&&(o=!0),1303==e.error.code&&(o=!0),o&&(c.secretCodeProvider=null)!=c.refWindow&&(c.refWindow.close(),c.refWindow=null)}else null!=e.result&&null!=e.result.userToken?(authAPI._setCurrentUser(e.result),null!=c.refWindow&&(c.refWindow.close(),c.refWindow=null),c.loginCallback&&c.loginCallback(null,authAPI.getCurrentUser())):null!=c.refWindow&&c.refWindow.closed?(c.refWindow.close(),c.secretCodeProvider=null,c.refWindow=null):setTimeout(n,1e3,r-1)},function(e){console.log(JSON.stringify(e))})}else(c.secretCodeProvider=null)!=c.refWindow&&(c.refWindow.close(),c.refWindow=null),c.loginCallback&&(c.invalidCredentials=!0,c.msgError="Invalid Login",c.loginCallback(null,null));else console.error("invalid appContext")}}]);
"use strict";var authAPI={authCtrlScope:null,init:function(e){this.context=e},login:function(e,n){var t=this.getCurrentUser();t?(n&&n(null,t),authAPI.triggerOnLogin(t)):(authAPI.authCtrlScope.loginOptions=e,authAPI.authCtrlScope.showLogin(function(e,t){!e&&t&&(authAPI._setCurrentUser(t),authAPI.triggerOnLogin(t),authAPI._checkGDPR(t),authAPI.authCtrlScope.hideLogin(),authAPI.authCtrlScope.$$phase||authAPI.authCtrlScope.$apply()),n&&n(e,t)}),authAPI.authCtrlScope.$$phase||authAPI.authCtrlScope.$apply())},_setCurrentUser:function(e){localStorage.setItem("AUTH_CURRENT_USER",JSON.stringify(e))},secondaryUserLookup:function(){return null},getCurrentUser:function(e,t){"function"==typeof e&&(t=e);var n=authAPI.secondaryUserLookup();if(n||(n=localStorage.getItem("AUTH_CURRENT_USER"),n=JSON.parse(n)),n&&n.userToken||(n=null),!t)return n;t(null,n)},_checkGDPR:function(e){if(e){var t="bf_terms_and_conditions",n="bf_privacy_policy",r=siteConfig.endPoints.crmHost+"/documents/"+t+","+n+"/check?userKey="+e.username;(bfUtils.isAppHtml5Version||bfUtils.isMobileDevice||bfUtils.isPwaAndroid||bfUtils.isPwaiOS)&&window.appContext&&1==window.appContext.liveMode&&bfUtils.http.get(r).success(function(e){e&&(e[t].isAccepted&&e[n].isAccepted||(window.location.hash="gdpr"))}).error(function(e){console.error(e)})}},logout:function(){this._setCurrentUser(null),authAPI.triggerOnLogout(null)},trackRegister:function(e){if(window.appContext&&window.appContext.liveMode){var t=new AnalyticsAPI(authAPI.context);t.setUserProperties({email:e.email,username:e.username,firstName:e.firstName,lastName:e.lastName}),t.trackAction("app/userRegistered");var n=localStorage.getItem("HISTORY_USERS");if(n){var r=JSON.parse(n);r.length&&-1==r.indexOf(e._id)&&(r.push(e._id),localStorage.setItem("HISTORY_USERS",JSON.stringify(r)))}else localStorage.setItem("HISTORY_USERS",JSON.stringify([e._id]))}},onLogin:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_LOGIN",e,!1)},onLogout:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_LOGOUT",e,!1)},onUpdate:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_UPDATE",e,!1)},triggerOnUpdate:function(e){e||(e=authAPI.getCurrentUser());var t=new CustomEvent("AUTH_CURRENT_USER_ON_UPDATE",{detail:e});document.dispatchEvent(t)},triggerOnLogin:function(e){var t=new CustomEvent("AUTH_CURRENT_USER_ON_LOGIN",{detail:e});document.dispatchEvent(t)},triggerOnLogout:function(){var e=new CustomEvent("AUTH_CURRENT_USER_ON_LOGOUT",{detail:null});document.dispatchEvent(e)},openProfile:function(e){window.location.hash="userProfile/"+e},getUserProfile:function(r,o){if(!r||!r.userId)throw new Error("userId have not been provided to getUserInfo");var s=null,e={id:1,method:"users/getPublicUser",params:{userId:r.userId}},t=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(t,{bypassInterceptorForStatus:404}).success(function(e){var t,n;o&&(e&&e.result?(s=e.result,t={id:1,method:"users/getUserProfile",params:{userId:r.userId}},n=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(t)),bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?(s=angular.extend({},e.result,s),o(null,s||null)):o(null,s))}).error(function(e,t,n,r){o&&o(e,null)})):o(null,null))}).error(function(e,t,n,r){console.error(e),o&&o(e,null)})},getUsersByEmail:function(r,o){if(!r||!r.emails)throw new Error("No emails have not been provided to getUserByEmail");var t=function(t){var e={id:1,method:"users/getUsersProfilesByEmail",params:{emails:r.emails}},n=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?function(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<t.length;r++)e[n].email==t[r].email&&(e[n].phone=t[r].phone);o(null,e)}(t,e.result):o(null,t))}).error(function(e,t,n,r){console.error(e),o&&o(e,null)})},e={id:1,method:"users/getUsersByEmail",params:{emails:r.emails}},n=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?t(e.result):o(null,null))}).error(function(e,t,n,r){console.error(e),o&&o(e,null)})},getUserPictureUrl:function(e){var t=null,n=null;if(e||(e={}),e.userId&&(t="userId",n=e.userId),e.email&&(t="email",n=e.email),e.username&&(t="username",n=e.username),!t||!n)throw Error("Invalid user picture params");return window.siteConfig.endPoints.authHost+"/src/server.js/user/picture?"+t+"="+n}};
"use strict";$app.controller("modalCtrl",["$scope","$dialog","$data",function(l,e,o){l.modal={},l.modal.body=o.body,l.modal.title=o.title?o.title:"Confirm",l.modal.okText=o.okText?o.okText:"OK",l.modal.cancelText=o.cancelText?o.cancelText:"Cancel",l.modal.disableCancel=!!o.disableCancel&&o.disableCancel,l.close=function(){e.close(!1)},l.confirm=function(){e.close(!0)}}]);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};setTimeout(function(){if(sessionStorage.getItem("notification"))try{var n=JSON.parse(sessionStorage.getItem("notification"));LocalNotificationsAPI.navToPlugin(n)}finally{sessionStorage.removeItem("notification")}},2e3);var LocalNotificationsAPI=function(){var c={},o="Cordova notification plugin not installed";function l(n){this.context=n}function r(n){return c.hasOwnProperty(n)}function s(n){r(n)&&(clearTimeout(c[n]),delete c[n])}function i(){return"undefined"!=typeof cordova}return l.prototype={schedule:function(n,t){var o=Math.floor(1e9*Math.random()),i=new Date;if(l.isPluginAvailable())n.badge=0,n.at?n.at=Date.parse(n.at):n.at=new Date(i.getTime()+250),n.id=o,n.data={actionItem:n.actionItem,pluginData:n.data,returnInstanceId:n.returnToPluginInstanceId||this.context.instanceId,launchInstanceId:this.context.instanceId},cordova.plugins.notification.local.schedule(n),t(null,{id:n.id});else{var a=Math.abs(Date.parse(n.at)-Date.now());if(a<-2e3)return;n.data={actionItem:n.actionItem,pluginData:n.data,returnInstanceId:n.returnToPluginInstanceId||this.context.instanceId,launchInstanceId:this.context.instanceId};var e=setTimeout(function(){r(o)&&(l.notificationModal(n),s(o))},a);c[o]=e,t(null,{id:o})}},cancel:function(n,t){l.isPluginAvailable()?(cordova.plugins.notification.local.cancel(n),t(null,{id:n})):i()?t(new Error(o),null):(s(n),t(null,{id:n}))},checkPermission:function(n,t){if(i())return l.isPluginAvailable()?void cordova.plugins.notification.local.hasPermission(function(n){t&&t(null,n)}):(t&&t(new Error(o),!1),void console.warn(o));t&&t(null,!0)},requestPermission:function(n,t){if(i())return l.isPluginAvailable()?void cordova.plugins.notification.local.hasPermission(function(n){n?t&&t(null,!0):cordova.plugins.notification.local.registerPermission(function(n){n?t&&t(null,!0):(console.warn("Permission not granted for local notifications"),t&&t(null,!1))})}):(t&&t(new Error(o),!1),void console.warn(o));t&&t(null,!0)}},l.isPluginAvailable=function(){var n=!0;return"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.notification&&cordova.plugins.notification.local||(n=!1),n},l.getPlatform=function(){return device.platform?device.platform.toLowerCase():""},l.notificationModal=function(t){var n={data:{title:t.title,body:t.text}};window.openDialog(n,function(n){n&&l.navToPlugin(t)})},l.navToPlugin=function(a){var n=postMaster.launcherPluginAPI?0:1500;setTimeout(function(){var n,t,o,i;postMaster.launcherPluginAPI&&(t=2e3,i=(o={doNothing:0,sendToLauncher:1,sendToPlugin:2}).sendToPlugin,"object"!==_typeof(a.data)&&(a.data=JSON.parse(a.data)),a.data.actionItem&&ActionItemsAPI.prototype.execute(a.data.actionItem,function(n,t){}),"home"==(n=a.data.returnInstanceId?a.data.returnInstanceId.toLowerCase():"")||"none"==n?i=o.doNothing:postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.context&&postMaster.launcherPluginAPI.context.instanceId==n&&(i=o.sendToLauncher),i!==o.doNothing&&(o===o.sendToLauncher?(t=500,postMaster.launcherPluginAPI.navigation.navigateHome()):(i=o.sendToPlugin,postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI.context&&postMaster.widgetPluginAPI.context.instanceId==a.data.returnInstanceId?t=500:postMaster.launcherPluginAPI.navigation.navigateToPluginInstance({instanceId:a.data.returnInstanceId})),setTimeout(function(){var n=new Packet(null,"notifications.localNotification.onClick",a.data.pluginData);i===o.sendToLauncher?postMaster.launcherPluginAPI.sendMessage(null,n):postMaster.widgetPluginAPI.sendMessage(null,n)},t)))},n)},l}();document.addEventListener("deviceready",function(){LocalNotificationsAPI.isPluginAvailable()&&(cordova.plugins.notification.local.on("trigger",function(n){console.log("*** notification trigger ***"),"ios"==LocalNotificationsAPI.getPlatform()&&LocalNotificationsAPI.notificationModal(n)}),cordova.plugins.notification.local.on("click",function(n){console.log("*** notification click ***"),LocalNotificationsAPI.navToPlugin(n)}))});
"use strict";var localStorageAPI={_prefix:"_bfls_",setItem:function(e,a){e&&e.key&&e.value?(localStorage.setItem(localStorageAPI._prefix+e.key,e.value),a(null,!0)):a(new Error("invalid parameters. Expected Key/Value object"))},getItem:function(e,a){(e&&e.key&&(e=e.key),e&&a)?a(null,localStorage.getItem(localStorageAPI._prefix+e)):a(new Error("invalid parameters. Expected Key and Callback"))},removeItem:function(e,a){e&&e.key&&(e=e.key),e&&a?(localStorage.removeItem(localStorageAPI._prefix+e),a(null,!0)):a(new Error("invalid parameters. Expected Key and Callback"))}};
"use strict";var validator={validatePassword:function(t){if(!t||t.length<8||60<t.length)return!1;var a=/[A-Z]/.test(t),r=/[a-z]/.test(t),e=/\d/.test(t),s=/\W/.test(t);return a&&r&&e&&s},passwordPattern:{test:function(t){return validator.validatePassword(t)}}};
"use strict";function PushNotificationsAPI(t){this.context=t}PushNotificationsAPI.prototype={schedule:function(t,o){if(t&&t.text&&t.title)if(this.context&&this.context.instanceId){t.at||(t.at=new Date),t.groupName||(t.groupName="");var i={groupID:PushNotificationsAPI._getGroupID(this.context,t.groupName),users:t.users,userTags:t.userTags,title:t.title,message:t.text,sendAfter:t.at,source:"plugin",richMessage:t.inAppMessage||void 0};i.sourceId=window.appContext.currentApp.appId+"_"+this.context.instanceId+"_"+i.source,!1!==t.actionItem&&(t.actionItem?i.actionItem=t.actionItem:i.actionItem={title:"View",action:"linkToApp",instanceId:this.context.instanceId,queryString:t.queryString}),authAPI.getCurrentUser(function(t,e){i.authCreatedBy=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/notification/",i).success(function(t){o&&o(null,t)}).error(function(t,e,i,n){o&&o(t)})})}else o&&o("instanceId is null, unable to build groupID");else o&&o("text or title is empty")},cancel:function(i,o){if(i)if(this.context&&this.context.instanceId){var n={source:"plugin"};n.sourceId=window.appContext.currentApp.appId+"_"+this.context.instanceId+"_"+n.source,authAPI.getCurrentUser(function(t,e){n.authCanceledBy=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/notification/"+i+"/cancel",n).success(function(t){o&&o(null,!0)}).error(function(t,e,i,n){o&&o(t)})})}else o&&o("instanceId is null, unable to build groupID");else o&&o("id is empty")},subscribe:function(t,e){if(t||(t={}),t.groupName||(t.groupName=""),this.context&&this.context.instanceId){var i=PushNotificationsAPI._getGroupID(this.context,t.groupName);PushNotificationsAPI._subscribe({groupID:i},e)}else e&&e("instanceId is null, unable to build groupID")},unsubscribe:function(t,e){if(t||(t={}),t.groupName||(t.groupName=""),this.context&&this.context.instanceId){var i=PushNotificationsAPI._getGroupID(this.context,t.groupName);PushNotificationsAPI._unsubscribe({groupID:i},e)}else e&&e("instanceId is null, unable to build groupID")}},PushNotificationsAPI._getGroupID=function(t,e){return window.appContext.currentApp.appId+"_"+t.instanceId+"_"+e},PushNotificationsAPI._unsubscribe=function(i,o){window.push&&window.push.deviceId&&window.push.platform?(i||(i={}),i.groupID?authAPI.getCurrentUser(function(t,e){i.deviceID=push.deviceId,i.os=window.push.platform?window.push.platform.toLowerCase():"",i.authUserId=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/unsubscribe/",i).success(function(t){o&&o(null,!0)}).error(function(t,e,i,n){o&&o(t)})}):o("groupID is not specified")):o&&o("Device not ready to get the deviceId")},PushNotificationsAPI._subscribe=function(s,u){window.push&&window.push.deviceId&&window.push.platform?(s||(s={}),s.groupID||(s.groupID=""),authAPI.getCurrentUser(function(t,e){var i="undefined"!=typeof PushNotification&&void 0!==PushNotification.listChannels,n=device.platform&&"android"===device.platform.toLowerCase()&&i;s.deviceID=push.deviceId,s.os=window.push.platform?window.push.platform.toLowerCase():"",s.authUserId=e&&e._id?e._id.toString():null,s.device="undefined"!=typeof device?device:null,s.deliveryMethod=n?"FCM":null;var o=localStorage.getItem("currentPushDeviceID");o&&o!==push.deviceId&&(s.oldDeviceID=o),bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscribe/",s).success(function(t){localStorage.setItem("currentPushDeviceID",push.deviceId),u&&u(null,!0)}).error(function(t,e,i,n){u&&u(t)})})):u&&u("Device not ready to get the deviceId")},authAPI.onLogin(function(){setTimeout(function(){PushNotificationsAPI._subscribe()},2e3)}),authAPI.onLogout(function(){setTimeout(function(){PushNotificationsAPI._subscribe()},2e3)});
"use strict";function FirebaseAPI(n){this.context=n}FirebaseAPI.prototype={createCustomToken:function(i,o){var a=this;function s(e){FirebaseAPI._getUser({instanceId:a.context.instanceId,appId:window.appContext.currentApp.appId,integrationToken:i.integrationToken},function(n,t){!t||i&&i.forceLogin?bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/user/firebase/login",{authUserId:e._id,authAccessToken:e.accessToken,pluginTypesToken:a.context.pluginId,appId:window.appContext.currentApp.appId,instanceId:a.context.instanceId,integrationToken:i.integrationToken}).success(function(n){FirebaseAPI._setUser({instanceId:a.context.instanceId,appId:window.appContext.currentApp.appId,integrationToken:i.integrationToken},n),o&&o(null,n)}).error(function(n,t,e,i){401==t||403==t?(authAPI.logout(),authAPI.login({},function(n,t){t?s(t):o&&o(null,null)})):o&&o(n)}):o&&o(null,t)})}authAPI.getCurrentUser(function(n,t){t?s(t):authAPI.login({},function(n,t){t?s(t):o&&o(null,null)})})}},function(){var a={};FirebaseAPI._getUser=function(n,t){var e=n.appId+"_"+n.instanceId+"_"+n.integrationToken,i=a[e],o=new Date;o.setMinutes(o.getMinutes()-60),i&&i.createdOn>o?t(null,i.value):(a[e]=void 0,t(null,null))},FirebaseAPI._setUser=function(n,t){var e=n.appId+"_"+n.instanceId+"_"+n.integrationToken;a[e]={createdOn:new Date,value:t}},authAPI.onLogout(function(){a={}})}();
"use strict";function PublicFilesAPI(e){this.context=e}PublicFilesAPI.prototype={showDialog:function(l,o){l||(l={});var a=this,i=[],s=[],u=null;function r(s,r){return new Promise(function(t,e){var n=!0;if(l.filter&&!function(e,t){for(var n=0;n<=t.length;n++)if(t[n]==e.type)return!0;return!1}(s,l.filter)&&(r.status="failed",r.error="invalid File Format",a._onComplete&&a._onComplete(r),n=!1,t(r)),1e7<s.size&&(r.status="failed",r.error="invalid File Size",a._onComplete&&a._onComplete(r),n=!1,t(r)),n){var o=new FormData;o.append("file",s),o.append("pluginId",a.context.pluginId),o.append("instanceId",a.context.instanceId),o.append("appId",a.context.appId),u&&u.accessToken&&o.append("accessToken",u.accessToken);var i=new XMLHttpRequest;i.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);r.percentage=t,a._onProgress&&a._onProgress(r)}},!1),i.onload=function(){var e=null;i.responseText&&(e=JSON.parse(i.responseText)),200==i.status?(r.url=e.url,r.status="success"):(r.status="failed",e.message?r.error=e.message:r.error="An error has occurred"),a._onComplete&&a._onComplete(r),t(r)},i.onerror=function(){r.status="failed",a._onComplete&&a._onComplete(r),t(r)},i.timeout=6e4,i.open("POST",window.siteConfig.endPoints.publicFilesHost+"/publicFiles/upload/"),i.send(o)}})}window.authAPI.getCurrentUser(function(e,t){t&&(u=t);var n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("style","display:none"),n.setAttribute("id","publicFilesHiddenInput"+(new Date).toISOString()),document.body.appendChild(n),l&&l.allowMultipleFilesUpload&&(n.setAttribute("multiple",""),n.setAttribute("name","files[]")),l&&l.filter&&(n.accept=l.filter.join(",")),n.addEventListener("change",function(){!function(e){for(var t=0;t<e.length;t++){var n={fileId:t,filename:e[t].name};e[t].fileId=t,s.push(n),i.push(r(e[t],n))}Promise.all(i).then(function(e){console.log(e),o(null,e)})}(this.files)},!1),setTimeout(function(){n.click()})})},onProgress:function(e){this._onProgress=e},onComplete:function(e){this._onComplete=e}};
"use strict";var imagePreviewerAPI={show:function(n,e){this.initialized||this.renderHTML();var i=document.querySelectorAll(".pswp")[0];e=e||Function.prototype;var s={index:0<=n.index?n.index:0,history:!1,counterEl:!1,captionEl:!1,fullscreenEl:!1,zoomEl:!1,arrowEl:!1,preloaderEl:!1,shareEl:!1,tapToToggleControls:!1,correctOrientation:!0},o=window.PhotoSwipeUI_Default;if(n&&n.images&&n.images.length){n.images[0]&&n.images[0].name&&(n.images=n.images.map(function(n){return n.name}));var t=[];n.images.forEach(function(e){var n=new Promise(function(n){var t=new Image;t.onload=function(){return n(t)},t.src=e});t.push(n)}),Promise.all(t).then(function(n){var t=[];n.forEach(function(e){t.push(new Promise(function(t){EXIF.getData(e,function(){var n=EXIF.getTag(this,"Orientation");t(3===n||6===n?{src:"https://czi3m2qn.cloudimg.io/crop/"+e.naturalHeight+"x"+e.naturalWidth+"/q100/"+e.src,w:e.naturalHeight,h:e.naturalWidth}:{src:"https://czi3m2qn.cloudimg.io/crop/"+e.naturalWidth+"x"+e.naturalHeight+"/q100/"+e.src,w:e.naturalWidth,h:e.naturalHeight})})}))}),Promise.all(t).then(function(n){window.pswp=new PhotoSwipe(i,o,n,s),window.pswp.listen("close",e),window.pswp.init()})})}},renderHTML:function(){var n=document.createElement("div");n.style.position="relative",n.style.zIndex=99999999,n.innerHTML='\n    \x3c!-- Root element of PhotoSwipe. Must have class pswp. --\x3e\n    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">\n\n        \x3c!-- Background of PhotoSwipe.\n             It\'s a separate element as animating opacity is faster than rgba(). --\x3e\n        <div class="pswp__bg"></div>\n\n        \x3c!-- Slides wrapper with overflow:hidden. --\x3e\n        <div class="pswp__scroll-wrap">\n\n            \x3c!-- Container that holds slides.\n                PhotoSwipe keeps only 3 of them in the DOM to save memory.\n                Don\'t modify these 3 pswp__item elements, data is added later on. --\x3e\n            <div class="pswp__container">\n                <div class="pswp__item"></div>\n                <div class="pswp__item"></div>\n                <div class="pswp__item"></div>\n            </div>\n\n            \x3c!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. --\x3e\n            <div class="pswp__ui pswp__ui--hidden">\n\n                <div class="pswp__top-bar" style="background: transparent !important; padding-top: env(safe-area-inset-top); padding-top: const(safe-area-inset-top);">\n\n                    \x3c!--  Controls are self-explanatory. Order can be changed. --\x3e\n\n                    <div class="pswp__counter"></div>\n\n                    <span class="glyphicon glyphicon-remove pswp__button pswp__button--close" title="Close (Esc)" style="color: #FFF !important;font-size: 20pt;padding: 15px;width:55px;height:55px">\n                    </span>\n\n                    <button class="pswp__button pswp__button--share" title="Share"></button>\n\n                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n\n                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n\n                    \x3c!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR --\x3e\n                    \x3c!-- element will get class pswp__preloader--active when preloader is running --\x3e\n                    <div class="pswp__preloader">\n                        <div class="pswp__preloader__icn">\n                          <div class="pswp__preloader__cut">\n                            <div class="pswp__preloader__donut"></div>\n                          </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n                    <div class="pswp__share-tooltip"></div>\n                </div>\n\n                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">\n                </button>\n\n                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">\n                </button>\n\n                <div class="pswp__caption">\n                    <div class="pswp__caption__center"></div>\n                </div>\n\n            </div>\n\n        </div>\n\n    </div>\n    ',0<=window.location.pathname.indexOf("pluginTester")?document.getElementById("app").appendChild(n):document.body.appendChild(n),this.initialized=!0}};
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var c=!1,l=function e(t){return t instanceof e?t:this instanceof e?void(this.EXIFwrapped=t):new e(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=l),exports.EXIF=l):this.EXIF=l;var u=l.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},f=l.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},g=l.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},m=l.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},p=l.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function o(e){return!!e.exifdata}function d(e){var t=new DataView(e);if(c&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return c&&console.log("Not a valid JPEG"),!1;for(var n,r=2,o=e.byteLength;r<o;){if(255!=t.getUint8(r))return c&&console.log("Not a valid marker at offset "+r+", found: "+t.getUint8(r)),!1;if(n=t.getUint8(r+1),c&&console.log(n),225==n)return c&&console.log("Found 0xFFE1 marker"),i(t,r+4,t.getUint16(r+2));r+=2+t.getUint16(r+2)}}var h={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function S(e,t,n){for(var r,o,i,a,s=new DataView(e),l={},u=t;u<t+n;)28===s.getUint8(u)&&2===s.getUint8(u+1)&&(a=s.getUint8(u+2))in h&&(i=s.getInt16(u+3),o=h[a],r=b(s,u+5,i),l.hasOwnProperty(o)?l[o]instanceof Array?l[o].push(r):l[o]=[l[o],r]:l[o]=r),u++;return l}function y(e,t,n,r,o){var i,a,s,l=e.getUint16(n,!o),u={};for(s=0;s<l;s++)i=n+12*s+2,!(a=r[e.getUint16(i,!o)])&&c&&console.log("Unknown tag: "+e.getUint16(i,!o)),u[a]=P(e,i,t,n,o);return u}function P(e,t,n,r,o){var i,a,s,l,u,c,f=e.getUint16(t+2,!o),d=e.getUint32(t+4,!o),g=e.getUint32(t+8,!o)+n;switch(f){case 1:case 7:if(1==d)return e.getUint8(t+8,!o);for(i=4<d?g:t+8,a=[],l=0;l<d;l++)a[l]=e.getUint8(i+l);return a;case 2:return b(e,i=4<d?g:t+8,d-1);case 3:if(1==d)return e.getUint16(t+8,!o);for(i=2<d?g:t+8,a=[],l=0;l<d;l++)a[l]=e.getUint16(i+2*l,!o);return a;case 4:if(1==d)return e.getUint32(t+8,!o);for(a=[],l=0;l<d;l++)a[l]=e.getUint32(g+4*l,!o);return a;case 5:if(1==d)return u=e.getUint32(g,!o),c=e.getUint32(g+4,!o),(s=new Number(u/c)).numerator=u,s.denominator=c,s;for(a=[],l=0;l<d;l++)u=e.getUint32(g+8*l,!o),c=e.getUint32(g+4+8*l,!o),a[l]=new Number(u/c),a[l].numerator=u,a[l].denominator=c;return a;case 9:if(1==d)return e.getInt32(t+8,!o);for(a=[],l=0;l<d;l++)a[l]=e.getInt32(g+4*l,!o);return a;case 10:if(1==d)return e.getInt32(g,!o)/e.getInt32(g+4,!o);for(a=[],l=0;l<d;l++)a[l]=e.getInt32(g+8*l,!o)/e.getInt32(g+4+8*l,!o);return a}}function b(e,t,r){var o="";for(n=t;n<t+r;n++)o+=String.fromCharCode(e.getUint8(n));return o}function i(e,t){if("Exif"!=b(e,t,4))return c&&console.log("Not valid EXIF data! "+b(e,t,4)),!1;var n,r,o,i,a,s=t+6;if(18761==e.getUint16(s))n=!1;else{if(19789!=e.getUint16(s))return c&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;n=!0}if(42!=e.getUint16(s+2,!n))return c&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var d=e.getUint32(s+4,!n);if(d<8)return c&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(s+4,!n)),!1;if((r=y(e,s,s+d,f,n)).ExifIFDPointer)for(o in i=y(e,s,s+r.ExifIFDPointer,u,n)){switch(o){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":i[o]=p[o][i[o]];break;case"ExifVersion":case"FlashpixVersion":i[o]=String.fromCharCode(i[o][0],i[o][1],i[o][2],i[o][3]);break;case"ComponentsConfiguration":i[o]=p.Components[i[o][0]]+p.Components[i[o][1]]+p.Components[i[o][2]]+p.Components[i[o][3]]}r[o]=i[o]}if(r.GPSInfoIFDPointer)for(o in a=y(e,s,s+r.GPSInfoIFDPointer,g,n)){switch(o){case"GPSVersionID":a[o]=a[o][0]+"."+a[o][1]+"."+a[o][2]+"."+a[o][3]}r[o]=a[o]}return r.thumbnail=function(e,t,n,r){var o,i,a,s,l=(i=t+d,a=r,s=(o=e).getUint16(i,!a),o.getUint32(i+2+12*s,!a));if(!l)return{};if(l>e.byteLength)return{};var u=y(e,t,t+l,m,r);if(u.Compression)switch(u.Compression){case 6:if(u.JpegIFOffset&&u.JpegIFByteCount){var c=t+u.JpegIFOffset,f=u.JpegIFByteCount;u.blob=new Blob([new Uint8Array(e.buffer,c,f)],{type:"image/jpeg"})}break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",u.Compression)}else 2==u.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");return u}(e,s,0,n),r}function F(e){var t={};if(1==e.nodeType){if(0<e.attributes.length){t["@attributes"]={};for(var n=0;n<e.attributes.length;n++){var r=e.attributes.item(n);t["@attributes"][r.nodeName]=r.nodeValue}}}else if(3==e.nodeType)return e.nodeValue;if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var i=e.childNodes.item(o),a=i.nodeName;if(null==t[a])t[a]=F(i);else{if(null==t[a].push){var s=t[a];t[a]=[],t[a].push(s)}t[a].push(F(i))}}return t}function x(e){try{var t={};if(0<e.children.length)for(var n=0;n<e.children.length;n++){var r=e.children.item(n),o=r.attributes;for(var i in o){var a=o[i],s=a.nodeName,l=a.nodeValue;void 0!==s&&(t[s]=l)}var u=r.nodeName;if(void 0===t[u])t[u]=F(r);else{if(void 0===t[u].push){var c=t[u];t[u]=[],t[u].push(c)}t[u].push(F(r))}}else t=e.textContent;return t}catch(e){console.log(e.message)}}l.enableXmp=function(){l.isXmpEnabled=!0},l.disableXmp=function(){l.isXmpEnabled=!1},l.getData=function(e,t){return!((self.Image&&e instanceof self.Image||self.HTMLImageElement&&e instanceof self.HTMLImageElement)&&!e.complete||(o(e)?t&&t.call(e):function(o,i){function t(e){var t=d(e);o.exifdata=t||{};var n=function(e){var t=new DataView(e);if(c&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return c&&console.log("Not a valid JPEG"),!1;for(var n,r,o=2,i=e.byteLength;o<i;){if(r=o,56===(n=t).getUint8(r)&&66===n.getUint8(r+1)&&73===n.getUint8(r+2)&&77===n.getUint8(r+3)&&4===n.getUint8(r+4)&&4===n.getUint8(r+5)){var a=t.getUint8(o+7);return a%2!=0&&(a+=1),0===a&&(a=4),S(e,o+8+a,t.getUint16(o+6+a))}o++}}(e);if(o.iptcdata=n||{},l.isXmpEnabled){var r=function(e){if("DOMParser"in self){var t=new DataView(e);if(c&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return c&&console.log("Not a valid JPEG"),!1;for(var n=2,r=e.byteLength,o=new DOMParser;n<r-4;){if("http"==b(t,n,4)){var i=b(t,n-1,t.getUint16(n-2)-1),a=i.indexOf("xmpmeta>")+8,s=(i=i.substring(i.indexOf("<x:xmpmeta"),a)).indexOf("x:xmpmeta")+10;return i=i.slice(0,s)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+i.slice(s),x(o.parseFromString(i,"text/xml"))}n++}}}(e);o.xmpdata=r||{}}i&&i.call(o)}var e,n,r;if(o.src)if(/^data\:/i.test(o.src))t(function(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(e),r=n.length,o=new ArrayBuffer(r),i=new Uint8Array(o),a=0;a<r;a++)i[a]=n.charCodeAt(a);return o}(o.src));else if(/^blob\:/i.test(o.src))(s=new FileReader).onload=function(e){t(e.target.result)},e=o.src,n=function(e){s.readAsArrayBuffer(e)},(r=new XMLHttpRequest).open("GET",e,!0),r.responseType="blob",r.onload=function(e){200!=this.status&&0!==this.status||n(this.response)},r.send();else{var a=new XMLHttpRequest;a.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";t(a.response),a=null},a.open("GET",o.src,!0),a.responseType="arraybuffer",a.send(null)}else if(self.FileReader&&(o instanceof self.Blob||o instanceof self.File)){var s;(s=new FileReader).onload=function(e){c&&console.log("Got file of length "+e.target.result.byteLength),t(e.target.result)},s.readAsArrayBuffer(o)}}(e,t),0))},l.getTag=function(e,t){if(o(e))return e.exifdata[t]},l.getIptcTag=function(e,t){if(o(e))return e.iptcdata[t]},l.getAllTags=function(e){if(!o(e))return{};var t,n=e.exifdata,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);return r},l.getAllIptcTags=function(e){if(!o(e))return{};var t,n=e.iptcdata,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);return r},l.pretty=function(e){if(!o(e))return"";var t,n=e.exifdata,r="";for(t in n)n.hasOwnProperty(t)&&("object"==_typeof(n[t])?n[t]instanceof Number?r+=t+" : "+n[t]+" ["+n[t].numerator+"/"+n[t].denominator+"]\r\n":r+=t+" : ["+n[t].length+" values]\r\n":r+=t+" : "+n[t]+"\r\n");return r},l.readFromBinaryFile=function(e){return d(e)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return l})}).call(void 0);