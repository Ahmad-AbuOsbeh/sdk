"use strict";var postMaster={controlPluginAPI:null,widgetPluginAPI:null,launcherPluginAPI:null,servicePluginAPIs:{},postMessageHandler:function(t){if(t.data){if("object"==typeof t.data)t.packet=t.data;else try{t.packet=JSON.parse(t.data)}catch(e){return void console.log("!! Post Master:: Ignore Invalid packet",e,t.data)}postMaster._acceptRequest(t)}},_acceptRequest:function(e){if(e&&e.packet&&e.packet.cmd){var t=!1,t=s(postMaster.widgetPluginAPI,e);if(!t&&!(t=postMaster.widgetPluginAPI!=postMaster.launcherPluginAPI?s(postMaster.launcherPluginAPI,e):t)&&!(t=s(postMaster.controlPluginAPI,e))){for(var n in postMaster.servicePluginAPIs)if(t=s(postMaster.servicePluginAPIs[n],e))return;t||console.warn("no home for this packet (sad face) ")}}function s(e,t){if(!e||!e.postMessageHandler||!t)return!1;try{return e.postMessageHandler(t)}catch(e){return console.error("postMessageHandler error:",e),!1}}},broadcast:function(t,n){function e(e){e&&(n&&e.context.instanceId!=n||e.sendMessage(null,t))}for(var s in e(postMaster.controlPluginAPI),postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI!=postMaster.launcherPluginAPI&&e(postMaster.widgetPluginAPI),postMaster.launcherPluginAPI&&postMaster.widgetPluginAPI==postMaster.launcherPluginAPI&&(t.fid=postMaster.launcherPluginAPI.iFrameId),postMaster.launcherPluginAPI&&e(postMaster.launcherPluginAPI),postMaster.servicePluginAPIs)e(postMaster.servicePluginAPIs[s])},attachService:function(e,t){this.servicePluginAPIs[e]=t},dettachService:function(e){delete this.servicePluginAPIs[e]},isLauncherPluginActive:function(){return-1<["","#/","#"].indexOf(window.location.hash)},isWidgetPluginInactive:function(){return null==postMaster.widgetPluginAPI||postMaster.widgetPluginAPI==postMaster.launcherPluginAPI},isPageActive:function(){return!this.isLauncherPluginActive()&&(window.location.href.indexOf("#/pluginContainer")<0||this.isWidgetPluginInactive())}};window.addEventListener("message",postMaster.postMessageHandler,!1);
"use strict";!function(t,h,u){function r(t,e,i){return setTimeout(a(t,i),e)}function i(t,e,i){return Array.isArray(t)&&(s(t,i[e],i),1)}function s(t,e,i){if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==u)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(var n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function o(t,e,i){for(var n=Object.keys(e),s=0;s<n.length;)i&&t[n[s]]!==u||(t[n[s]]=e[n[s]]),s++;return t}function n(t,e){return o(t,e,!0)}function e(t,e,i){var n=e.prototype,e=t.prototype=Object.create(n);e.constructor=t,e._super=n,i&&o(e,i)}function a(t,e){return function(){return t.apply(e,arguments)}}function c(t,e){return typeof t==J?t.apply(e&&e[0]||u,e):t}function l(t,e){return t===u?e:t}function p(e,t,i){s(m(t),function(t){e.addEventListener(t,i,!1)})}function f(e,t,i){s(m(t),function(t){e.removeEventListener(t,i,!1)})}function d(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function v(t,e){return-1<t.indexOf(e)}function m(t){return t.trim().split(/\s+/g)}function g(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function T(t){return Array.prototype.slice.call(t,0)}function y(t,i,e){for(var n=[],s=[],r=0;r<t.length;){var o=i?t[r][i]:t[r];g(s,o)<0&&n.push(t[r]),s[r]=o,r++}return n=e?i?n.sort(function(t,e){return t[i]>e[i]}):n.sort():n}function E(t,e){for(var i,n=e[0].toUpperCase()+e.slice(1),s=0;s<Z.length;){if((i=(i=Z[s])?i+n:e)in t)return i;s++}return u}function I(t){t=t.ownerDocument;return t.defaultView||t.parentWindow}function A(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){c(e.options.enable,[e])&&i.handler(t)},this.init()}function _(t,e,i){var n=i.pointers.length,s=i.changedPointers.length,r=e&ht&&n-s==0,s=e&(at|ut)&&n-s==0;i.isFirst=!!r,i.isFinal=!!s,r&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,n=e.pointers,s=n.length;i.firstInput||(i.firstInput=D(e)),1<s&&!i.firstMultiple?i.firstMultiple=D(e):1===s&&(i.firstMultiple=!1);var r=i.firstInput,o=i.firstMultiple,h=(o||r).center,s=e.center=S(n);e.timeStamp=$(),e.deltaTime=e.timeStamp-r.timeStamp,e.angle=C(h,s),e.distance=b(h,s),function(t,e){var i=e.center,n=t.offsetDelta||{},s=t.prevDelta||{},r=t.prevInput||{};e.eventType!==ht&&r.eventType!==at||(s=t.prevDelta={x:r.deltaX||0,y:r.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=s.x+(i.x-n.x),e.deltaY=s.y+(i.y-n.y)}(i,e),e.offsetDirection=w(e.deltaX,e.deltaY),e.scale=o?function(t,e){return b(e[0],e[1],yt)/b(t[0],t[1],yt)}(o.pointers,n):1,e.rotation=o?function(t,e){return C(e[1],e[0],yt)-C(t[1],t[0],yt)}(o.pointers,n):0,function(t,e){var i,n,s=t.lastInterval||e,r=e.timeStamp-s.timeStamp;{var o,h,a;e.eventType!=ut&&(ot<r||s.velocity===u)?(o=s.deltaX-e.deltaX,h=s.deltaY-e.deltaY,a=function(t,e,i){return{x:e/t||0,y:i/t||0}}(r,o,h),i=a.x,n=a.y,a=Q(a.x)>Q(a.y)?a.x:a.y,h=w(o,h),t.lastInterval=e):(a=s.velocity,i=s.velocityX,n=s.velocityY,h=s.direction)}e.velocity=a,e.velocityX=i,e.velocityY=n,e.direction=h}(i,e);t=t.element;d(e.srcEvent.target,t)&&(t=e.srcEvent.target),e.target=t}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function D(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:K(t.pointers[i].clientX),clientY:K(t.pointers[i].clientY)},i++;return{timeStamp:$(),pointers:e,center:S(e),deltaX:t.deltaX,deltaY:t.deltaY}}function S(t){var e=t.length;if(1===e)return{x:K(t[0].clientX),y:K(t[0].clientY)};for(var i=0,n=0,s=0;s<e;)i+=t[s].clientX,n+=t[s].clientY,s++;return{x:K(i/e),y:K(n/e)}}function w(t,e){return t===e?ct:Q(t)>=Q(e)?0<t?lt:pt:0<e?ft:dt}function b(t,e,i){var n=e[(i=i||Tt)[0]]-t[i[0]],i=e[i[1]]-t[i[1]];return Math.sqrt(n*n+i*i)}function C(t,e,i){var n=e[(i=i||Tt)[0]]-t[i[0]],i=e[i[1]]-t[i[1]];return 180*Math.atan2(i,n)/Math.PI}function R(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.allow=!0,this.pressed=!1,A.apply(this,arguments)}function z(){this.evEl=_t,this.evWin=Dt,A.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,A.apply(this,arguments)}function P(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},A.apply(this,arguments)}function M(){A.apply(this,arguments);var t=a(this.handler,this);this.touch=new P(this.manager,t),this.mouse=new R(this.manager,t)}function O(t,e){this.manager=t,this.set(e)}function x(t){this.id=tt++,this.manager=null,this.options=n(t||{},this.defaults),this.options.enable=l(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function X(t){return t==dt?"down":t==ft?"up":t==lt?"left":t==pt?"right":""}function Y(t,e){e=e.manager;return e?e.get(t):t}function F(){x.apply(this,arguments)}function W(){F.apply(this,arguments),this.pX=null,this.pY=null}function q(){F.apply(this,arguments)}function L(){x.apply(this,arguments),this._timer=null,this._input=null}function H(){F.apply(this,arguments)}function k(){F.apply(this,arguments)}function U(){x.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function G(t,e){return(e=e||{}).recognizers=l(e.recognizers,G.defaults.preset),new V(t,e)}function V(t,e){this.options=n(e=e||{},G.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=new((t=this).options.inputClass||(it?z:nt?P:et?M:R))(t,_),this.touchAction=new O(this,this.options.touchAction),j(this,!0),s(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function j(t,i){var n=t.element;s(t.options.cssProps,function(t,e){n.style[E(n.style,e)]=i?t:""})}var Z=["","webkit","moz","MS","ms","o"],B=h.createElement("div"),J="function",K=Math.round,Q=Math.abs,$=Date.now,tt=1,et="ontouchstart"in t,it=E(t,"PointerEvent")!==u,nt=et&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),st="touch",rt="mouse",ot=25,ht=1,at=4,ut=8,ct=1,lt=2,pt=4,ft=8,dt=16,vt=lt|pt,mt=ft|dt,gt=vt|mt,Tt=["x","y"],yt=["clientX","clientY"];A.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(I(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&f(this.element,this.evEl,this.domHandler),this.evTarget&&f(this.target,this.evTarget,this.domHandler),this.evWin&&f(I(this.element),this.evWin,this.domHandler)}};var Et={mousedown:ht,mousemove:2,mouseup:at};e(R,A,{handler:function(t){var e=Et[t.type];e&ht&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=at),this.pressed&&this.allow&&(e&at&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:rt,srcEvent:t}))}});var It={pointerdown:ht,pointermove:2,pointerup:at,pointercancel:ut,pointerout:ut},At={2:st,3:"pen",4:rt,5:"kinect"},_t="pointerdown",Dt="pointermove pointerup pointercancel";t.MSPointerEvent&&(_t="MSPointerDown",Dt="MSPointerMove MSPointerUp MSPointerCancel"),e(z,A,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),s=It[n],r=At[t.pointerType]||t.pointerType,o=r==st,n=g(e,t.pointerId,"pointerId");s&ht&&(0===t.button||o)?n<0&&(e.push(t),n=e.length-1):s&(at|ut)&&(i=!0),n<0||(e[n]=t,this.callback(this.manager,s,{pointers:e,changedPointers:[t],pointerType:r,srcEvent:t}),i&&e.splice(n,1))}});var St={touchstart:ht,touchmove:2,touchend:at,touchcancel:ut};e(N,A,{handler:function(t){var e,i=St[t.type];i===ht&&(this.started=!0),this.started&&(e=function(t,e){var i=T(t.touches),t=T(t.changedTouches);return[i=e&(at|ut)?y(i.concat(t),"identifier",!0):i,t]}.call(this,t,i),i&(at|ut)&&e[0].length-e[1].length==0&&(this.started=!1),this.callback(this.manager,i,{pointers:e[0],changedPointers:e[1],pointerType:st,srcEvent:t}))}});var wt={touchstart:ht,touchmove:2,touchend:at,touchcancel:ut};e(P,A,{handler:function(t){var e=wt[t.type],i=function(t,e){var i=T(t.touches),n=this.targetIds;if(e&(2|ht)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var s,r=T(t.changedTouches),o=[],h=this.target,a=i.filter(function(t){return d(t.target,h)});if(e===ht)for(s=0;s<a.length;)n[a[s].identifier]=!0,s++;for(s=0;s<r.length;)n[r[s].identifier]&&o.push(r[s]),e&(at|ut)&&delete n[r[s].identifier],s++;return o.length?[y(a.concat(o),"identifier",!0),o]:void 0}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:st,srcEvent:t})}}),e(M,A,{handler:function(t,e,i){var n=i.pointerType==st,s=i.pointerType==rt;if(n)this.mouse.allow=!1;else if(s&&!this.mouse.allow)return;e&(at|ut)&&(this.mouse.allow=!0),this.callback(t,e,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var bt=E(B.style,"touchAction"),Ct=bt!==u,Rt="compute",zt="manipulation",Nt="none",Pt="pan-x",Mt="pan-y";O.prototype={set:function(t){t==Rt&&(t=this.compute()),Ct&&(this.manager.element.style[bt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return s(this.manager.recognizers,function(t){c(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),function(t){if(v(t,Nt))return Nt;var e=v(t,Pt),i=v(t,Mt);return e&&i?Pt+" "+Mt:e||i?e?Pt:Mt:v(t,zt)?zt:"auto"}(e.join(" "))},preventDefaults:function(t){if(!Ct){var e=t.srcEvent,i=t.offsetDirection;if(!this.manager.session.prevented){var n=this.actions,s=v(n,Nt),t=v(n,Mt),n=v(n,Pt);return s||t&&i&vt||n&&i&mt?this.preventSrc(e):void 0}e.preventDefault()}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Ot=2,xt=4,Xt=8,Yt=Xt,Ft=16;x.prototype={defaults:{},set:function(t){return o(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(i(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Y(t,this)).id]||(e[t.id]=t).recognizeWith(this),this},dropRecognizeWith:function(t){return i(t,"dropRecognizeWith",this)||(t=Y(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(i(t,"requireFailure",this))return this;var e=this.requireFail;return-1===g(e,t=Y(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(i(t,"dropRequireFailure",this))return this;t=Y(t,this);t=g(this.requireFail,t);return-1<t&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(e){function t(t){i.manager.emit(i.options.event+(t?(t=n)&Ft?"cancel":t&Xt?"end":t&xt?"move":t&Ot?"start":"":""),e)}var i=this,n=this.state;n<Xt&&t(!0),t(),Xt<=n&&t(!0)},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=32)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){t=o({},t);return c(this.options.enable,[this,t])?(this.state&(Yt|Ft|32)&&(this.state=1),this.state=this.process(t),void(this.state&(Ot|xt|Xt|Ft)&&this.tryEmit(t))):(this.reset(),void(this.state=32))},process:function(){},getTouchAction:function(){},reset:function(){}},e(F,x,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(Ot|xt),t=this.attrTest(t);return n&&(i&ut||!t)?e|Ft:n||t?i&at?e|Xt:e&Ot?e|xt:Ot:32}}),e(W,F,{defaults:{event:"pan",threshold:10,pointers:1,direction:gt},getTouchAction:function(){var t=this.options.direction,e=[];return t&vt&&e.push(Mt),t&mt&&e.push(Pt),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,s=t.direction,r=t.deltaX,o=t.deltaY;return s&e.direction||(n=e.direction&vt?(s=0===r?ct:r<0?lt:pt,i=r!=this.pX,Math.abs(t.deltaX)):(s=0===o?ct:o<0?ft:dt,i=o!=this.pY,Math.abs(t.deltaY))),t.direction=s,i&&n>e.threshold&&s&e.direction},attrTest:function(t){return F.prototype.attrTest.call(this,t)&&(this.state&Ot||!(this.state&Ot)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=X(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),e(q,F,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Nt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Ot)},emit:function(t){var e;this._super.emit.call(this,t),1!==t.scale&&(e=t.scale<1?"in":"out",this.manager.emit(this.options.event+e,t))}}),e(L,x,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,s=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(at|ut)&&!s)this.reset();else if(t.eventType&ht)this.reset(),this._timer=r(function(){this.state=Yt,this.tryEmit()},e.time,this);else if(t.eventType&at)return Yt;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Yt&&(t&&t.eventType&at?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=$(),this.manager.emit(this.options.event,this._input)))}}),e(H,F,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Nt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Ot)}}),e(k,F,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:vt|mt,pointers:1},getTouchAction:function(){return W.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(vt|mt)?e=t.velocity:i&vt?e=t.velocityX:i&mt&&(e=t.velocityY),this._super.attrTest.call(this,t)&&i&t.direction&&t.distance>this.options.threshold&&Q(e)>this.options.velocity&&t.eventType&at},emit:function(t){var e=X(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),e(U,x,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[zt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,s=t.deltaTime<e.time;if(this.reset(),t.eventType&ht&&0===this.count)return this.failTimeout();if(n&&s&&i){if(t.eventType!=at)return this.failTimeout();s=!this.pTime||t.timeStamp-this.pTime<e.interval,i=!this.pCenter||b(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,i&&s?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=r(function(){this.state=Yt,this.tryEmit()},e.interval,this),Ot):Yt}return 32},failTimeout:function(){return this._timer=r(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Yt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),G.VERSION="2.0.4",G.defaults={domEvents:!1,touchAction:Rt,enable:!0,inputTarget:null,inputClass:null,preset:[[H,{enable:!1}],[q,{enable:!1},["rotate"]],[k,{direction:vt}],[W,{direction:vt},["swipe"]],[U],[U,{event:"doubletap",taps:2},["tap"]],[L]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};V.prototype={set:function(t){return o(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,s=e.curRecognizer;(!s||s.state&Yt)&&(s=e.curRecognizer=null);for(var r=0;r<n.length;)i=n[r],2===e.stopped||s&&i!=s&&!i.canRecognizeWith(s)?i.reset():i.recognize(t),!s&&i.state&(Ot|xt|Xt)&&(s=e.curRecognizer=i),r++}},get:function(t){if(t instanceof x)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(i(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),(t.manager=this).touchAction.update(),t},remove:function(t){if(i(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(g(e,t),1),this.touchAction.update(),this},on:function(t,e){var i=this.handlers;return s(m(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},off:function(t,e){var i=this.handlers;return s(m(t),function(t){e?i[t].splice(g(i[t],e),1):delete i[t]}),this},emit:function(t,e){var i,n,s;this.options.domEvents&&(i=t,n=e,(s=h.createEvent("Event")).initEvent(i,!0,!0),(s.gesture=n).target.dispatchEvent(s));var r=this.handlers[t]&&this.handlers[t].slice();if(r&&r.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var o=0;o<r.length;)r[o](e),o++}},destroy:function(){this.element&&j(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},o(G,{INPUT_START:ht,INPUT_MOVE:2,INPUT_END:at,INPUT_CANCEL:ut,STATE_POSSIBLE:1,STATE_BEGAN:Ot,STATE_CHANGED:xt,STATE_ENDED:Xt,STATE_RECOGNIZED:Yt,STATE_CANCELLED:Ft,STATE_FAILED:32,DIRECTION_NONE:ct,DIRECTION_LEFT:lt,DIRECTION_RIGHT:pt,DIRECTION_UP:ft,DIRECTION_DOWN:dt,DIRECTION_HORIZONTAL:vt,DIRECTION_VERTICAL:mt,DIRECTION_ALL:gt,Manager:V,Input:A,TouchAction:O,TouchInput:P,MouseInput:R,PointerEventInput:z,TouchMouseInput:M,SingleTouchInput:N,Recognizer:x,AttrRecognizer:F,Tap:U,Pan:W,Swipe:k,Pinch:q,Rotate:H,Press:L,on:p,off:f,each:s,merge:n,extend:o,inherit:e,bindFn:a,prefixed:E}),typeof define==J&&define.amd?define(function(){return G}):"undefined"!=typeof module&&module.exports?module.exports=G:t.Hammer=G}(window,document);
"use strict";var WebPullToRefresh=function(){function n(t){f.startingPositionY=document.body.scrollTop,0===f.startingPositionY&&(f.enabled=!0)}function e(t){f.enabled&&(t.preventDefault(),f.distance=t.distance/l.resistance,m(),p())}function r(t){f.enabled&&0!==f.distance&&(t.preventDefault(),f.distance<t.distance/l.resistance?f.distance=0:f.distance=t.distance/l.resistance,m(),p())}function o(t){f.enabled&&(t.preventDefault(),l.contentEl.style.transform=l.contentEl.style.webkitTransform="",l.ptrEl.style.transform=l.ptrEl.style.webkitTransform="",(document.body.classList.contains("ptr-refresh")?E:b)(),f.distance=0,f.enabled=!1)}var a="content",s="ptr",i=70,c=!1,d=2.5,l={},f={enabled:!1,distance:0,startingPositionY:0},u=document.body.classList,m=function(){l.contentEl.style.transform=l.contentEl.style.webkitTransform="translate3d( 0, "+f.distance+"px, 0 )",l.ptrEl.style.transform=l.ptrEl.style.webkitTransform="translate3d( 0, "+(f.distance-l.ptrEl.offsetHeight)+"px, 0 )"},p=function(){f.distance>l.distanceToRefresh?u.add("ptr-refresh"):u.remove("ptr-refresh")},E=function(){if(u.add("ptr-loading"),!l.loadingFunction)return b();var t=l.loadingFunction();setTimeout(function(){t.then(b)},1e3)},b=function(){u.remove("ptr-loading"),u.remove("ptr-refresh"),u.add("ptr-reset");function t(){u.remove("ptr-reset"),document.body.removeEventListener("transitionend",t,!1)}document.body.addEventListener("transitionend",t,!1)};return{init:function(t){if(!(l={contentEl:(t=t||{}).contentEl||document.getElementById(a),ptrEl:t.ptrEl||document.getElementById(s),distanceToRefresh:t.distanceToRefresh||i,loadingFunction:t.loadingFunction||c,resistance:t.resistance||d}).contentEl||!l.ptrEl)return!1;t=new Hammer(l.contentEl);t.get("pan").set({direction:Hammer.DIRECTION_VERTICAL}),t.on("panstart",n),t.on("pandown",e),t.on("panup",r),t.on("panend",o)},disable:function(){var t;l&&l.contentEl&&((t=new Hammer(l.contentEl))&&t.get("pan").set({enable:!1}))},enable:function(){var t;l&&l.contentEl&&((t=new Hammer(l.contentEl))&&t.get("pan").set({enable:!0}))}}}();
"use strict";!function(l){function u(t,e){if(e=e||{},(t=t||"")instanceof u)return t;if(!(this instanceof u))return new u(t,e);var r,n,a,i,s,o,f,h,a=(n={r:0,g:0,b:0},o=s=i=null,h=f=!(a=1),"object"==typeof(r="string"==typeof(r=t)?function(t){t=t.replace(F,"").replace(C,"").toLowerCase();var e,r=!1;if(j[t])t=j[t],r=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};return(e=P.rgb.exec(t))?{r:e[1],g:e[2],b:e[3]}:(e=P.rgba.exec(t))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=P.hsl.exec(t))?{h:e[1],s:e[2],l:e[3]}:(e=P.hsla.exec(t))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=P.hsv.exec(t))?{h:e[1],s:e[2],v:e[3]}:(e=P.hsva.exec(t))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=P.hex8.exec(t))?{r:x(e[1]),g:x(e[2]),b:x(e[3]),a:H(e[4]),format:r?"name":"hex8"}:(e=P.hex6.exec(t))?{r:x(e[1]),g:x(e[2]),b:x(e[3]),format:r?"name":"hex"}:(e=P.hex4.exec(t))?{r:x(e[1]+""+e[1]),g:x(e[2]+""+e[2]),b:x(e[3]+""+e[3]),a:H(e[4]+""+e[4]),format:r?"name":"hex8"}:!!(e=P.hex3.exec(t))&&{r:x(e[1]+""+e[1]),g:x(e[2]+""+e[2]),b:x(e[3]+""+e[3]),format:r?"name":"hex"}}(r):r)&&(R(r.r)&&R(r.g)&&R(r.b)?(n=function(t,e,r){return{r:255*y(t,255),g:255*y(e,255),b:255*y(r,255)}}(r.r,r.g,r.b),f=!0,h="%"===String(r.r).substr(-1)?"prgb":"rgb"):R(r.h)&&R(r.s)&&R(r.v)?(i=w(r.s),s=w(r.v),n=function(t,e,r){t=6*y(t,360),e=y(e,100),r=y(r,100);var n=l.floor(t),a=t-n,i=r*(1-e),t=r*(1-a*e),e=r*(1-(1-a)*e),n=n%6;return{r:255*[r,t,i,i,e,r][n],g:255*[e,r,r,t,i,i][n],b:255*[i,i,e,r,r,t][n]}}(r.h,i,s),f=!0,h="hsv"):R(r.h)&&R(r.s)&&R(r.l)&&(i=w(r.s),o=w(r.l),n=function(t,e,r){function n(t,e,r){return r<0&&(r+=1),1<r&&--r,r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}var a,i,s;t=y(t,360),e=y(e,100),r=y(r,100),0===e?a=i=s=r:(a=n(e=2*r-(r=r<.5?r*(1+e):r+e-r*e),r,t+1/3),i=n(e,r,t),s=n(e,r,t-1/3));return{r:255*a,g:255*i,b:255*s}}(r.h,i,o),f=!0,h="hsl"),r.hasOwnProperty("a")&&(a=r.a)),a=v(a),{ok:f,format:r.format||h,r:I(255,L(n.r,0)),g:I(255,L(n.g,0)),b:I(255,L(n.b,0)),a:a});this._originalInput=t,this._r=a.r,this._g=a.g,this._b=a.b,this._a=a.a,this._roundA=M(100*this._a)/100,this._format=e.format||a.format,this._gradientType=e.gradientType,this._r<1&&(this._r=M(this._r)),this._g<1&&(this._g=M(this._g)),this._b<1&&(this._b=M(this._b)),this._ok=a.ok,this._tc_id=q++}function n(t,e,r){t=y(t,255),e=y(e,255),r=y(r,255);var n,a=L(t,e,r),i=I(t,e,r),s=(a+i)/2;if(a==i)n=f=0;else{var o=a-i,f=.5<s?o/(2-a-i):o/(a+i);switch(a){case t:n=(e-r)/o+(e<r?6:0);break;case e:n=(r-t)/o+2;break;case r:n=(t-e)/o+4}n/=6}return{h:n,s:f,l:s}}function a(t,e,r){t=y(t,255),e=y(e,255),r=y(r,255);var n,a=L(t,e,r),i=I(t,e,r),s=a,o=a-i,f=0===a?0:o/a;if(a==i)n=0;else{switch(a){case t:n=(e-r)/o+(e<r?6:0);break;case e:n=(r-t)/o+2;break;case r:n=(t-e)/o+4}n/=6}return{h:n,s:f,v:s}}function e(t,e,r,n){r=[k(M(t).toString(16)),k(M(e).toString(16)),k(M(r).toString(16))];return n&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function i(t,e,r,n){return[k(S(n)),k(M(t).toString(16)),k(M(e).toString(16)),k(M(r).toString(16))].join("")}function t(t,e){e=0===e?0:e||10;t=u(t).toHsl();return t.s-=e/100,t.s=A(t.s),u(t)}function r(t,e){e=0===e?0:e||10;t=u(t).toHsl();return t.s+=e/100,t.s=A(t.s),u(t)}function s(t){return u(t).desaturate(100)}function o(t,e){e=0===e?0:e||10;t=u(t).toHsl();return t.l+=e/100,t.l=A(t.l),u(t)}function f(t,e){e=0===e?0:e||10;t=u(t).toRgb();return t.r=L(0,I(255,t.r-M(-e/100*255))),t.g=L(0,I(255,t.g-M(-e/100*255))),t.b=L(0,I(255,t.b-M(-e/100*255))),u(t)}function h(t,e){e=0===e?0:e||10;t=u(t).toHsl();return t.l-=e/100,t.l=A(t.l),u(t)}function c(t,e){t=u(t).toHsl(),e=(t.h+e)%360;return t.h=e<0?360+e:e,u(t)}function g(t){t=u(t).toHsl();return t.h=(t.h+180)%360,u(t)}function b(t){var e=u(t).toHsl(),r=e.h;return[u(t),u({h:(r+120)%360,s:e.s,l:e.l}),u({h:(r+240)%360,s:e.s,l:e.l})]}function d(t){var e=u(t).toHsl(),r=e.h;return[u(t),u({h:(r+90)%360,s:e.s,l:e.l}),u({h:(r+180)%360,s:e.s,l:e.l}),u({h:(r+270)%360,s:e.s,l:e.l})]}function _(t){var e=u(t).toHsl(),r=e.h;return[u(t),u({h:(r+72)%360,s:e.s,l:e.l}),u({h:(r+216)%360,s:e.s,l:e.l})]}function p(t,e,r){e=e||6,r=r||30;var n=u(t).toHsl(),a=360/r,i=[u(t)];for(n.h=(n.h-(a*e>>1)+720)%360;--e;)n.h=(n.h+a)%360,i.push(u(n));return i}function m(t,e){e=e||6;for(var t=u(t).toHsv(),r=t.h,n=t.s,a=t.v,i=[],s=1/e;e--;)i.push(u({h:r,s:n,v:a})),a=(a+s)%1;return i}function v(t){return t=parseFloat(t),t=isNaN(t)||t<0||1<t?1:t}function y(t,e){"string"==typeof(r=t)&&-1!=r.indexOf(".")&&1===parseFloat(r)&&(t="100%");var r,r="string"==typeof(r=t)&&-1!=r.indexOf("%");return t=I(e,L(0,parseFloat(t))),r&&(t=parseInt(t*e,10)/100),l.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function A(t){return I(1,L(0,t))}function x(t){return parseInt(t,16)}function k(t){return 1==t.length?"0"+t:""+t}function w(t){return t=t<=1?100*t+"%":t}function S(t){return l.round(255*parseFloat(t)).toString(16)}function H(t){return x(t)/255}function R(t){return P.CSS_UNIT.exec(t)}var F=/^\s+/,C=/\s+$/,q=0,M=l.round,I=l.min,L=l.max,N=l.random;u.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t=this.toRgb(),e=t.r/255,r=t.g/255,t=t.b/255;return.2126*(e<=.03928?e/12.92:l.pow((.055+e)/1.055,2.4))+.7152*(r<=.03928?r/12.92:l.pow((.055+r)/1.055,2.4))+.0722*(t<=.03928?t/12.92:l.pow((.055+t)/1.055,2.4))},setAlpha:function(t){return this._a=v(t),this._roundA=M(100*this._a)/100,this},toHsv:function(){var t=a(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=a(this._r,this._g,this._b),e=M(360*t.h),r=M(100*t.s),t=M(100*t.v);return 1==this._a?"hsv("+e+", "+r+"%, "+t+"%)":"hsva("+e+", "+r+"%, "+t+"%, "+this._roundA+")"},toHsl:function(){var t=n(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=n(this._r,this._g,this._b),e=M(360*t.h),r=M(100*t.s),t=M(100*t.l);return 1==this._a?"hsl("+e+", "+r+"%, "+t+"%)":"hsla("+e+", "+r+"%, "+t+"%, "+this._roundA+")"},toHex:function(t){return e(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return e=this._r,r=this._g,n=this._b,a=this._a,t=t,a=[k(M(e).toString(16)),k(M(r).toString(16)),k(M(n).toString(16)),k(S(a))],t&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("");var e,r,n,a},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:M(this._r),g:M(this._g),b:M(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+M(this._r)+", "+M(this._g)+", "+M(this._b)+")":"rgba("+M(this._r)+", "+M(this._g)+", "+M(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:M(100*y(this._r,255))+"%",g:M(100*y(this._g,255))+"%",b:M(100*y(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+M(100*y(this._r,255))+"%, "+M(100*y(this._g,255))+"%, "+M(100*y(this._b,255))+"%)":"rgba("+M(100*y(this._r,255))+"%, "+M(100*y(this._g,255))+"%, "+M(100*y(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&O[e(this._r,this._g,this._b,!0)]||!1},toFilter:function(t){var e="#"+i(this._r,this._g,this._b,this._a),r=e;return"progid:DXImageTransform.Microsoft.gradient("+(this._gradientType?"GradientType = 1, ":"")+"startColorstr="+e+",endColorstr="+(r=t?"#"+i((t=u(t))._r,t._g,t._b,t._a):r)+")"},toString:function(t){var e=!!t;t=t||this._format;var r=!1,n=this._a<1&&0<=this._a;return!e&&n&&("hex"===t||"hex6"===t||"hex3"===t||"hex4"===t||"hex8"===t||"name"===t)?"name"===t&&0===this._a?this.toName():this.toRgbString():("rgb"===t&&(r=this.toRgbString()),"prgb"===t&&(r=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(r=this.toHexString()),"hex3"===t&&(r=this.toHexString(!0)),"hex4"===t&&(r=this.toHex8String(!0)),"hex8"===t&&(r=this.toHex8String()),"name"===t&&(r=this.toName()),"hsl"===t&&(r=this.toHslString()),(r="hsv"===t?this.toHsvString():r)||this.toHexString())},clone:function(){return u(this.toString())},_applyModification:function(t,e){e=t.apply(null,[this].concat([].slice.call(e)));return this._r=e._r,this._g=e._g,this._b=e._b,this.setAlpha(e._a),this},lighten:function(){return this._applyModification(o,arguments)},brighten:function(){return this._applyModification(f,arguments)},darken:function(){return this._applyModification(h,arguments)},desaturate:function(){return this._applyModification(t,arguments)},saturate:function(){return this._applyModification(r,arguments)},greyscale:function(){return this._applyModification(s,arguments)},spin:function(){return this._applyModification(c,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(p,arguments)},complement:function(){return this._applyCombination(g,arguments)},monochromatic:function(){return this._applyCombination(m,arguments)},splitcomplement:function(){return this._applyCombination(_,arguments)},triad:function(){return this._applyCombination(b,arguments)},tetrad:function(){return this._applyCombination(d,arguments)}},u.fromRatio=function(t,e){if("object"==typeof t){var r,n={};for(r in t)t.hasOwnProperty(r)&&(n[r]="a"===r?t[r]:w(t[r]));t=n}return u(t,e)},u.equals=function(t,e){return!(!t||!e)&&u(t).toRgbString()==u(e).toRgbString()},u.random=function(){return u.fromRatio({r:N(),g:N(),b:N()})},u.mix=function(t,e,r){r=0===r?0:r||50;t=u(t).toRgb(),e=u(e).toRgb(),r/=100;return u({r:(e.r-t.r)*r+t.r,g:(e.g-t.g)*r+t.g,b:(e.b-t.b)*r+t.b,a:(e.a-t.a)*r+t.a})},u.readability=function(t,e){t=u(t),e=u(e);return(l.max(t.getLuminance(),e.getLuminance())+.05)/(l.min(t.getLuminance(),e.getLuminance())+.05)},u.isReadable=function(t,e,r){var n=u.readability(t,e),a=!1;switch((e={level:r="AA"!==(r=((e=(e=r)||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==r?"AA":r,size:e="small"!==(e=(e.size||"small").toLowerCase())&&"large"!==e?"small":e}).level+e.size){case"AAsmall":case"AAAlarge":a=4.5<=n;break;case"AAlarge":a=3<=n;break;case"AAAsmall":a=7<=n}return a},u.mostReadable=function(t,e,r){for(var n,a=null,i=0,s=(r=r||{}).includeFallbackColors,o=r.level,f=r.size,h=0;h<e.length;h++)i<(n=u.readability(t,e[h]))&&(i=n,a=u(e[h]));return u.isReadable(t,a,{level:o,size:f})||!s?a:(r.includeFallbackColors=!1,u.mostReadable(t,["#fff","#000"],r))};var z,E,T,j=u.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},O=u.hexNames=function(t){var e,r={};for(e in t)t.hasOwnProperty(e)&&(r[t[e]]=e);return r}(j),P=(E="[\\s|\\(]+("+(z="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+z+")[,|\\s]+("+z+")\\s*\\)?",T="[\\s|\\(]+("+z+")[,|\\s]+("+z+")[,|\\s]+("+z+")[,|\\s]+("+z+")\\s*\\)?",{CSS_UNIT:new RegExp(z),rgb:new RegExp("rgb"+E),rgba:new RegExp("rgba"+T),hsl:new RegExp("hsl"+E),hsla:new RegExp("hsla"+T),hsv:new RegExp("hsv"+E),hsva:new RegExp("hsva"+T),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});"undefined"!=typeof module&&module.exports?module.exports=u:"function"==typeof define&&define.amd?define(function(){return u}):window.tinycolor=u}(Math);
"use strict";!function(){function e(t){return this.promise=new Promise(t),this.promise.success=function(t){return this.then(t),this},this.promise.error=function(t){return this.then(null,t),this},this.promise}function o(){}console.log("httpClient is loading"),o.get=function(t,e){return o.request("GET",t,void 0,e)},o.post=function(t,e,n){return o.request("POST",t,e)},o.put=function(t,e,n){return o.request("PUT",t,e)},o.jsonp=function(t,e){function n(t){this.promise=new Promise(t)}return n.prototype.success=function(t){return this.promise.then(t,null),this},n.prototype.error=function(t){return this.promise.then(null,t),this},new n((r,s)=>{setTimeout(()=>{console.info("Angular $http is not ready"),window.bfUtils.http.jsonp(t,e).success((t,e,n,o)=>r(t,e,n,o)).error((t,e,n,o)=>s(t,e,n,o))},200)})},o.request=function(o,r,s,t){return console.log("httpClient create request for url: ",r," using method: ",o),new e(function(e,t){var n=new XMLHttpRequest;n.onload=function(){console.log("httpClient read response for url: ",r," using method: ",o);n.status,n.statusText;var t="response"in n?n.response:n.responseText;e(t?JSON.parse(t):null)},n.onerror=function(){console.log("httpClient failed for url: ",r," using method: ",o),t(new TypeError("Network request failed"))},n.ontimeout=function(){console.log("httpClient timed out for url: ",r," using method: ",o),t(new TypeError("Network request failed"))},console.log("httpClient requesting for url: ",r," using method: ",o),n.open(o,r,!0),n.send(s)})},window.httpClient=o}();
"use strict";var bfUtils={get deviceOnline(){return!("undefined"==typeof window||!window.ignoreNavigatorOnline)||("undefined"==typeof navigator||(navigator.connection&&navigator.connection.type?"none"!=navigator.connection.type:void 0===navigator.onLine||navigator.onLine))},get isMobileDevice(){return window.location.protocol.indexOf("http")<0},get isAndroid(){return window.location.protocol.indexOf("http")<0&&"undefined"!=typeof device&&"Android"==device.platform},get isIOS(){return window.location.protocol.indexOf("http")<0&&"undefined"!=typeof device&&"iOS"==device.platform},get isPwaAndroid(){return!!navigator.userAgent.match(/Android/i)},get isPwaiOS(){return"undefined"==typeof device&&"standalone"in window.navigator&&window.navigator.standalone},get isHtml5iOS(){return"undefined"==typeof device&&"standalone"in window.navigator&&!window.navigator.standalone},get isPwaOrHtml5iOS(){return"undefined"==typeof device&&"standalone"in window.navigator},get isAppHtml5Version(){return window.self==window.top},get isEmulatorCP(){return window.top&&window.top!=window&&0==window.location.protocol.indexOf("http")},get isApp(){return!!window.siteConfig&&"app"===window.siteConfig.scope},tryParseJSON:function(t){try{return JSON.parse(t)}catch(n){return void console.error("Cannot parse data :: "+t,n.message,n.stack)}},get http(){return window.$http||window.httpClient},get currentApp(){return window.appContext&&window.appContext.currentApp?window.appContext.currentApp:{}},getIPAddress:function(t){bfUtils.http.get(siteConfig.endPoints.crmHost+"/ipinfo?ipOnly=true").success(function(n){t(null,n)}).error(function(n){t(n)})},sanitize:function(n,t){bfUtils.sanitizeCallbacks=bfUtils.sanitizeCallbacks||[];let i=n.data,e={onIgnoreTagAttr:function(n,t,i,e){if("class"===t||"style"===t||"src"===t||"id"===t)return t+'="'+i+'"'}};"undefined"==typeof filterXSS?bfUtils.isLoadingXSSLibrary?bfUtils.sanitizeCallbacks.push(()=>{t(null,filterXSS(i,e))}):(bfUtils.isLoadingXSSLibrary=!0,bfUtils.sanitizeCallbacks.push(()=>{t(null,filterXSS(i,e))}),function(n){const t=document.createElement("script");"sdk"==window.siteConfig.scope?t.src="scripts/lib/xss.min.js":"cp"==window.siteConfig.scope?t.src="/app/scripts/lib/xss/xss.min.js":t.src=window._appRoot+"scripts/lib/xss/xss.min.js",t.type="text/javascript",t.onload=()=>{n&&n()},document.getElementsByTagName("head")[0].appendChild(t)}(()=>{bfUtils.sanitizeCallbacks.forEach(n=>{n()})})):t(null,filterXSS(i,e))}};
"use strict";const atatusAPI={log(t,a=[],n={}){if("undefined"==typeof atatus||!atatus.notify)return console.warn("atatus not configured");var{appId:o,appName:p}=window.appContext.currentApp||{};atatus.notify(new Error(t),n,["appId:".concat(o),"appName:".concat(p),...a])}};
"use strict";var customRegistration={googleMapServices:{},get wl_name(){let e="Full ";return appContext&&appContext.currentApp&&appContext.currentApp.config&&(e=appContext.currentApp.config.whitlabelName+" "),e},getFields:function(r,e){let i=r.customRegistrationSettings;if(i&&i.singlePage&&i.singlePage.formControls){let l=[],t={},o=[],a="",n=r.defaults||{};i.singlePage.formControls.forEach(function(e,i){var s;r.isProfileMode&&"registrationOnly"===e.settings.displayOn||("custom"!=e.type?(s={control:e,controlIndex:i,fields:l,rules:t,initializers:o,isProfileMode:r.isProfileMode,defaults:r.defaults,refreshUI:r.refreshUI},customRegistration.preparePresetField(s)):(i={control:e,controlIndex:i,fields:l,defaults:r.defaults},customRegistration.prepareCustomField(i)))});let u=function(e,i){let s=e.field;"edit"!==e.mode||"email"!==s.name&&!s.preventEditing?"edit"===e.mode&&"profilePicture"===s.name?(s.value=e.profilePicture,s.validate(s.value,(e,i)=>{a=e?e:null})):"multipleSelect"===s.type?s.validate(s.values):s.validate(s.value):s.error=null,i&&i(null,{profilePictureError:a})};e(null,{fields:l,rules:t,initializers:o,fetch:function(i,t){let s=!1,o={},r=[];if(i&&i.validateFields&&l.forEach(function(e){if(i.field=e,u(i),e.error&&(s=!0),e.isCustom)switch(e.type){case"singleSelect":r.push({id:e.id,type:e.type,value:e.value,displayValue:e.displayValue,visibilityChoice:e.visibilityChoice});break;case"multipleSelect":r.push({id:e.id,type:e.type,values:e.values,visibilityChoice:e.visibilityChoice});break;case"text":case"number":case"textarea":r.push({id:e.id,type:e.type,value:e.value,visibilityChoice:e.visibilityChoice})}else o[e.name]={value:e.value,extra:e.extra,messages:e.messages,visibilityChoice:e.visibilityChoice}}),s)t({profilePictureError:a},null);else{let e={user:n},s=e.user;s.email=o.email.value,s.password=o.password?o.password.value:void 0,s.firstName=o.firstName?o.firstName.value:s.firstName,s.lastName=o.lastName?o.lastName.value:s.lastName,s.displayName=o.displayName?o.displayName.value:s.displayName,s.userProfile=s.userProfile||{},s.userProfile.address=s.userProfile.address||{},s.userProfile.address.fullAddress=o.address?o.address.value:s.userProfile.address.fullAddress,s.userProfile.address.customFields=s.userProfile.address.customFields||{},s.userProfile.address.customFields.aptNo=o.aptNo?o.aptNo.value:s.userProfile.address.customFields.aptNo,s.userProfile.address.customFields.zipCode=o.zipCode?o.zipCode.value:s.userProfile.address.customFields.zipCode,s.userProfile.address.geoLocation=o.address?o.address.value?o.address.extra:void 0:s.userProfile.address.geoLocation,s.userProfile.addressVisibilityChoice=o.address?o.address.visibilityChoice:o.zipCode?o.zipCode.visibilityChoice:s.userProfile.addressVisibilityChoice,s.userProfile.bio=o.bio?o.bio.value:s.userProfile.bio,s.userProfile.bioVisibilityChoice=o.bio?o.bio.visibilityChoice:s.userProfile.bioVisibilityChoice,s.userProfile.birthDate=o.birthDate?o.birthDate.value?new Date(o.birthDate.value):null:"string"==typeof s.userProfile.birthDate?new Date(s.userProfile.birthDate):s.userProfile.birthDate,s.userProfile.birthDateVisibilityChoice=o.birthDate?o.birthDate.visibilityChoice:s.userProfile.birthDateVisibilityChoice,s.userProfile.tel=o.tel?o.tel.value:s.userProfile.tel,s.userProfile.telVisibilityChoice=o.tel?o.tel.visibilityChoice:s.userProfile.telVisibilityChoice,s.userProfile.emailVisibilityChoice=o.email?o.email.visibilityChoice:s.userProfile.emailVisibilityChoice,s.userProfile.customTypeFields=s.userProfile.customTypeFields||[],r.forEach(i=>{var e=s.userProfile.customTypeFields.findIndex(e=>i.id===e.id);0<=e?s.userProfile.customTypeFields[e]=i:s.userProfile.customTypeFields.push(i)}),delete s.imageUrl,e.messages={emailAlreadyInUse:o.email.messages.emailAlreadyInUse},e.profilePictureFile=o.profilePicture?o.profilePicture.value:void 0,t(null,e)}},checkFieldsErrors:function(i,s){i&&i.validateFields&&l.forEach(function(e){i.field=e,u(i,s)})}})}else e(null,null)},preparePresetField:function(l){let{control:a,controlIndex:e,fields:s,rules:i,initializers:o}=l;switch(a.id){case"fullName":a.active&&(a.settings.displayNameEnabled&&s.push({type:"text",viewType:"none",name:"displayName",maxLength:150,order:e,label:a.options.fieldsLabels.displayName,iconClass:a.icon||"glyphicon glyphicon-font",validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.fullNameRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults?l.defaults.displayName:void 0}),a.settings.firstNameEnabled&&s.push({type:"text",viewType:"text",name:"firstName",maxLength:150,order:e,label:a.options.fieldsLabels.firstName,iconClass:a.icon||"glyphicon glyphicon-font",validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.fullNameRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults?l.defaults.firstName:void 0}),a.settings.lastNameEnabled&&s.push({type:"text",viewType:"text",name:"lastName",maxLength:150,order:e,label:a.options.fieldsLabels.lastName,iconClass:a.icon||"glyphicon glyphicon-font",validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.fullNameRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults?l.defaults.lastName:void 0}));break;case"email":var t="userChoice"===a.settings.visibility?"public":void 0,t=l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.emailVisibilityChoice||t;s.push({type:"email",viewType:"email",name:"email",order:e,label:a.options.fieldsLabels.email,info:a.options.infoMessages?a.options.infoMessages.assistiveText:void 0,iconClass:a.icon||"glyphicon glyphicon-send",visibility:a.settings.visibility||"private",visibilityChoice:t,validate:function(e){this.error=null,e&&e.trim().length?window.validator.validateEmail(e)?e&&e.trim().length||(this.error=a.options.errorMessages.emailAlreadyInUse):this.error=a.options.errorMessages.emailInvalidFormat:this.error=a.options.errorMessages.emailRequired},touch:function(e,i){!e&&i&&i.target&&(e=i.target.value),this.validate(e)},messages:a.options.errorMessages,value:l.defaults?l.defaults.email:void 0});break;case"address":if(a.active){let t=a.options.addressGoogleApiKey;var r="userChoice"===a.settings.visibility?"public":void 0,r=l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.addressVisibilityChoice||r;a.options.addressGoogleApiKey&&o.push(function(){setTimeout(function(){let e=document.getElementById("customRegistrationScript");var i=e&&e.src,s="https://maps.googleapis.com/maps/api/js?key=".concat(t,"&libraries=places&callback=googleMapsInitCallback");e&&i!=s&&document.getElementsByTagName("head")[0].removeChild(e),customRegistration.googleMapServices.mapsApiKeyError=null,i!=s&&(e=document.createElement("script"),e.id="customRegistrationScript",e.src=s,e.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(e)),window.googleMapsInitCallback=function(){customRegistration.googleMapServices.autoAddressCompleteService=new google.maps.places.AutocompleteService,customRegistration.googleMapServices.addressGeocoder=new google.maps.Geocoder},l.refreshUI&&l.refreshUI()},0)}),a.settings.showFullAddress&&(s.push({type:"text",viewType:"text",name:"address",maxLength:150,order:e,label:a.options.fieldsLabels.address,iconClass:a.icon||"glyphicon glyphicon-pushpin",visibility:a.settings.visibility||"private",visibilityChoice:r,preventEditing:!1===a.settings.allowEditingInProfile,change:function(e){let s=this;s.extra=null,customRegistration.googleMapServices.mapsApiKeyError&&(s.error=customRegistration.googleMapServices.mapsApiKeyError),customRegistration.googleMapServices.autoAddressCompleteService?(customRegistration.googleMapServices.checkMapsApiKeyErrors=!0,setTimeout(function(){customRegistration.googleMapServices.checkMapsApiKeyErrors=!1},3e3),customRegistration.googleMapServices.autoAddressCompleteService.getPlacePredictions({input:e,types:["street_number","street_address","route"]},function(e,i){i!==google.maps.places.PlacesServiceStatus.OK&&(s.error=a.options.errorMessages.invalidGoogleAddress),s.suggestions=e,l.refreshUI&&l.refreshUI()})):s.error=a.options.errorMessages.invalidGoogleAddress},selectSuggestion:function(o){let r=this;r.error=null,r.suggestions=null,r.value=o.description,customRegistration.googleMapServices.addressGeocoder.geocode({placeId:o.place_id},function(e,i){var s,t;e&&e[0]&&e[0]?(s=e[0].geometry.location.lat(),t=e[0].geometry.location.lng(),a.settings.required&&(e[0].address_components.find(function(e){return e.types&&e.types.find(function(e){return"street_number"===e||"street_address"===e||"route"===e})})||(r.error=a.options.errorMessages.invalidGoogleAddress)),r.extra={lat:s,lng:t,place:o,addressComponents:e[0].address_components}):r.error=a.options.errorMessages.invalidGoogleAddress,l.refreshUI&&l.refreshUI()})},validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required?e&&e.trim().length&&!this.extra&&(this.error=a.options.errorMessages.invalidGoogleAddress):this.error=a.options.errorMessages.addressRequired},touch:function(e){this.suggestions&&this.suggestions.length||this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this),this.change(this.value)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.address?l.defaults.userProfile.address.fullAddress:void 0,extra:l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.address?l.defaults.userProfile.address.geoLocation:void 0}),a.settings.showAptNo&&s.push({type:"text",viewType:"text",name:"aptNo",maxLength:150,order:e,label:a.options.fieldsLabels.aptNo,iconClass:a.icon||"glyphicon glyphicon-pushpin",containerClass:"small-login-field",preventEditing:!1===a.settings.allowEditingInProfile,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.addressRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.address&&l.defaults.userProfile.address.customFields?l.defaults.userProfile.address.customFields.aptNo:void 0})),a.settings.showZipCode&&s.push({type:"text",viewType:"text",name:"zipCode",maxLength:150,order:e,label:a.options.fieldsLabels.zipCode,iconClass:a.icon||"glyphicon glyphicon-pushpin",visibility:a.settings.visibility||"private",visibilityChoice:r,preventEditing:!1===a.settings.allowEditingInProfile,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.addressRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.address&&l.defaults.userProfile.address.customFields?l.defaults.userProfile.address.customFields.zipCode:void 0})}break;case"password":l.isProfileMode||(s.push({type:"password",name:"password",order:e,label:a.options.fieldsLabels.password,iconClass:a.icon||"glyphicon glyphicon-lock",togglePasswordVisibility:"showHidePassword"===a.settings.validation,info:"simple"===a.settings.passwordStrength?a.options.infoMessages.passwordSimpleRules:a.options.infoMessages.passwordRules,validate:function(e){if(this.error=null,"retypePassword"===a.settings.validation){let e=s.find(function(e){return"retypePassword"===e.name});e.error=null}e&&e.trim().length?window.validator.validatePassword(e,{simplePasswordValidation:"simple"===a.settings.passwordStrength})||(this.error="simple"===a.settings.passwordStrength?a.options.errorMessages.invalidPasswordSimpleRules:a.options.errorMessages.invalidPasswordRules):this.error=a.options.errorMessages.passwordRequired},touch:function(e){this.validate(e)},messages:a.options.errorMessages}),"retypePassword"===a.settings.validation&&s.push({type:"password",name:"retypePassword",order:e,label:a.options.fieldsLabels.retypePassword,iconClass:a.icon||"glyphicon glyphicon-lock",togglePasswordVisibility:"showHidePassword"===a.settings.validation,validate:function(e){var i=s.find(function(e){return"password"===e.name});this.error=null,e&&e.trim().length?i.value!==e&&(this.error=a.options.errorMessages.passwordsDontMatch):this.error=a.options.errorMessages.passwordRequired},touch:function(e){this.validate(e)},messages:a.options.errorMessages})),i.passwordStrength=a.settings.passwordStrength;break;case"bio":a.active&&(r="userChoice"===a.settings.visibility?"public":void 0,r=l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.bioVisibilityChoice||r,s.push({type:"textarea",viewType:"multiline",name:"bio",maxLength:1024,order:e,label:a.options.fieldsLabels.bio,info:a.options.infoMessages?a.options.infoMessages.assistiveText:void 0,iconClass:a.icon||"glyphicon glyphicon-list-alt",visibility:a.settings.visibility||"private",visibilityChoice:r,preventEditing:!1===a.settings.allowEditingInProfile,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required||(this.error=a.options.errorMessages.bioRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile?l.defaults.userProfile.bio:void 0}));break;case"telephone":a.active&&(n="userChoice"===a.settings.visibility?"public":void 0,n=l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.telVisibilityChoice||n,s.push({type:"tel",viewType:"text",name:"tel",maxLength:150,order:e,label:a.options.fieldsLabels.tel,info:a.settings.showReasonForTelephone?a.options.infoMessages.reasonForTelephone:null,iconClass:a.icon||"glyphicon glyphicon-earphone",visibility:a.settings.visibility||"private",visibilityChoice:n,preventEditing:!1===a.settings.allowEditingInProfile,validate:function(e){this.error=null,e&&e.trim().length||!a.settings.required?e&&(/^(?:(?:\(?(?:00|\+)([1-4]\d\d|[1-9]\d?)\)?)?[\-\.\ \\\/]?)?((?:\(?\d{1,}\)?[\-\.\ \\\/]?){0,})(?:[\-\.\ \\\/]?(?:#|ext\.?|extension|x)[\-\.\ \\\/]?(\d+))?$/i.test(e)||(this.error=a.options.errorMessages.invalidEntry)):this.error=a.options.errorMessages.invalidEntry},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile?l.defaults.userProfile.tel:void 0}));break;case"birthDate":if(a.active){var n="userChoice"===a.settings.visibility?"public":void 0,n=l.defaults&&l.defaults.userProfile&&l.defaults.userProfile.birthDateVisibilityChoice||n;let i=function(e){return e?moment(e).format("L"):null};s.push({type:"date",viewType:"text",name:"birthDate",order:e,label:a.options.fieldsLabels.dateBirth,info:a.options.infoMessages?a.options.infoMessages.assistiveText:void 0,minDate:a.settings.maxAgeIsRequired&&a.settings.maxAgeRequired?moment().subtract(a.settings.maxAgeRequired,"years").toDate():void 0,maxDate:a.settings.minAgeIsRequired&&a.settings.minAgeRequired?moment().subtract(a.settings.minAgeRequired,"years").toDate():void 0,iconClass:a.icon||"glyphicon glyphicon-calendar",displayValue:i(l.defaults&&l.defaults.userProfile?l.defaults.userProfile.birthDate:void 0),visibility:a.settings.visibility||"private",visibilityChoice:n,preventEditing:!1===a.settings.allowEditingInProfile,validate:function(e){this.error=null,e?(e=moment(e),e=moment().diff(e,"years"),a.settings.maxAgeIsRequired&&a.settings.maxAgeRequired&&e>a.settings.maxAgeRequired?this.error=a.options.errorMessages.maxAge+" "+a.settings.maxAgeRequired:a.settings.minAgeIsRequired&&a.settings.minAgeRequired&&e<a.settings.minAgeRequired&&(this.error=a.options.errorMessages.minAge+" "+a.settings.minAgeRequired)):a.settings.required&&(this.error=a.options.errorMessages.birthRequired)},change:function(e){this.validate(e),this.displayValue=i(e)},touch:function(e){this.validate(e)},messages:a.options.errorMessages,value:l.defaults&&l.defaults.userProfile?l.defaults.userProfile.birthDate?new Date(l.defaults.userProfile.birthDate):null:void 0})}break;case"profilePicture":a.active&&s.push({type:"image",viewType:"none",name:"profilePicture",order:e,label:a.options.fieldsLabels.profilePicture,info:a.options.infoMessages.assistiveText,iconClass:a.icon||"icon icon-camera2",resetImage:function(){this.value=null},validate:function(e,i){this.error=null,!e&&a.settings.required&&(this.error=a.options.errorMessages.required),i&&i(this.error,null)},messages:a.options.errorMessages})}},prepareCustomField:function(o){let{control:r,controlIndex:l,fields:a}=o;switch(r.customType){case"singleSelect":if(r.active){let i,s,t,e;var n="userChoice"===r.settings.visibility?"public":void 0;if(o.defaults&&o.defaults.userProfile&&o.defaults.userProfile.customTypeFields&&0<o.defaults.userProfile.customTypeFields.length){t=o.defaults.userProfile.customTypeFields.find(e=>e.id===r.id);let e;t&&(e=r.selectOptions.find(e=>e.key===t.value)),i=t&&e?t.value:void 0,s=e?e.label:void 0}e=t&&t.visibilityChoice||n,a.push({id:r.id,name:"singleSelect",type:"singleSelect",viewType:"multiline",isCustom:!0,order:l,display:r.settings.displayOption,label:r.options.fieldsLabels.singleSelect,info:r.options.infoMessages?r.options.infoMessages.assistiveText:void 0,iconClass:r.icon||"glyphicon glyphicon-th-list",selectOptions:r.selectOptions,value:i,displayValue:s,messages:r.options.errorMessages,visibility:r.settings.visibility||"private",visibilityChoice:e,preventEditing:!1===r.settings.allowEditingInProfile,validate:function(e){this.error=null,!e&&r.settings.required&&(this.error=r.options.errorMessages.required)},openDrawer:function(s){let t=new ComponentUIAPI,i=[];this.selectOptions.forEach(e=>{i.push({text:e.label,value:e.key})}),t.openDrawer({header:this.label,listItems:i},(e,i)=>e?console.error(e):(this.value=i.value,s.target.value=this.displayValue=i.text,this.validate(this.value),void t.closeDrawer()))}})}break;case"multipleSelect":if(r.active){let e=[],i="",s,t;n="userChoice"===r.settings.visibility?"public":void 0;function u(e,t){let o="";return e.forEach((i,s)=>{t.selectOptions.forEach(e=>{i.value===e.key&&(o+=0===s?e.label:", ".concat(e.label))})}),o}o.defaults&&o.defaults.userProfile&&o.defaults.userProfile.customTypeFields&&0<o.defaults.userProfile.customTypeFields.length&&(t=o.defaults.userProfile.customTypeFields.find(e=>e.id===r.id),e=t?t.values:[],e&&0<e.length&&(e=e.filter(i=>void 0!==r.selectOptions.find(e=>e.key===i.value)),i=u(e,r))),s=t&&t.visibilityChoice||n,a.push({id:r.id,name:"multipleSelect",type:"multipleSelect",viewType:"multiline",isCustom:!0,order:l,display:r.settings.displayOption,label:r.options.fieldsLabels.multipleSelect,info:r.options.infoMessages?r.options.infoMessages.assistiveText:void 0,iconClass:r.icon||"glyphicon glyphicon-th-list",selectOptions:r.selectOptions,values:e,displayValue:i,messages:r.options.errorMessages,visibility:r.settings.visibility||"private",visibilityChoice:s,preventEditing:!1===r.settings.allowEditingInProfile,validate:function(e){this.error=null,e&&e.length<1&&r.settings.required&&(this.error=r.options.errorMessages.required)},updateCheckboxValue:function(i,e){e.target.checked?this.values.find(e=>e.value===i.key)||this.values.push({value:i.key,displayValue:i.label}):this.values=this.values.filter(e=>e.value!==i.key),this.displayValue="",this.displayValue=u(this.values,r)},isSelected:function(i){return void 0!==this.values.find(e=>i.key===e.value)},openDrawer:function(o){let r=new ComponentUIAPI,e=[];this.selectOptions.forEach(i=>{this.values&&this.values.find(e=>i.key===e.value)?e.push({text:i.label,value:i.key,selected:!0}):e.push({text:i.label,value:i.key})}),r.openDrawer({header:this.label,listItems:e,multiSelection:!0,multiSelectionActionButton:{text:"SELECT"}},(e,i)=>{if(e)return console.error(e);let s=[],t="";i.forEach((e,i)=>{t+=0===i?e.text:", ".concat(e.text),s.push({value:e.value,displayValue:e.text})}),this.values=s,o.target.value=this.displayValue=t,this.validate(this.values),r.closeDrawer()})}})}break;case"text":if(r.active){let e="",i="",s,t;var d="userChoice"===r.settings.visibility?"public":void 0;o.defaults&&o.defaults.userProfile&&o.defaults.userProfile.customTypeFields&&0<o.defaults.userProfile.customTypeFields.length&&(t=o.defaults.userProfile.customTypeFields.find(e=>e.id===r.id),t&&(e=t.value)),s=t&&t.visibilityChoice||d,"short"===r.settings.fieldLength?i="text":"long"===r.settings.fieldLength&&(i="textarea"),a.push({id:r.id,name:"customText",type:i,viewType:"multiline",isCustom:!0,maxLength:r.settings.maxCharRequired&&r.settings.maxCharEnabled?r.settings.maxCharRequired:void 0,order:l,label:r.options.fieldsLabels.text,info:r.options.infoMessages?r.options.infoMessages.assistiveText:void 0,iconClass:r.icon||"glyphicon glyphicon-font",value:e,messages:r.options.errorMessages,visibility:r.settings.visibility||"private",visibilityChoice:s,preventEditing:!1===r.settings.allowEditingInProfile,validate:function(e){this.error=null,!e&&r.settings.required?this.error=r.options.errorMessages.required:e&&r.settings.minCharEnabled&&e.length<r.settings.minCharRequired&&(this.error=r.options.errorMessages.minChar+" "+r.settings.minCharRequired)},touch:function(e){this.validate(e)},enforceMaxLength:function(){customRegistration.enforceMaxLength(this)}})}break;case"number":if(r.active){let e,i,s;d="userChoice"===r.settings.visibility?"public":void 0;o.defaults&&o.defaults.userProfile&&o.defaults.userProfile.customTypeFields&&0<o.defaults.userProfile.customTypeFields.length&&(s=o.defaults.userProfile.customTypeFields.find(e=>e.id===r.id),s&&(e=s.value)),i=s&&s.visibilityChoice||d,a.push({id:r.id,name:"customNumber",type:"number",viewType:"multiline",inputMode:r.settings.decimalsEnabled?"decimal":"numeric",isCustom:!0,order:l,label:r.options.fieldsLabels.number,info:r.options.infoMessages?r.options.infoMessages.assistiveText:void 0,iconClass:r.icon,value:e,messages:r.options.errorMessages,visibility:r.settings.visibility||"private",visibilityChoice:i,preventEditing:!1===r.settings.allowEditingInProfile,validate:function(e){this.error=null,!e&&0!==e&&r.settings.required?this.error=r.options.errorMessages.required:e>r.settings.maxNumRequired&&r.settings.maxNumEnabled?this.error=r.options.errorMessages.maxNum+" "+r.settings.maxNumRequired:e<r.settings.minNumRequired&&r.settings.minNumEnabled&&(this.error=r.options.errorMessages.minNum+" "+r.settings.minNumRequired)},touch:function(e){this.validate(e)},change:function(e){r.settings.decimalsEnabled||(this.value=e||0===e?Math.round(e):void 0)}})}}},enforceMaxLength:function(e){e.value.length>e.maxLength&&(e.value=e.value.substring(0,e.maxLength))},editVisibilityOptions:function(e,s){let t=new ComponentUIAPI;t.openDrawer({header:e.field.label,listItems:[{text:"Public"},{text:"Private"}],enableFilter:!1},(e,i)=>e?console.error(e):(i&&s(null,i),void t.closeDrawer()))}};function gm_authFailure(){customRegistration.googleMapServices.checkMapsApiKeyErrors&&(customRegistration.googleMapServices.mapsApiKeyError="There seems to be an issue with google maps key")}
"use strict";var userTags={get isUserTaggingEnabled(){return window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&window.appContext.currentApp.config.userTagging&&"hidden"!=window.appContext.currentApp.config.userTagging&&"disabled"!=window.appContext.currentApp.config.userTagging},init:function(){},checkPluginAccessSettings:function(e,a){const{accessSettings:n,requiresLogin:t}=e||{},{appId:s,config:r}=window.appContext.currentApp,{requiresTags:i,requiredTags:o}=n||{};if(bfUtils.isEmulatorCP||!t)return a(null,!0);authAPI.getCurrentUser(function(e,t){if(e)return console.error(e),a(e,null);if(!t)return a(null,!1);if(!userTags.isUserTaggingEnabled||"enabled"!=r.advancedPluginAccessSettings)return a(null,!0);if(!i||!o||!o.length)return a(null,!0);t=(t.tags||[])[s],t=userTags._checkUserTags({...n,currentUserTags:t});a(null,t)})},checkUserTags:function(e,a){const n=(window.appContext&&window.appContext.currentApp||{})["appId"],{requiredTags:s,giveAccessWhen:r}=e||{};if(a=a||console.warn,!s||!s.length)return a(null,!0);r=r||"any",authAPI.getCurrentUser(function(e,t){if(e)return a(e,null);if(!t)return a(null,!1);t=(t.tags||[])[n],t=userTags._checkUserTags({requiredTags:s,currentUserTags:t,giveAccessWhen:r});a(null,t)})},_checkUserTags:function(e){const{requiredTags:t,currentUserTags:a,giveAccessWhen:n}=e||{};if(!n||!a||!a.length)return!1;switch(n){case"all":case"matchAllTags":return t.every(e=>s(e));case"any":case"matchAnyTag":return t.some(e=>s(e));default:return!1}function s(t){return a.some(e=>e.tagName==t.name&&t.appliedCount<=e.appliedCount)}},setBehavioralTags:function(a){!bfUtils.isEmulatorCP&&bfUtils.deviceOnline&&userTags.isUserTaggingEnabled&&authAPI.getCurrentUser(null,function(e,t){e?console.log(e):t&&bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/app/"+window.appContext.currentApp.appId+"/user/assignBehavioralTag",{instanceId:a,accessToken:t.accessToken}).success(function(e){authAPI.refreshAndTriggerUpdate({updateType:"user_tags_updated"})}).error(function(e){console.log(e)})})},removeProfileTags:function(e,a){e=["$$profile_birth_year:","$$profile_birth_month:","$$profile_zip:","$$profile_city:","$$profile_state:","$$profile_town:","$$profile_country:","$$profile_picture"].concat(e);userTags.unassignUserTags(e,{isPrefix:!0,removeTag:!0,preventRefresh:!0},function(e,t){e?a(e,null):a(null,t)})},setRegistrationTags:function(e,t,a){let s=[],r={},n=e?e.userProfile:null;AppearanceAPI.prototype.getAppearance(null,function(e,t){return e?console.error(e):void(t&&(r=t.customRegistration))});function i(t,a){for(let e=0;e<t.length;e++)if(t[e].types[0]==a)return t[e].short_name}if(userTags.isUserTaggingEnabled){var o,u=[];if(t&&(o=new Date,u.push("$$registered"),u.push("$$registered_year:"+o.getFullYear()),u.push("$$registered_month:"+(o.getMonth()+1))),n)if(n.birthDate&&(u.push("$$profile_birth_year:"+n.birthDate.getFullYear()),u.push("$$profile_birth_month:"+(n.birthDate.getMonth()+1))),n.address&&n.address.customFields&&n.address.customFields.zipCode&&u.push("$$profile_zip:"+n.address.customFields.zipCode),n.address&&n.address.geoLocation&&n.address.geoLocation.addressComponents&&((p=i(n.address.geoLocation.addressComponents,"country"))&&u.push("$$profile_country:"+p.replace(/ /g,"_")),(p=i(n.address.geoLocation.addressComponents,"administrative_area_level_1"))&&u.push("$$profile_state:"+p.replace(/ /g,"_")),(p=i(n.address.geoLocation.addressComponents,"administrative_area_level_2"))&&u.push("$$profile_city:"+p.replace(/ /g,"_")),(p=i(n.address.geoLocation.addressComponents,"locality"))&&u.push("$$profile_town:"+p.replace(/ /g,"_"))),n.customTypeFields&&0<n.customTypeFields.length){let e=[];var p=authAPI.getCurrentUser();p&&p.tags&&window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&(e=p.tags[window.appContext.currentApp.appId]),n.customTypeFields.forEach(a=>{let n=r.singlePage.formControls.find(e=>e.id===a.id);if(n&&n.active){switch(n.customType){case"text":case"number":case"singleSelect":e.find(e=>e.tagName==="$$profile_".concat(n.uniqueId))||!a.value&&0!==a.value||u.push("$$profile_".concat(n.uniqueId)),!a.value&&0!==a.value||e.find(e=>e.tagName==="$$profile_".concat(n.uniqueId,":").concat(a.value))||u.push("$$profile_".concat(n.uniqueId,":").concat(a.value));break;case"multipleSelect":!e.find(e=>e.tagName==="$$profile_".concat(n.uniqueId))&&a.values&&0<a.values.length&&u.push("$$profile_".concat(n.uniqueId)),a.values.forEach(t=>{e.find(e=>e.tagName==="$$profile_".concat(n.uniqueId,":").concat(t.value))||u.push("$$profile_".concat(n.uniqueId,":").concat(t.value))})}e.forEach(t=>{if(t.tagName.startsWith("$$profile_".concat(n.uniqueId,":")))switch(n.customType){case"text":case"number":case"singleSelect":t.tagName!=="$$profile_".concat(n.uniqueId,":").concat(a.value)&&s.push(t.tagName);break;case"multipleSelect":a.values.find(e=>t.tagName==="$$profile_".concat(n.uniqueId,":").concat(e.value))||s.push(t.tagName)}})}})}e&&e.imageUrl&&u.push("$$profile_picture"),t?userTags.assignUserTags(u,{},a):userTags.removeProfileTags(s,function(e,t){e?a(e):userTags.assignUserTags(u,{overridingUser:t},a)})}},assignUserTags:function(a,n,s){"string"==typeof a&&(a=a.split(",")),n=n||{},authAPI.getCurrentUser(function(e,t){if(t=n.overridingUser||t,e)console.log(e),s(e,null);else if(t){let n=!1;userTags.matchUserTags({tags:a,user:t},function(e,t){var a;n=t.isProfileTagUpdate,t.matchingTag?(t.matchingTag.appliedCount++,t.matchingTag.lastAssgined=(new Date).toISOString()):((a={}).tagName=t.tagName.toLowerCase().trim().replace(/ /g,"-"),a.appliedCount=1,a.firstAssgined=(new Date).toISOString(),a.lastAssgined=(new Date).toISOString(),t.appTags.push(a))},function(){authAPI._setCurrentUser(t)}),bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/app/"+window.appContext.currentApp.appId+"/user/assign",{tags:a,accessToken:t.accessToken}).success(function(e){authAPI.refreshAndTriggerUpdate({updateType:"user_tags_updated",isProfileTagUpdate:n}),s(null,!0)}).error(function(e){console.log(e),s(e)})}})},unassignUserTags:function(a,n,s){"string"==typeof a&&(a=a.split(",")),authAPI.getCurrentUser(function(e,t){e?(console.log(e),s(e,null)):t&&(userTags.matchUserTags({tags:a,user:t},function(e,t){var a;t.matchingTag&&(1<t.matchingTag.appliedCount&&!n.removeTag?(t.matchingTag.appliedCount--,t.matchingTag.lastAssgined=(new Date).toISOString()):(a=t.appTags.indexOf(t.matchingTag),t.appTags.splice(a,1)))},function(){n.preventRefresh||authAPI._setCurrentUser(t)}),bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/userTagging/app/"+window.appContext.currentApp.appId+"/user/unassign",{tags:a,isPrefix:n.isPrefix||!1,accessToken:t.accessToken,removeTag:n.removeTag||!1}).success(function(e){n.preventRefresh||authAPI.refreshAndTriggerUpdate({updateType:"user_tags_updated"}),s(null,t)}).error(function(e){console.log(e),s(e,null)}))})},matchUserTags:function(e,t,a){let{tags:n,user:s}=e;if(n&&0<n.length&&window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId){let e=!1;var r=window.appContext.currentApp.appId;s.tags||(s.tags={}),s.tags[r]||(s.tags[r]=[]);for(var i=0;i<n.length;i++){var o=n[i],u=!1;!e&&o&&0==o.indexOf("$$profile_")&&(e=!0);for(var p=0;p<s.tags[r].length;p++){var g=s.tags[r][p];if(g.tagName.toLowerCase()==o.toLowerCase()||-1<g.tagName.toLowerCase().indexOf(o.toLowerCase())){t(null,{appTags:s.tags[r],tagName:o,matchingTag:g,isProfileTagUpdate:e}),u=!0;break}}u||t(null,{appTags:s.tags[r],tagName:o,matchingTag:null,isProfileTagUpdate:e})}a&&a()}}};userTags.init();
"use strict";function RemoteDatastore(t,e,r,n,i){this.appId=t,this.pluginId=e,this.instanceId=r,this.liveMode=n,this.dataStoreUrl=i}RemoteDatastore.prototype={createReadUrl:function(t,e,r){e=this.dataStoreUrl+"/plugin/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+this.liveMode+"/"+e;return r&&(e+="?withDynamicData=true"),e},createSearchUrl:function(t){return this.dataStoreUrl+"/plugin/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+this.liveMode+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/plugin/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createCloneUrl:function(t){return this.dataStoreUrl+"/app/"+this.appId+"/plugin/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/clone/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/plugin/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/plugin/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/plugin/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/plugin/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createPublishUrl:function(){return this.dataStoreUrl+"/publish/"+this.appId},createServicesUrl:function(){return this.dataStoreUrl+"/app/"+this.appId+"/services/"+this.liveMode},createDeletePluginInstanceUrl:function(t){return this.dataStoreUrl+"/plugin/deletePluginInstance/"+this.appId+"/"+t},resolveTag:function(t){return null==t||""==t?"primary":t},_httpGet:function(t,e,s){"function"!=typeof e||s||(s=e,e=this),bfUtils.http?bfUtils.http.get(t).success(function(t){s.apply(e,[null,t])}).error(function(t,e,r,n){var i="datastore GET Error with URL: "+n.url;s(i),console.error("datastore GET Error: "+n.url,e)}):s("datastore GET Error:bfUtils.http is undefined. Try again later.")},_httpPost:function(t,e,s){bfUtils.http.post(t,e).success(function(t){s(null,t)}).error(function(t,e,r,n){var i="datastore POST Error with URL: "+n.url;s(i),console.error("datastore POST Result: ",e,n.url)})},_httpPut:function(t,e,s){bfUtils.http.put(t,e).success(function(t){s(null,t)}).error(function(t,e,r,n){var i="datastore PUT Error with URL: "+n.url;s(i),console.error("datastore PUT Result: ",e,n.url)})},get:function(t,e,r,n,i){return this._httpGet(this.createReadUrl(e,t,n),r,i),this},save:function(t,e,r){return this._httpPost(this.createSaveUrl(t),e,r),this},insert:function(t,e,r){return this._httpPost(this.createWriteUrl(t),e,r),this},clone:function(t,e,r){return this._httpPost(this.createCloneUrl(t),e,r),this},bulkInsert:function(t,e,r){return this._httpPost(this.createBulkInsertUrl(t),e,r),this},update:function(t,e,r){return this._httpPut(this.createWriteUrl(t),e,r),this},searchAndUpdate:function(t,e,r){return this._httpPost(this.createSearchAndUpdateUrl(t),e,r),this},delete:function(t,e,r,n){return this._httpPost(this.createDeleteUrl(t,e),r,n),this},search:function(t,e,r,n){return this._httpPost(this.createSearchUrl(t),r,n),this},publish:function(t,e){return this._httpPost(this.createPublishUrl(),t,e),this},getServices:function(t,e){return this._httpGet(this.createServicesUrl(),t,e),this},deletePluginInstance:function(t,e,r){return this._httpPost(this.createDeletePluginInstanceUrl(t),e,r),this}};
"use strict";function DatastoreAPI(t,e,i,n,r){var o;if(window.appContext&&window.appContext.currentApp||console.warn("invalid appContext in datastore"),this.enableCache=window.location.protocol.indexOf("http")<0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,this._featureSecurityAccess=void 0,window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&(void 0===window.appContext.currentApp.config.featureSecurityAccess?"enterprise"==window.appContext.currentApp.config.type&&(this._featureSecurityAccess="enabled"):this._featureSecurityAccess=window.appContext.currentApp.config.featureSecurityAccess),"object"==typeof t?(this.appId=(o=t).appId,this.pluginId=o.pluginId,this.instanceId=o.instanceId,this.liveMode=o.liveMode,this.writeKey=o.writeKey||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null)):(this.appId=t,this.pluginId=e,this.instanceId=i,this.liveMode=n,r?this.writeKey=r:window.appContext.currentApp&&window.appContext.currentApp.keys&&window.appContext.currentApp.keys.datastoreKey?this.writeKey=window.appContext.currentApp.keys.datastoreKey:window.appContext.currentApp&&window.appContext.currentApp.datastoreWriteKey?this.writeKey=window.appContext.currentApp.datastoreWriteKey:this.writeKey=null),"undefined"==typeof CustomEvent&&console.warn("Browser doesn't support CustomEvent"),"undefined"==typeof RemoteDatastore&&document.querySelector('script[src="scripts/overrides.js"]'))throw console.error("SDK is outdated. Please update to the most recent version."),"SDK is outdated. Please update to the most recent version.";r=new RemoteDatastore(this.appId,this.pluginId,this.instanceId,this.liveMode,this.dataStoreUrl);this.enableCache&&"undefined"!=typeof OfflineDatastore?this._provider=new OfflineDatastore(this.appId,this.pluginId,this.instanceId,this.liveMode,r):this._provider=r}DatastoreAPI.prototype={deviceOnline:function(){return"undefined"==typeof navigator||!navigator.connection||!navigator.connection.type||"none"!=navigator.connection.type},onUpdate:function(t){},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t)},onRefresh:function(t){document.addEventListener("datastoreOnRefresh",t,!1)},triggerOnRefresh:function(t){t=new CustomEvent("datastoreOnRefresh",{detail:t});document.dispatchEvent(t)},onDisableRefresh:function(t){document.addEventListener("datastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("datastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||""==t?"primary":t},get:function(t,r){if("function"==typeof r){var e,o=this,i="",s=!1;"object"==typeof t?(e="string"==typeof t.tag?t.tag:"",i="string"==typeof t.id?t.id:"",s=t.withDynamicData):"string"==typeof t?e=t:null==e&&(e=""),"string"!=typeof e&&(e="");Date.now();return this._provider.get(i,e,{ds:this,obj:t},s,function(t,i){var n;404==t?r(null,null):t?r(t):null==i?r(null,null):(n=i.tag,i.tag=e,s&&i&&i.data&&i.data._buildfire?o._dynamicDataSecurityFilter(i.data._buildfire,function(t,e){i.data._buildfire=e,r(null,i),i.tag=n}):(r(null,i),i.tag=n))}),this}},save:function(e,i){if(window.toast&&window.toast("saving..."),this.writeKey){var n=e.tag,t=e.obj;"object"==typeof t&&(t=this._cleanUp(t),t="undefined"!=typeof angular?angular.toJson({data:t,writeKey:this.writeKey,id:e.id}):JSON.stringify({data:t,writeKey:this.writeKey,id:e.id}));var r=this;return this._provider.save&&this._provider.save(n,t,function(t){404==t?(window.toast&&window.toast("404","danger"),i(null,null)):t?(window.toast&&window.toast("error saving","danger"),i(t)):(t={id:e.id,data:e.obj,tag:n},i(null,t),r.triggerOnUpdate(t))}),this}console.error("no write key has been provided")},insert:function(i,n){var r=i.tag,t=i.obj,e=i.checkDuplicate;"object"==typeof t&&(t={data:t=this._cleanUp(t),writeKey:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var o=this;return this._provider.insert&&this._provider.insert(r,t,function(t,e){404==t?n(null,null):t?n(t):(i.id=e.id,e={id:e.id,data:i.obj,tag:r},n(null,e),o.triggerOnUpdate(e))}),this},clone:function(i,n){var r=i.tag,t=i.obj,e=i.checkDuplicate;"object"==typeof t&&(t={data:t=this._cleanUp(t),writeKey:this.writeKey},e&&(t.checkDuplicate=e),t=JSON.stringify(t));var o=this;return this._provider.clone&&this._provider.clone(r,t,function(t,e){404==t?n(null,null):t?n(t):(i.id=e.id,e={id:e.id,data:i.obj,tag:r},n(null,e),o.triggerOnUpdate(e))}),this},bulkInsert:function(i,n){var r=i.tag,t=i.obj;"object"==typeof t&&(t=this._cleanUp(t),t=JSON.stringify({data:t,writeKey:this.writeKey,checkDuplicate:!1}));var o=this;return this._provider.bulkInsert&&this._provider.bulkInsert(r,t,function(t,e){404==t?n(null,null):t?n(t):(t={data:i.obj,tag:r},n(null,t),o.triggerOnUpdate(t))}),this},update:function(i,n){window.toast&&window.toast("saving...");var t=i.tag,e=i.obj;"object"==typeof e&&(e=this._cleanUp(e),e=JSON.stringify({id:i.id,data:e,writeKey:this.writeKey}));var r=this;return this._provider.update&&this._provider.update(t,e,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(e.record.tag=i.tag,n(null,e.record),r.triggerOnUpdate(e.record))}),this},searchAndUpdate:function(t,i){window.toast&&window.toast("saving...");var e=t.tag,n=t.obj;"object"==typeof n&&(n=this._cleanUp(n),n=JSON.stringify({search:t.search,data:n,writeKey:this.writeKey}));var r=this;return this._provider.searchAndUpdate&&this._provider.searchAndUpdate(e,n,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(i(null,e),r.triggerOnUpdate(e))}),this},delete:function(i,n){var t=i.tag,e=JSON.stringify({writeKey:this.writeKey}),r=this;return this._provider.delete&&this._provider.delete(t,i.id,e,function(t,e){404==t?n(null,null):t?n(t):(n(null,e),r.triggerOnUpdate(i))}),this},deletePluginInstance:function(i,n){var t=JSON.stringify({writeKey:this.writeKey}),r=this;return this._provider.deletePluginInstance&&this._provider.deletePluginInstance(i.id,t,function(t,e){404==t?n(null,null):t?n(t):(n(null,e),r.triggerOnUpdate(i))}),this},search:function(t,i){var n=this,e=t.tag,r=t.obj;if("function"==typeof i)return"string"!=typeof e&&(e=""),"object"==typeof r&&(r=JSON.stringify(r)),this._provider.search(e,t.obj,r,function(t,e){404==t?i(null,null):t?i(t):null==e?i(null,null):"string"==typeof e?i(null,bfUtils.tryParseJSON(e)):("pluginInstances"===n.pluginId&&"undefined"!=typeof userTags&&userTags.checkPluginAccessSettings&&e.result&&n._pluginInstancesSecurityFilter(e.result),i(null,e))}),this},publish:function(i){var t=JSON.stringify({publishKey:this.publishKey}),n=this;return this._provider.publish&&this._provider.publish(t,function(t,e){404==t?i(null,null):t?i(t):(i(null,bfUtils.tryParseJSON(e)),n.triggerOnUpdate(obj))}),this},getServices:function(t,i){return this._provider.getServices(t,function(t,e){404==t?i(null,null):t?i(t):i(null,e)}),this},_cleanUp:function(t){if(t){var e=JSON.stringify(t);-1<e.indexOf(".cloudimg.io/")&&(console.warn("Plugin CDN url detected in datastore. Use imageLib directly on widget: https://sdk.buildfire.com/docs/imagelib/#buildfireimagelib"),"undefined"!=typeof atatusAPI&&atatusAPI.log("CloudImg url detected in DataStore",["pluginId:".concat(this.pluginId),"provider:datastore"]));e=JSON.parse(e);return this._cleanUpTree(e),e}return t},_cleanUpTree:function(t){for(var e in t){var i=t[e];"_buildfire"==e&&i?(delete i.result,delete i.err):null!==i&&"object"==typeof i&&this._cleanUpTree(t[e])}},_dynamicDataSecurityFilter:function(t,e){if("undefined"!=typeof userTags&&userTags.checkPluginAccessSettings)for(var i in t)i&&((i=t[i])&&i.result&&this._pluginInstancesSecurityFilter(i.result));e(null,t)},_pluginInstancesSecurityFilter:function(t){var e=this;t&&t.forEach(function(i){i&&i.data&&(i.hasAccess=!0,"enabled"===e._featureSecurityAccess&&userTags.checkPluginAccessSettings(i.data,function(t,e){i.hasAccess=e}))})}};
"use strict";var appApiKeys={_callbacksQueue:[],_getInProgress:!1,get:function(a){if(window.appContext){if(window.appContext.currentApp.apiKeys)return a&&a(null,window.appContext.currentApp.apiKeys),window.appContext.currentApp.apiKeys;if(a&&appApiKeys._callbacksQueue.splice(0,0,a),!appApiKeys._getInProgress){appApiKeys._getInProgress=!0;let p=new window.DatastoreAPI({appId:window.appContext.currentApp.appId,pluginId:"apiKeys",instanceId:"apiKeys"});p.get({tag:"apiKeys"},function(p,e){if(p){for(;a=appApiKeys._callbacksQueue.pop();)a(p);appApiKeys._getInProgress=!1}else{for(e&&e.data?window.appContext.currentApp.apiKeys=e.data:window.appContext.currentApp.apiKeys={};a=appApiKeys._callbacksQueue.pop();)a(null,window.appContext.currentApp.apiKeys);appApiKeys._getInProgress=!1}})}}else a&&a("no appContext")}};
"use strict";function UserDatastoreAPI(t,e,r,i,n){var s;window.appContext&&window.appContext.currentApp?(this.enableCache=!1,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,"object"==typeof t?(this.appId=(s=t).appId,this.pluginId=s.pluginId,this.instanceId=s.instanceId,this.isAppUser="control"!=s.type,this.isAppUser?this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null:this.writeKey=s.writeKey||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null)):(this.appId=t,this.pluginId=e,this.instanceId=r,this.isAppUser=i,this.isAppUser?this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null:this.writeKey=n||(window.appContext.currentApp?window.appContext.currentApp.keys.datastoreKey:null)),"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")):console.error("invalid appCOntext in userstore")}UserDatastoreAPI.prototype={onUpdate:function(t){},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t)},onRefresh:function(t){document.addEventListener("userDataOnRefresh",t,!1)},triggerOnRefresh:function(t){t=new CustomEvent("userDataOnRefresh",{detail:t});document.dispatchEvent(t)},onDisableRefresh:function(t){document.addEventListener("userDatastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("userDatastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||""==t?"primary":t},createReadUrl:function(t,e,r){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(e)+"/"+r},createSearchUrl:function(t){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createWriteUrl:function(t,e){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(e)+"/"},createSearchAndUpdateUrl:function(t,e){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(e)+"/"},createDeleteUrl:function(t,e,r){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(r)+"/"+e},createSaveUrl:function(t,e){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(e)+"/"},createBulkInsertUrl:function(t,e){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"+encodeURIComponent(e)+"/"},createAggregateUrl:function(t,e){return this.dataStoreUrl+"/user/aggregate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},_httpGet:function(r,i,n){"function"!=typeof i||n||(n=i,i=this),bfUtils.http.get(r).success(function(t){n.apply(i,[null,t])}).error(function(t,e){n.apply(i,[t=t||"http error with status: "+e]),console.error("user datastore GET Error: ",r,t)})},_httpPost:function(r,t,i){bfUtils.http.post(r,t).success(function(t){i(null,t)}).error(function(t,e){i(t=t||"http error with status: "+e),console.error("user datastore POST Result: ",r,t)})},_httpPut:function(r,t,i){bfUtils.http.put(r,t).success(function(t){i(null,t)}).error(function(t,e){i(t=t||"http error with status: "+e),console.error("user datastore PUT Result: ",r,t)})},get:function(t,n){if(console.log("user datastore: get "+JSON.stringify(t)),"function"==typeof n){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void n("no logged in user found",null);var e,r="";"object"==typeof t?(e="string"==typeof t.tag?t.tag:"",r="string"==typeof t.id?t.id:""):"string"==typeof t?e=t:null==e&&(e=""),"string"!=typeof e&&(e="");var i,s=!1,o=null;try{this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),(o=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(e),t.id))&&(console.log("data cache: found cache"),(i=o).tag=t.tag,i.obj=t.obj,n(null,i),s=!0))}catch(t){console.error("dataDump error: "+t)}var a=Date.now();return this._httpGet(this.createReadUrl(e,this.writeKey,r,!1),{ds:this,isCallBackDone:s,obj:t,userDataDumpAPI:window.userDataDumpAPI},function(t,e){var r=this,i=Date.now()-a;if(console.log("user datastore: response time "+i),t)r.isCallBackDone||n(t);else if(404==t)r.isCallBackDone||n(null,null);else try{null==e?r.isCallBackDone||n(null,null):(r.ds.enableCache&&void 0!==r.userDataDumpAPI&&r.userDataDumpAPI.setData(r.ds.appId,r.ds.pluginId,r.ds.instanceId,r.ds.resolveTag(r.obj.tag),r.obj.id,e),e.tag=r.obj.tag,r.isCallBackDone?o&&o.lastUpdated!=e.lastUpdated&&(console.log("data cache: send updated object onUpdate"),r.ds.triggerOnUpdate(e)):n(null,e))}catch(t){s||n(t)}}),this}},save:function(r,i){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var n=r.tag,s=r.obj,t=r.userToken||this.writeKey;"object"==typeof s&&(s="undefined"!=typeof angular?this.isAppUser?angular.toJson({data:s,userToken:this.writeKey,id:r.id}):angular.toJson({data:s,writeKey:this.writeKey,id:r.id}):this.isAppUser?JSON.stringify({data:s,userToken:this.writeKey,id:r.id}):JSON.stringify({data:s,writeKey:this.writeKey,id:r.id}));var o=this;return this._httpPost(this.createSaveUrl(n,t),s,function(t,e){404==t?(window.toast&&window.toast("404","danger"),i(null,null)):t?(window.toast&&window.toast("error saving","danger"),i(t)):(t={id:r.id,data:r.obj,tag:n},i(null,t),o.triggerOnUpdate(t),o._analyze(s))}),this},insert:function(r,i){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var n=r.tag,s=r.obj,t=r.checkDuplicate,e=r.userToken||this.writeKey;"object"==typeof s&&(s=this.isAppUser?{data:s,userToken:this.writeKey}:{data:s,writeKey:this.writeKey},t&&(s.checkDuplicate=t),s=JSON.stringify(s));var o=this;return this._httpPost(this.createWriteUrl(n,e),s,function(t,e){404==t?i(null,null):t?i(t):(r.id=e.id,e={id:e.id,data:r.obj,tag:n},i(null,e),o.triggerOnUpdate(e),o._analyze(s))}),this},bulkInsert:function(r,i){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var n=r.tag,s=r.obj,t=r.userToken||this.writeKey;"object"==typeof s&&(s=this.isAppUser?JSON.stringify({data:s,userToken:this.writeKey,checkDuplicate:!1}):JSON.stringify({data:s,writeKey:this.writeKey,checkDuplicate:!1}));var o=this;return this._httpPost(this.createBulkInsertUrl(n,t),s,function(t,e){404==t?i(null,null):t?i(t):(t={data:r.obj,tag:n},i(null,t),o.triggerOnUpdate(t),o._analyze(s))}),this},update:function(r,i){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var t=r.tag,n=r.obj,e=r.userToken||this.writeKey;"object"==typeof n&&(n=this.isAppUser?JSON.stringify({id:r.id,data:n,userToken:this.writeKey}):JSON.stringify({id:r.id,data:n,writeKey:this.writeKey}));var s=this;return this._httpPut(this.createWriteUrl(t,e),n,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(e.record.tag=r.tag,i(null,e.record),s.triggerOnUpdate(e.record),s._analyze(n))}),this},searchAndUpdate:function(t,r){if(window.toast&&window.toast("saving..."),this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var e=t.tag,i=t.obj,n=t.userToken||this.writeKey;"object"==typeof i&&(i=this.isAppUser?JSON.stringify({search:t.search,data:i,userToken:this.writeKey}):JSON.stringify({search:t.search,data:i,writeKey:this.writeKey}));var s=this;return this._httpPost(this.createSearchAndUpdateUrl(e,n),i,function(t,e){404==t?(window.toast&&window.toast("404"),r(null,null)):t?(window.toast&&window.toast("error updating"),r(t)):(r(null,e),s.triggerOnUpdate(e),s._analyze(i))}),this},delete:function(r,i){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(i&&i("no logged in user found",null));var t={},e=r.tag,n=r.userToken||this.writeKey,t=this.isAppUser?JSON.stringify({userToken:this.writeKey}):JSON.stringify({writeKey:this.writeKey}),s=this;return this._httpPost(this.createDeleteUrl(e,r.id,n),t,function(t,e){404==t?i(null,null):t?i(t):(i(null,e),s.triggerOnUpdate(r))}),this},search:function(t,r){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var e=t.tag,t=t.obj;return"function"==typeof r?("string"!=typeof e&&(e=""),"string"==typeof t&&(t=JSON.parse(t)),this.isAppUser?t.userToken=this.writeKey:t.writeKey=this.writeKey,"object"==typeof t&&(t=JSON.stringify(t)),this._httpPost(this.createSearchUrl(e),t,function(t,e){404==t?r(null,null):t?r(t):r(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this):void 0},aggregate:function(t,r){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));let e=t.tag,i=t.obj;t=t.userToken||this.writeKey;return"function"==typeof r?("string"!=typeof e&&(e=""),"string"==typeof i&&(i=JSON.parse(i)),this.isAppUser?i.userToken=this.writeKey:i.writeKey=this.writeKey,"object"==typeof i&&(i=JSON.stringify(i)),this._httpPost(this.createAggregateUrl(e,t),i,function(t,e){404==t?r(null,null):t?r(t):r(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this):void 0},dataDump:function(r){if(this.isAppUser&&(this.writeKey=authAPI.getCurrentUser()?authAPI.getCurrentUser()._id:null),!this.writeKey)return console.error("no write key has been provided"),void(r&&r("no logged in user found",null));var i=this;return this._httpget(this.createDataDumpUrl(),function(t,e){404==t?r(null,null):t?r(t):(r(null,bfUtils.tryParseJSON(e)),i.triggerOnUpdate(obj))}),this},_analyze:function(t){"string"==typeof t&&-1<t.indexOf(".cloudimg.io/")&&(console.warn("Plugin CDN url detected in userData. Use imageLib directly on widget: https://sdk.buildfire.com/docs/imagelib/#buildfireimagelib"),"undefined"!=typeof atatusAPI&&atatusAPI.log("CloudImg url detected in DataStore",["pluginId:".concat(this.pluginId),"provider:userData"]))}};
"use strict";function AnalyticsAPI(e,t,s,i,n){var a;this.analyticsHostUrl=siteConfig.endPoints.analyticsHost,"object"==typeof e?(this.appId=(a=e).appId,this.pluginId=a.pluginId,this.instanceId=a.instanceId,this.liveMode=a.liveMode,this.developerId=a.developerId):(this.appId=e,this.pluginId=t,this.instanceId=s,this.liveMode=i,this.developerId=n),this.source=window.siteConfig&&"app"===window.siteConfig.scope?"app":"web",this.secondLevelEmailVerificationEnabled=!1,window.whitelabelContext&&window.whitelabelContext.whitelabelId&&(this.whitelabelId=window.whitelabelContext.whitelabelId,window.whitelabelContext.selfProvSettings&&(this.secondLevelEmailVerificationEnabled=window.whitelabelContext.selfProvSettings.secondLevelEmailVerificationEnabled)),this._user=this._getUser(),this.firebase.init(),window.appContext&&window.appContext.liveMode&&this.appId&&this._trackInstall()}AnalyticsAPI.prototype={_getIpInfo:function(e){function t(){var e=new XMLHttpRequest;e.open("GET",window.siteConfig.endPoints.crmHost+"/ipinfo",!0),e.onreadystatechange=function(){if(4==e.readyState){if(200<=e.status&&e.status<400){if(e.responseText){var t={};try{t=JSON.parse(e.responseText)}catch(e){t={}}}t=t,!0&&(t={data:t,lastSyncDate:new Date},localStorage.setItem("analyticsUserIpInfo",JSON.stringify(t)))}AnalyticsAPI.IPInfoCalled=!1}},e.send(null)}var s,i,n=localStorage.getItem("analyticsUserIpInfo");if(n){try{n=JSON.parse(n)}catch(e){n=null}var a=new Date,o=n&&n.lastSyncDate?new Date(n.lastSyncDate):new Date;i=a,s=(s=o).getTime(),i=i.getTime(),s=Math.abs(i-s),Math.round(s/864e5)<=30&&n&&n.data?e&&e(n.data):(e&&e(n?n.data:null),AnalyticsAPI.IPInfoCalled||(AnalyticsAPI.IPInfoCalled=!0,t()))}else e&&e(),AnalyticsAPI.IPInfoCalled||(AnalyticsAPI.IPInfoCalled=!0,t())},_updateMetadata:function(e){let t=null;var s;"undefined"==typeof authAPI||(s=authAPI.getCurrentUser())&&s._id&&(t={userId:s._id,username:s.username,email:s.email||s.username,displayName:s.displayName,firstName:s.firstName,lastName:s.lastName}),e.user=t,"undefined"!=typeof push&&null!=push.deviceId&&(e.deviceId=push.deviceId)},_getUser:function(){if("undefined"==typeof authAPI)return this._getAnonymousUser();var e=authAPI.getCurrentUser();return e&&e.username?{userId:e.username,isValidEmail:this.secondLevelEmailVerificationEnabled?e.isValidEmail:1}:"undefined"!=typeof push&&null!=push.deviceId?{userId:push.deviceId}:this._getAnonymousUser()},_getAnonymousUser:function(){var e,t,s=localStorage.getItem("analyticsUser");if(s)try{n=JSON.parse(s)}catch(e){console.log(e)}if(!n){s=this._getCookie("ajs_anonymous_id");if(s)n={anonymousId:s.replace("%22","").replace("%22","")};else{var i=1,n={anonymousId:(e=new Date,t=e.getMilliseconds()+"",++e+t+(1e4==++i?i=1:i))};try{localStorage.setItem("analyticsUser",JSON.stringify(n))}catch(e){console.log(e)}}}return n},_getBrowserInfo:function(){return{path:document.location.pathname,referrer:document.referrer,url:document.location.href,title:document.title,platform:window.device&&window.device.platform?window.device.platform.toLowerCase():""}},_getCookie:function(e){for(var t=e+"=",s=document.cookie.split(";"),i=0;i<s.length;i++){for(var n=s[i];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""},_trackInstall:function(){localStorage.getItem("INSTALL_TRACKED")||(this.trackAction("app/installed",{appId:this.appId}),localStorage.setItem("INSTALL_TRACKED","true"))},firebase:{_plugin:void 0,_analytics:void 0,_userId:null,_isEnabled:!1,init:function(){this._isEnabled&&(this._plugin="undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.firebase&&cordova.plugins.firebase?cordova.plugins.firebase:null,this._analytics=this._plugin?this._plugin.analytics:null)},logEvent:function(e,t){this._analytics&&(e=this._sanitizeKey(e),t=this._sanitizeMetadata(t),this._analytics.logEvent(e,t))},setScreenName:function(e){this._analytics&&(e=this._sanitizeKey(e),this._analytics.setScreenName(e))},_syncUserId:function(){this._user&&!this._user.userId&&this._userId!==this._user.userId&&(this._userId=this._user.userId,this._analytics.setUserId(this._user.userId))},_setUserProperties:function(){if(this._user)for(var e in this._user)this._user.hasOwnProperty(e)&&this._analytics.setUserProperty(e,this._user[e])},_sanitizeKey:function(e,t=40){return"string"!=typeof e?e:e.replace(/[\W_]+/g,"_").slice(0,t)},_sanitizeMetadata:function(e){const n=s=>{const i={};return Object.keys(s).forEach(e=>{var t=s[e];"object"!=typeof t||null===t||Array.isArray(t)?["string","number"].includes(typeof t)&&(i[this._sanitizeKey(e)]=this._sanitizeKey(t,100)):Object.assign(i,n(t))}),i},s=n(e);return Object.keys(s).slice(0,25).reduce((e,t)=>(e[t]=s[t],e),{})}},trackAction:function(t,s,i){var n,a=this;if(s){var e,o=this._getBrowserInfo();for(e in o)s[e]=o[e]}return(s=s||this._getBrowserInfo()).source=this.source,this._updateMetadata(s),this.analyticsHostUrl&&t&&(n=!!s&&s.forceSync,s&&delete s.forceSync,a.firebase.logEvent(t,s),this._getIpInfo(function(e){e&&e.country&&(s.ipInfo=e),a._httpPost(a.analyticsHostUrl+"/event",{type:"action",value:t,metadata:s,context:{whitelabelId:a.whitelabelId,appId:a.appId,pluginId:a.pluginId,instanceId:a.instanceId,liveMode:a.liveMode,developerId:a.developerId||void 0},user:a._user},!n,function(e,t){i&&i(e,t)})})),this},trackView:function(t,s,i){var e,n,a=this;if(s){var o,l=this._getBrowserInfo();for(o in l)s[o]=l[o]}return(s=s||this._getBrowserInfo()).source=this.source,this._updateMetadata(s),this.analyticsHostUrl&&t&&((e=this._getCookie("_ga"))&&((n={}).clientId=e.substr(6)),this.firebase.setScreenName(t),this._getIpInfo(function(e){e&&(s.ipInfo=e),a._httpPost(a.analyticsHostUrl+"/event",{type:"view",value:t,metadata:s,context:{whitelabelId:a.whitelabelId,appId:a.appId,pluginId:a.pluginId,instanceId:a.instanceId,liveMode:a.liveMode,developerId:a.developerId||void 0},segmentContext:{"Google Analytics":n},user:a._user},!0,function(e,t){i&&i()})})),this},registerPluginEvent:function(i,n){var s,e,a;"cp"==window.siteConfig.scope||"sdk"==window.siteConfig.scope?i?(i.data||(i.data={}),i.options||(i.options={}),(s=i.data).key?s.title?(s._titleLowerCase=s.title.toLowerCase(),e=this.instanceId+"_pluginEvents",(a=new DatastoreAPI(this.appId,this.pluginId,e,this.liveMode)).searchAndUpdate({tag:"events",obj:{$set:s},search:{key:s.key}},function(e,t){null==e&&t&&0==t.nModified?a.insert({tag:"events",obj:s,checkDuplicate:!1},function(e,t){var s=new CustomEvent("pluginAnalyticsRegisterEvent",{detail:{data:i.data,options:i.options}});document.dispatchEvent(s),n&&n(e,t)}):n&&n(e,t)})):n&&n("Missing event title",null):n&&n("Missing event key",null)):n&&n("invalid params",null):n&&n("This method works only on Control Side",null)},unregisterPluginEvent:function(e,i){var t,n;e&&e.key?(t=this.instanceId+"_pluginEvents",(n=new DatastoreAPI(this.appId,this.pluginId,t,this.liveMode)).search({tag:"events",obj:{filter:{"$json.key":e.key}}},function(e,t){if(!e&&t&&0<t.length)for(var s=0;s<t.length;s++)n.delete({tag:"events",id:t[s].id},function(e,t){i&&i(e,t)});else i&&i(e,t)})):i&&i("Missing event key",null)},getPluginEvents:function(e,s){var t=this.instanceId+"_pluginEvents",t=new DatastoreAPI(this.appId,this.pluginId,t,this.liveMode);(e=e||{}).skip=e.skip||0,e.limit=e.limit||50,t.search({tag:"events",obj:e},function(e,t){s&&s(e,t)})},setUsername:function(e){this._user.userId=e,this._user.anonymousId&&(this._user.updateIdentity=!0)},setUserProperties:function(e){this._user.properties=e,this._user.updateIdentity=!0},_httpPost:function(e,t,s,i){if(!window.__$haultEvents){var n=new XMLHttpRequest;n.open("POST",e,s),n.setRequestHeader("Content-type","application/JSON");var a=this;t.user&&t.user.userId&&t.user.userId.userId&&(t.user=o(t.user),localStorage.setItem("analyticsUser",JSON.stringify(t.user))),n.onreadystatechange=function(){4==n.readyState&&(200<=n.status&&n.status<400?(a._user&&a._user.userId&&a._user.userId.userId&&(a._user=o(a._user)),a._user.updateIdentity&&(delete a._user.updateIdentity,delete a._user.properties,delete a._user.anonymousId),localStorage.setItem("analyticsUser",JSON.stringify(a._user)),i(null,n.responseText)):0==n.status?(i(n.status),window.__$haultEvents=!0):i(n.status))};s=null;try{s=JSON.stringify(t)}catch(e){console.error("error stringifying analytics data",t.context,t.type+":"+t.value,t.metadata,t,e)}if(s)try{n.send(s)}catch(e){e.code&&console.error("error sending analytics",e,t,t.context,t.type+":"+t.value,t.metadata,s,e)}}function o(e){return e&&"object"==typeof e.userId?o(e.userId):e}},session:{_sessionsObject:{},init:function(){this._sessionsObject=JSON.parse(localStorage.getItem(window.appContext.currentApp.appId+"-sessions")),this._sessionsObject?(this._sessionsObject.appSession&&(this._sessionsObject.appSession.terminationReason="appUnload",this._syncApp()),this._sessionsObject.pluginSession&&(this._sessionsObject.pluginSession.terminationReason="appUnload",this._sessionsObject.pluginSession.old=!0,this._syncPlugin())):this._sessionsObject={},this._trackAppSession(),bfUtils.isMobileDevice?(document.addEventListener("deviceAppResumed",this.onDeviceResumed.bind(this),!1),document.addEventListener("deviceAppBackgrounded",this.onDeviceBackground.bind(this),!1)):document.addEventListener("sessionActivity",this._handleUserActivity.bind(this),!1)},_updateLocalStorage:function(){localStorage.setItem(window.appContext.currentApp.appId+"-sessions",JSON.stringify(this._sessionsObject))},_handleUserActivity:function(){!bfUtils.isMobileDevice&&this._sessionsObject&&(this._sessionsObject.appSession&&(300<this._getTimeDifference(new Date,new Date(this._sessionsObject.appSession.lastPulseTime))?(this._sessionsObject.appSession.terminationReason="inactivity",this._updateLocalStorage(),this.startAppSession()):(this._sessionsObject.appSession.lastPulseTime=new Date,this._updateLocalStorage())),this._sessionsObject.pluginSession&&(300<this._getTimeDifference(new Date,new Date(this._sessionsObject.pluginSession.lastPulseTime))?(this._sessionsObject.pluginSession.terminationReason="inactivity",this._sessionsObject.pluginSession.old=!0,this._updateLocalStorage(),this.startPluginSession()):(this._sessionsObject.pluginSession.lastPulseTime=new Date,this._updateLocalStorage())))},_getTimeDifference:function(e,t){return Math.ceil((e.getTime()-t.getTime())/1e3)},_syncApp:function(){if(this._sessionsObject.appSession){let e={};e.session=JSON.parse(JSON.stringify(this._sessionsObject.appSession)),e.actionName="app/appSession",this._sessionsObject.appSession=null,this._updateLocalStorage(),this._saveSession(e)}},_syncPlugin:function(){if(this._sessionsObject.pluginSession){let e={},t=JSON.parse(JSON.stringify(this._sessionsObject.pluginSession));t.lastPulseTime=t.old?t.lastPulseTime:new Date,t.terminationReason||(t.terminationReason="pluginNavigation"),e.session=t,e.actionName="app/pluginSession",this._sessionsObject.pluginSession=null,this._updateLocalStorage(),this._saveSession(e)}},_trackAppSession:function(){this._handleUserActivity(),this.startAppSession()},trackPluginSession:function(e){this.pluginContext=e.context,this._handleUserActivity(),this.startPluginSession()},_saveSession:function(t){var s=t.session;let i={appId:window.appContext.currentApp.appId,pluginId:s.pluginId,instanceId:s.instanceId,liveMode:window.appContext.liveMode};var n=this._getTimeDifference(new Date(s.lastPulseTime),new Date(s.startSessionTime));if(!(n<=0||10800<n)){let e={pluginTitle:s.pluginTitle,pluginId:s.pluginId,instanceId:s.instanceId,startSessionTime:s.startSessionTime,endSessionTime:s.lastPulseTime,sessionDurationSeconds:n,terminationReason:s.terminationReason,_buildfire:{aggregationValue:n}};setTimeout(()=>{new AnalyticsAPI(i).trackAction(t.actionName,e,(e,t)=>{e&&console.error("Error: could not track the app action")})},3e3)}},createSessionObject:function(e){let t={};return t.lastPulseTime=new Date,t.startSessionTime=new Date,e&&"plugin"==e.type&&(t.pluginId=e.context&&e.context.pluginId,t.instanceId=e.context&&e.context.instanceId,t.pluginTitle=e.context&&e.context.title),t},startAppSession:function(){let e=this;this.endAppSession(),this._syncApp();let t=this.createSessionObject();this._sessionsObject.appSession=t,this._updateLocalStorage(),bfUtils.isMobileDevice&&(this.appSessionInterval=setInterval(()=>{t.lastPulseTime=new Date,e._updateLocalStorage()},1e4))},startPluginSession:function(){let e=this;this.endPluginSession(),this._syncPlugin();let t=this.createSessionObject({type:"plugin",context:this.pluginContext});this._sessionsObject.pluginSession=t,this._updateLocalStorage(),bfUtils.isMobileDevice&&(this.pluginSessionInterval=setInterval(()=>{t.lastPulseTime=new Date,e._updateLocalStorage()},1e4))},endAppSession:function(){this.appSessionInterval&&(clearInterval(this.appSessionInterval),this.appSessionInterval=void 0)},endPluginSession:function(){this.pluginSessionInterval&&(clearInterval(this.pluginSessionInterval),this.pluginSessionInterval=void 0)},suspendAppSession:function(){this.endAppSession()},suspendPluginSession:function(){this.endPluginSession()},onDeviceResumed:function(){this._sessionsObject&&this._sessionsObject.appSession&&(this._sessionsObject.appSession.terminationReason="paused"),this._sessionsObject&&this._sessionsObject.pluginSession&&(this._sessionsObject.pluginSession.terminationReason="paused",this._sessionsObject.pluginSession.old=!0),this.startAppSession(),this.startPluginSession(),console.log("App resumed")},onDeviceBackground:function(){this.suspendAppSession(),this.suspendPluginSession(),console.log("App on hold")}}},setTimeout(()=>{window.appContext&&window.appContext.liveMode&&AnalyticsAPI.prototype.session.init()},3e3);
"use strict";function PublicDatastoreAPI(t,e,n){var i;window.appContext&&window.appContext.currentApp?(this.enableCache=!0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,"object"==typeof t?(this.appId=(i=t).appId,this.pluginId=i.pluginId,this.instanceId=i.instanceId):(this.appId=t,this.pluginId=e,this.instanceId=n),this.writeKey="public","undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")):console.error("invalid appCOntext in publicdata")}PublicDatastoreAPI.prototype={onUpdate:function(t){document.addEventListener("publicDataOnUpdate",t,!1)},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t);t=new CustomEvent("publicDataOnUpdate",{detail:t});document.dispatchEvent(t)},onRefresh:function(t){document.addEventListener("publicDataOnRefresh",t,!1)},triggerOnRefresh:function(t){t=new CustomEvent("publicDataOnRefresh",{detail:t});document.dispatchEvent(t)},onDisableRefresh:function(t){document.addEventListener("publicDatastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("publicDatastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||""==t?"primary":t},createReadUrl:function(t,e){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSearchUrl:function(t){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createAggregateUrl:function(t){return this.dataStoreUrl+"/user/aggregate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},_httpGet:function(e,n,i){"function"!=typeof n||i||(i=n,n=this),bfUtils.http.get(e).success(function(t){i.apply(n,[null,t])}).error(function(t){i.apply(n,[t]),console.error("public datastore GET Error: ",e,t)})},_httpPost:function(e,t,n){bfUtils.http.post(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("public datastore POST Result: ",e,t)})},_httpPut:function(e,t,n){bfUtils.http.put(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("public datastore PUT Result: ",e,t)})},get:function(t,r){if(console.log("public datastore: get "+JSON.stringify(t)),"function"==typeof r){if(this.writeKey){var e,n="";"object"==typeof t?(e="string"==typeof t.tag?t.tag:"",n="string"==typeof t.id?t.id:""):"string"==typeof t?e=t:null==e&&(e=""),"string"!=typeof e&&(e="");var i,o=!1,a=null;try{this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),(a=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(e),t.id))&&(console.log("data cache: found cache"),(i=a).tag=t.tag,i.obj=t.obj,r(null,i),o=!0))}catch(t){console.error("dataDump error: "+t)}var s=Date.now();return this._httpGet(this.createReadUrl(e,n,!1),{ds:this,isCallBackDone:o,obj:t,userDataDumpAPI:window.userDataDumpAPI},function(t,e){var n=this,i=Date.now()-s;if(console.log("public datastore: response time "+i),t)n.isCallBackDone||r(t);else if(404==t)n.isCallBackDone||r(null,null);else try{null==e?n.isCallBackDone||r(null,null):(n.ds.enableCache&&void 0!==n.userDataDumpAPI&&n.userDataDumpAPI.setData(n.ds.appId,n.ds.pluginId,n.ds.instanceId,n.ds.resolveTag(n.obj.tag),n.obj.id,e),e.tag=n.obj.tag,n.isCallBackDone?a&&a.lastUpdated!=e.lastUpdated&&(console.log("data cache: send updated object onUpdate"),n.ds.triggerOnUpdate(e)):r(null,e))}catch(t){o||r(t)}}),this}console.error("no write key has been provided")}},save:function(n,i){if(window.toast&&window.toast("saving..."),this.writeKey){var r=n.tag,o=n.obj;"object"==typeof o&&(o="undefined"!=typeof angular?angular.toJson({data:o,userToken:this.writeKey,id:n.id}):JSON.stringify({data:o,userToken:this.writeKey,id:n.id}));var a=this;return this._httpPost(this.createSaveUrl(r),o,function(t,e){404==t?(window.toast&&window.toast("404","danger"),i(null,null)):t?(window.toast&&window.toast("error saving","danger"),i(t)):(t={id:n.id,data:n.obj,tag:r},i(null,t),a.triggerOnUpdate(t),a._analyze(o))}),this}console.error("no write key has been provided")},insert:function(n,i){if(this.writeKey){var r=n.tag,o=n.obj,t=n.checkDuplicate;"object"==typeof o&&(o={data:o,userToken:this.writeKey},t&&(o.checkDuplicate=t),o=JSON.stringify(o));var a=this;return this._httpPost(this.createWriteUrl(r),o,function(t,e){404==t?i(null,null):t?i(t):(n.id=e.id,e={id:e.id,data:n.obj,tag:r},i(null,e),a.triggerOnUpdate(e),a._analyze(o))}),this}console.error("no write key has been provided")},bulkInsert:function(n,i){if(this.writeKey){var r=n.tag,o=n.obj;"object"==typeof o&&(o=JSON.stringify({data:o,userToken:this.writeKey,checkDuplicate:!1}));var a=this;return this._httpPost(this.createBulkInsertUrl(r),o,function(t,e){404==t?i(null,null):t?i(t):(t={data:n.obj,tag:r},i(null,t),a.triggerOnUpdate(t),a._analyze(o))}),this}console.error("no write key has been provided")},update:function(n,i){if(window.toast&&window.toast("saving..."),this.writeKey){var t=n.tag,r=n.obj;"object"==typeof r&&(r=JSON.stringify({id:n.id,data:r,userToken:this.writeKey}));var o=this;return this._httpPut(this.createWriteUrl(t),r,function(t,e){404==t?(window.toast&&window.toast("404"),i(null,null)):t?(window.toast&&window.toast("error updating"),i(t)):(e.record.tag=n.tag,i(null,e.record),o.triggerOnUpdate(e.record),o._analyze(r))}),this}console.error("no write key has been provided")},searchAndUpdate:function(t,n){if(window.toast&&window.toast("saving..."),this.writeKey){var e=t.tag,i=t.obj;"object"==typeof i&&(i=JSON.stringify({search:t.search,data:i,userToken:this.writeKey}));var r=this;return this._httpPost(this.createSearchAndUpdateUrl(e),i,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(n(null,e),r.triggerOnUpdate(e),r._analyze(i))}),this}console.error("no write key has been provided")},delete:function(n,i){if(this.writeKey){var t=n.tag,e=JSON.stringify({userToken:this.writeKey}),r=this;return this._httpPost(this.createDeleteUrl(t,n.id),e,function(t,e){404==t?i(null,null):t?i(t):(i(null,e),r.triggerOnUpdate(n))}),this}console.error("no write key has been provided")},search:function(t,n){if(this.writeKey){var e=t.tag,t=t.obj;if("function"==typeof n)return"string"!=typeof e&&(e=""),(t="string"==typeof t?JSON.parse(t):t).userToken=this.writeKey,"object"==typeof t&&(t=JSON.stringify(t)),this._httpPost(this.createSearchUrl(e),t,function(t,e){404==t?n(null,null):t?n(t):n(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this}else console.error("no write key has been provided")},aggregate:function(n,i){if(this.writeKey){let t=n.tag,e=n.obj;if("function"==typeof i)return"string"!=typeof t&&(t=""),"string"==typeof e&&(e=JSON.parse(e)),e.userToken=this.writeKey,"object"==typeof e&&(e=JSON.stringify(e)),this._httpPost(this.createAggregateUrl(t),e,function(t,e){404==t?i(null,null):t?i(t):i(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this}else console.error("no write key has been provided")},dataDump:function(n){if(this.writeKey){var i=this;return this._httpget(this.createDataDumpUrl(),function(t,e){404==t?n(null,null):t?n(t):(n(null,bfUtils.tryParseJSON(e)),i.triggerOnUpdate(obj))}),this}console.error("no write key has been provided")},_analyze:function(t){"string"==typeof t&&-1<t.indexOf(".cloudimg.io/")&&(console.warn("Plugin CDN url detected in publicData. Use imageLib directly on widget: https://sdk.buildfire.com/docs/imagelib/#buildfireimagelib"),"undefined"!=typeof atatusAPI&&atatusAPI.log("CloudImg url detected in DataStore",["pluginId:".concat(this.pluginId),"provider:publicData"]))}};
"use strict";function AppDatastoreAPI(t){window.appContext&&window.appContext.currentApp?(this.enableCache=!0,this.dataStoreUrl=window.siteConfig.endPoints.datastoreHost,this.appId="object"==typeof t?t.appId:t,this.pluginId="public",this.instanceId="public",this.writeKey="public","undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")):console.error("invalid appCOntext in publicdata")}AppDatastoreAPI.prototype={onUpdate:function(t){document.addEventListener("appDataOnUpdate",t,!1)},triggerOnUpdate:function(t){this.onUpdate&&this.onUpdate(t);t=new CustomEvent("appDataOnUpdate",{detail:t});document.dispatchEvent(t)},onRefresh:function(t){document.addEventListener("appDataOnRefresh",t,!1)},triggerOnRefresh:function(t){t=new CustomEvent("appDataOnRefresh",{detail:t});document.dispatchEvent(t)},onDisableRefresh:function(t){document.addEventListener("appDatastoreOnDisableRefresh",t,!1)},disableRefresh:function(){document.dispatchEvent(new CustomEvent("appDatastoreOnDisableRefresh"))},resolveTag:function(t){return null==t||""==t?"primary":t},createReadUrl:function(t,e){return this.dataStoreUrl+"/user/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSearchUrl:function(t){return this.dataStoreUrl+"/user/search/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},createWriteUrl:function(t){return this.dataStoreUrl+"/user/insert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createSearchAndUpdateUrl:function(t){return this.dataStoreUrl+"/user/searchAndUpdate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createDeleteUrl:function(t,e){return this.dataStoreUrl+"/user/delete/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"+e},createSaveUrl:function(t){return this.dataStoreUrl+"/user/save/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createBulkInsertUrl:function(t){return this.dataStoreUrl+"/user/bulkInsert/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/public/"},createAggregateUrl:function(t){return this.dataStoreUrl+"/user/aggregate/"+this.appId+"/"+this.pluginId+"/"+this.instanceId+"/"+encodeURIComponent(this.resolveTag(t))+"/"},_httpGet:function(e,n,r){"function"!=typeof n||r||(r=n,n=this),bfUtils.http.get(e).success(function(t){r.apply(n,[null,t])}).error(function(t){r.apply(n,[t]),console.error("appDatastore GET Error: ",e,t)})},_httpPost:function(e,t,n){bfUtils.http.post(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("appDatastore POST Result: ",e,t)})},_httpPut:function(e,t,n){bfUtils.http.put(e,t).success(function(t){n(null,t)}).error(function(t){n(t),console.error("appDatastore PUT Result: ",e,t)})},get:function(t,i){if(console.log("appDatastore: get "+JSON.stringify(t)),"function"==typeof i){if(this.writeKey){var e,n="";if("object"==typeof t?(e="string"==typeof t.tag?t.tag:"",n="string"==typeof t.id?t.id:""):"string"==typeof t&&(e=t),"string"!=typeof e||!e)return i(new Error("tag is required for appData"),null);var r,a=!1,o=null;try{this.enableCache&&"undefined"!=typeof userDataDumpAPI&&(console.log("data cache: check for cache"),(o=userDataDumpAPI.getData(this.appId,this.pluginId,this.instanceId,this.resolveTag(e),t.id))&&(console.log("data cache: found cache"),(r=o).tag=t.tag,r.obj=t.obj,i(null,r),a=!0))}catch(t){console.error("dataDump error: "+t)}var s=Date.now();return this._httpGet(this.createReadUrl(e,n,!1),{ds:this,isCallBackDone:a,obj:t,userDataDumpAPI:window.userDataDumpAPI},function(t,e){var n=this,r=Date.now()-s;if(console.log("appDatastore: response time "+r),t)n.isCallBackDone||i(t);else if(404==t)n.isCallBackDone||i(null,null);else try{null==e?n.isCallBackDone||i(null,null):(n.ds.enableCache&&void 0!==n.userDataDumpAPI&&n.userDataDumpAPI.setData(n.ds.appId,n.ds.pluginId,n.ds.instanceId,n.ds.resolveTag(n.obj.tag),n.obj.id,e),e.tag=n.obj.tag,n.isCallBackDone?o&&o.lastUpdated!=e.lastUpdated&&(console.log("data cache: send updated object onUpdate"),n.ds.triggerOnUpdate(e)):i(null,e))}catch(t){a||i(t)}}),this}console.error("no write key has been provided")}},save:function(n,r){if(window.toast&&window.toast("saving..."),this.writeKey){var i=n.tag,a=n.obj;if("string"!=typeof i||!i)return r(new Error("tag is required for appData"),null);"object"==typeof a&&(a="undefined"!=typeof angular?angular.toJson({data:a,userToken:this.writeKey,id:n.id}):JSON.stringify({data:a,userToken:this.writeKey,id:n.id}));var o=this;return this._httpPost(this.createSaveUrl(i),a,function(t,e){404==t?(window.toast&&window.toast("404","danger"),r(null,null)):t?(window.toast&&window.toast("error saving","danger"),r(t)):(t={id:n.id,data:n.obj,tag:i},r(null,t),o.triggerOnUpdate(t),o._analyze(a))}),this}console.error("no write key has been provided")},insert:function(n,r){if(this.writeKey){var i=n.tag,a=n.obj,t=n.checkDuplicate;if("string"!=typeof i||!i)return r(new Error("tag is required for appData"),null);"object"==typeof a&&(a={data:a,userToken:this.writeKey},t&&(a.checkDuplicate=t),a=JSON.stringify(a));var o=this;return this._httpPost(this.createWriteUrl(i),a,function(t,e){404==t?r(null,null):t?r(t):(n.id=e.id,e={id:e.id,data:n.obj,tag:i},r(null,e),o.triggerOnUpdate(e),o._analyze(a))}),this}console.error("no write key has been provided")},bulkInsert:function(n,r){if(this.writeKey){var i=n.tag,a=n.obj;if("string"!=typeof i||!i)return r(new Error("tag is required for appData"),null);"object"==typeof a&&(a=JSON.stringify({data:a,userToken:this.writeKey,checkDuplicate:!1}));var o=this;return this._httpPost(this.createBulkInsertUrl(i),a,function(t,e){404==t?r(null,null):t?r(t):(t={data:n.obj,tag:i},r(null,t),o.triggerOnUpdate(t),o._analyze(a))}),this}console.error("no write key has been provided")},update:function(n,r){if(window.toast&&window.toast("saving..."),this.writeKey){var t=n.tag,i=n.obj;if("string"!=typeof t||!t)return r(new Error("tag is required for appData"),null);"object"==typeof i&&(i=JSON.stringify({id:n.id,data:i,userToken:this.writeKey}));var a=this;return this._httpPut(this.createWriteUrl(t),i,function(t,e){404==t?(window.toast&&window.toast("404"),r(null,null)):t?(window.toast&&window.toast("error updating"),r(t)):(e.record.tag=n.tag,r(null,e.record),a.triggerOnUpdate(e.record),a._analyze(i))}),this}console.error("no write key has been provided")},searchAndUpdate:function(t,n){if(window.toast&&window.toast("saving..."),this.writeKey){var e=t.tag,r=t.obj;if("string"!=typeof e||!e)return n(new Error("tag is required for appData"),null);"object"==typeof r&&(r=JSON.stringify({search:t.search,data:r,userToken:this.writeKey}));var i=this;return this._httpPost(this.createSearchAndUpdateUrl(e),r,function(t,e){404==t?(window.toast&&window.toast("404"),n(null,null)):t?(window.toast&&window.toast("error updating"),n(t)):(n(null,e),i.triggerOnUpdate(e),i._analyze(r))}),this}console.error("no write key has been provided")},delete:function(n,r){if(this.writeKey){var t=n.tag,e=JSON.stringify({userToken:this.writeKey});if("string"!=typeof t||!t)return r(new Error("tag is required for appData"),null);var i=this;return this._httpPost(this.createDeleteUrl(t,n.id),e,function(t,e){404==t?r(null,null):t?r(t):(r(null,e),i.triggerOnUpdate(n))}),this}console.error("no write key has been provided")},search:function(t,n){if(this.writeKey){var e=t.tag,t=t.obj;if("function"==typeof n)return"string"==typeof e&&e?((t="string"==typeof t?JSON.parse(t):t).userToken=this.writeKey,"object"==typeof t&&(t=JSON.stringify(t)),this._httpPost(this.createSearchUrl(e),t,function(t,e){404==t?n(null,null):t?n(t):n(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this):n(new Error("tag is required for appData"),null)}else console.error("no write key has been provided")},aggregate:function(e,n){if(this.writeKey){var r=e.tag;let t=e.obj;if("function"==typeof n)return"string"==typeof r&&r?("string"==typeof t&&(t=JSON.parse(t)),t.userToken=this.writeKey,"object"==typeof t&&(t=JSON.stringify(t)),this._httpPost(this.createAggregateUrl(r),t,function(t,e){404==t?n(null,null):t?n(t):n(null,null==e?null:"string"==typeof e?bfUtils.tryParseJSON(e):e)}),this):n(new Error("tag is required for appData"),null)}else console.error("no write key has been provided")},dataDump:function(n){if(this.writeKey){var r=this;return this._httpget(this.createDataDumpUrl(),function(t,e){404==t?n(null,null):t?n(t):(n(null,bfUtils.tryParseJSON(e)),r.triggerOnUpdate(obj))}),this}console.error("no write key has been provided")},_analyze:function(t){"string"==typeof t&&-1<t.indexOf(".cloudimg.io/")&&(console.warn("Plugin CDN url detected in appData. Use imageLib directly on widget: https://sdk.buildfire.com/docs/imagelib/#buildfireimagelib"),"undefined"!=typeof atatusAPI&&atatusAPI.log("CloudImg url detected in DataStore",["pluginId:".concat(this.pluginId),"provider:appData"]))}};
"use strict";var deepLinkAPI={navigateToContent(n,t){var{pluginInstanceId:a,payload:n}=n,n=JSON.stringify(n),n="".concat("&dld=").concat(n);if(a){const i=window.postMaster.launcherPluginAPI["navigation"];"function"!=typeof t&&(t=Function.prototype),i.navigateToPluginInstance({instanceId:a,queryString:n},t)}}};
"use strict";function ShortLinksAPI(t){this.context=t,this.url=window.siteConfig.endPoints.appHost+"/api/app/"+this.context.appId+"/shortlink/"}ShortLinksAPI.prototype={generate:function(n,o){let a=this;if(n.pluginToken=this.context.pluginId,n.instanceId=this.context.instanceId,n.data&&"object"!=typeof n.data)o("data is not an object");else{if(n.extraMetaTags){if("object"!=typeof n.extraMetaTags)return void o("extraMetaTags is not array of objects");for(var t=0;t<n.extraMetaTags.length;t++)if("object"!=typeof n.extraMetaTags[t])return void o("extraMetaTags is not array of objects")}bfUtils.http.post(this.url,n).success(function(t){let e=new AnalyticsAPI(a.context.appId,a.context.pluginId,a.context.instanceId,a.context.liveMode);n.shortLinkUrl=t.url,e.trackAction("shortlink/generate",n),o(null,t)}).error(function(t){o(t)})}}};
"use strict";function AppearanceAPI(e){this.pluginAPI=e}function resetToDefaults(){postMaster.isLauncherPluginActive()&&AppearanceAPI.prototype.titlebar.hide(),AppearanceAPI.prototype.sideMenu.show(),AppearanceAPI.prototype.fullScreenMode.disable(),AppearanceAPI.prototype.navbar.show();var e=document.getElementById("launcherPlugin");AppearanceAPI.prototype.applyToScope(e,"disableAutomaticNavigationBar",!1)}AppearanceAPI.prototype={getCSSFiles:function(e,t){return t(null,["https://bootswatch.com/cerulean/bootstrap.css"]),this},autosizeContainer:function(e,t){this.autosizeContainerHandler(e.height),t(null,null)},autosizeContainerHandler:function(){},setHeaderVisibility:function(e){var t=document.getElementById("pluginControlHeader"),n=document.getElementById("pluginControlHeaderTabs");t&&(e?t.classList.remove("hidden"):t.classList.add("hidden")),n&&(e?n.classList.remove("hidden"):n.classList.add("hidden"))},beforeUpdate:function(e){document.addEventListener("appearanceBeforeUpdate",e,!1)},triggerBeforeUpdate:function(e){var t=new CustomEvent("appearanceBeforeUpdate");document.dispatchEvent(t)},onUpdate:function(e){document.addEventListener("appearanceOnUpdate",e,!1)},triggerOnUpdate:function(e){e&&(AppearanceAPI._appearance=e);e=new CustomEvent("appearanceOnUpdate");document.dispatchEvent(e)},onAppThemeUpdate:function(e){document.addEventListener("appThemeOnUpdate",e,!1)},triggerAppThemeUpdate:function(){var e=new CustomEvent("appThemeOnUpdate");document.dispatchEvent(e)},applyToScope:function(e,t,n,a){if(!e)return a&&a();let o=void 0;o=angular.element(e).scope(),o[t]=n,o.$$phase||(o.$apply(),a&&a())},getScope:function(e){return angular.element(e).scope()},applyScopeFunction:function(e,t,n){let a=void 0;a=angular.element(e).scope(),"function"==typeof a[t]&&a[t](),n&&n()},applyToRootScope:function(e,t,n){let a=void 0;a=angular.element(document.body).scope().$root,a[e]=t,a.$$phase||(a.$apply(),n&&n())},getRootScope:function(){return angular.element(document.body).scope().$root},getFooterMenu:function(e,t){"function"==typeof e&&(t=e);var n=localStorage.getItem("footerMenu"),e={};t(null,e=n?JSON.parse(n):e)},getAppearance:function(e,n){if(AppearanceAPI._appearance)n(null,AppearanceAPI._appearance);else{if(!window.appContext||!window.appContext.currentApp||!window.appContext.currentApp.appId)return n("missing currentApp parameters");var t="appearance",a={appId:window.appContext.currentApp.appId,pluginId:t,instanceId:t};let e=new window.DatastoreAPI(a);e.get({tag:t,withDynamicData:!0},function(e,t){return e?n(e,null):t&&t.data?(AppearanceAPI._appearance=t.data,n(null,t.data)):void n("No result",null)})}},updateCustomRegistration:function(e){AppearanceAPI._appearance&&(AppearanceAPI._appearance.customRegistration=e)},updateCustomLoginUI:function(e){AppearanceAPI._appearance&&e&&(AppearanceAPI._appearance.customLoginUI=e)},titlebar:{show:function(e,t){AppearanceAPI.prototype.titlebar.toggleVisibility(!0,"showNavigationBar",t)},hide:function(e,t){AppearanceAPI.prototype.titlebar.toggleVisibility(!1,"showNavigationBar",t)},toggleVisibility:function(t,n="showNavigationBar",e){var a=document.getElementsByClassName("pluginFrame"),o=postMaster.isLauncherPluginActive(),p=AppearanceAPI.prototype.getRootScope();let i=0;var r=e=>{i+=e},c=()=>{i--,0==i&&e&&e()};if(o||p.accessCodeVisible){p=document.getElementById("launcherPlugin");r(2),AppearanceAPI.prototype.applyToScope(p,"disableAutomaticNavigationBar",!0,c),AppearanceAPI.prototype.applyToScope(p,n,t,c)}else{r(2*a.length);for(let e=0;e<a.length;e++)AppearanceAPI.prototype.applyToScope(a[e],"disableAutomaticNavigationBar",!0,c),AppearanceAPI.prototype.applyToScope(a[e],n,t,c)}},reset:function(e,t){var n=document.getElementsByClassName("pluginFrame"),a=postMaster.isLauncherPluginActive();let o=0;var p=e=>{o+=e},i=()=>{o--,0==o&&t&&t()};if(a){var r=document.getElementById("launcherPlugin");p(2),AppearanceAPI.prototype.applyToScope(r,"disableAutomaticNavigationBar",!1,i),AppearanceAPI.prototype.applyToScope(r,e,!1,i);a=new HistoryAPI;a.historyItems&&1<a.historyItems.length&&AppearanceAPI.prototype.applyToScope(r,"showNavigationBar",!0,i)}else{p(2*n.length);for(const c of n)AppearanceAPI.prototype.applyToScope(c,"disableAutomaticNavigationBar",!1,i),AppearanceAPI.prototype.applyToScope(c,e,!1,i)}},isVisible:function(){var e=!postMaster.isWidgetPluginInactive()||!postMaster.isLauncherPluginActive(),t=document.getElementById("launcherPlugin"),n=angular.element(t).scope(),t=n.showNavigationBar;return!0===n.disableAutomaticNavigationBar?t:e}},navbar:{show:function(e,t){AppearanceAPI.prototype.navbar.toggleVisibility(!0,"isFooterMenuHidden",e,t)},hide:function(e,t){AppearanceAPI.prototype.navbar.toggleVisibility(!1,"isFooterMenuHidden",e,t)},toggleVisibility:function(t,n,e,a){var o=document.getElementsByClassName("pluginFrame"),p=postMaster.isLauncherPluginActive(),i=document.getElementById("footerMenuParent");let r=0;var c=e=>{r+=e},l=()=>{r--,0==r&&a&&a()};if(p){p=document.getElementById("launcherPlugin");c(2),AppearanceAPI.prototype.applyToScope(i,n,!t,l),AppearanceAPI.prototype.applyToScope(p,n,!t,l)}else{c(2*o.length);for(let e=0;e<o.length;e++)AppearanceAPI.prototype.applyToScope(i,n,!t,l),AppearanceAPI.prototype.applyToScope(o[e],n,!t,l)}},isVisible:function(){return AppearanceAPI.prototype.getRootScope().turnOnFooterMenu}},fullScreenMode:{enable:function(e,t){AppearanceAPI.prototype.fullScreenMode.toggle(!0,e,t)},disable:function(e,t){AppearanceAPI.prototype.fullScreenMode.toggle(!1,e,t)},toggle:function(e,t,n){let a=3;var o=()=>{a--,0==a&&n&&n()},p=postMaster.isLauncherPluginActive(),i=document.getElementById("launcherPlugin");p&&AppearanceAPI.prototype.applyToScope(i,"isInFullScreenMode",!e);var{showNavigationBar:r,disableAutomaticNavigationBar:c,previousState:l}=AppearanceAPI.prototype.getScope(i)||{};e?(l||AppearanceAPI.prototype.applyToScope(i,"previousState",{showNavigationBar:r,disableAutomaticNavigationBar:c}),AppearanceAPI.prototype.titlebar.toggleVisibility(!e,"isInFullScreenMode",o)):p?l?(AppearanceAPI.prototype.applyToScope(i,"previousState",null),AppearanceAPI.prototype.applyToScope(i,"disableAutomaticNavigationBar",l.disableAutomaticNavigationBar,o),1<((new HistoryAPI).historyItems||[]).length&&AppearanceAPI.prototype.applyToScope(i,"showNavigationBar",!0,o)):c?AppearanceAPI.prototype.titlebar[r?"show":"hide"]({},o):AppearanceAPI.prototype.titlebar.reset("isInFullScreenMode",o):o(),AppearanceAPI.prototype.sideMenu.toggleIconVisibility(!e,"isInFullScreenMode",null,o),AppearanceAPI.prototype.navbar.toggleVisibility(!e,"isInFullScreenMode",null,o)}},sideMenu:{show:function(e,t){AppearanceAPI.prototype.sideMenu.toggleIconVisibility(!0,"isMenuIconHidden",e,t)},hide:function(e,t){AppearanceAPI.prototype.sideMenu.toggleIconVisibility(!1,"isMenuIconHidden",e,t)},toggleIconVisibility:function(e,t,n,a){var o,p=document.getElementById("menu-location");postMaster.isLauncherPluginActive()&&(o=document.getElementById("launcherPlugin"),AppearanceAPI.prototype.applyToScope(o,t,!e)),AppearanceAPI.prototype.applyToScope(p,t,!e,a)},open:function(e,t){cpSync.menu.showSideMenu(),t&&t()},close:function(e,t){var n=document.getElementById("sideMenuCloseButton");AppearanceAPI.prototype.applyScopeFunction(n,"closeMenu",t)},getStyles:function(e,a){e={appId:e.appId,pluginId:"sideMenu",instanceId:1,liveMode:e.liveMode,writeKey:e.writeKey};null==this.dataStore&&(this.dataStore=new DatastoreAPI(e)),this.dataStore.get({tag:"",withDynamicData:!0},(e,t)=>{var n;e?a(e):(e=(n=t.data&&t.data._buildfire?t.data._buildfire:{}).sideMenu,(e=(void 0===(e=void 0===(e=e)?{style:void 0}:e).style&&(e.style={alignLeft:!1,showIcon:!0,icon:"icon-menu",transparent:!1,floating:!1}),e)).id=t.id,e.styleUpdate=n.styleUpdate,a(null,e))})},reset:function(e){AppearanceAPI.prototype.sideMenu.getStyles(e,(e,n)=>{var a=n.style;let t;t=postMaster&&postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.history&&postMaster.launcherPluginAPI.history.historyItems?postMaster.launcherPluginAPI.history.historyItems:null;var o=!postMaster.isLauncherPluginActive()&&window.location.href.indexOf("#/pluginContainer")<0,p=!t||!t.length||1==t.length&&"home"==t[0].source,i=document.getElementById("faux-http-section");if(i){let e=AppearanceAPI.prototype.getScope(i);e.showIcon=a.showIcon,e.menuIcon=a.icon,e.isMenuLeftAligned=a.alignLeft,e.menuDisabled=!(!n||!n.content)&&n.content.turnOffSideMenu,e.menuDisabled||(e.menuDisabled=e.authShown&&!e.allowCancel&&!0!==e.showMenuOnAuth),a&&a.headerImage&&(e.headerImage=a.headerImage.replace("/width/21/","/width/78/"));let t=e.showMenuIcon()?"":" ng-hide ";t+=!o&&p?a.alignLeft?" menu menu-left-align ":" menu menu-right-align ":a&&a.alignLeft?" menu menuLeft ":" menu ",a.transparent&&(t+=" translucent "),a.floating&&(a.alignLeft?t+=" floating-left ":t+=" floating-right "),e.menuClass=t,e.$$phase||e.$apply()}})}},ready:function(){var t=document.getElementsByClassName("pluginFrame");if(postMaster.isLauncherPluginActive()){var e=document.getElementById("launcherPlugin");AppearanceAPI.prototype.applyToScope(e,"readyToShow",!0)}else for(let e=0;e<t.length;e++)AppearanceAPI.prototype.applyToScope(t[e],"readyToShow",!0);window.spinner&&window.spinner.hide()}},document.addEventListener("launcherOnReactivated",()=>{var e=document.getElementById("launcherPlugin"),t=AppearanceAPI.prototype.getScope(e),n={};Object.assign(n,t);var{isMenuIconHidden:a,isInFullScreenMode:o,isFooterMenuHidden:e,disableAutomaticNavigationBar:t,showNavigationBar:n}=n;a?AppearanceAPI.prototype.sideMenu.hide():AppearanceAPI.prototype.sideMenu.show(),o?AppearanceAPI.prototype.fullScreenMode.enable():AppearanceAPI.prototype.fullScreenMode.disable(),e?AppearanceAPI.prototype.navbar.hide():AppearanceAPI.prototype.navbar.show(),t&&(n?AppearanceAPI.prototype.titlebar.show():AppearanceAPI.prototype.titlebar.hide())}),document.addEventListener("AUTH_CURRENT_USER_ON_LOGOUT",()=>{resetToDefaults()},!1),document.addEventListener("pluginOnActivated",()=>{AppearanceAPI.prototype.fullScreenMode.disable(),AppearanceAPI.prototype.navbar.show(),AppearanceAPI.prototype.sideMenu.show()});
"use strict";function Track(a,e,i,t,r){this.title=a,this.url=e,this.image=i,this.album=t,this.artist=r,this.startAt=0,this.lastPosition=0}var audioPlayer={_audio:null,_allowPlay:!0,_interval:{time:5e3,id:null},get audio(){return null==this._audio&&("undefined"!=typeof Audio?this._audio=new Audio:this._audio={}),this._audio},_currentTrack:null,settings:{autoPlayNext:!1,loopPlaylist:!1,autoJumpToLastPosition:!1,shufflePlaylist:!1,volume:1},getSettings:function(a,e){e(null,this.settings)},setSettings:function(a){console.log("setSettings called"),a&&(this.audio&&this.settings&&(this.audio.volume=this.settings.volume),angular.extend(this.settings,a),this.save())},resetSettingsToDefault:function(){audioPlayer.settings={autoPlayNext:!1,loopPlaylist:!1,autoJumpToLastPosition:!1,shufflePlaylist:!1,volume:1}},isStream:function(){return!isFinite(audioPlayer.audio.duration)},isAndroid:function(){var a=!1;return a=window.device&&window.device.platform&&"android"===window.device.platform.toLowerCase()?!0:a},retryAllowed:function(){var a=!0;return a=!audioPlayer.isStream()?!1:a},retryAudio:function(){console.warn("retryAudio"),null==audioPlayer._interval.id&&(audioPlayer._interval.id=setInterval(function(){audioPlayer.resumePlay()},audioPlayer._interval.time))},cancelRetry:function(){null!=audioPlayer._interval.id&&(clearInterval(audioPlayer._interval.id),audioPlayer._interval.id=null)},resumePlay:function(){audioPlayer.audio.paused||(console.warn("restart audio",new Date),audioPlayer._allowPlay=!0,audioPlayer.play(audioPlayer._currentTrack))},init:function(){var e=this;try{this.audio&&this.audio.addEventListener&&this.audio.addEventListener("ended",function(){e.triggerOnEvent("audioEnded",e._currentTrack),e.settings.autoPlayNext&&e.next()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("stalled",function(){console.warn("audio stalled",new Date),audioPlayer.retryAllowed()&&audioPlayer.retryAudio()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("error",function(){console.warn("audio error",new Date),audioPlayer.retryAllowed()&&audioPlayer.retryAudio()}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("playing",function(){console.warn("playing",new Date),audioPlayer.cancelRetry()})}catch(a){console.warn("error",a)}var a=0;this.audio&&this.audio.addEventListener&&this.audio.addEventListener("timeupdate",function(){e._currentTrack&&(e._currentTrack.lastPosition=e.audio.currentTime),5<Math.abs(a-e.audio.currentTime)&&(e.save(),a=e.audio.currentTime),e.triggerOnEvent("timeUpdate",{currentTime:e.audio.currentTime,duration:e.audio.duration,buffer:{start:e.audio.buffered.length?e.audio.buffered.start(0):0,end:e.audio.buffered.length?e.audio.buffered.end(0):0}})}),this.audio&&this.audio.addEventListener&&this.audio.addEventListener("error",function(a){e.triggerOnEvent("error",a)});var i=window.appContext;if(null!=i&&void 0!==i&&void 0!==i.currentApp&&void 0!==i.currentApp.appId){i=window.localStorage.getItem("audioPlayer");if("{}"!=i)try{var t=JSON.parse(i);e.settings=t.settings,e.playlist=t.playlist,e._currentTrack=t._currentTrack,e.audio.volume=e.settings.volume}catch(a){console.warn("audioPlayer localStorage error",a)}}else console.warn("no app found for audioPlayer")},getCurrentTrack:function(a,e){return e&&e(this._currentTrack),this._currentTrack},onEvent:function(e){function a(a){e&&e(a.detail)}return document.addEventListener("audioPlayer.onEvent",a,!1),{clear:function(){document.removeEventListener("audioPlayer.onEvent",a,!1)}}},triggerOnEvent:function(a,e){a=new CustomEvent("audioPlayer.onEvent",{detail:{event:a,data:e}});document.dispatchEvent(a)},_tmrSave:null,save:function(){this._tmrSave&&clearTimeout(this._tmrSave),this._tmrSave=setTimeout(function(){try{var e={settings:audioPlayer.settings,playlist:audioPlayer.playlist,_currentTrack:audioPlayer._currentTrack};window.localStorage.setItem("audioPlayer",JSON.stringify(e))}catch(a){e=a.message||"";console.error("Error with JSON.stringify. ",e)}},500)},play:function(a){if((!audioPlayer._currentTrack||a&&audioPlayer._currentTrack.url!=a.url)&&(audioPlayer._allowPlay=!0),audioPlayer._allowPlay){var e=typeof a;if("string"==e)a={url:a};else if("number"==e){e=this.playlist.tracks[a];if(!e)return;this.playlist.lastIndex=a,a=e,this.save()}else if(!a)return void(this.audio.paused&&(this.audio.play(),this.triggerOnEvent("resume",{track:this._currentTrack})));this.audio.src=a.url,this.audio.preload="auto",this._currentTrack=a,console.warn("this.audio.play()",new Date),this.audio.play(),this.triggerOnEvent("play",{track:a}),this.settings&&this.settings.autoJumpToLastPosition&&a.lastPosition&&this.skip(a.lastPosition),a.startAt&&this.skip(a.startAt),audioPlayer._allowPlay=!1,!audioPlayer.isBackgroundModeEnabled&&"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.backgroundMode&&(audioPlayer.isBackgroundModeEnabled=!0,cordova.plugins.backgroundMode.enable&&cordova.plugins.backgroundMode.enable(),cordova.plugins.backgroundMode.on("activate",function(){cordova.plugins.backgroundMode.disableWebViewOptimizations()}))}},skip:function(a){this.audio&&(this.audio.currentTime+a<0?this.audio.currentTime=0:this.audio.currentTime+a>this.audio.duration?this.audio.currentTime=this.audio.duration:this.audio.currentTime+=a,this.triggerOnEvent("skip",a))},pause:function(){audioPlayer.audio.pause(),audioPlayer._allowPlay=!0,audioPlayer.triggerOnEvent("pause")},isPaused:function(a,e){e&&e(null,audioPlayer.audio.paused)},loopTrack:function(a){audioPlayer.audio&&(audioPlayer.audio.loop=a)},next:function(){var a;if(audioPlayer.settings.shufflePlaylist?audioPlayer.playlist.lastIndex=Math.round((audioPlayer.playlist.tracks.length-1)*Math.random()):audioPlayer.playlist.lastIndex++,audioPlayer.playlist.lastIndex>=audioPlayer.playlist.tracks.length){if(!audioPlayer.settings.loopPlaylist||!audioPlayer.playlist.tracks.length)return audioPlayer.playlist.lastIndex=audioPlayer.playlist.tracks.length-1,null;audioPlayer.playlist.lastIndex=0}return a=audioPlayer.playlist.tracks[audioPlayer.playlist.lastIndex],audioPlayer.save(),audioPlayer.triggerOnEvent("next",{index:audioPlayer.playlist.lastIndex,track:a}),a&&audioPlayer.play(a),a},previous:function(){var a;if(audioPlayer.settings.shufflePlaylist?audioPlayer.playlist.lastIndex=Math.round((audioPlayer.playlist.tracks.length-1)*Math.random()):audioPlayer.playlist.lastIndex--,audioPlayer.playlist.lastIndex<0){if(!audioPlayer.settings.loopPlaylist||!audioPlayer.playlist.tracks.length)return audioPlayer.playlist.lastIndex=0,null;audioPlayer.playlist.lastIndex=audioPlayer.playlist.tracks.length-1}return a=audioPlayer.playlist.tracks[audioPlayer.playlist.lastIndex],audioPlayer.save(),audioPlayer.triggerOnEvent("previous",{index:audioPlayer.playlist.lastIndex,track:a}),a&&audioPlayer.play(a),a},removeFromPlaylist:function(a){var e;a<0||a>=audioPlayer.playlist.tracks.length||(e=audioPlayer.playlist.tracks.splice(a,1),a==audioPlayer.playlist.lastIndex?audioPlayer.playlist.lastIndex=-1:a<audioPlayer.playlist.lastIndex&&audioPlayer.playlist.lastIndex--,audioPlayer.triggerOnEvent("removeFromPlaylist",{index:a,track:e,newPlaylist:audioPlayer.playlist}))},addToPlaylist:function(a){audioPlayer.playlist.tracks.push(a),audioPlayer.save(),audioPlayer.triggerOnEvent("addToPlaylist",{track:a,newPlaylist:audioPlayer.playlist})},setTime:function(a){audioPlayer.audio.currentTime=a,audioPlayer._currentTrack.lastPosition=audioPlayer.audio.currentTime,audioPlayer.save(),audioPlayer.triggerOnEvent("timeUpdate",{currentTime:audioPlayer.audio.currentTime,duration:audioPlayer.audio.duration,buffer:{start:audioPlayer.audio.buffered.length?audioPlayer.audio.buffered.start(0):0,end:audioPlayer.audio.buffered.length?audioPlayer.audio.buffered.end(0):0}})},setVolume:function(a){a<0?a=0:1<a&&a<=100&&(a/=100),audioPlayer.settings&&(audioPlayer.settings.volume=a),audioPlayer.audio&&(audioPlayer.audio.volume=a),audioPlayer.triggerOnEvent("volumeChange",{volume:a}),audioPlayer.save()},playlist:{tracks:[],lastIndex:-1},getPlaylist:function(a,e){e(null,audioPlayer.playlist)}};"undefined"==typeof PluginAPI||PluginAPI.prototype.mediaAPI||(PluginAPI.prototype.mediaAPI={audioPlayer:window.audioPlayer}),audioPlayer.init();
"use strict";function NotificationsAPI(t){this.context=t,this.dialogApi=null}NotificationsAPI.prototype={initDialog:function(){this.dialogApi||(this.dialogApi=new DialogAPI(this.context))},alert:function(t,n){if(this.initDialog(),(t=t||{}).message)return t.okButton||(t.okButton={text:"OK"}),t.okButton.text||(t.okButton.text="OK"),this.dialogApi.alert({title:t.title,message:t.message,okButtonText:t.okButton.text},(t,i)=>{if(n)return window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.confirm?t?n(t):n(1,void 0):n(i)});n("invalid parameter, messing message")},confirm:function(t,n){if(this.initDialog(),(t=t||{}).message)return t.confirmButton||(t.confirmButton={text:"Confirm"}),t.confirmButton.text||(t.confirmButton.text="Confirm"),t.cancelButton||(t.cancelButton={text:"Cancel"}),t.cancelButton.text||(t.cancelButton.text="Cancel"),t.buttonLabels=[t.confirmButton.text,t.cancelButton.text],this.dialogApi.confirm({title:t.title,message:t.message,confirmButtonText:t.confirmButton.text,cancelButtonText:t.cancelButton.text},(t,i)=>{if(n)return window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.confirm?n(i?1:2,void 0):n(i)});n("invalid parameter, missing message",null)},prompt:function(t,i){window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.prompt?navigator.notification.prompt(t.message,i,t.title,t.buttonLabels,t.defaultText):(t=prompt(t.message),i&&i(t))},beep:function(t,i){console.log("calling NotificationsAPI.beep ..."),window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&navigator.notification&&navigator.notification.beep&&navigator.notification.beep(t.times),i&&i()},vibrate:function(t,i){console.log("calling NotificationsAPI.vibrate ..."),window.device&&"web"!=window.device.platform&&"undefined"!=typeof navigator&&("function"==typeof navigator.vibrate?navigator.vibrate(t.milliseconds):navigator.notification&&"function"==typeof navigator.notification.vibrate&&navigator.notification.vibrate(t.milliseconds)),i&&i()}};
"use strict";function appAPI(t){this.appId=t.appId,this.liveMode=t.liveMode,this.appHost=t.endPoints.appHost,"undefined"==typeof CustomEvent&&console.warn("Browser doesnt support CustomEvent")}appAPI.prototype={getPluginInstances:function(t,n){var e=new DatastoreAPI(this.appId,"pluginInstances",1,this.liveMode,null);(t=t||{}).pageSize||(t.pageSize=50),t.pageIndex||(t.pageIndex=1);t={obj:{filter:{"$json.title":{$regex:null!=t.title?t.title:""}},page:t.pageIndex-1,pageSize:t.pageSize,withDynamicData:!0,recordCount:!0},tag:""};e.search(t,function(t,e){t||n(null,{data:e.result,totals:e.totalRecord})})},getPluginInstancesByIds(e,a){let s=0,i=[],o=new DatastoreAPI(this.appId,"pluginInstances",1,this.liveMode,null);!function n(){let t={obj:{filter:{"$json.instanceId":{$in:e||[]}},page:s,pageSize:50,withDynamicData:!0,recordCount:!0},tag:""};o.search(t,function(t,e){!t&&e&&e.result&&(i=i.concat(e.result)),e&&e.result&&50<=e.result.length?(s++,n()):a(null,{data:i,totals:i.length})})}()}};
"use strict";"undefined"==typeof ActionItemsAPI&&(window.ActionItemsAPI=function(e){this.templateUrl="pages/share/actionBuilder.html",this.listTemplateUrl=window._appRoot+"pages/templates/actionItemsListDialog.html",this.controller="actionItemsCtrl",this.context=e,this.init()}),ActionItemsAPI.prototype.init=function(){},ActionItemsAPI.prototype.list=function(e,t){e={templateUrl:this.listTemplateUrl,controller:"actionItemsListDialogCtrl",size:"lg",data:e};window.openDialog(e,function(e){t&&t(null,e)})},ActionItemsAPI.prototype.openWebLink=function(n,o,i){if(n){var a="_blank"===o;let e=window.open(n,o,"location=no"),t;a&&(t=setTimeout(()=>{ActionItemsAPI.prototype.openWebLink(n,"_system",i),e&&e.close()},1e3)),e&&e.addEventListener("loadstart",()=>{t&&clearTimeout(t)}),i&&i(e?null:"failed to open window"),e||ActionItemsAPI.prototype.popUpCtrlScope.show(n)}},ActionItemsAPI.prototype.sendEmail=function(e,t,n){window.open("mailto:"+(null!=e&&""!=e?e:"")+"?"+(null!=t&&""!=t?"subject="+t:"")+"&"+(null!=n&&""!=n?"body="+n:""),"_system")},ActionItemsAPI.prototype.navigateToAddress=function(e,t){var n;e&&t&&(n="https://maps.google.com/?q=",window.device&&null!=window.device.platform&&("android"==window.device.platform.toLowerCase()?n="geo:?q=":"ios"==window.device.platform.toLowerCase()&&(n="maps://maps.apple.com?q=")),window.open(n+e+","+t,"_system","location=no,menubar=no,titlebar=no,toolbar=no"))},ActionItemsAPI.prototype.callNumber=function(e){e&&(e=e.replace(/ /,""),window.open("tel:"+e,"_system","location=no,menubar=no,titlebar=no,toolbar=no"))},ActionItemsAPI.prototype.sendSms=function(e){e&&(e=e.replace(/ /,""),-1!=navigator.platform.indexOf("Android")||-1!=navigator.platform.indexOf("Linux")||null==navigator.platform||-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPad")?(e="sms:"+e,window.open(e,"_system")):console.error("This action can't be used on browser , it should be used on actual device"))},ActionItemsAPI.prototype.chat=function(p,c){const e=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),l=window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI,t={obj:{filter:{"$json.token":"b15c62f2-7a99-48dc-a37a-e42d46bd3289"},pageSize:1,page:0,sort:{createdOn:-1},withDynamicData:!0}};e.search(t,function(e,t){if(t&&t.length){const o=t[0].data.instanceId,i=t[0].data._buildfire.pluginType.result[0].token,a=t[0].data._buildfire.pluginType.result[0].folderName,s=t[0].data.title;let n=authAPI.getCurrentUser();const r=()=>{var e="wid="+encodeURIComponent(p+":"+n._id)+"&userIds="+encodeURIComponent(c.join(","));l?l.navigation.navigateTo({pluginId:i,instanceId:o,title:s,folderName:a,pushToHistory:!0,queryString:e},null):console.warn("Plugin API is empty")};n?r():authAPI.login(null,(e,t)=>{t&&(n=t,r())})}})},ActionItemsAPI.prototype.linkToAppContent=function(e,s){var t=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),n={};n.obj={filter:{"$json.instanceId":e},pageSize:1,withDynamicData:!0},t.search(n,function(e,t){var n,o,i,a;t&&t.length&&(n=t[0].data.instanceId,o=t[0].data._buildfire.pluginType.result[0].token,i=t[0].data._buildfire.pluginType.result[0].folderName,a=t[0].data.title,(t=window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI)?t.navigation.navigateTo({pluginId:o,instanceId:n,title:a,folderName:i,pushToHistory:!0,queryString:s?s.queryString:null},null):console.warn("Plugin API is empty"))})},ActionItemsAPI.prototype.navigateToPage=function(e,n){if(n=n||{},e)if("login"!=e)if("appSearch"!=e||"enterprise"==window.appContext.currentApp.config.type){if(n.queryString){let t=encodeURIComponent;e=e+"?"+Object.keys(n.queryString).map(e=>t(e)+"="+t(n.queryString[e])).join("&")}window.location.hash=e}else console.info("Action Items","Search page only available for Enterprise Plan");else window.authAPI&&window.authAPI.login&&window.authAPI.login();else console.error("Action Items","navigateToPage","Please specify Page Name!")},ActionItemsAPI.prototype.purchase=function(n,o,i,a,s,r){var p;bfUtils.isMobileDevice&&("undefined"!=typeof inAppPurchaseAPI?(p=function(e,t){var n;e?(n={data:{title:" ",body:a,disableCancel:!0}},window.openDialog(n,function(){})):t&&t.isApproved&&(bfUtils.isIOS||(n={data:{title:" ",body:i,disableCancel:!0}},window.openDialog(n,function(){}),s&&ActionItemsAPI.prototype.linkToAppContent(s))),r(e,t)},inAppPurchaseAPI.checkAccess(o,function(e,t){e&&console.error("error while checking product",e),t&&t.owned?(s&&ActionItemsAPI.prototype.linkToAppContent(s),r(null,{product:t,isApproved:!0})):(t=o.productId,"subscriptions"===o.purchaseType&&o.subscription&&(t=o.subscription.subscriptionId||o.subscription.id),inAppPurchaseAPI.purchase({productId:t,purchaseType:n},p))})):console.error("inAppPurchaseAPI is undefined"))},ActionItemsAPI.prototype.execute=function(t,n){var o=!1;switch(t.action){case"linkToApp":this.linkToAppContent(t.instanceId,{queryString:t.queryString});break;case"linkToWeb":o=!0,this.openWebLink(t.url,t.openIn,n);break;case"sendEmail":this.sendEmail(t.email,t.subject,t.body);break;case"callNumber":this.callNumber(t.phoneNumber);break;case"sendSms":this.sendSms(t.phoneNumber);break;case"chat":this.chat(t.chatId,t.userIds);break;case"navigateToAddress":this.navigateToAddress(t.lat,t.lng);break;case"navigateToAppSettings":this.navigateToPage("appSettings");break;case"navigateToNotifications":this.navigateToPage("pushGroups");break;case"navigateToBookmarks":this.navigateToPage("bookmarks");break;case"navigateToSearch":let e={};t.searchAppValue&&(e.queryString={searchTerm:t.searchAppValue}),this.navigateToPage("appSearch",e);break;case"navigateToLogin":this.navigateToPage("login");break;case"navigateToNotes":window.notesAPI.openDialog();break;case"linkToSocialGoogle":case"linkToSocialFacebook":case"linkToSocialInstagram":case"linkToSocialTwitter":case"linkToSocialLinkedIn":this.openWebLink(t.url,"_system");break;case"purchase":var o=!0,i={productId:t.productId,subscriptions:t.subscriptions,subscription:t.subscription,purchaseType:t.purchaseType};this.purchase(t.purchaseType,i,t.successMessage,t.errorMessage,t.instanceId,n)}o||n(null,!0)},"undefined"!=typeof $app&&$app.controller("actionItemsListDialogCtrl",["$scope","$data","$dialog",function(e,t,o){e.actionItems=t.actionItems,e.executeItem=!0,e.close=function(){o.close(null)},t.options&&t.options.executeItem&&(e.executeItem=t.options.executeItem),e.openActionItem=function(n){e.executeItem?(window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI).actionItems.execute(n,function(e,t){o.close(n)}):o.close(n)}}]);
"use strict";function PluginInstanceAPI(t){this.templateUrl="pages/plugins/pluginInstanceDialog/pluginInstanceDialog.html",this.controller="pluginInstanceDialog",this.appId=t.appId,this.liveMode=t.liveMode,this.appHost=window.siteConfig.endPoints.appHost;t=JSON.parse(JSON.stringify(t));t.pluginId="pluginInstances",t.instanceId=1,this.ds=new DatastoreAPI(t)}PluginInstanceAPI.prototype={showDialog:function(t,n){window.openDialog?(t={templateUrl:this.templateUrl,controller:this.controller,size:"lg",data:t},window.openDialog(t,function(t){n&&n(null,t)})):console.error("openDialog isnt defined")},get:function(t,i){var n={};n.obj={filter:{"$json.instanceId":t},pageSize:1,withDynamicData:!0},this.ds.search(n,function(t,n){t?i(t,null):n&&n.length?i(null,n[0].data):i(null)})},_createReadUrl:function(){return this.appHost+"/api/appPluginInstances/getByIds/"+this.appId},_httpGet:function(t,n,i){bfUtils.http.get(t,{params:n}).success(function(t){i(null,t)}).error(function(t){i(t)})},search:function(t,n){var i;(t.title||t.instanceIds)&&(i={}),t.title&&(i["$json.title"]={$regex:t.title,$options:"-i"}),t.instanceIds&&(i["$json.instanceId"]={$in:t.instanceIds});t={obj:{filter:i,page:t.pageIndex,pageSize:t.pageSize,withDynamicData:!0,recordCount:!0},tag:""};this.ds.search(t,n)}};
"use strict";var deviceAPI={calendar:{addEvent:function(a,i){permissionRequestsAPI.queueRequest("calendar",this,()=>{var e;if(!(e=window.plugins&&window.plugins.calendar?window.plugins.calendar:e))return console.warn("cannot complete action add event to calendar. so fake it"),void(0<=window.location.protocol.indexOf("http")?alert("Adding to calendar requires native app."):console.error("Calendar feature not installed"));a.startDate instanceof Date||(a.startDate=new Date(a.startDate)),a.endDate instanceof Date||(a.endDate=new Date(a.endDate));function n(e){i(null,e)}function t(e){i(e)}var o;a.options?((o=e.getCalendarOptions()).firstReminderMinutes=a.options.firstReminderMinutes||o.firstReminderMinutes,o.secondReminderMinutes=a.options.secondReminderMinutes||o.secondReminderMinutes,o.recurrence=a.options.recurrence||o.recurrence,a.options.recurrenceEndDate&&(o.recurrenceEndDate=new Date(a.options.recurrenceEndDate)),e.createEventWithOptions(a.title,a.location,a.notes,a.startDate,a.endDate,o,n,t)):e.createEvent(a.title,a.location,a.notes,a.startDate,a.endDate,n,t)})}},share:function(e,n){window.plugins&&window.plugins.socialsharing?window.plugins.socialsharing.share(e.text,e.subject,e.image,e.link):(console.warn("device sharing plugin not found. defaulting to email sending"),window.location="mailto:?subject="+encodeURIComponent(e.subject)+"&body="+encodeURIComponent(e.text+" "+e.link)),n(null,!0)},onAppBackgrounded:function(e){document.addEventListener("deviceAppBackgrounded",e,!1)},onAppResumed:function(e){document.addEventListener("deviceAppResumed",e,!1)},getAppSchema:function(){let e=null;return window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&(e="app"+window.appContext.currentApp.appId.slice(0,6)),e},contacts:{search:function(e,n){permissionRequestsAPI.queueRequest("contacts",this,()=>{this._search(e,n)})},_search:function(n,t){let o=new ComponentUIAPI,a=[],i={};if(navigator.contacts&&navigator.contacts.find){let e=new ContactFindOptions;e.desiredFields=[navigator.contacts.fieldType.displayName,navigator.contacts.fieldType.name,navigator.contacts.fieldType.nickname,navigator.contacts.fieldType.photos,navigator.contacts.fieldType.emails,navigator.contacts.fieldType.phoneNumbers],e.filter="",e.multiple=!0,navigator.contacts.find([""],function(e){e.forEach(e=>{i.text=e.displayName||e.name.formatted||e.nickname||"".concat(e.name.givenName||""," ").concat(e.name.familyName||""),i.imageUrl=e.photos&&0<e.photos.length?e.photos[0].value:window._appRoot+"media/avatar.png",i.secondaryText="",i.name=i.text,i.emails=e.emails||[],i.photos=e.photos||[],i.phoneNumbers=e.phoneNumbers||[],e.phoneNumbers&&e.phoneNumbers.forEach(e=>{i.secondaryText+="<div>".concat(e.value,"</div>")}),e.emails&&e.emails.forEach(e=>{i.secondaryText+="<div>".concat(e.value,"</div>")}),i.text&&(a.push(i),i={})});o.openDrawer({header:n.header||" ",content:n.content||"",listItems:a,multiSelection:!0,multiSelectionActionButton:{text:n.drawerButtonText||"Import",type:n.drawerButtonType||"success"},enableFilter:!0},(e,n)=>{n&&n.forEach(e=>{delete e.text,delete e.secondaryText,delete e.imageUrl}),t(e,n)})},function(e){t(e,null)},e)}else t("Contacts plugin is not integrated or not working properly",null)},showDialog:function(e,n){permissionRequestsAPI.queueRequest("contacts",this,()=>{this._showDialog(e,n)})},_showDialog:function(e,t){navigator.contacts&&navigator.contacts.pickContact?navigator.contacts.pickContact(function(e){let n={};n.name=e.displayName||e.name.formatted||e.nickname||"".concat(e.name.givenName||""," ").concat(e.name.familyName||""),n.emails=e.emails||[],n.photos=e.photos||[],n.phoneNumbers=e.phoneNumbers||[],t(null,n)},function(e){t(e,null)}):t("Contacts plugin is not integrated or not working properly",null)}}};document.addEventListener("deviceready",function(){window.open=(e,n,t)=>{var o="_blank"===n;let a=cordova.InAppBrowser.open(e,n,t);t=a&&a.channels&&a.channels.close;return o&&t&&(function(){const e=document.getElementById("webviewBackdrop");e&&e.classList.remove("hide")}(),a&&a.addEventListener("close",()=>{i()}),a&&a.addEventListener("exit",()=>{i()})),a;function i(){const e=document.getElementById("webviewBackdrop");e&&!e.classList.contains("hide")&&(e.classList.add("closing"),setTimeout(()=>{e.classList.replace("closing","hide")},250))}}});
"use strict";function HistoryAPI(t,s,e,i){var n;"object"==typeof t?(this.appId=(n=t).appId,this.pluginId=n.pluginId,this.instanceId=n.instanceId,this.liveMode=n.liveMode):(this.appId=t,this.pluginId=s,this.instanceId=e,this.liveMode=i)}HistoryAPI.prototype={historyItems:[],push:function(t,s){if("undefined"==typeof emulatorSync){if("plugin"!=t.source){var e=-1;if(1<this.historyItems.length){for(var i=1;i<this.historyItems.length;i++)if("plugin"==this.historyItems[i].source&&"control"==this.historyItems[i-1].source){e=i;break}0<=e&&this.historyItems.splice(e)}}t.uid=(new Date).getTime();var n=this["instanceId"];t.options=t.options||{},t.options.pluginData=t.options.pluginData||{instanceId:n};const h=this.historyItems.map(({options:t})=>(t.pluginData||{}).instanceId);var o=h.lastIndexOf(n),n=o===h.length-1;-1<o&&!n?this.historyItems.splice(o+1,0,t):this.historyItems.push(t);o=new CustomEvent("historyOnPush",{detail:{pushedItem:t}});document.dispatchEvent(o);o=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});document.dispatchEvent(o)}else{t=new Packet(null,"history.pushAppHistory",t);emulatorSync.sendMessage(t)}return s&&s(null,!0),this},get:function(s,e){var i=t=>"plugin"==t.source&&t.options&&t.options.pluginData&&t.options.pluginData.instanceId==this.instanceId;if(s&&s.pluginBreadcrumbsOnly){var n=[];let t=0;postMaster.launcherPluginAPI&&this!=postMaster.launcherPluginAPI.history&&(s=this.historyItems.findIndex(t=>"control"==t.source),t=-1==s?this.historyItems.length:s);for(var o=t;o<this.historyItems.length;o++)i(this.historyItems[o])&&n.push(this.historyItems[o]);e(null,n)}else e(null,this.historyItems);return this},getNext:function(t){var s=null;if(this.historyItems)for(var e=0;e<this.historyItems.length;e++)if(this.historyItems[e]==t||this.historyItems[e].uid==t.uid){e<this.historyItems.length&&(s=this.historyItems[e+1]);break}return s},pop:function(t,s){if("undefined"==typeof emulatorSync){if(!t&&this.historyItems&&(1<this.historyItems.length?(o=this.historyItems[this.historyItems.length-1])&&"plugin"==o.source&&(t=this.historyItems[this.historyItems.length-2]):this.historyItems[0]&&"plugin"==this.historyItems[0].source&&(t=this.historyItems[0])),t){for(var e=-1,i=!1,n=0;n<this.historyItems.length;n++)if(this.historyItems[n]==t||this.historyItems[n].uid==t.uid){(e=n)+1<this.historyItems.length&&"plugin"==this.historyItems[n+1].source&&(i=!0);break}0<=e&&e<=this.historyItems.length&&this.historyItems.splice(e+1);var o=new CustomEvent("historyOnPop",{detail:{poppedItem:t}});document.dispatchEvent(o);o=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});document.dispatchEvent(o),(i||"plugin"==t.source)&&postMaster&&(h=new Packet(null,"history.triggerOnPop",t),postMaster.widgetPluginAPI?postMaster.widgetPluginAPI.sendMessage(null,h):postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.sendMessage(null,h))}else if(s)return s("breadcrumb not found"),this}else{var h=new Packet(null,"history.popAppHistory",t);emulatorSync.sendMessage(h)}return s&&s(null,!0),this},popToHome:function(){if(this.historyItems&&1<this.historyItems.length)for(var t=1;t<this.historyItems.length;t++)"control"==this.historyItems[t].source&&this.pop(this.historyItems[t-1])},popToPlugin:function(){if(this.historyItems&&1<this.historyItems.length)for(var t=this.historyItems.length-1;1<t&&"plugin"==this.historyItems[t].source;t--)this.pop(this.historyItems[t-1])},clear:function(t,s){var e=this.historyItems[0];this.historyItems.splice(0),s&&s(null);s=new CustomEvent("historyOnUpdate",{detail:{historyItems:this.historyItems}});return document.dispatchEvent(s),e&&(e=new CustomEvent("historyOnPop",{detail:{poppedItem:e}}),document.dispatchEvent(e)),this},triggerOnPop:function(t){t=new CustomEvent("historyOnPop",{detail:{poppedItem:t}});return document.dispatchEvent(t),this},triggerOnUpdate:function(t){this.historyItems=t;t=new CustomEvent("historyOnUpdate",{detail:{historyItems:t}});return document.dispatchEvent(t),this},onUpdate:function(s){function t(t){s&&s({historyItems:t.detail.historyItems})}return document.addEventListener("historyOnUpdate",t,!1),{clear:function(){document.removeEventListener("historyOnUpdate",t,!1)}}},onPop:function(s){function t(t){s&&s(t.detail)}return document.addEventListener("historyOnPop",t,!1),{clear:function(){document.removeEventListener("historyOnPop",t,!1)}}},onPush:function(s){function t(t){s&&s({historyItems:t.detail.historyItems,pushedItem:t.detail.pushedItem})}return document.addEventListener("historyOnPush",t,!1),{clear:function(){document.removeEventListener("historyOnPush",t,!1)}}},clearLauncherBreadcrumbs:function(){let e=[];for(let t=0,s=!1;t<this.historyItems.length;t++){var i=this.historyItems[t];if(s){if("control"==i.source){s=!1;break}}else e.push(i);"home"==i.source&&(s=!0)}this.historyItems=e;var t=new CustomEvent("historyOnUpdate",{detail:{historyItems:e}});return document.dispatchEvent(t),this}};
"use strict";function Packet(e,t,n,i){this.id=e,this.cmd=t,this.data=n,this.error=i,this.instanceId}var logger,pluginCount=0;function PluginAPI(e,t,n,i,o,a,s,r){pluginCount++,this.datastore=this.analytics=this.appearance=null,this.iFrameId=e,this.iFrame=document.getElementById(e),this.init(t,n,i,o,a,s,r)}void 0===logger&&(logger={log:function(){}}),PluginAPI._defaultAppTheme={colors:{backgroundColor:"#ffffff",bodyText:"#858585",dangerTheme:"#f24965",defaultTheme:"#07a05e",footerMenuBackgroundColor:"#ffffff",footerMenuIconColor:"#45cae6",headerText:"#000000",icons:"#45cae6",infoTheme:"#66d6ed",primaryTheme:"#45cae6",successTheme:"#0ac775",titleBar:"#0ac775",titleBarTextAndIcons:"#ffffff",warningTheme:"#ffcf40"},fontId:"Lato",fontName:"Lato"},PluginAPI.appTheme={isDefault:!0,appName:"",colors:PluginAPI._defaultAppTheme.colors,fontId:PluginAPI._defaultAppTheme.fontId,fontName:PluginAPI._defaultAppTheme.fontName,updateTheme:function(e){this.appName=e.appName||this.appName,this.colors=e.colors||PluginAPI._defaultAppTheme.colors,this.fontId=e.fontId||PluginAPI._defaultAppTheme.fontId,this.fontName=e.fontName||PluginAPI._defaultAppTheme.fontName,this.fontUrl=e.fontUrl||null,this.fontFormat=e.fontFormat||null,this.fontFileName=e.fontFileName||null,this.isCustomFont=e.isCustomFont||!1,this.fontFolderPath=e.fontFolderPath||null,this.fontLastUpdatedOn=e.fontLastUpdatedOn||null,delete this.isDefault}},PluginAPI.prototype={getContentWindow:function(){return this.iFrame=document.getElementById(this.iFrameId),this.iFrame?this.iFrame.contentWindow:null},debugTag:null,init:function(e,t,n,i,o,a,s){if(window.appContext&&window.appContext.currentApp){var r=window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&window.appContext.currentApp.config.cpDomain?window.appContext.currentApp.config.cpDomain:window.siteConfig.endPoints.appHost;this.context={appId:e,pluginId:t,instanceId:n,liveMode:i||0,endPoints:window.siteConfig.endPoints,cpDomain:r,device:window.device,deviceId:"undefined"!=typeof push?push.deviceId:null,debugTag:this.debugTag,datastoreWriteKey:o||void 0,type:a,appTheme:PluginAPI.appTheme,configType:PluginAPI.configType,title:s};a=localStorage.getItem("currentAppManifest");if(a){s=null;try{s=JSON.parse(a)}catch(e){console.error("bad currentAppManifest",e)}this.context.offlineModeEnabled=s.offlineModeEnabled}this.context.device||(this.context.device={platform:"web"}),"undefined"!=typeof AppearanceAPI&&(this.appearance=new AppearanceAPI(this.context)),"undefined"!=typeof DatastoreAPI&&(this.datastore=new DatastoreAPI(this.context)),"undefined"!=typeof UserDatastoreAPI&&(this.userData=new UserDatastoreAPI(this.context)),"undefined"!=typeof AnalyticsAPI&&(this.analytics=new AnalyticsAPI(this.context)),"undefined"!=typeof ImageLibAPI&&(this.imageLib=new ImageLibAPI(this.context)),"undefined"!=typeof ColorLibAPI&&(this.colorLib=new ColorLibAPI(this.context),this.colorLib.onChange(function(e){p.sendMessage(null,new Packet(null,"colorLib._triggerOnChange",e))})),"undefined"!=typeof appAPI&&(this.appAPI=new appAPI(this.context)),"undefined"!=typeof ActionItemsAPI&&(this.actionItems=new ActionItemsAPI(this.context)),"undefined"!=typeof NotificationsAPI&&(this.notificationsAPI=new NotificationsAPI(this.context)),"undefined"!=typeof PopupLibAPI&&(this.notificationsAPI=PopupLibAPI),"undefined"!=typeof DialogAPI&&(this.dialogAPI=new DialogAPI(this.context)),"undefined"!=typeof HistoryAPI&&(this.history=new HistoryAPI(this.context)),"undefined"!=typeof PluginInstanceAPI&&(this.pluginInstances=new PluginInstanceAPI(this.context)),"undefined"!=typeof inAppPurchaseAPI&&(this.inAppPurchase=inAppPurchaseAPI),"undefined"!=typeof barcodeScannerAPI&&(this.barcodeScanner=barcodeScannerAPI),"undefined"!=typeof UsersLibAPI&&(this.usersLib=new UsersLibAPI(this.context)),"undefined"!=typeof PublicDatastoreAPI&&(this.publicData=new PublicDatastoreAPI(this.context)),"undefined"!=typeof AppDatastoreAPI&&(this.appData=new AppDatastoreAPI(this.context)),"undefined"!=typeof LocalStorageAPI&&(this.localStorage=new LocalStorageAPI(this.context)),"undefined"!=typeof LocalNotificationsAPI&&(this.localNotifications=new LocalNotificationsAPI(this.context)),"undefined"!=typeof deviceAPI&&(this.device=deviceAPI,this.device.onAppBackgrounded(function(e){p.sendMessage(null,new Packet(null,"device.triggerOnAppBackgrounded",e.detail))}),this.device.onAppResumed(function(e){p.sendMessage(null,new Packet(null,"device.triggerOnAppResumed",e.detail))})),"undefined"!=typeof geoAPI&&(this.geo=geoAPI),"undefined"!=typeof inputAPI&&(this.input=inputAPI),"undefined"!=typeof notesAPI&&(this.notes=notesAPI),"undefined"!=typeof bookmarkAPI&&(this.bookmarkAPI=bookmarkAPI),"undefined"!=typeof deepLinkAPI&&(this.deepLink=deepLinkAPI),"undefined"!=typeof imagePreviewerAPI&&(this.imagePreviewer=imagePreviewerAPI),"undefined"!=typeof bluetoothAPI&&(this.bluetooth=bluetoothAPI),"undefined"!=typeof BleCentralAPI&&(this.bleCentral=new BleCentralAPI),"undefined"!=typeof iBeaconAPI&&(this.iBeacon=iBeaconAPI),"undefined"!=typeof CameraAPI&&(this.camera=new CameraAPI(this.context)),"undefined"!=typeof fileManagerAPI&&(this.fileManager=fileManagerAPI,this.fileManager.onProgress(function(e){p.sendMessage(null,new Packet(null,"services.fileSystem.fileManager._triggerOnProgress",{percentage:e}))})),"undefined"!=typeof imageCacheAPI&&(this.imageCache=imageCacheAPI),"undefined"!=typeof PushNotificationsAPI&&(this.pushNotifications=new PushNotificationsAPI(this.context)),"undefined"!=typeof FirebaseAPI&&(this.firebase=new FirebaseAPI(this.context)),"undefined"!=typeof ComponentUIAPI&&(this.componentUI=new ComponentUIAPI(this.context)),"undefined"!=typeof HealthAPI&&(this.health=new HealthAPI(this.context)),"undefined"!=typeof authAPI&&(this.auth=authAPI,this.auth.init(this.context),(p=this).auth.onLogin(function(e){p.sendMessage(null,new Packet(null,"auth.triggerOnLogin",e.detail))}),this.auth.onLogout(function(){p.sendMessage(null,new Packet(null,"auth.triggerOnLogout"))}),this.auth.onUpdate(function(e){p.sendMessage(null,new Packet(null,"auth.triggerOnUpdate",e.detail))})),"undefined"!=typeof richModal&&(this.popup=richModal);var p=this;this.mediaAPI=new Object,"undefined"!=typeof audioPlayer&&(this.mediaAPI.audioPlayer=audioPlayer,this.mediaAPI.audioPlayer.onEvent(function(e){p.sendMessage(null,new Packet(null,"services.media.audioPlayer.triggerOnEvent",e))})),this.analytics.trackActionCommand=function(e,t){return!!e&&p.analytics.trackAction(e.value,e.metadata,t)},this.analytics.trackViewCommand=function(e,t){return!!e&&p.analytics.trackView(e.value,e.metadata,t)},this.navigation.pluginAPI=this,"undefined"!=typeof PublicFilesAPI&&(this.publicFiles=new PublicFilesAPI(this.context),this.publicFiles.onProgress(function(e){p.sendMessage(null,new Packet(null,"services.publicFiles._triggerOnProgress",{file:e}))}),this.publicFiles.onComplete(function(e){p.sendMessage(null,new Packet(null,"services.publicFiles._triggerOnComplete",{file:e}))})),"undefined"!=typeof searchEngineAPI&&(this.searchEngine=new searchEngineAPI(this.context)),"undefined"!=typeof CreditsAPI&&(this.credits=new CreditsAPI(this.context)),"undefined"!=typeof StripeAPI&&(this.stripe=new StripeAPI(this.context)),"undefined"!=typeof ShortLinksAPI&&(this.shortLinks=new ShortLinksAPI(this.context)),"undefined"!=typeof userTagsAPI&&(this.userTags=userTagsAPI)}else console.error("invalid appContext cant create pluginAPI")},postMessageHandler:function(n){if(!this.iFrameId)return!1;var i=void 0;try{i=n.packet||JSON.parse(n.data)}catch(e){return void console.warn("error parsing post message data.")}if(i&&i.cmd&&i.cmd.split&&(n.source==this.getContentWindow()||i.fid==this.iFrameId||this.context.instanceId==i.instanceId)){for(var o=this,e=i.cmd.split("."),t=this,a=this,s=0;s<e.length;s++){if(0<s&&(a=t),!t[e[s]])return!0;t=t[e[s]]}return t.apply(a,[i.data,function(e,t){e&&console.warn(n.data,e);e=new Packet(i.id,i.cmd,t,e);o.sendMessage(null,e)}]),!0}},sendMessage:function(e,t){(e=this.getContentWindow())&&e.postMessage&&(t=JSON.parse(JSON.stringify(t)),e.postMessage(t,"*"))},getContext:function(n,i){var o=this;return PluginAPI.appTheme.isDefault?new DatastoreAPI(window.appContext.currentApp.appId,"appearance","appearance",window.appContext.liveMode).get({tag:"appearance",withDynamicData:!0},function(e,t){e&&console.error(e),t&&t.data&&(t=t.data,PluginAPI.appTheme.updateTheme(t),o._getContext(n,i))}):this._getContext(n,i),this},_getContext:function(e,n){let i=Object.assign({},this.context);i.navbarEnabled=this.appearance.navbar.isVisible(),this.localStorage.getCollection(null,function(e,t){i.localStorage=t||{},"undefined"!=typeof appApiKeys?appApiKeys.get(function(e,t){i.apiKeys=t||{},n&&n(null,i)}):(window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.apiKeys&&(i.apiKeys=window.appContext.currentApp.apiKeys||{}),n&&n(null,i))})},navigation:{displayPopUpInstructions:function(){window.location.hash="/popUp"},_navigateTo:function(t,e){if(!t)return console.error("Critical error: no pluginData provided to _navigateTo");!1!==t.pushToHistory&&(t.pushToHistory=!0);var n=new HistoryAPI;t.pushToHistory||n.popToHome(),0==n.historyItems.length&&this.createHomeBreadcrumb();var i,o,a,s,r,p,c=n.historyItems[n.historyItems.length-1],l=t.instanceId===c.options.pluginData.instanceId&&(-1<["","#/","#"].indexOf(window.location.hash)||-1<window.location.hash.toLowerCase().indexOf("#/plugincontainer"));let d=window.location.hash;if(l||({pluginId:i,instanceId:o,title:a,folderName:s,pushToHistory:r,isNavigateBack:c}=t,d="/pluginContainer/".concat(i,"/").concat(o,"/").concat(encodeURIComponent(encodeURIComponent(a)),"/").concat(s,"/").concat(r),!c||(c=postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI.context&&postMaster.widgetPluginAPI.context.instanceId)&&c!==o&&(d+="/".concat(c))),postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.context&&t.instanceId==postMaster.launcherPluginAPI.context.instanceId&&t.pluginId==postMaster.launcherPluginAPI.context.pluginId)return n.popToHome(),window.location.hash="/",void(t.queryString&&(p=new Packet(null,"deeplink.triggerOnUpdate",t.queryString),postMaster.launcherPluginAPI.sendMessage(null,p)));if(!l){let e=void 0;if(t.title){e=t.title;try{e=decodeURIComponent(e)}catch(e){}}n.push({label:e,options:{pluginData:t,context:window.location.href},source:"control"})}t.queryString&&!t.isNavigateBack&&(l?(p=new Packet(null,"deeplink.triggerOnUpdate",t.queryString),postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI.sendMessage(null,p)):window.pluginControllerHelper.pluginPassThroughqueryString=t.queryString),t.dontTriggerHashChangeEvent||l?"undefined"!=typeof cpSync&&cpSync.navigation.silentNavigation(d):window.location.hash=d,e&&e(null,{status:"completed"})},navigateTo:function(o,a){var s,e,t;o&&o.pluginId&&o.instanceId&&o.title&&o.folderName?this._navigateTo(o,a):o&&(o.pluginId||o.instanceId||o.folderName)?(s=this,e=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),t={obj:{filter:{},pageSize:1,withDynamicData:!0}},o.instanceId&&(t.obj.filter["$json.instanceId"]=o.instanceId),o.pluginId&&(t.obj.filter["$json.token"]=o.pluginId),e.search(t,function(e,t){var n,i;e?a("error fetching pluginInstance",!1):t&&t.length?(n=t[0].data.instanceId,i=t[0].data._buildfire.pluginType.result[0].token,e=t[0].data._buildfire.pluginType.result[0].folderName,t=t[0].data.title,s._navigateTo({pluginId:i,instanceId:n,title:o.title||t,folderName:e,pushToHistory:o.pushToHistory,queryString:o.queryString},a)):a&&a("pluginInstance not found",!1)})):a("either pluginId, instanceId or folderName must be specified",!1)},navigateToPluginInstance:function(i,o){var e,t,a=this;i&&i.instanceId?(e=new DatastoreAPI(appContext.currentApp.appId,"pluginInstances",1,appContext.liveMode),(t={}).obj={filter:{"$json.instanceId":i.instanceId},pageSize:1,withDynamicData:!0},e.search(t,function(e,t){var n;e?o("error fetching pluginInstance",!1):t&&t.length?(n=t[0].data._buildfire.pluginType.result[0].token,e=t[0].data._buildfire.pluginType.result[0].folderName,t=t[0].data.title,a._navigateTo({pluginId:n,instanceId:i.instanceId,title:t,folderName:e,pushToHistory:!1,queryString:i.queryString},o)):o&&o("pluginInstance not found",!1)})):o("Invalid parameters. Need to pass instanceId.")},navigateToAppearance:function(e){e&&e.dontTriggerHashChangeEvent?cpSync.navigation.silentNavigation("/appearanceSample"):window.location.hash="/appearanceSample"},navigateHome:function(e,t){e&&e.dontTriggerHashChangeEvent?cpSync.navigation.silentNavigation("/"):window.location.hash="/",(new HistoryAPI).clear(),this.createHomeBreadcrumb(),t&&t()},navigateBack:function(){var e=new HistoryAPI;if(e.historyItems&&1<e.historyItems.length){var t=e.historyItems[e.historyItems.length-1],n=e.historyItems[e.historyItems.length-2];if(n&&n.options)switch(n.source){case"control":var i=null;"plugin"==t.source?(e.pop(n),n.options.pluginData&&((i=JSON.parse(JSON.stringify(n.options.pluginData))).isNavigateBack=!0,this._navigateTo(i))):(n.options.pluginData&&((i=JSON.parse(JSON.stringify(n.options.pluginData))).isNavigateBack=!0,this._navigateTo(i)),e.pop(n));break;case"plugin":"control"==t.source?(e.pop(n),window.location.hash="/"):e.pop(n);break;case"home":if("plugin"==t.source){e.pop(n);break}default:e.clear(),this.createHomeBreadcrumb(),window.location.hash="/"}}else e.clear(),this.createHomeBreadcrumb(),window.location.hash="/"},createHomeBreadcrumb:function(){const e=new HistoryAPI;var t=(postMaster.launcherPluginAPI?postMaster.launcherPluginAPI.context:appContext.currentPlugin)["instanceId"];e.push({label:"Home",options:{pluginData:{instanceId:t}},source:"home"})},scrollTop:function(e,t){document.body.scrollTop=e||0,t&&t()},navigateEmulator:function(e){"undefined"!=typeof PreviewerAPI&&"function"==typeof PreviewerAPI.previewApp&&PreviewerAPI.previewApp(e)},exitEmulator:function(){"undefined"!=typeof PreviewerAPI&&"function"==typeof PreviewerAPI.exit&&PreviewerAPI.exit()},navigateToApp:function(e){window.location.search="?env="+window.appContext.environment+"&appId="+e.appId+"&mode="+window.appContext.currentApp.liveMode+"&lastUrl="+encodeURIComponent(window.location.href)}},messaging:{triggerOnNewControlMessage:function(e){console.warn("unhandled message [onNewControlMessage]")},triggerOnNewWidgetMessage:function(e){e=new Packet(null,"messaging.onReceivedMessage",e);(postMaster.widgetPluginAPI||postMaster.launcherPluginAPI).sendMessage(null,e)},sendMessageToService:function(e,t){var n=postMaster.widgetPluginAPI;(n=n||postMaster.launcherPluginAPI)&&n.context&&postMaster.servicePluginAPIs&&((n=postMaster.servicePluginAPIs[n.context.instanceId])&&n.sendMessage&&(e=new Packet(null,"messaging.onReceivedMessage",e),n.sendMessage(null,e),t&&t(null,!0))),t&&t("no service available for current widget",null)}},spinner:{show:function(e,t){window.spinner&&window.spinner.show(),t&&t()},hide:function(e,t){window.spinner&&window.spinner.hide(),t&&t()}}};
"use strict";var geoAPI={getPermissionType:function(){return"undefined"==typeof BackgroundGeolocation&&"undefined"==typeof backgroundGeolocation?"location":"background_location"},currentPosition:null,convertPosition:function(o){return{coords:{latitude:o.coords.latitude,longitude:o.coords.longitude,altitude:o.coords.altitude,accuracy:o.coords.accuracy,altitudeAccuracy:o.coords.altitudeAccuracy,heading:o.coords.heading,speed:o.coords.speed},timestamp:o.timestamp,isBackground:o.isBackground||!1}},convertBackGroundPosition:function(o){return{coords:{latitude:o.latitude,longitude:o.longitude,altitude:o.altitude,accuracy:o.accuracy,speed:o.speed},timestamp:o.time,isBackground:!0}},getCurrentPosition:function(o,n){permissionRequestsAPI.queueRequest(geoAPI.getPermissionType(),geoAPI,()=>{this._getCurrentPosition(o,n)})},_getCurrentPosition:function(n,t){return navigator.geolocation?(bfUtils.isMobileDevice||(n=n||{}).timeout||(n.timeout=5e3),navigator.geolocation.getCurrentPosition(function(o){t(null,geoAPI.convertPosition(o))},function(o){geoAPI.currentPosition&&(!n.maximumAge||Date.now()-geoAPI.currentPosition.timestamp<n.maximumAge)?t(null,geoAPI.currentPosition):t(o,null)},n)):console.error("navigator.geolocation is undefined"),this},isAndroid:!1,watchPosition:function(o,n){permissionRequestsAPI.queueRequest(geoAPI.getPermissionType(),geoAPI,()=>{this._watchPosition(o,n)})},_watchPosition:function(o,n){function t(o){(o=geoAPI.convertPosition(o)).watchId=i,geoAPI.currentPosition=o;o=new Packet(null,"geo.onPositionChange",o);postMaster.broadcast(o)}function e(o){console.log("Geo watchPosition: ",o.message),o.watchId=i,n(o)}var i,a,c;navigator.geolocation&&navigator.geolocation.watchPosition?(i=navigator.geolocation.watchPosition(t,e,o),a=function(o){t(geoAPI.convertBackGroundPosition(o))},c=function(o){console.error("Background geo error",o)},bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},function(){"undefined"==typeof BackgroundGeolocation&&"undefined"==typeof backgroundGeolocation||("undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.backgroundMode&&(cordova.plugins.backgroundMode.enable&&cordova.plugins.backgroundMode.enable(),cordova.plugins.backgroundMode.on("activate",function(){cordova.plugins.backgroundMode.disableWebViewOptimizations()})),"undefined"==typeof backgroundGeolocation?(BackgroundGeolocation.configure({locationProvider:BackgroundGeolocation.ACTIVITY_PROVIDER,desiredAccuracy:BackgroundGeolocation.HIGH_ACCURACY,stationaryRadius:1,distanceFilter:1,debug:!1,interval:1e4,fastestInterval:5e3,activitiesInterval:1e4,activityType:o?o.activityType:void 0}),BackgroundGeolocation.on("location",a),BackgroundGeolocation.on("error",c),BackgroundGeolocation.on("authorization",function(o){console.log("[INFO] BackgroundGeolocation authorization status: "+o),!0===bfUtils.isIOS&&o!==BackgroundGeolocation.AUTHORIZED&&setTimeout(function(){if(console.log("always permission needed"),confirm("To use background location, you must enable 'Always' in the in the Location Services settings"))return BackgroundGeolocation.showAppSettings()},1e3)}),BackgroundGeolocation.checkStatus(function(o){console.log("[INFO] BackgroundGeolocation service is running",o.isRunning),console.log("[INFO] BackgroundGeolocation services enabled",o.locationServicesEnabled),console.log("[INFO] BackgroundGeolocation auth status: "+o.authorization),o.isRunning||BackgroundGeolocation.start()})):(backgroundGeolocation.configure(a,c,{desiredAccuracy:0,stationaryRadius:1,distanceFilter:1,interval:1e3,locationProvider:backgroundGeolocation.provider.ANDROID_ACTIVITY_PROVIDER}),backgroundGeolocation.start()))})):(console.log("HTML5 position"),i=setInterval(function(){geoAPI.getCurrentPosition(o,function(o,n){o?e(o):t(n)})},o&&o.timeout?o.timeout:5e3)),n()},clearWatch:function(o,n){navigator.geolocation&&navigator.geolocation.watchPosition?navigator.geolocation.clearWatch(o):clearInterval(o),n&&n()},isEnabled:function(o,n){BackgroundGeolocation.checkStatus(function(o){return n(null,o.locationServicesEnabled)})}};
"use strict";var inputAPI={initialized:!1,timer:null,currentStepData:null,currentStepOptions:null,init:function(){this.inputDialog?this.inputDialog.innerHTML="":(this.inputDialog=document.createElement("div"),this.inputDialog.style.display="none"),this.listDialog?this.listDialog.innerHTML="":(this.listDialog=document.createElement("div"),this.listDialog.style.display="none"),this.backdrop?this.backdrop.className="":(this.backdrop=document.createElement("div"),this.backdrop.id="input-backdrop"),0<=window.location.pathname.indexOf("pluginTester")?(this.inputDialog.style.height=document.getElementById("app").offsetHeight+"px",this.inputDialog.style.position="absolute",this.listDialog.style.height=document.getElementById("app").offsetHeight+"px",this.listDialog.style.position="absolute"):(this.inputDialog.style.height="100vh",this.inputDialog.style.maxHeight="100vh",this.listDialog.style.height="100vh",this.listDialog.style.maxHeight="100vh");var t=localStorage.getItem("footerMenu");this.inputDialog.id="inputDialog",this.inputDialog.className=t?"has-footer-menu":"";const e=document.createElement("div");e.className="input-dialog-container backgroundColorTheme",this.inputDialog.appendChild(e),this.dialogNav=document.createElement("div"),this.dialogNav.className="inputapi-nav titleBarBackgroundTheme",e.appendChild(this.dialogNav),this.dialogNavFlex=document.createElement("div"),this.dialogNavFlex.className="inputapi-nav-flex",this.dialogNav.appendChild(this.dialogNavFlex),this.dialogNavSecondary=document.createElement("div"),this.dialogNavSecondary.className="inputapi-nav secondary titleBarBackgroundTheme",e.appendChild(this.dialogNavSecondary),this.dialogNavFlexSecondary=document.createElement("div"),this.dialogNavFlexSecondary.className="inputapi-nav-flex secondary",this.dialogNavSecondary.appendChild(this.dialogNavFlexSecondary),this.currentUserContainer=document.createElement("div"),this.currentUserContainer.className="inputapi-user-container",e.appendChild(this.currentUserContainer),this.textarea=document.createElement("textarea"),this.textarea.className="inputapi-textarea needsfocus bodyTextTheme",this.textarea.id="inputapi-textarea",this.textarea.onclick=window.keyboardResize,this.textarea.addEventListener("touchend",t=>{t.target.click()}),this.textarea.addEventListener("focus",({target:t})=>{t.style.webkitTransform="translate3d(0px,-10000px,0)",requestAnimationFrame(()=>t.style.webkitTransform="")}),this.textarea.addEventListener("input",t=>{this.currentStepData.textValue=t.target.value,this.currentStepData.textValue.length>this.currentStepOptions.maxLength&&(this.currentStepData.textValue=this.currentStepData.textValue.substring(0,this.currentStepOptions.maxLength),t.target.value=this.currentStepData.textValue),this.doneButton.disabled=!this.validate()}),e.appendChild(this.textarea),this.imageGallery=document.createElement("div"),this.imageGallery.id="imageGallery",this.geoContainer=document.createElement("div"),this.geoContainer.id="geo-container",this.geoContainer.classList="img-gallery-container",this.geoContainer.style.display="none",this.geoImage=document.createElement("img"),this.geoImage.id="geo-img",this.geoContainer.appendChild(this.geoImage),this.geoDeleteBtn=document.createElement("span"),this.geoDeleteBtn.className="galery-delete glyphicon glyphicon-minus-sign",this.geoDeleteBtn.onclick=()=>this.setLocation(),this.geoContainer.appendChild(this.geoDeleteBtn),this.imageGallery.appendChild(this.geoContainer),e.appendChild(this.imageGallery),this.cancelButton=document.createElement("button"),this.cancelButton.className="inputapi-cancel titleBarTextAndIcons",this.dialogNavFlex.appendChild(this.cancelButton),this.title=document.createElement("h1"),this.title.className="inputapi-nav-title primary titleBarTextAndIcons ellipsis",this.title.style.whiteSpace="nowrap",this.dialogNavFlex.appendChild(this.title),this.titleSecondary=document.createElement("h1"),this.titleSecondary.className="inputapi-nav-title secondary titleBarTextAndIcons ellipsis",this.titleSecondary.style.whiteSpace="nowrap",this.dialogNavFlexSecondary.appendChild(this.titleSecondary),this.doneButton=document.createElement("button"),this.doneButton.className="inputapi-done titleBarTextAndIcons",this.dialogNavFlex.appendChild(this.doneButton),this.actionFooter=document.createElement("div"),this.actionFooter.className="inputapi-footer",e.appendChild(this.actionFooter),this.cameraBtn=document.createElement("span"),this.cameraBtn.className="icon icon-camera2 needsclick",this.cameraBtn.onclick=t=>this.showFileDialog(),this.actionFooter.appendChild(this.cameraBtn),this.geoPin=document.createElement("span"),this.geoPin.id="goc-pin",this.geoPin.className="icon icon-map-marker",this.geoPin.onclick=t=>this.showLocationModal(),this.actionFooter.appendChild(this.geoPin),this.gifBtn=document.createElement("span"),this.gifBtn.className="icon icon-gif",this.gifBtn.id="gif-btn",this.gifBtn.onclick=t=>this.showGifDialog(),this.actionFooter.appendChild(this.gifBtn),this.listDialog.id="listDialog";const i=document.createElement("div");i.className="body backgroundColorTheme",this.listDialog.appendChild(i),this.listDialogHeader=document.createElement("h1"),this.listDialogHeader.className="list-header",i.appendChild(this.listDialogHeader),this.listDialogItems=document.createElement("form"),this.listDialogItems.className="input-list",i.appendChild(this.listDialogItems);const n=document.createElement("div");n.className="button-container",i.appendChild(n),this.listDialogCancelBtn=document.createElement("button"),this.listDialogCancelBtn.className="cancel primaryTheme",n.appendChild(this.listDialogCancelBtn),this.listDialogConfirmBtn=document.createElement("button"),this.listDialogConfirmBtn.className="confirm primaryTheme",n.appendChild(this.listDialogConfirmBtn),0<=window.location.pathname.indexOf("pluginTester")?(document.getElementById("app").appendChild(this.inputDialog),document.getElementById("app").appendChild(this.listDialog),document.getElementById("app").appendChild(this.backdrop)):(document.body.appendChild(this.inputDialog),document.body.appendChild(this.listDialog),document.body.appendChild(this.backdrop)),this.initialized=!0},showLocationModal:function(){window.spinner&&window.spinner.show(),this.getLocation((t,e)=>{try{if(t)throw t;const{latitude:n,longitude:a}=e.coords,{mapUrl:o,thumbnail:l}=this.getMapUrl(e);if(this.currentStepOptions.attachments.location.required)return window.spinner&&window.spinner.hide(),this.geoDeleteBtn.style.display="none",this.setLocation({latitude:n,longitude:a},l);var i={title:"Send My Current Location",richContent:'\n          <img style="height: 90vw !important; width: 90vw !important" src="'.concat(o,'" />\n        '),action:{title:"Confirm",handler:()=>this.setLocation({latitude:n,longitude:a},l)}};window.spinner&&window.spinner.hide(),richModal.display(i)}catch(t){console.error("inputAPI location error",t);let e="Failed to determine location. Please try again later.";if(t.code)switch(t.code){case 1:e="App does not have location access.";break;case 2:e="Location information is not availible to this device.";break;case 3:e="Location request timed out. Try again.";break;case 4:e="Failed to determine location. Please try again later (code 4)";break;case 5:e="This app does not have access to this feature."}i={title:"Could not determine location",richContent:e};richModal.display(i),window.spinner&&window.spinner.hide()}})},getLocation:i=>{let n=null,a;appApiKeys.get(function(t,e){a=e.googleMapKey,a||(n=new Error("no google API key"),n.code=5),n||"object"==typeof geoAPI||(n=new Error("geoAPI not defined"),n.code=4),n?i(n,null):geoAPI.getCurrentPosition({timeout:1e4},(t,e)=>{e&&(e.googleMapKey=a),i(t,e)})})},setLocation:function(t,e){t&&e?"undefined"!=typeof tinymce&&tinymce.activeEditor?(tinymce.activeEditor.insertContent('<img src="'.concat(e,'" width="100" height="100" class="tinymce-geoImage">')),this.currentStepData.location=t):(this.currentStepData.location=t,this.geoContainer.style.display="block",this.geoImage.src=e):(this.currentStepData.location={},this.geoContainer.style.display="none",this.geoImage.removeAttribute("src")),this.doneButton.disabled=!this.validate()},getMapUrl:t=>{var{latitude:e,longitude:i}=t.coords,n=t["googleMapKey"],t="size=".concat(window.innerWidth,"x").concat(window.innerWidth),t="zoom=15&".concat(t,"&maptype=roadmap&key=").concat(n),n="center=".concat(e,",").concat(i),i="markers=color:blue|size:large|".concat(e,",").concat(i);const a="".concat("https://maps.googleapis.com/maps/api/staticmap","?").concat(n,"&").concat(i,"&").concat(t);t=a.replace(/size:large/g,"size:mid").replace(/size=\d{1,4}x\d{1,4}/g,"size=100x100").replace(/zoom=15/g,"zoom=12");return{mapUrl:a,thumbnail:t}},showGifDialog:function(i=!1){if("object"==typeof gifAPI){const{multiple:n,rating:t}=this.currentStepOptions.attachments.gifs,a=e=>{if(!(6<=this.currentStepData.images.length+this.currentStepData.gifs.length)){this.currentStepData.gifs.push(e);let t="";t=bfUtils.isIOS?e.images.preview.mp4||e.images.gif.downsized_small.mp4:e.images.downsized_medium.url||e.images.original.url,i?inputAPI._showTinyMceDialog(t,"gif"):this.addToGallery(t,"gifs")}};gifAPI.showGifDialog({multiple:n,rating:t},(t,e)=>{var i;!t&&e&&({cancelled:i,results:t}=e,!i&&t&&t.length&&(n?e.results.forEach(t=>a(t)):(this.currentStepData.gifs=[],(t=document.getElementById("gifs_0"))&&this.imageGallery.removeChild(t),e=e.results[0],a(e))))})}},showFileDialog(n=!1){let t=new PublicFilesAPI(window.appContext.currentApp);t._onComplete=t=>{var e,i;"success"===t.status?({images:i,gifs:e}=this.currentStepData,i=i?i.length:0,6<=(e?e.length:0)+i||(this.currentStepData.images.push(t.url),n?inputAPI._showTinyMceDialog(t.url,"image"):this.addToGallery(t.url,"images"))):console.error("Image upload failed - inputAPI",t)},t._onProgress=()=>{window.spinner&&window.spinner.show(),this.doneButton.disabled=!0};var e=this.currentStepOptions.attachments.images["multiple"];t.showDialog({allowMultipleFilesUpload:e||!1,filter:["image/*"]},()=>{window.spinner&&setTimeout(window.spinner.hide.bind(null,!0),300),this.doneButton.disabled=!(!this.currentStepOptions.required||!this.currentStepData.textValue||this.currentStepData.textValue.length)})},addToGallery(t,e){const i=this.currentStepData[e].length-1,n=document.createElement("div");n.className="img-gallery-container animated fadeInUp ".concat(e),n.id="".concat(e,"_").concat(i);const a=document.createElement("span");a.className="galery-delete glyphicon glyphicon-minus-sign",a.onclick=()=>{this.removeFromGallery(i,e)},n.appendChild(a),"images"===e&&"undefined"!=typeof imageTools&&(t=imageTools.cropImage(t,{size:"s",aspect:"1:1",compression:50}));const o=document.createElement("img");o.setAttribute("src",t),o.className="img-gallery-item ".concat(e),n.appendChild(o),this.imageGallery.appendChild(n);var{images:l,gifs:t}=this.currentStepData,l=l?l.length:0;5<(t?t.length:0)+l&&(this.cameraBtn.classList.add("disabled"),this.gifBtn.classList.add("disabled"))},removeFromGallery(t,e){this.currentStepData[e].splice(t,1);e=document.getElementById("".concat(e,"_").concat(t));e&&this.imageGallery.removeChild(e);var{images:t,gifs:e}=this.currentStepData,t=t?t.length:0;(e?e.length:0)+t<6&&(this.cameraBtn.classList.remove("disabled"),this.gifBtn.classList.remove("disabled"))},getTinyMceStyles:function(){let t=document.createElement("style");if(t.id="tinymce-styles",!PluginAPI.appTheme)return t;var{icons:e,backgroundColor:i,bodyText:n,primaryTheme:a}=PluginAPI.appTheme.colors;return t.innerHTML="\n      .tox .tox-tbtn svg,\n      .tox-icon svg {\n        fill: ".concat(e," !important;\n      }\n\n      .tox .tox-toolbar,\n      .tox .tox-toolbar__overflow,\n      #tinymce-textarea_ifr,\n      .tox .tox-edit-area__iframe,\n      .tox-dialog__header,\n      .tox-dialog,\n      .tox-dialog__footer,\n      .tox .tox-statusbar {\n        background-color: ").concat(i," !important;\n      }\n\n      .tox-editor-header,\n      .tox .tox-toolbar__primary,\n      .tox .tox-toolbar-overlord {\n        background-color: ").concat(i,"33 !important;\n      }\n      .tox .tox-tbtn--enabled {\n        background-color: rgba(155, 155, 155, .3) !important;\n        background: rgba(155, 155, 155, .3) !important;\n      }\n\n      .tox .tox-tbtn--enabled:hover,\n      .tox .tox-tbtn:hover {\n        background-color: rgba(155, 155, 155, .1) !important;\n        background: rgba(155, 155, 155, .1) !important;\n      }\n      \n      .tox-label,\n      .tox-dialog__body-content,\n      .tox-dialog__title,\n      .tox-statusbar__path-item,\n      .tox-statusbar__path {\n        color: ").concat(n," !important;\n      }\n\n      button.tox-button.tox-button--secondary {\n        background: none !important;\n        border: none !important;\n        color: ").concat(n," !important;\n      }\n\n      .tox.tox-tinymce.tox-tinymce--toolbar-bottom {\n        border-left: none;\n        border-right: none;\n        border-top: none;\n        border-bottom: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      @media (min-width: 1200px) {\n        .tox.tox-tinymce.tox-tinymce--toolbar-bottom {\n          min-height: 200px;\n        }\n      }\n\n      .tox-toolbar.tox-toolbar--scrolling {\n        background: transparent !important;\n        border-top: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      .tox:not([dir=rtl]) .tox-toolbar__group:not(:last-of-type) {\n        border-right: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      .tox-statusbar {\n        border-top: 1px solid rgba(128,128,128,.15) !important;\n      }\n\n      .tox-dialog__footer {\n        border-top: none !important;\n      }\n\n      .wysiwyg_radio {\n        display: flex;\n      }\n\n      .wysiwyg_radio__label {\n        margin-left: 1rem;\n      }\n\n      .wysiwyg_radio__label:after {\n        background-color: ").concat(a," !important;\n      }\n\n      .wysiwyg_radio__input:checked + .wysiwyg_radio__label:before {\n        border-color: ").concat(a," !important;\n      }\n\n      .wysiwyg_radio__label:before {\n        border: 2px solid ").concat(n," !important;\n      }\n\n      .tox .tox-form__group {\n        margin-bottom: 2rem !important;\n      }\n\n      .tox-dialog {\n        width: calc(100vw - 4rem) !important;\n        border: none !important;\n        border-radius: 5px !important;\n        margin-top: 50% !important; \n      }\n\n      #full_width path#Shape {\n        fill: ").concat(e,";\n      }\n\n      #half_width path#Shape {\n        fill: ").concat(e,";\n      }\n\n      #third_width path#Shape {\n        fill: ").concat(e,";\n      }\n\n      #quarter_width path#Shape {\n        fill: ").concat(e,';\n      }\n\n      .wysiwyg_radio svg {\n        margin-left: auto !important;\n      }\n\n      .tox .tox-dialog-wrap__backdrop--opaque {\n        background-color: rgba(0,0,0,.5) !important;\n      }\n\n      [aria-label="Close"] {\n        visibility: hidden;\n      }\n\n    '),t},getTinyMceOptions(t,e){let i="";var n,a;return PluginAPI.appTheme&&({bodyText:n,icons:a}=PluginAPI.appTheme.colors,i="\n          body { \n            color: ".concat(n,"; \n          } \n          .mce-content-body[data-mce-placeholder]:not(.mce-visualblocks)::before { \n            color: ").concat(n,"99;\n          }\n          .tox .tox-tbtn svg {\n            fill: ").concat(a," !important;\n          }\n      ")),{selector:"#inputapi-textarea",plugins:"image lists imagetools",toolbar:["bold italic | bullist numlist | alignleft aligncenter alignright"],placeholder:t.placeholder||"Type something...",toolbar_location:"bottom",height:"100%",menubar:!1,toolbar_mode:"scrolling",content_style:i,setup:function(i){i.on("click",function(t){window.keyboardResize()}),i.on("init",t=>{let e=document.querySelector('[aria-label="Powered by Tiny"]');e.addEventListener("click",t=>{t.preventDefault(),window.open(e.href,"_system")}),setTimeout(()=>{i.focus()},500)})}}},fullWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>full_width</title> <desc>Created with Sketch.</desc> <g id="full_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M16,12 C17.1045695,12 18,12.8954305 18,14 L18,16 C18,17.1045695 17.1045695,18 16,18 L2,18 C0.8954305,18 0,17.1045695 0,16 L0,14 C0,12.8954305 0.8954305,12 2,12 L16,12 Z M16,14 L2,14 L2,16 L16,16 L16,14 Z M16,0 C17.1045695,0 18,0.8954305 18,2 L18,8 C18,9.1045695 17.1045695,10 16,10 L2,10 C0.8954305,10 0,9.1045695 0,8 L0,2 C0,0.8954305 0.8954305,0 2,0 L16,0 Z" id="Shape" fill="#000000"></path> </g> </svg>',halfWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>half_width</title> <desc>Created with Sketch.</desc> <g id="half_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M6,3.55271368e-15 C7.1045695,3.55271368e-15 8,0.8954305 8,2 L8,16 C8,17.1045695 7.1045695,18 6,18 L2,18 C0.8954305,18 -3.2162453e-16,17.1045695 -3.2162453e-16,16 L-3.2162453e-16,2 C-3.2162453e-16,0.8954305 0.8954305,3.55271368e-15 2,3.55271368e-15 L6,3.55271368e-15 Z M16,7.10542736e-15 C17.1045695,7.10542736e-15 18,0.8954305 18,2 L18,16 C18,17.1045695 17.1045695,18 16,18 L12,18 C10.8954305,18 10,17.1045695 10,16 L10,2 C10,0.8954305 10.8954305,7.10542736e-15 12,7.10542736e-15 L16,7.10542736e-15 Z M16,2 L12,2 L12,16 L16,16 L16,2 Z" id="Shape" fill="#000000"></path> </g> </svg>',thirdWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>third_width</title> <desc>Created with Sketch.</desc> <g id="third_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M4,4 C4.55228475,4 5,4.44771525 5,5 L5,13 C5,13.5522847 4.55228475,14 4,14 L2,14 C1.44771525,14 1,13.5522847 1,13 L1,5 C1,4.44771525 1.44771525,4 2,4 L4,4 Z M10,4 C10.5522847,4 11,4.44771525 11,5 L11,13 C11,13.5522847 10.5522847,14 10,14 L8,14 C7.44771525,14 7,13.5522847 7,13 L7,5 C7,4.44771525 7.44771525,4 8,4 L10,4 Z M16,4 C16.5522847,4 17,4.44771525 17,5 L17,13 C17,13.5522847 16.5522847,14 16,14 L14,14 C13.4477153,14 13,13.5522847 13,13 L13,5 C13,4.44771525 13.4477153,4 14,4 L16,4 Z M10,5 L8,5 L8,13 L10,13 L10,5 Z M16,5 L14,5 L14,13 L16,13 L16,5 Z" id="Shape" fill="#000000"></path> </g> </svg>',quarterWidthIcon:'<?xml version="1.0" encoding="UTF-8"?> <svg width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e <title>quarter_width</title> <desc>Created with Sketch.</desc> <g id="quarter_width" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <path d="M2,4 C2.55228475,4 3,4.44771525 3,5 L3,13 C3,13.5522847 2.55228475,14 2,14 L1,14 C0.44771525,14 0,13.5522847 0,13 L0,5 C0,4.44771525 0.44771525,4 1,4 L2,4 Z M7,4 C7.55228475,4 8,4.44771525 8,5 L8,13 C8,13.5522847 7.55228475,14 7,14 L6,14 C5.44771525,14 5,13.5522847 5,13 L5,5 C5,4.44771525 5.44771525,4 6,4 L7,4 Z M17,4 C17.5522847,4 18,4.44771525 18,5 L18,13 C18,13.5522847 17.5522847,14 17,14 L16,14 C15.4477153,14 15,13.5522847 15,13 L15,5 C15,4.44771525 15.4477153,4 16,4 L17,4 Z M12,4 C12.5522847,4 13,4.44771525 13,5 L13,13 C13,13.5522847 12.5522847,14 12,14 L11,14 C10.4477153,14 10,13.5522847 10,13 L10,5 C10,4.44771525 10.4477153,4 11,4 L12,4 Z M7,5 L6,5 L6,13 L7,13 L7,5 Z M17,5 L16,5 L16,13 L17,13 L17,5 Z M12,5 L11,5 L11,13 L12,13 L12,5 Z" id="Shape" fill="#000000"></path> </g> </svg>',_showTinyMceDialog(a,t){var e="image"===t?"Image":"Gif",i="Insert ".concat(e),t={title:"Save",handler:()=>{let e;["fullWidth","halfWidth","thirdWidth","quarterWidth"].some(t=>{if(document.querySelector('input[value="'.concat(t,'"]')).checked)return e=t,!0});let t=tinyMCE.activeEditor.getContainer().clientWidth,i;switch(e){case"fullWidth":t="calc(".concat(t,"px - 2rem)"),i="full_width";break;case"halfWidth":t="calc(".concat(t/2,"px - 1rem)"),i="half_width";break;case"thirdWidth":t="calc((".concat(t,"px - 2rem) / 3)"),i="third_width";break;case"quarterWidth":t="calc(".concat(t/4,"px - .5rem)"),i="quarter_width"}var n=imageTools.resizeImage(a,{size:i,aspect:"1:1"});tinymce.activeEditor.insertContent('<img src="'.concat(n,'" style="width: ').concat(t,';">')),richModal.close()}},e='\n      <div>\n        <p style="margin-bottom: 2rem !important">'.concat(e,' size</p>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="fullWidth" class="wysiwyg_radio__input" value="fullWidth" checked>\n          <label for="fullWidth" class="wysiwyg_radio__label">Full Width</label>\n          ').concat(this.fullWidthIcon,'\n        </div>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="halfWidth" class="wysiwyg_radio__input" value="halfWidth">\n          <label for="halfWidth" class="wysiwyg_radio__label">Half Width</label>\n          ').concat(this.halfWidthIcon,'\n        </div>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="thirdWidth" class="wysiwyg_radio__input" value="thirdWidth">\n          <label for="thirdWidth" class="wysiwyg_radio__label">Third Width</label>\n          ').concat(this.thirdWidthIcon,'\n        </div>\n        <div class="wysiwyg_radio" style="margin-bottom: 2rem !important;">\n          <input type="radio" name="width" id="quarterWidth" class="wysiwyg_radio__input" value="quarterWidth">\n          <label for="quarterWidth" class="wysiwyg_radio__label">Quarter Width</label>\n          ').concat(this.quarterWidthIcon,"\n        </div>\n      </div>\n    ");richModal.display({title:i,richContent:e,action:t})},renderStep(n,e,i){this.currentStepData={wysiwygValue:n.defaultValue||"",textValue:n.defaultValue||"",images:[],location:{},gifs:[]},n.maxLength=n.maxLength||2e3,this.currentStepOptions=n,this.title.innerHTML=n.title||"",this.titleSecondary.innerHTML=n.title||"";var{location:t,images:a,gifs:o}=this.currentStepOptions.attachments,l=!1;["images","gifs","location"].forEach(t=>{n.attachments[t]&&n.attachments[t].enable&&(n.attachments[t].required||(l=!0))}),this.actionFooter.style.display=l?"flex":"none",this.cameraBtn.style.display=a.enable&&this.currentStepData.images.length<6?"block":"none",this.geoPin.style.display=t.enable&&!t.required?"block":"none",this.gifBtn.style.display=o.enable?"block":"none",this.imageGallery.style.display=n.wysiwyg?"none":"flex",this.currentUserContainer.innerHTML="";o=authAPI.getCurrentUser();this.userImage=document.createElement("img"),o&&o.imageUrl?"undefined"!=typeof imageTools?this.userImage.src=imageTools.cropImage(o.imageUrl,{size:"xs",aspect:"1:1",compression:70}):this.userImage.src=o.imageUrl:this.userImage.src="https://pluginserver.buildfire.com/styles/media/avatar-placeholder.png",this.userImage.className="inputapi-user-image",this.currentUserContainer.appendChild(this.userImage),this.userTitle=document.createElement("h1"),this.userTitle.className="inputapi-user-title ellipsis",o&&(this.userTitle.innerHTML=o.displayName||(o.firstName?o.firstName+" ":"")+(o.lastName||"")||""),this.currentUserContainer.appendChild(this.userTitle),n.wysiwyg?(document.getElementById("tinymce-styles")||document.head.appendChild(inputAPI.getTinyMceStyles()),"undefined"!=typeof Keyboard&&Keyboard.shrinkView&&Keyboard.shrinkView(!0),this.textarea.innerHTML=n.defaultValue||"",tinymce.init(this.getTinyMceOptions(n,this)),this.cameraBtn.onclick=t=>this.showFileDialog(!0),this.gifBtn.onclick=t=>this.showGifDialog(!0)):(this.textarea.placeholder=n.placeholder||"Type something...",this.textarea.maxLength=n.maxLength||2e3,this.textarea.value=n.defaultValue?n.defaultValue.substring(0,this.textarea.maxLength):"");const s=document.createElement("div");s.className="btn-txt primary",s.innerHTML=n.saveText||(n._buffer.length?"Next":"Done");const r=document.createElement("div");r.className="btn-txt secondary iconsTheme",r.innerHTML=n.saveText||(n._buffer.length?"Next":"Done");const c=document.createElement("div");c.className="btn-txt primary",c.innerHTML=n.cancelText||"Cancel";const d=document.createElement("div");for(d.className="btn-txt secondary iconsTheme",d.innerHTML=n.cancelText||"Cancel",this.doneButton.innerHTML="",this.cancelButton.innerHTML="",this.doneButton.appendChild(s),this.doneButton.appendChild(r),this.cancelButton.appendChild(c),this.cancelButton.appendChild(d),this.doneButton.onclick=t=>i(this.currentStepData),this.cancelButton.onclick=t=>e(),this.backdrop.onclick=t=>e(),n.prefill&&(this.textarea.value=n.prefill),this.doneButton.disabled=!this.validate();this.imageGallery.childNodes[1];)this.imageGallery.removeChild(this.imageGallery.childNodes[1]);if("object"==typeof n.defaultAttachments){let{images:t,gifs:e,location:i}=n.defaultAttachments;t&&t.length&&(this.currentStepData.images=t,t.forEach(t=>{this.addToGallery(t,"images")})),e&&e.length&&(this.currentStepData.gifs=e,e.forEach(t=>this.addToGallery(t,"gifs"))),this.currentStepData.gifs=e,this.currentStepData.location=i}t.required?this.showLocationModal():this.setLocation()},showTextDialog:function(t,e){if(t&&e)if("undefined"==typeof tinymce&&("function"==typeof t.some?t.some(t=>t.wysiwyg):t.wysiwyg)){const i=document.createElement("script");i.src=window._appRoot+"scripts/lib/tinymce/js/tinymce/tinymce.min.js",i.type="text/javascript",i.onload=()=>{this._showTextDialog(t,e)},document.getElementsByTagName("head")[0].appendChild(i)}else this._showTextDialog(t,e)},_showTextDialog:function(t,e){if(t&&e){if(this.currentStepOptions&&this.currentStepOptions._buffer)return e({message:"inputDialog is already active"});this.initialized||this.init();let i=new PublicFilesAPI(window.appContext.currentApp);var n=Array.isArray(t)?t:[t],a=[],o=!1,l=!1;if(n.forEach(function(t){t.cancelText&&9<t.cancelText.length&&(l=!0),t.saveText&&9<t.saveText.length&&(o=!0),t.attachments||(t.attachments={}),t.attachments.images||(t.attachments.images={}),t.attachments.location||(t.attachments.location={}),t.attachments.location.required&&(t.attachments.location.enable=!0),t.attachments.gifs||(t.attachments.gifs={})}),o)return e(new Error("saveText too long, max 9 chars"));if(l)return e(new Error("cancelText too long, max 9 chars"));!t.hideUserData&&authAPI.getCurrentUser()||(this.currentUserContainer.style.display="none"),t.prefill&&(this.textarea.value=t.prefill);const s=t=>"undefined"==typeof Keyboard?t():Keyboard.shrinkView?(Keyboard.shrinkView(!1),t()):Keyboard.hide&&Keyboard.isVisible?(window.addEventListener("keyboardWillHide",()=>t(),{once:!0}),void Keyboard.hide()):t(),r=t=>{e(null,{cancelled:t,results:a}),this.currentStepOptions=null,this.currentStepData=null,this.timer=setTimeout(()=>{this.inputDialog.addEventListener("transitionend",()=>{this.inputDialog.classList.remove("transition")},{once:!0}),this.inputDialog.classList.add("transition"),this.inputDialog.classList.remove("active"),this.backdrop.classList.remove("active"),setTimeout(()=>{this.inputDialog.classList.contains("active")||(this.inputDialog.style.display="none",this.init(),"undefined"!=typeof tinymce&&tinymce.activeEditor&&tinymce.activeEditor.remove())},500)},150)},c=()=>{s(()=>r(!0))},d=e=>{"undefined"!=typeof tinymce&&tinymce.activeEditor&&(e.wysiwygValue=tinymce.activeEditor.getContent(),e.textValue=tinymce.activeEditor.getContent({format:"text"}),e.images&&e.images.length&&(e.images=e.images.filter(t=>!!e.wysiwygValue.includes(t)||(i.deleteFile({fileId:t.split("/").pop()},(t,e)=>{t&&console.error("Error while deleting image")}),!1))),tinymce.activeEditor.remove(),this.textarea.value=""),a.push(e);s(()=>{var t=n.shift();if(!t)return r(!1);t._buffer=n,this.renderStep(t,c,d)})};t=n.shift();t._buffer=n,this.renderStep(t,c,d),this.timer&&(clearTimeout(this.timer),this.timer=null),this.inputDialog.style.display="flex",setTimeout(()=>{this.inputDialog.addEventListener("transitionend",()=>{this.inputDialog.classList.remove("transition")},{once:!0}),this.inputDialog.classList.add("transition"),this.inputDialog.classList.add("active"),this.backdrop.classList.add("active")},100),setTimeout(()=>{"undefined"==typeof tinymce||tinymce.activeEditor||this.textarea.focus()},500)}},showListDialog:function(l,t){if(l&&t){if(!l.listItems||!l.listItems.length)return t(new Error("No listItems provided to showListDialog"),null);if(l.listItems.some(t=>!t.text||!t.value))return t(new Error("All listItems must contain text and value"),null);l.cancelButton||(l.cancelButton={text:"Cancel",value:"cancel"}),l.confirmButton||(l.confirmButton={text:"Ok",value:"ok"}),this.initialized||this.init(),this.listDialogItems.innerHTML="",this.listDialogHeader.innerText=l.title||"",l.listItems.forEach(t=>{const e=document.createElement("div");e.className="input-list-item";const i=document.createElement("input");i.value=t.value,i.setAttribute("type",l.multiSelect?"checkbox":"radio"),i.setAttribute("name","listDialogItem"),i.setAttribute("id",t.value),e.appendChild(i);const n=document.createElement("label");n.setAttribute("for",t.value);const a=document.createElement("span");a.className="selector primaryBackgroundTheme";const o=document.createElement("div");o.innerText=t.text,n.appendChild(a),n.appendChild(o),e.appendChild(n),this.listDialogItems.appendChild(e)});let n=[];var e=t=>{const{value:e,type:i}=t.target.children[0];switch(t.target.children[0].checked?t.target.children[0].checked=!1:t.target.children[0].checked=!0,i){case"checkbox":t.target.checked?n.push({value:e}):n=n.filter(t=>t.value!==e);break;case"radio":n=[{value:e}],this.listDialogConfirmBtn.disabled=!1}};for(let t=0;t<this.listDialogItems.childElementCount;t++)this.listDialogItems.children[t].onclick=e;this.listDialogCancelBtn.innerHTML=l.cancelButton.text,this.listDialogCancelBtn.value=l.cancelButton.value,this.listDialogConfirmBtn.innerHTML=l.confirmButton.text,this.listDialogConfirmBtn.value=l.confirmButton.value,l.multiSelect||(this.listDialogConfirmBtn.disabled=!0);const i=()=>{this.listDialog.classList.remove("active"),this.backdrop.classList.remove("active"),this.backdrop.classList.remove("isDialog");for(let t=0;t<this.listDialogItems.childElementCount;t++)this.listDialogItems.children[t].onclick=null;this.listDialogItems.innerHTML="",this.listDialogHeader.innerHTML=""};this.backdrop.onclick=()=>(i(),t(null,{cancelled:!0,selected:n})),this.listDialogCancelBtn.onclick=()=>(i(),t(null,{cancelled:!0,selected:n})),this.listDialogConfirmBtn.onclick=()=>(i(),t(null,{cancelled:!1,selected:n})),this.listDialog.classList.add("active"),this.backdrop.classList.add("active"),this.backdrop.classList.add("isDialog")}},validate(){let t=!1,e=!1;var{required:i,attachments:n}=this.currentStepOptions;return(!i||this.textarea.value&&0<this.textarea.value.length)&&(t=!0),n.location.required&&!this.currentStepData.location.latitude||(e=!0),t&&e}};setTimeout(function(){inputAPI.initialized||inputAPI.init()},5e3);
"use strict";const gifAPI={initialized:!1,apiKey:"5yISc07frWLGwJJgXt7PKnsDMQP1or1H",results:[],pages:[],options:{},handleClose:null,init(){this.gifDialog?this.gifDialog.innerHTML="":(this.gifDialog=document.createElement("div"),this.gifDialog.style.display="none"),this.backdrop?this.backdrop.className="":(this.backdrop=document.createElement("div"),this.backdrop.id="gif-backdrop"),this.gifDialog.id="gifDialog",this.gifDialog.className="backgroundColorTheme";const e=document.createElement("div");e.className="gifDialog-container backgroundColorTheme",this.gifDialog.appendChild(e);const t=document.createElement("div");t.className="gifapi-nav backgroundColorTheme",e.appendChild(t);const i=document.createElement("div");i.className="gifapi-nav-flex gifapi-search-bar",t.appendChild(i),this.cancelButton=document.createElement("span"),this.cancelButton.className="icon icon-cross2 gifapi-cancel bodyTextTheme",this.cancelButton.style.width="unset",i.appendChild(this.cancelButton);const a=document.createElement("form");a.action=".",i.appendChild(a),this.gifSearchInput=document.createElement("input"),this.gifSearchInput.className="gif-search-input form-control",this.gifSearchInput.placeholder="search GIPHY",this.gifSearchInput.type="search",this.gifSearchInput.onkeydown=({key:e,target:t})=>{"Enter"===e&&(this.search(),t.blur())},this.gifSearchInput.oninput=({target:e})=>{this.clearSearch.style.display=e.value?"block":"none"},this.setSearchBarStyle(),a.appendChild(this.gifSearchInput);const s=document.createElement("i");s.className="glyphicon glyphicon-search search-icon",a.appendChild(s),this.clearSearch=document.createElement("button"),this.clearSearch.className="search-clear",this.clearSearch.style.display="none",this.clearSearch.onclick=({target:e})=>{this.gifSearchInput.value="",e.style.display="none"},a.appendChild(this.clearSearch);const n=document.createElement("i");n.className="glyphicon glyphicon-minus-sign",this.clearSearch.appendChild(n),this.gifResults=document.createElement("div"),this.gifResults.className="gif-results",this.gifResults.addEventListener("scroll",()=>{this.lazyLoad.processLazyImages(),this.loadPage()},!1),e.appendChild(this.gifResults);const l=document.createElement("div");l.className="powered-by-giphy",e.appendChild(l);const o=document.createElement("img");o.src="".concat(window._appRoot,"media/PoweredByGiphy.png"),l.appendChild(o),0<=window.location.pathname.indexOf("pluginTester")?(this.gifDialog.style.height=document.getElementById("app").offsetHeight+"px",this.gifDialog.style.position="absolute",document.getElementById("app").appendChild(this.gifDialog),document.getElementById("app").appendChild(this.backdrop)):(this.gifDialog.style.height="100vh",this.gifDialog.style.maxHeight="100vh",document.body.appendChild(this.gifDialog),document.body.appendChild(this.backdrop)),this.initialized=!0},setSearchBarStyle(){var e=(e,t)=>{if(!e&&t&&t.data&&t.data.colors){var{backgroundColor:i,bodyText:e}=t.data.colors,t=tinycolor(i).isDark()?"lighten":"darken",i=tinycolor(i)[t](10).toString(),t=tinycolor(e)[t](10).toString();const a=document.createElement("style");a.innerHTML="\n\t\t\t\t.gif-search-input::placeholder,\n\t\t\t\t.search-icon {\n\t\t\t\t\tcolor: ".concat(t," !important;\n\t\t\t\t}\n\t\t\t\t.gif-search-input {\n\t\t\t\t\tcolor: ").concat(t,";\n\t\t\t\t\tbackground: ").concat(i,"\n\t\t\t\t}\n\t\t\t"),this.gifDialog.appendChild(a)}};if(PluginAPI.appTheme)return e(null,{data:PluginAPI.appTheme});const t=new DatastoreAPI(window.appContext.currentApp.appId,"appearance","appearance",window.appContext.liveMode);t.get({tag:"appearance",withDynamicData:!1},e)},showGifDialog(e,t){this.options=e=e||{multiple:!1,rating:"g"},this.initialized||this.init(),this.gifResults.innerHTML="",this.gifSearchInput.value="";this.results=[],this.handleClose=e=>{t(null,{cancelled:e,results:this.results}),this.handleClose=null,this.pages=[],this.results=[],this.options={},this.timer=setTimeout(()=>{this.gifDialog.classList.remove("active"),this.backdrop.classList.remove("active"),setTimeout(()=>{this.gifDialog.classList.contains("active")||(this.gifResults.innerHTML="",this.gifSearchInput.value="",this.gifDialog.style.display="none",this.init())},500)},150)},this.cancelButton.onclick=()=>this.handleClose(!0),this.backdrop.onclick=()=>this.handleClose(!0),this.timer&&(clearTimeout(this.timer),this.timer=null),this.gifDialog.style.display="flex",setTimeout(()=>{this.gifDialog.classList.add("active"),this.backdrop.classList.add("active")},100),this.gifDialog.addEventListener("transitionend",()=>this.getTrending(),{once:!0})},createRequestUrl(l){if(l){let{key:e,endpoint:t,query:i,limit:a,offset:s,rating:n}=l;l="https://api.giphy.com/v1/gifs/".concat(t,"?api_key=").concat(e);return a="&limit=".concat(a||120),s="&offset=".concat(s||0),n="&rating=".concat(n||"g"),i=i&&"search"===t?"&q=".concat(i):"","".concat(l).concat(a).concat(s).concat(n).concat(i)}},createProxyUrl:e=>"https://proxy.buildfire.com/hop?url=".concat(encodeURIComponent(e)),get(e,t,i){if(!e||!["trending","search","random"].includes(e))return i(new Error("invalid endpoint"),null);"function"==typeof t&&(i=i||t,t={});var{limit:a,offset:s,rating:n,query:t}=t||{},t={key:this.apiKey,endpoint:e,limit:a,offset:s,rating:n,query:t},t=this.createRequestUrl(t),t=this.createProxyUrl(t);fetch(t).then(e=>e.json()).then(e=>this.digest(e,i)).catch(e=>{i?i(e,null):console.error(e)})},digest(e,t){const i=this.convertGifs(e.data);if(t)return t(null,i);this.gifResults.innerHTML="",this.pages=[];const a=[];for(;i.length;){let e=[];e=24<i.length?i.splice(0,24):i.splice(0,i.length),a.push(e)}this.pages=a,this.loadPage()},convertGifs(e){return e?(e=e.id?[e]:e).map(e=>{var{id:t,title:i,rating:a,user:s}=e,{preview:n,preview_gif:l,original:o,downsized_large:c,downsized_medium:r,downsized_small:h,downsized_still:d,original_still:g,fixed_height:e}=e.images;return{id:t,title:i,rating:a,user:s,images:{preview:n,preview_gif:l,original:o,downsized_large:c,downsized_medium:r,downsized_small:h,downsized_still:d,original_still:g,fixed_height:e}}}):[]},loadPage(){var e,t,i;this.pages.length<1||({scrollHeight:e,scrollTop:t,clientHeight:i}=this.gifResults,e-t<=1.75*i&&(i=this.pages.splice(0,1)[0],this.renderPage(i)))},renderPage(e){if(e&&e.length){bfUtils.isIOS;e.forEach(t=>{e=(e=t).images.preview_gif&&e.images.preview_gif.url?e.images.preview_gif.url:e.images.downsized_medium&&e.images.downsized_medium.url?e.images.downsized_medium.url:e.images.original&&e.images.original.url?e.images.original.url:null;if(e){const i=document.createElement("div");i.className="gif-container lazy-img",i.id="gif_".concat(t.id),i.setAttribute("data-src",e),i.onclick=e=>this.selectGif(e,t);var e=document.createElement("span");i.appendChild(e);const a=document.createElement("div");a.className="gif-thumbnail",i.appendChild(a),this.gifResults.appendChild(i)}}),this.lazyLoad.processLazyImages()}},selectGif(e,t){e.target.classList.add("selected"),this.results=[t],this.handleClose&&this.handleClose(!1)},getTrending(){this.get("trending",this.options)},search(){gifAPI.options.query=gifAPI.gifSearchInput.value||"",gifAPI.options.query?gifAPI.get("search",gifAPI.options):gifAPI.get("trending",gifAPI.options)},lazyLoad:{process(e){if(e.hasAttribute("data-src")){const t=e.querySelectorAll(".gif-thumbnail")[0];t&&(t.style.backgroundImage=this.isInViewport(e)?"url(".concat(e.getAttribute("data-src"),")"):"unset")}},isInViewport(e){var t=window["innerHeight"],e=e.getBoundingClientRect()["top"];return e>t*-Math.abs(1.25)&&e<1.25*t},processLazyImages(){document.querySelectorAll(".lazy-img").forEach(e=>this.process(e))}}};setTimeout(function(){gifAPI.initialized||gifAPI.init()},5e3);
"use strict";var bookmarkAPI={add(n,t){var e=(window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin:window.postMaster.launcherPluginAPI.context).instanceId,a=authAPI.getCurrentUser(),a=a?a._id:"guest",a="".concat(a,".bookmarks");const o=localStorage.getItem(a)?JSON.parse(localStorage.getItem(a)):[];n.id=n.id||n.title,n.pluginInstanceId=e;e=o.findIndex(t=>{var e=t.id===n.id,t=t.pluginInstanceId===n.pluginInstanceId;return e&&t});0<=e?o[e]=n:o.push(n),localStorage.setItem(a,JSON.stringify(o)),t(null,n)},delete(e,t){var n=authAPI.getCurrentUser(),a=n?n._id:"guest",n="".concat(a,".bookmarks");const o=localStorage.getItem(n)?JSON.parse(localStorage.getItem(n)):[];a=o.findIndex(t=>t.id===e);0<=a&&o.splice(a,1),localStorage.setItem(n,JSON.stringify(o)),t&&t(null,o)},deleteFromPlugin(e,t){var n=authAPI.getCurrentUser(),a=n?n._id:"guest",n="".concat(a,".bookmarks");const o=localStorage.getItem(n)?JSON.parse(localStorage.getItem(n)):[];a=o.findIndex(t=>t.id===e);0<=a&&o.splice(a,1),localStorage.setItem(n,JSON.stringify(o)),t(null,null)},getAll(t){var e=authAPI.getCurrentUser(),e=e?e._id:"guest",e="".concat(e,".bookmarks");t(null,localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):[])},getAllFromPlugin(t,e){var n=authAPI.getCurrentUser(),n=n?n._id:"guest";const a=(window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin:window.postMaster.launcherPluginAPI.context).instanceId;n="".concat(n,".bookmarks");const o=localStorage.getItem(n)?JSON.parse(localStorage.getItem(n)):[];e(null,o.filter(t=>t.pluginInstanceId===a))}};
"use strict";var notesAPI={notesCtrlScope:null,_getUserDataContext(t,n){this._getUser(t=>{var e=t._id,t=window.currentAppId||window.appContext.currentApp.appId,t=new UserDatastoreAPI(t,"sideMenu",1,!0,e);n(null,{userDatastore:t,userToken:e})})},openDialog(e,n){this._getUser(t=>{e?(this.notesCtrlScope.tempNoteData=e,this.notesCtrlScope.instanceId=(window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin:window.postMaster.launcherPluginAPI.context).instanceId,this.notesCtrlScope.pluginOpen=!0,this.notesCtrlScope.callback=n):this.notesCtrlScope.pluginOpen=!1,this._showModal()})},getByItemId(n,i){let o=this;(n=n||{}).itemId?this.getAllFromItem(n.itemId,function(t,e){t?i(t):(t=o.formatNotes(e),t={itemId:n.itemId,hasNotes:e&&0<e.length,noteCount:e?e.length:0,notes:t},i(null,t))}):i("invalid params, missing itemId")},formatNotes(t){let e=[];return t&&0<t.length&&t.forEach(t=>{e.push({id:t.id,text:t.noteText,timeIndex:t.timeIndex})}),e},_showModal(){this.notesCtrlScope.notesShown=!0,notesAPI.notesCtrlScope.$$phase||notesAPI.notesCtrlScope.$apply()},add(o,a){var t={title:o.title||"New Note",hideUserData:!0,placeholder:"Note Text",saveText:"Save"};window.inputAPI.showTextDialog(t,(t,e)=>{if(t)throw t;o.noteText=e.cancelled?"":e.results[0].textValue,""!==o.noteText&&(o.id=Date.now(),this.notesCtrlScope.notes.push({id:o.id,noteText:o.noteText,timeIndex:o.timeIndex}),this.notesCtrlScope.$$phase||this.notesCtrlScope.$apply(),this._getUser(i=>{this._getUserData((t,e)=>{if(t)throw t;var n;o.userToken=i._id,e.id?({pluginIndex:n,itemIndex:t}=this._getIndex(e,o.instanceId,o.itemId),-1<n?-1<t?this._addNote(e,o,n,t,a):this._addItem(e,o,n,a):this._initPluginData(e,o,a)):this._initUserData(o,a)})}))})},_addNote(t,e,n,i,o){var{id:a,noteText:s,timeIndex:e}=e;t.data[n].content[i].notes.push({id:a,noteText:s,timeIndex:e}),this._updatePluginData(t,o)},_addItem(t,e,n,i){var{title:o,itemId:a,imageUrl:s,payload:d,noteText:r,timeIndex:l,id:e}=e;t.data[n].content.push({title:o,itemId:a,imageUrl:s,payload:d,notes:[{id:e,noteText:r,timeIndex:l}]}),this._updatePluginData(t,i)},edit(e,s,d,r){this._getUserData((t,n)=>{if(t)throw t;const{pluginIndex:i,itemIndex:o,noteIndex:a}=this._getIndex(n,d,s,e);t={title:n.data[i].content[o].title||"New Note",hideUserData:!0,placeholder:"",saveText:"Save",prefill:n.data[i].content[o].notes[a].noteText};window.inputAPI.showTextDialog(t,(t,e)=>{if(t)throw t;e.cancelled||""===e.results[0].textValue||(n.data[i].content[o].notes[a].noteText=e.results[0].textValue,this._updatePluginData(n,r))})})},delete(i,o,a,s){this._getUserData((t,e)=>{if(t)throw t;var{pluginIndex:n,itemIndex:t}=this._getIndex(e,a,o);e.data[n].content[t].notes=e.data[n].content[t].notes.filter(t=>t.id!=i),0===e.data[n].content[t].notes.length&&(e.data[n].content.splice(t,1),0===e.data[n].content.length&&e.data.splice(n,1)),this._updatePluginData(e,s)})},getAllFromItem(i,o){this._getUserData((t,e)=>{if(!t&&e.id&&e.data.length){var t=(window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin:window.postMaster.launcherPluginAPI.context).instanceId,t=this._getIndex(e,t)["pluginIndex"];const n=e.data[t];t=n.content.find(t=>t.itemId===i);o(null,t?t.notes:[])}else o(null,[])})},getAll(n){this._getUserData((t,e)=>{if(t)throw t;n(null,e.data)})},loadNote(g,I,h,x){this._getUserData((t,e)=>{if(t)throw t;const{pluginId:n,instanceId:i,title:o,folderName:a}=h;var{pluginIndex:s,itemIndex:d,noteIndex:r}=this._getIndex(e,i,I,g),t=e.data[s].content[d],r=!!g&&e.data[s].content[d].notes[r];let l=!1;window.appContext&&window.appContext.currentPlugin&&document.getElementById(window.appContext.currentPlugin.pluginAPI.iFrameId)&&window.appContext.currentPlugin.instanceId===i&&(l=!0);const p=window.postMaster.launcherPluginAPI["navigation"];let u="";if(t.payload){const c=t["payload"];r&&(c.timeIndex=r.timeIndex);t=JSON.stringify(c),t="".concat("&dld=").concat(t);u=t}else{let t;t=r?JSON.stringify({link:I,timeIndex:r.timeIndex}):JSON.stringify({link:I}),u="&dld=".concat(t)}"function"!=typeof x&&(x=Function.prototype),l?p.navigateHome({},()=>{p.navigateTo({pluginId:n,instanceId:i,title:o,folderName:a,queryString:u},x)}):p.navigateTo({pluginId:n,instanceId:i,title:o,folderName:a,queryString:u},x)})},_getUserData(n){this._getUserDataContext({},(t,e)=>{if(t)throw t;e.userDatastore.get("notesDB.18",(t,e)=>{n(t,e)})})},_initUserData(t,i){const{id:o,title:a,noteText:s,timeIndex:d,instanceId:r,itemId:l,imageUrl:p,payload:u}=t;this._getUserDataContext({},(t,e)=>{if(t)throw t;const n={tag:"notesDB.18",userToken:e.userToken,checkDuplicate:!0};n.obj=[{instanceId:r,content:[{title:a,itemId:l,imageUrl:p,payload:u,notes:[{id:o,noteText:s,timeIndex:d}]}]}],e.userDatastore.insert(n,(t,e)=>{if(t)throw this.notesCtrlScope.notes=JSON.parse(JSON.stringify(this.notesCtrlScope.notesCopy)),t;this.notesCtrlScope.notesCopy=JSON.parse(JSON.stringify(this.notesCtrlScope.notes)),i(e)})})},_initPluginData(t,e,n){var{id:i,title:o,noteText:a,timeIndex:s,instanceId:d,itemId:r,imageUrl:l,payload:e}=e;t.data.push({instanceId:d,content:[{title:o,itemId:r,imageUrl:l,payload:e,notes:[{id:i,noteText:a,timeIndex:s}]}]}),this._updatePluginData(t,n)},_updatePluginData(i,o){this._getUserDataContext({},(t,e)=>{if(t)throw t;const n={id:i.id,tag:"notesDB.18",userToken:e.userToken};n.obj=i.data,e.userDatastore.update(n,(t,e)=>{if(t)throw this.notesCtrlScope.notes=JSON.parse(JSON.stringify(this.notesCtrlScope.notesCopy)),t;this.notesCtrlScope.notesCopy=JSON.parse(JSON.stringify(this.notesCtrlScope.notes)),o(e)})})},_getUser(n){var t=window.authAPI.getCurrentUser();t?n(t):authAPI.login({showMenu:!1},(t,e)=>{!t&&e&&n(e)})},_getIndex(t,e,n,i){let o={};var a=t.data.findIndex(t=>t.instanceId===e);if((o.pluginIndex=a)<0||!n)return o;var s=t.data[a].content.findIndex(t=>t.itemId===n);if((o.itemIndex=s)<0||!i)return o;s=t.data[a].content[s].notes.findIndex(t=>t.id===i);return o.noteIndex=s,o},seekTo(a,s,d,r){this._getUserData((t,e)=>{if(t)throw t;var{pluginIndex:n,itemIndex:i,noteIndex:t}=this._getIndex(e,d,s,a),t=!!a&&e.data[n].content[i].notes[t];if(t){const o=window.appContext&&window.appContext.currentPlugin?window.appContext.currentPlugin.pluginAPI:window.postMaster.launcherPluginAPI;o.sendMessage(null,new Packet(null,"notes.triggerOnSeekTo",{time:t.timeIndex})),r()}})}};
"use strict";$app.controller("authCtrl",["$rootScope","$scope","Upload","$sce","StringResource",function(a,l,i,s,n){l._appRoot=window._appRoot,l.registerClick=!1;document.addEventListener("appThemeOnUpdate",function(){AppearanceAPI.prototype.getAppearance(null,function(e,o){return e?console.error(e):void(o&&l.setThemeType(o))});const e=document.querySelector(".form.registration");var o,n,t=e.querySelectorAll("input[type=date]");o=t,n=tinycolor(PluginAPI.appTheme.colors.backgroundColor).isDark(),o.forEach(e=>{n?e.classList.add("inverted-input"):e.classList.remove("inverted-input")})},!1);var c,d=void 0;window.appContext.currentApp&&window.appContext.currentApp.config&&(void 0===window.appContext.currentApp.config.userLoginDomainSettings?"enterprise"==window.appContext.currentApp.config.type&&(d="enabled"):d=window.appContext.currentApp.config.userLoginDomainSettings);var u="Password must be at least 8 characters long, contains an upper case letter, a lower case letter, a number and a symbol.";l.loginTranslation="Log In",l.registerTranslation="Register",l.emailDoesNotExistTxt="Email does not exist in system.",l.updateLoginTranslations=function(e){e.passwordAtLeast8ComplexChars&&(u=e.passwordAtLeast8ComplexChars),e.loginTranslation&&(l.loginTranslation=e.loginTranslation),e.registerTranslation&&(l.registerTranslation=e.registerTranslation),e.emailDoesNotExist&&(l.emailDoesNotExistTxt=e.emailDoesNotExist)},n.getData().then(function(e){e&&(l.loginButtonTitle=e.logIn,l.changedPasswordSuccessfully=e.changedPasswordSuccessfully||"Password Changed Successfully",l.changePasswordAtLeast8ComplexChars=e.changePasswordAtLeast8ComplexChars||"Password must be at least 8 characters long, contains an upper case letter, a lower case letter, a number and a symbol.",l.changePasswordError=e.changePasswordError||"Sorry, we couldn't change your password, please try later.",l.secretCodeInformModal=e.secretCodeInformModal||"We are going to send you a secret code through your email in order to complete changing password process",l.secretCodeError=e.secretCodeError||"Sorry, we have faced a problem while sending you a secret code")});function t(e,n,o){if(e&&e.active&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)){const i=o||(PluginAPI&&PluginAPI.appTheme&&PluginAPI.appTheme.colors?PluginAPI.appTheme.colors:null);customRegistration.getFields({customRegistrationSettings:e,refreshUI:function(){l.$$phase||l.$apply()}},function(e,o){if(o){l.showCustomRegistration=!0;let t=[],s=null,r=null;termsAPI.getGdprLinks({openGDPRContent:function(e){l.loadGDPR(e.key)}},function(e,o){return e?console.error(e):(t=o.gdprLinks,l.registrationGdprLinks=t,s=o.customTermsAndConditions.key,r=o.customPrivacyPolicy.key,void(s&&r?l.shouldDisableRegisterButton=!1:l.shouldDisableRegisterButton=!0))}),l.customRegistrationSubmit=function(){o.fetch({validateFields:!0},function(e,o){let n=!1;t&&t.forEach(function(e){e.validate(e.value),e.error&&(n=!0)}),e||n||(l.uploadFile=o.profilePictureFile,o.customTermsAndConditionsKey=s,o.customPrivacyPolicyKey=r,l.register(o))})},o.fields&&o.fields.forEach(function(e){e&&"date"===e.type&&i&&i.backgroundColor&&tinycolor(i.backgroundColor).isDark()&&(e.class="inverted-input")}),l.customRegistrationFields=o.fields,l.customRegistrationRules=o.rules,l.initCustomRegistration=function(){o.initializers.forEach(function(e){e()})},n&&n(null,null),l.$$phase||l.$apply()}})}else{let t=[],s=null,r=null;termsAPI.getGdprLinks({openGDPRContent:function(e){l.loadGDPR(e.key)}},function(e,o){return e?console.error(e):(t=o.gdprLinks,l.registrationGdprLinks=t,void(o.customTermsAndConditions.key&&o.customPrivacyPolicy.key?(s=o.customTermsAndConditions.key,r=o.customPrivacyPolicy.key,l.shouldDisableRegisterButton=!1):l.shouldDisableRegisterButton=!0))}),l.registerUser=function(){let e={},o=!(l.registerClick=!0);var n;t&&t.forEach(function(e){e.validate(e.value),e.error&&(o=!0)}),l.frmAuthRegister.$invalid||o||(window.validator.validatePassword(l.password)?(e.customTermsAndConditionsKey=s,e.customPrivacyPolicyKey=r,l.register(e),l.registerClick=!1):(n={data:{title:" ",body:u,disableCancel:!0}},window.openDialog(n,function(){})))},l.showCustomRegistration=!1,l.$$phase||l.$apply()}}l.checkIfDisable=function(e){let o=!1;e&&e.forEach(function(e){e.value||"termsAndConditions"===e.name||"privacyPolicy"===e.name||(o=!0)}),l.shouldDisableRegisterButton=o},l.editVisibilityOptions=function(n){customRegistration.editVisibilityOptions({field:n},(e,o)=>e?console.error(e):(n.visibilityChoice=o.text.toLowerCase(),void(l.$$phase||l.$apply())))},window.authAPI.authCtrlScope=l,a.allowCancel=void 0===a.allowCancel||a.allowCancel,a.authShown=!1,l.secretCodeProvider=null,l.refWindow=null,l.errors={},l.msgSuccess=null,l.enablePasswordBasedAuth=!0,l.password="",l.userObj={username:"",email:""},l.changePassword={oldPassword:"",newPassword:"",reTypedPassword:"",secretCode:""},l.loginCallback=null;var r="",p="",g="",w="",h="",m="",f="",C="",P="",y=window.appContext.currentApp.appId;function o(e){e&&(e=window.loginUI.convertToCss(e)||"*{}",localStorage.loginUI=e);var o=e||localStorage.getItem("loginUI_"+y),n=document.getElementById("custom-login-ui");n||(e=document.getElementsByClassName("login-holder")[0],(n=document.createElement("style")).id="custom-login-ui",e.appendChild(n)),n.innerHTML=o}function b(e){return"boolean"!=typeof e||e}function S(e,s){e?console.error(e):(l.authLoginProviders=[],s&&s.data&&0<Object.keys(s.data).length?("SSOLogin"==s.data.signOnStrategy&&(l.SSOLogin=!0,P=s.data.contentType,p="application/x-www-form-urlencoded"==P||"multipart/form-data"==P?(r=window.siteConfig.endPoints.hopHost+"?url="+s.data.accessTokenAPI,window.siteConfig.endPoints.hopHost+"?url="+s.data.loginAPI):(r=s.data.accessTokenAPI,s.data.loginAPI),l.signOnStrategy=m=s.data.signOnStrategy,l.resetPasswordAPI=g=s.data.resetPasswordAPI,w=s.data.resetPasswordMessage,l.registerUrl=h=s.data.registerUrl,f=s.data.clientId,C=s.data.clientSecret,setInterval(v,9e5)),n.getData().then(function(o){if(o&&(l.appleSignIn=o.appleSignIn||"Continue with Apple",l.facebookSignIn=o.facebookSignIn||"Continue with Facebook",l.twitterSignIn=o.twitterSignIn||"Continue with Twitter",l.googleSignIn=o.googleSignIn||"Continue with Google",l.appleRegistration=o.appleRegistration||"Continue with Apple",l.facebookRegistration=o.facebookRegistration||"Continue with Facebook",l.twitterRegistration=o.twitterRegistration||"Continue with Twitter",l.googleRegistration=o.googleRegistration||"Continue with Google"),s.data.authLoginProviders)l.enablePasswordBasedAuth=b(s.data.enablePasswordBasedAuth),l.authLoginProviders=s.data.authLoginProviders.filter(e=>e.isActive),l.authLoginProviders.forEach(e=>{"oauth2"===e.authType?(e.buttonIcon?"image"===e.buttonIcon.type?e.darkButtonImageUrl=e.lightButtonImageUrl=imageTools.cropImage(e.buttonIcon.value,{size:"xxs",aspect:"1:1"}):(e.buttonIconValue=e.buttonIcon.value+(e.buttonTextColor?"":" bodyTextTheme"),e.buttonIconStyles=(e.buttonTextColor?"color: "+e.buttonTextColor+" !important; ":"")+"width: 1.75em; margin: 0.625em; flex: none;"):e.buttonIconStyles=(e.buttonTextColor?"color: "+e.buttonTextColor+" !important; ":"")+"width: 1.75em; margin: 0.625em; flex: none;",e.buttonColor&&(e.buttonBackground={},"gradient"===e.buttonColor.colorType&&(e.buttonBackground.background=e.buttonColor.gradient&&e.buttonColor.gradient.backgroundCSSValue),"solid"===e.buttonColor.colorType&&(e.buttonBackground.background=e.buttonColor.solid&&e.buttonColor.solid.color))):I(e)});else{let e=!0;var n=b(s.data.enableFacebook),t=b(s.data.enableTwitter),o=!!s.data.enableGoogle;l.enablePasswordBasedAuth=b(s.data.enablePasswordBasedAuth),e=!!(n||t||o||void 0!==s.data.enableApple)&&b(s.data.enableApple),e&&l.authLoginProviders.push(I({providerId:"apple",authType:"social"})),n&&l.authLoginProviders.push(I({providerId:"facebook",authType:"social"})),t&&l.authLoginProviders.push(I({providerId:"twitter",authType:"social"})),o&&l.authLoginProviders.push(I({providerId:"google",authType:"social"}))}}),m=s.data.signOnStrategy,"enabled"==d&&(c=s.data.domain),l.emailInputType=c?"text":"email"):n.getData().then(function(e){e&&(l.appleSignIn=e.appleSignIn||"Continue with Apple",l.facebookSignIn=e.facebookSignIn||"Continue with Facebook",l.twitterSignIn=e.twitterSignIn||"Continue with Twitter",l.googleSignIn=e.googleSignIn||"Continue with Google",l.appleRegistration=e.appleRegistration||"Continue with Apple",l.facebookRegistration=e.facebookRegistration||"Continue with Facebook",l.twitterRegistration=e.twitterRegistration||"Continue with Twitter",l.googleRegistration=e.googleRegistration||"Continue with Google"),l.enablePasswordBasedAuth=!0,l.authLoginProviders.push(I({providerId:"apple",authType:"social"})),l.authLoginProviders.push(I({providerId:"twitter",authType:"social"})),l.authLoginProviders.push(I({providerId:"facebook",authType:"social"})),l.authLoginProviders.push(I({providerId:"google",authType:"social"}))}))}function I(e){switch(e.providerId){case"apple":return e.classes="btn-apple",e.loginButtonName=l.appleSignIn,e.registerButtonName=l.appleRegistration,e.darkButtonImageUrl=_appRoot+"media/logo_apple_b.png",e.lightButtonImageUrl=_appRoot+"media/logo_apple_w.png",e;case"facebook":return e.classes="btn-fb",e.loginButtonName=l.facebookSignIn,e.registerButtonName=l.facebookRegistration,e.darkButtonImageUrl=e.lightButtonImageUrl=_appRoot+"media/logo_facebook.png",e;case"twitter":return e.classes="btn-twitter",e.loginButtonName=l.twitterSignIn,e.registerButtonName=l.twitterRegistration,e.darkButtonImageUrl=e.lightButtonImageUrl=_appRoot+"media/logo_twitter.png",e;case"google":return e.classes="btn-google",e.loginButtonName=l.googleSignIn,e.registerButtonName=l.googleRegistration,e.darkButtonImageUrl=e.lightButtonImageUrl=_appRoot+"media/logo_google.png",e}}function v(){var e,o,n=JSON.parse(window.localStorage.getItem("SSO_USER"));n&&((new Date).getTime()/1e3>n.ssoExpiresAt&&(a.allowCancel=!1,a.showMenu=!1,l.showLogin(function(e,o){o&&authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,l.hideLogin(),l.$$phase||l.$apply()})),o=r,"multipart/form-data"==P||"application/x-www-form-urlencoded"==P?e={headers:{Authorization:"Bearer "+n.ssoUserToken,"Content-Type":"application/json"}}:(e={headers:{"Content-Type":"application/x-www-form-urlencoded"}},o=r+"?access_token="+n.ssoUserToken),window.bfUtils.http.get(o,e).success(function(e){console.log(e)}).error(function(e,o,n,t){a.allowCancel=!1,a.showMenu=!1,l.showLogin(function(e,o){authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,l.hideLogin(),l.$$phase||l.$apply()})}))}l.updateLoginCss=function(){o()},l.updateSSORegistrationFormStatus=function(e){/htt(p|ps):\/\//g.test(R.src)&&(window.spinner&&window.spinner.hide(),l.ssoRegistrationFormStatus=e,l.$$phase||l.$apply())},o(),l.SSOLogin=!1,authAPI.getAuthSettings(null,S),l.closeLogin=function(){l.loginCallback&&l.loginCallback(),a.allowCancel?l.hideLogin():k()},l.reset=function(){l.errors={},l.showProgressMessage=!1,l.allowToRegister=!1,l.uploadFile=null,l.changePassword.oldPassword=null,l.changePassword.newPassword=null,l.changePassword.reTypedPassword=null,l.changePassword.secretCode=null,l.userObj.email=null,l.userObj.username=null,l.password=null,l.secretCode=null,l.newPassword=null,l.confirmPassword=null,l.msgSuccess=null,l.firstName=null,l.lastName=null,l.secretCodeProvider=null,l.refWindow=null,l.registrationGdprLinks&&l.registrationGdprLinks.forEach(function(e){e.value=void 0,e.error=void 0}),l.customRegistrationFields&&l.customRegistrationFields.forEach(function(e){e.value=void 0,e.error=void 0,"date"===e.type&&tinycolor(PluginAPI.appTheme.colors.backgroundColor).isDark()?e.class="inverted-input":e.class=e.class?e.class.replace("inverted-input",""):""})};var A=function(){l.successShown=!1,l.registrationShown=!1,l.loginShown=!1,l.forgetPasswordShown=!1,l.resetPasswordShown=!1,l.changePasswordShown=!1,(R=R||document.getElementById("frmExternalRegistrationForm")).src="",l.externalRegister=!1,l.ssoRegistrationFormStatus=null};A(),l.openTermsAndConditions=function(){return window.open("https://learn.appdocumentation.com/en/collections/1618556-terms-conditions-and-privacy-policy","_system"),!1},l.hideLogin=function(){l.reset(),A(),a.authShown=!1,l.loginCallback=null};var R=document.getElementById("frmExternalRegistrationForm");function k(){l.reset(),A(),a.allowCancel=!l.loginOptions||!1!==l.loginOptions.allowCancel,a.showMenuOnAuth=!l.loginOptions||!1!==l.loginOptions.showMenu,l.loginShown=!0,l.showAuth(),l.$$phase||l.$apply()}function U(){let o={};if(l.customRegistrationFields&&l.customRegistrationFields.forEach(function(e){"password"===e.type&&(o=e.messages)}),l.customRegistrationRules&&"simple"===l.customRegistrationRules.passwordStrength){if(!window.validator.validatePassword(l.changePassword.newPassword,{simplePasswordValidation:!0}))return l.errors.newPassword=!0,void(l.newPasswordError=o.invalidPasswordSimpleRules)}else if(!window.validator.validatePassword(l.changePassword.newPassword))return l.errors.newPassword=!0,void(l.newPasswordError=o.invalidPasswordRules||l.changePasswordAtLeast8ComplexChars);return 1}function T(e,s){var o=(o=JSON.parse(window.localStorage.getItem("SSO_USER")))||{};if("string"==typeof e)try{e=JSON.parse(e)}catch(e){console.warn("Unexpected parsing issue",e)}e&&e.access_token?o.ssoUserToken=e.access_token:o.ssoUserToken=e.replace(/["]+/g,""),e&&e.expires_in&&e.issued_at?o.ssoExpiresAt=e.issued_at+e.expires_in:o.ssoExpiresAt=1902608081e3,window.localStorage.setItem("SSO_USER",JSON.stringify(o));var n=null,n="undefined"==typeof push?{}:push,e=r.replace(window.siteConfig.endPoints.hopHost+"?url=",""),n={accessToken:o.ssoUserToken,accessTokenAPI:e,deviceId:n.deviceId,osType:n.platform?n.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId,loginProviderType:"SSO",email:l.userObj.username,contentType:P},n=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/loginSSO",params:n}));window.bfUtils.http.jsonp(n,{bypassInterceptorForStatus:404}).success(function(e){var o;e&&e.result?(authAPI._setCurrentUser(e.result),a.$broadcast("loginSuccessfully",e.result),s(null,e.result),bfUtils.isEmulatorCP&&cpSync.SSO.log("Succeed...")):(o=null,e&&e.error?(console.error(e.error),o=e.error,bfUtils.isEmulatorCP&&cpSync.SSO.log(e.error)):(e=o="Could not retrieve profile data",console.error(e),bfUtils.isEmulatorCP&&cpSync.SSO.log(e)),s&&s(o,null))}).error(function(e,o,n,t){console.error(e),s&&s(e,null),bfUtils.isEmulatorCP&&cpSync.SSO.log("Error while testing SSO Login..")})}l.showRegistration=function(e,t){l.scrolling=bfUtils.isIOS?"no":"auto","SSOLogin"==m&&h?(window.spinner.show(),l.externalRegister=!0,l.ssoRegistrationFormStatus="loading",(R=R||document.getElementById("frmExternalRegistrationForm")).src=h,window.addEventListener("message",function e(o){if(o&&-1<h.indexOf(o.origin)&&o.data){var n=null;try{n=JSON.parse(o.data)}catch(e){}n&&("success"===n.status&&(n.user&&n.user.username&&(l.userObj.username=n.user.username),window.spinner&&window.spinner.show&&window.spinner.show(!0),T(n.user,function(e,o){e?(console.error(e),window.openDialog({data:{title:" ",body:"Invalid Login",disableCancel:!0}},function(){}),t&&t(e,null)):(t=t||l.loginCallback)&&t(null,o),window.spinner&&window.spinner.hide&&window.spinner.hide(!0)})),window.removeEventListener("message",e,!1),R.src="",l.externalRegister=!1,l.ssoRegistrationFormStatus=null,l.$$phase||l.$apply())}},!1)):(l.reset(),A(),l.registrationShown=!0,l.showAuth())},l.showAuth=function(){a.authShown||(a.authShown=!0,AppearanceAPI.prototype.sideMenu.reset({appId:window.appContext.currentApp.appId}))},l.showForgetPassword=function(){l.reset(),A(),l.forgetPasswordShown=!0,l.showAuth()},l.showSuccess=function(e){A(),l.msgSuccess=e,l.successShown=!0},l.showResetPassword=function(e){l.reset(),A(),l.resetPasswordShown=!0,l.showAuth(),l.loginCallback=e},l.updateLogin=function(e){bfUtils.isEmulatorCP&&a.accessCodeVisible&&(a.accessCodeVisible=!1),e&&"SSOForgetPassword"!=e&&o(e),l.loginCallback=function(e,o){if(e)return console.error(e);o&&(window.authAPI._setCurrentUser(o),window.authAPI.triggerOnLogin(o)),a.allowCancel=!0,a.showMenu=!0,l.hideLogin(),l.$$phase||l.$apply()},k(),e&&"SSOForgetPassword"==e&&(l.showForgetPassword(),l.$apply()),O()},l.updateRegistration=function(e){l.reset(),A(),e&&t(e,function(){l.initCustomRegistration()}),l.registrationShown=!0,l.showAuth(),l.$$phase||l.$apply()},l.updateLoginAuth=function(e){l.enablePasswordBasedAuth=b(e.enablePasswordBasedAuth),e.domain&&"enabled"==d&&(c=e.domain),l.authLoginProviders=null,l.$$phase||l.$apply(),S(null,{data:e}),l.$$phase||l.$apply()},l.returnToLogin=function(){l.showLogin(l.loginCallback)},l.showLogin=function(e){l.loginCallback=e,k()},l.resetPassword=function(){var e;l.newPassword==l.confirmPassword&&(e={email:l.email,secretCode:l.secretCode,password:l.newPassword,passwordStrength:l.customRegistrationRules?l.customRegistrationRules.passwordStrength:null,externalAppId:window.currentAppId},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/changePassword",params:e})),window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){var o;e&&e.result?(l.showSuccess("Password reset successfully"),o={data:{title:" ",body:"Password reset successfully",disableCancel:!0}},window.openDialog(o,function(){})):e&&e.error&&(o={data:{title:" ",body:e.error.message,disableCancel:!0}},window.openDialog(o,function(){}),console.error(e.error))}).error(function(e,o,n,t){console.error(e),callback&&callback(e,null)}))},l.forgotPassword=function(e){var o;"SSOLogin"!=m?(o={email:l.email,sendSecretCode:!0,externalAppId:window.currentAppId},e&&(o.email=e.email),o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/forgotPassword",params:o})),window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(e){var o;e&&e.result?l.showResetPassword(l.loginCallback):(o={data:{title:" ",body:l.emailDoesNotExistTxt,disableCancel:!0}},window.openDialog(o,function(){}),e&&console.warn(e))}).error(function(e,o,n,t){console.error(e)})):(o=-1===g.indexOf("?")?"?":"&",o=g+o+"email="+l.email,window.bfUtils.http.get(o,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(){var e={data:{title:" ",body:w||"An email has been sent, please check your email.",disableCancel:!0}};window.openDialog(e,function(){l.showLogin(function(e,o){authAPI._setCurrentUser(o),authAPI.triggerOnLogin(o),a.allowCancel=!0,a.showMenu=!0,l.hideLogin(),l.$$phase||l.$apply()})}),cpSync.SSO.log("Succeed...")}).error(function(e,o,n,t){e&&console.error(e),bfUtils.isEmulatorCP&&(e||"0"!=o?(o&&cpSync.SSO.log("Error status:"+o),e&&cpSync.SSO.log("Error details:"+JSON.stringify(e))):cpSync.SSO.log("Error while testing SSO Login , CORS policy .."))}))},l.showChangePassword=function(){A(),l.changePasswordShown=!0,l.showAuth(),l.passwordChangeForm.showCurrentPasswordField=!0},l.changePasswordByCurrentPassword=function(){var e;U()&&(e=l.customRegistrationRules?l.customRegistrationRules.passwordStrength:null,authAPI.changePassword({oldPassword:l.changePassword.oldPassword,newPassword:l.changePassword.newPassword,passwordStrength:e},function(o,e){if(o){if("invalidPassword"==o.code)return l.errors.oldPassword=!0;{let e=l.changePasswordError;1310===o.code&&(e=o.message),richModal.display({title:"Change Password",richContent:"<p style='font-size:1.8rem'>".concat(e,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:"OK",handler:function(){}}})}}else{l.changePasswordShown=!1,a.authShown=!1,l.reset();let e=new ComponentUIAPI;e.showToastMessage({text:l.changedPasswordSuccessfully,hideDismiss:!0})}}))},l.showSecretCodeModal=function(){richModal.display({title:"Secret Code",richContent:"<p style='font-size:1.8rem'>".concat(l.secretCodeInformModal,"</p>"),showDismissButton:!0,forceShow:!0,action:{title:"OK",handler:function(){!function(){let o=authAPI.getCurrentUser(),e={email:o.email,sendSecretCode:!0,externalAppId:window.currentAppId},n={id:1,method:"users/forgotPassword",params:e},t=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(n));window.bfUtils.http.jsonp(t,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result){let e=new ComponentUIAPI;e.showToastMessage({text:"A secret code has been sent to ".concat(o.email),hideDismiss:!0})}}).error(function(e,o,n,t){richModal.display({title:"Secret Code",richContent:"<p style='font-size:1.8rem'>".concat(secretCodeError,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:"OK",handler:function(){}}}),console.error(e)})}(),l.passwordChangeForm.showCurrentPasswordField=!1}}})},l.changePasswordBySecretCode=function(){var e;U()&&(e={email:authAPI.getCurrentUser().email,secretCode:l.changePassword.secretCode,password:l.changePassword.newPassword,passwordStrength:l.customRegistrationRules?l.customRegistrationRules.passwordStrength:null,externalAppId:window.currentAppId},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/changePassword",params:e})),window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){if(e&&e.result){l.changePasswordShown=!1,a.authShown=!1,l.reset(),authAPI.logout();let e=new ComponentUIAPI;e.showToastMessage({text:l.changedPasswordSuccessfully,hideDismiss:!0})}else e&&e.error&&(l.errors.secretCode=!0,console.error(e.error))}).error(function(e,o,n,t){richModal.display({title:"Change Password",richContent:"<p style='font-size:1.8rem'>".concat(l.changePasswordError,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:"OK",handler:function(){}}}),console.error(e)}))},l.showBackLogin=function(){authAPI.login(null,function(){a.$broadcast("displayNav")})},l.login=function(e,t){var s,o,n,r,i;window.spinner&&window.spinner.show&&window.spinner.show(!0),"SSOLogin"!=m?(n=e,r=function(e,o){var n;e||!o?(n=null,n=e?1303===e.code?e.message:"Invalid Login":"To log in, please make sure you have a valid connection.",window.openDialog({data:{title:" ",body:n,disableCancel:!0}},function(){}),console.error(e),t&&t(e,null)):(t=t||l.loginCallback)&&t(null,o),window.spinner&&window.spinner.hide&&window.spinner.hide(!0)},window.appContext&&window.appContext.currentApp?(r=r||l.loginCallback,i=null,i="undefined"==typeof push?{}:push,e=(e=l.userObj.email)||n.email,l.password||(l.password=n.password),"enabled"==d&&c&&!e.includes("@")&&(e+=c),console.warn("email",e),i={email:e,password:l.password,deviceId:i.deviceId,osType:i.platform?i.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId},n&&(i.email=n.email,i.password=n.password),i=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/login",params:i})),window.bfUtils.http.jsonp(i,{bypassInterceptorForStatus:404}).success(function(e){var o;e&&e.result&&e.result.userToken?(authAPI._setCurrentUser(e.result),a.$broadcast("loginSuccessfully",e.result),r&&r(null,e.result)):(o=null,e&&e.error&&(console.warn("login error: ",e.error),o=e.error),r&&r(o,null))}).error(function(e,o,n,t){console.error(e),r&&r(e,null)})):console.error("invalid appContext")):(s=function(e,o){if(e){console.error(e);var n=null;if(e)switch(e.code){case 1303:case 1301:case 1312:n=e.message;break;default:n="Invalid Login"}else n="To log in, please make sure you have a valid connection.";window.openDialog({data:{title:" ",body:n,disableCancel:!0}},function(){}),t&&t(e,null)}else(t=t||l.loginCallback)(null,o);window.spinner&&window.spinner.hide&&window.spinner.hide(!0)},n={headers:{"Content-Type":"application/x-www-form-urlencoded"}},i=l.userObj.username,"enabled"==d&&c&&!i.includes("@")&&(i+=c),"application/x-www-form-urlencoded"==P?o=encodeURIComponent("grant_type")+"="+encodeURIComponent("password")+"&"+encodeURIComponent("username")+"="+encodeURIComponent(i)+"&"+encodeURIComponent("password")+"="+encodeURIComponent(l.password)+"&"+encodeURIComponent("client_id")+"="+encodeURIComponent(f)+"&"+encodeURIComponent("client_secret")+"="+encodeURIComponent(C):"multipart/form-data"==P?(n={transformRequest:angular.identity,headers:{"Content-Type":void 0}},(o=new FormData).append("username",i),o.append("password",l.password)):o={grant_type:"password",username:i,password:l.password,client_id:f},window.bfUtils.http.post(p,o,n).success(function(e){T(e,s)}).error(function(e,o,n,t){e&&e.error_description&&console.error(e),s&&s("Login Failed",null),bfUtils.isEmulatorCP&&(e||"0"!=o?(o&&cpSync.SSO.log("Error status:"+o),e&&cpSync.SSO.log("Error details:"+JSON.stringify(e))):cpSync.SSO.log("Error while testing SSO Login , CORS policy .."))}))};l.getGDPR=function(n,t){var e=l.userObj.email,e=siteConfig.endPoints.crmHost+"/documents/"+n.key+"/check?userKey="+encodeURIComponent(e)+"&withDetails=true";bfUtils.http.get(e).success(function(e){let o={};o.title=s.trustAsHtml(e[n.key].title),o.subtitle=s.trustAsHtml(e[n.key].subtitle),o.details=s.trustAsHtml(e[n.key].details),t(null,o)}).error(function(e){console.error(e),t(e,null)})},l.loadGDPR=function(e){l.getGDPR({key:e},function(e,o){o&&(l.GDPR_content=o,l.showGDPR=!0,a.$broadcast("hideNav"),l.$$phase||l.$apply())})},l.hideGDPR=function(){a.$broadcast("displayNav"),l.showGDPR=!1,l.GDPR_content=null},l.saveGDPR=function(i,a){var o;o=function(e,o){var n=o?o:{};n.appId=appContext.currentApp.appId;var t,s;let r=["bf_terms_and_conditions","bf_privacy_policy"];i.customTermsAndConditionsKey&&r.push(i.customTermsAndConditionsKey),i.customPrivacyPolicyKey&&r.push(i.customPrivacyPolicyKey),t=r.join(","),s=function(){a&&a()},t?(t=siteConfig.endPoints.crmHost+"/documents/"+t+"/accept",bfUtils.http.post(t,{userKey:(i||l.userObj).email.toLowerCase(),info:n,source:"app"}).success(function(e){s(null,e)}).error(function(e){s(e),console.error(e)})):s(null,null)},window.$http.get("https://ipapi.co/json/").success(function(e){e?(e={ipInfo:{city:e.city,country:e.country_name,countryCode:e.country,lat:e.latitude,lon:e.longitude,regionName:e.region,timezone:e.timezone,zip:e.postal,ip:e.ip}},o(null,e)):o(null,null)}).error(function(e){o(null,null)})},l.register=function(t,r){var s,e;window.appContext&&window.appContext.currentApp?(r=r||l.loginCallback,e=null,e="undefined"==typeof push?{}:push,(s=(t?t.user:void 0)||{firstName:l.firstName||"",lastName:l.lastName||"",email:l.userObj.email,password:l.password}).deviceId=e.deviceId,s.osType=e.platform?e.platform.toLowerCase():"web",s.passwordStrength=l.customRegistrationRules?l.customRegistrationRules.passwordStrength:null,s.externalAppId=window.appContext.currentApp.appId,e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(angular.toJson({id:1,method:"users/register",params:s})),l.isRegistering=!0,window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(o){if(o&&o.result){let e={email:s.email};t&&(e.customTermsAndConditionsKey=t.customTermsAndConditionsKey,e.customPrivacyPolicyKey=t.customPrivacyPolicyKey),l.saveGDPR(e,function(){l.login({email:s.email,password:s.password},function(e,o){s.userProfile&&userTags.setRegistrationTags(s,!0,function(e,o){e&&console.log(e)}),o&&o.userToken?(authAPI.uploadProfileImage({file:l.uploadFile,uploader:i},function(e,o){var n,s;e?(l.isRegistering=!1,r&&r(e,null)):(e=authAPI.getCurrentUser(),o?(userTags.setRegistrationTags({imageUrl:o.result},!0,function(e,o){e&&console.log(e)}),o={userToken:e.userToken,imageUrl:o.result,externalAppId:window.currentAppId},n=o,s=function(e,o){l.isRegistering=!1,r&&r(e,o)},o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/update",params:n})),window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(e){var o;e.error?(o=null,e&&e.error&&(console.error(e.error),o=e.error),s&&s(o,null)):(null!=(o=authAPI.getCurrentUser())&&(o.imageUrl=n.imageUrl,authAPI._setCurrentUser(o)),s&&s(null,o))}).error(function(e,o,n,t){console.error(e),s&&s(e,null)})):(l.isRegistering=!1,r&&r(null,e)))}),authAPI.trackRegister(o)):l.isRegistering=!1})})}else{l.isRegistering=!1;if(o&&o.error){let e=o.error.message;1301===o.error.code&&t&&t.messages&&t.messages.emailAlreadyInUse&&(e=t.messages.emailAlreadyInUse);var n={data:{title:" ",body:e,disableCancel:!0}};window.openDialog(n,function(){}),console.warn(o.error),o.error}}}).error(function(e,o,n,t){console.error(e),l.isRegistering=!1})):console.error("invalid appContext")},l.requestLoginProvider=function(e,s){var o={id:1,method:"secretCode/request",params:{externalAppId:window.currentAppId}},o=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(o));l.refWindow&&!l.refWindow.closed||window.bfUtils.http.jsonp(o,{bypassInterceptorForStatus:404}).success(function(n){if(null!=n&&null!=n.result&&n.result.code){if(l.secretCodeProvider=n.result.code,"social"===e&&"apple"===s)l.refWindow=window.open(window.siteConfig.endPoints.authHost+"/website/appleLogin.html?code="+encodeURIComponent(l.secretCodeProvider)+"&externalAppId="+encodeURIComponent(window.currentAppId),"_blank","location=no,enableViewportScale=yes");else if("oauth2"==e)l.refWindow=window.open(window.siteConfig.endPoints.authHost+"/app/".concat(encodeURIComponent(window.currentAppId),"/oauth2/login")+"?code="+encodeURIComponent(l.secretCodeProvider)+"&providerId="+encodeURIComponent(s),"_blank","location=no,enableViewportScale=yes");else{let e="",o="_blank";var t;("facebook"===s&&bfUtils.isAndroid||"google"===s&&bfUtils.isMobileDevice)&&(n=deviceAPI.getAppSchema(),o="_system",t=imageTools.cropImage(window.appContext.currentApp.iconUrl,{width:65,height:65}),e="&appSchema="+encodeURIComponent(n||"")+"&isExternalWindow=true&appName="+encodeURIComponent(window.appContext.currentApp.appName||"")+"&appIcon="+encodeURIComponent(t||"")),t=window.open(window.siteConfig.endPoints.authHost+"/website/index.html?v=2.0&code="+encodeURIComponent(l.secretCodeProvider)+"&loginProviderType="+s+"&externalAppId="+encodeURIComponent(window.currentAppId)+e,o,"location=no,enableViewportScale=yes"),l.refWindow="_blank"===o?t:null}l.refWindow&&l.refWindow.addEventListener&&(l.refWindow.addEventListener("exit",function(){l.refWindow=null}),l.refWindow.addEventListener("close",function(){l.refWindow=null}));setTimeout(L,1e3,480)}},function(e){console.log(JSON.stringify(e))})};var L=function(o){var e;window.appContext&&window.appContext.currentApp?0<o?(e={id:1,method:"users/secretCodeLogin",params:{code:l.secretCodeProvider,deviceId:push.deviceId,osType:push.platform?push.platform.toLowerCase():"web",externalAppId:window.appContext.currentApp.appId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e)),window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(n){if(n.error){var e=!1;1300==n.error.code&&(e=!0),(e=1303==n.error.code?!0:e)&&(l.secretCodeProvider=null)!=l.refWindow&&(l.refWindow.close(),l.refWindow=null)}else if(null!=n.result&&null!=n.result.userToken){authAPI._setCurrentUser(n.result);let e=new Date;e.setMinutes(e.getMinutes()-5);let o=new Date(n.result.createdOn);o&&o.getTime()>=e.getTime()&&userTags.setRegistrationTags(null,!0,function(e,o){e&&console.log(e)}),null!=l.refWindow&&(l.refWindow.close(),l.refWindow=null),l.loginCallback&&l.loginCallback(null,authAPI.getCurrentUser())}else null!=l.refWindow&&l.refWindow.closed?(l.refWindow.close(),l.secretCodeProvider=null,l.refWindow=null):setTimeout(L,1e3,o-1)},function(e){console.log(JSON.stringify(e))})):((l.secretCodeProvider=null)!=l.refWindow&&(l.refWindow.close(),l.refWindow=null),l.loginCallback&&l.loginCallback(null,null)):console.error("invalid appContext")};l.setThemeType=function(e){let o=null;var n,t;(e=e||{}).customLoginUI&&e.customLoginUI.background&&e.customLoginUI.background.active&&e.customLoginUI.background.activeColor?e.customLoginUI.background.color&&"solid"===e.customLoginUI.background.color.colorType&&(o=e.customLoginUI.background.color.solid.colorHex):e.colors&&e.colors.backgroundColor&&(o=e.colors.backgroundColor),o&&(e=o.match(/^rgb/)?(o=o.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/),n=o[1],t=o[2],o[3]):(o=+("0x"+o.slice(1).replace(o.length<5&&/./g,"$&$&")),n=o>>16,t=o>>8&255,255&o),e=Math.sqrt(n*n*.299+t*t*.587+e*e*.114),l.themeType=127.5<e?"light":"dark")},l.validateImage=function(e,o){return authAPI.validateProfileImage({file:e,type:o,stringResource:n})};let O=function(){AppearanceAPI.prototype.getAppearance(null,function(e,o){return e?console.error(e):(o&&t(o.customRegistration,null,o.colors),void(o&&l.setThemeType(o)))})};O()}]);
"use strict";$app.controller("userProfileCtrl",["Upload","$scope","StringResource",function(o,s,n){function i(e,r){new AnalyticsAPI(window.appContext.currentApp.appId,"user_profile","user_profile",window.appContext.liveMode).trackAction(e,r)}(window.authAPI.userProfileCtrlScope=s).user=null,s.userProfile=null,s.tempUser=null,s.tempUserProfile=null,s.editingProfile=!1,s.uploadProfileImage=null,s.uploadBackgroundImage=null,s._appRoot=window._appRoot,s.tabIndex=0,s.switchTabs=function(e){switch(e){case"info":s.tabIndex=0;break;case"badges":s.tabIndex=1}s.$broadcast("tabClicked",{tabIndex:s.tabIndex})},authAPI.getAuthSettings(null,(e,t)=>e?console.error(e):void n.getData().then(function(e){var r=void 0===t.data.enablePasswordBasedAuth||!0===t.data.enablePasswordBasedAuth;s.changePasswordShow=""!==e.changePassword&&r}));var r=window.appContext.currentApp.appId,a=new AppDatastoreAPI(r);a.search({tag:"$$badges",obj:{sort:{rank:1}}},(e,r)=>e?console.error(e):(s.badges=r,void(s.$$phase||s.$apply())));function t(e,t){const o=e.tags?e.tags[r]:[];if(!o.length)return t([]);const n=[];s.badges.forEach(function(r){var e=o.find(function(e){return e.tagName===r.data.tag&&e.appliedCount>=r.data.tagCount});e&&(e=Math.floor(e.appliedCount/r.data.tagCount),r.data.appliedCount=e,imageTools&&(r.data.imageUrl=imageTools.cropImage(r.data.imageUrl,{size:"xxs",aspect:"1:1",compression:80,disablePixelRatio:1})),n.push(r.data))}),e={tag:"$$userDirectory",obj:{filter:{"$json.userId":{$eq:p},"_buildfire.index.string1":p}}},a.search(e,function(e,r){return!e&&r&&r.length&&r[0]&&r[0].data&&r[0].data.badges&&r[0].data.badges.forEach(function(r){var e=n.findIndex(function(e){return e.id===r.id});-1<e&&(n[e].earned=r.earned)}),t(n)})}function l(){var e;return s.user.imageUrl?s.user.imageUrl=imageTools.cropImage(s.user.imageUrl,{size:"s",aspect:"1:1"}):(e={id:1,method:"users/getUserImage",params:{userId:s.user._id,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?data="+encodeURIComponent(JSON.stringify(e)),s.user.imageUrl=e),s.user.imageUrl}var u=document.getElementsByClassName("profile-container")[0];s.getUserProfile=function(e,n){var r={id:1,method:"users/getUserProfile",params:{userId:s.user._id}},r=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(r));window.bfUtils.http.jsonp(r,{bypassInterceptorForStatus:404}).success(function(e){e&&e.result?(e.result.email=s.user.email,s.userProfile=e.result,i("app/user_profile_view",{userId:s.user._id}),n(null,e.result)):n(null,null)}).error(function(e,r,t,o){console.error(e),n(e,null)})},s.hideDropdown=function(){s.shownDropdown=!1},s.showDropdown=function(e){e.stopPropagation(),s.shownDropdown=!s.shownDropdown},s.showChangePassword=function(){if(window.siteConfig&&"sdk"===window.siteConfig.scope)return alert("You can't change password from SDK");let t=authAPI.getCurrentUser().loginProviderType;authAPI.getAuthSettings(null,function(e,r){if(e)return console.error(e);r=r.data.signOnStrategy;if("KAuth"===t&&"SSOLogin"!==r)s.close(),window.closeSideMenu(),authAPI.authCtrlScope.showChangePassword();else{let e="your external account";switch(t){case"facebook":e="Facebook";break;case"apple":e="Apple";break;case"twitter":e="Twitter";break;case"google":e="Google"}let r=new ComponentUIAPI;r.showToastMessage({text:"You used an external registration method, change your password through ".concat(e,"."),hideDismiss:!0})}})},s.close=function(e){if(e||!s.busy){if(s.sideMenuScroll.enable(),s.showForceUpdateError=!1,s.showProfilePictureError=!1,s.tempUser=null,s.tempUserProfile=null,s.shownDropdown=!1,s.editingProfile=!1,s.uploadProfileImage=null,s.uploadBackgroundImage=null,s.busy=!1,window.spinner.hide(),e)return s.user=null,void(s.userProfile=null);u.addEventListener("animationend",function(){s.user=null,s.userProfile=null,s.$$phase||s.$apply(function(){u.classList.remove("closing")})},{once:!0}),requestAnimationFrame(function(){u.classList.add("closing")})}},s.openUrl=function(e){return e&&(e.toLowerCase().indexOf("http")<0&&(e="https://"+e),window.open(e,"_blank","location=yes,enableViewportScale=yes")),!1};function d(e,n){e={id:1,method:"users/getPublicUser",params:{userId:e,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e)),window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(r){t(r.result,function(e){r.result.badges=e,n(null,r)})}).error(function(e,r,t,o){console.error(e),n(e,null)})}function c(e,n){let r=window.currentAppId;!r&&window.appContext&&window.appContext.currentApp&&(r=window.appContext.currentApp.appId),e={id:1,method:"users/getUserByAccessToken",params:{accessToken:e,externalAppId:r}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e)),window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(r){r&&r.error?1311===r.error.code?(authAPI.getAuthSettings(null,function(e,r){e?console.error(e):r&&r.data&&r.data.sessionSettings&&(r=(e=r.data.sessionSettings.kickedOutDialogOptions||{}).content||"Please login again to continue",richModal.display({title:e.title||"You've been kicked out of your session",richContent:"<p id=\"kickedOutDialog\" style='font-size:2rem'>".concat(r,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:e.dismissBtn||"OK",handler:function(){}}}))}),authAPI.logout()):1309===r.error.code?authAPI.logout():(console.error(r.error),n(r.error,null)):t(r.result,function(e){r.result.badges=e,n(null,r)})}).error(function(e,r,t,o){console.error(e),n(e,null)})}var p=null,f=null;s.openEditProfile=function(e){s.editingProfile=!0,s.open(e,{editMode:!0})},s.open=function(e,n){n=n||{},window.spinner.show(),p=e,f=authAPI.getCurrentUser(),s.sideMenuScroll.disable(),p||f&&f._id&&(p=f._id),p&&AppearanceAPI.prototype.getAppearance(null,function(e,t){if(e)return console.error(e),void callback(e);function o(){s.getUserProfile(null,(e,r)=>{n.editMode&&(s.editProfile(),s.customRegistration.checkFieldsErrors({validateFields:!0,mode:"edit",profilePicture:f.imageUrl},(e,r)=>{r&&r.profilePictureError&&(s.showProfilePictureError=!0),s.showForceUpdateError=!0}))})}t&&t.customRegistration&&t.customRegistration.active&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)?(s.showCustomUserProfile=!0,f&&f._id==p?c(f.accessToken,function(e,r){r&&(s.user=r.result,window.spinner.hide(),f&&f._id==s.user._id&&(s.user.userToken=f.userToken),l(),m(t.customRegistration,r.result),s.customUserProfile=r.result,o())}):d(p,function(e,r){r&&(s.user=r.result,window.spinner.hide(),l(),m(t.customRegistration,r.result),s.customUserProfile=r.result,o())})):f&&f._id==p?c(f.accessToken,function(e,r){r&&(s.user=r.result,window.spinner.hide(),f&&f._id==s.user._id&&(s.user.userToken=f.userToken),l(),o())}):d(p,function(e,r){r&&(s.user=r.result,window.spinner.hide(),l(),o())})})};let m=function(e,r){customRegistration.getFields({defaults:r,isProfileMode:!0,customRegistrationSettings:e,refreshUI:function(){var e;s.customRegistrationFields&&s.customRegistrationFields.length&&((e=s.customRegistrationFields.find(e=>"address"===e.name))&&e.validate(e.value)),s.$$phase||s.$apply()}},function(e,r){r&&(s.customRegistrationFields=r.fields,s.customRegistration=r,s.initCustomRegistration=function(){r.initializers.forEach(function(e){e()})},s.initCustomRegistration(),s.$$phase||s.$apply())})};s.editVisibilityOptions=function(t){customRegistration.editVisibilityOptions({field:t},(e,r)=>e?console.error(e):(t.visibilityChoice=r.text.toLowerCase(),void(s.$$phase||s.$apply())))},authAPI.onLogout(function(){s.user&&delete s.user.userToken,s.close(!0)}),s.tempUser=null,s.tempUserProfile=null,s.busy=!1,s.cancelEdit=function(){return s.tempUser=null,s.tempUserProfile=null,s.showForceUpdateError=!1,s.showProfilePictureError=!1,s.editingProfile=null,s.uploadBackgroundImage=null,s.uploadProfileImage=null,s.showCustomUserProfile&&s.open(s.user._id),s.$$phase||s.$apply(),!1},s.showInvalidFieldsErr=function(){n.getData().then(function(e){e={richContent:'<p class="padding-top-fifteen">'.concat(e.editProfileInvalidFields||"One or more fields are invalid.","</p>"),dismissButtonText:"OK"};richModal.display(e)})};function g(r,n){var e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(angular.toJson({id:1,method:"users/update",params:r}));window.bfUtils.http.jsonp(e).success(function(e){s.tempUser.lastUpdated=(new Date).toISOString(),userTags.setRegistrationTags(r,!1,function(e,r){e&&console.log(e)}),n(null,e)}).error(function(e,r,t,o){console.error(e),s.busy=!1,window.spinner.hide(),n(e,null)}).finally()}s.update=function(){s.tempUserProfile||(s.tempUserProfile={}),s.busy=!0,window.spinner.show({timeout:6e4});var t={};s.tempUser.displayName=e(s.tempUser.firstName,s.tempUser.lastName),authAPI.uploadProfileImage({file:s.uploadProfileImage,uploader:o},function(e,r){return e?console.error(e):(r&&(s.showProfilePictureError=!1,s.tempUser.imageUrl=imageTools.cropImage(r.result,{size:"s",aspect:"1:1"}),t.imageUrl=s.tempUser.imageUrl),void authAPI.uploadProfileImage({file:s.uploadBackgroundImage,uploader:o},function(e,r){return e?console.error(e):(r&&(s.tempUserProfile.backgroundImage=r.result,t.backgroundImage=s.tempUserProfile.backgroundImage),void function(n){if(s.customRegistration)s.customRegistration.fetch({validateFields:!0,mode:"edit",profilePicture:s.tempUser.imageUrl},function(e,r){if(e)return s.busy=!1,window.spinner.hide(),s.showInvalidFieldsErr(),void(e.profilePictureError&&(s.showProfilePictureError=!0));for(var t in r.user)r.user.hasOwnProperty(t)&&(s.tempUser[t]=r.user[t]);let o=r.user;o._id=s.tempUser._id,o.userToken=s.tempUser.userToken,o.imageUrl=s.tempUser.imageUrl,o.externalAppId=window.appContext.currentApp.appId,g(o,n)});else{let e={};e._id=s.tempUser._id,e.email=s.tempUser.email,e.userToken=s.tempUser.userToken,e.firstName=s.tempUser.firstName||"",e.lastName=s.tempUser.lastName||"",e.displayName=s.tempUser.displayName||"",e.imageUrl=s.tempUser.imageUrl,e.externalAppId=window.appContext.currentApp.appId,g(e,n)}}(function(){!function(n){var e=JSON.parse(JSON.stringify(s.tempUserProfile));(e=e||{}).userId=s.tempUser._id,e.userToken=s.tempUser.userToken,e.email=s.tempUser.email,e.firstName=s.tempUser.firstName,e.lastName=s.tempUser.lastName,e.displayName=s.tempUser.displayName;e=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify({id:1,method:"users/saveUserProfile",params:e}));window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){n(null,e)}).error(function(e,r,t,o){console.error(e),n(e,null)})}(function(){s.tempUser.badges=s.user.badges,s.user=s.tempUser,s.tempUser=null,s.userProfile=s.tempUserProfile,s.tempUserProfile=null,s.uploadBackgroundImage=null,s.uploadProfileImage=null,authAPI._setCurrentUser(s.user),authAPI.triggerOnUpdate(),s.showForceUpdateError=!1,s.editingProfile=!1,s.busy=!1,window.spinner.hide(),t.userId=s.user._id,i("app/user_profile_update",t)})}))}))})};let e=function(e,r){let t=e?r?e+" ":e:"";return r&&(t+=r),t};s.validateImage=function(e,r){return authAPI.validateProfileImage({file:e,type:r,stringResource:n})},s.editProfile=function(){null!=f&&f._id&&(s.tempUser=f,s.currentUserEmail=f.email,s.tempUserProfile=s.userProfile,s.editingProfile=!0,s.busy=!1,s.customRegistrationFields&&s.customRegistrationFields.forEach(function(e){delete e.error}),s.$$phase||s.$apply())},s.sideMenuScroll={enable:function(){var e=document.getElementsByClassName("menu-body-container")[0];e&&e.classList.remove("disable_overflow_scroll")},disable:function(){var e=document.getElementsByClassName("menu-body-container")[0];e&&e.classList.add("disable_overflow_scroll")}},authAPI.getCurrentUser(function(e,r){return e?console.error(e):void(r&&setTimeout(()=>{authAPI.checkForceUpdate({user:r})},5e3))})}]),$app.filter("cropCoverImage",function(){return function(e){if(!e)return"";if(!imageTools||!/(https|http):\/\//g.test(e))return e;var r="full_width";return-1<window.location.href.indexOf("pluginTester")&&(r="xl"),imageTools.cropImage(e,{size:r,aspect:"16:9",compression:80})}});
"use strict";$app.controller("notesCtrl",["$scope","$rootScope","$sce",function(i,e,t){i.notes=[],i.notesShown=!1,i.pluginOpen=!1,i.settings={includeTime:!0},i.tempNoteText="",i.instanceId=!1,(window.notesAPI.notesCtrlScope=i).close=function(){if(i.notesShown=!1,i.callback){let e={};i.tempNoteData.itemId&&(e.itemId=i.tempNoteData.itemId);var t=window.notesAPI.formatNotes(i.notes);e.hasNotes=i.notes&&0<i.notes.length,e.noteCount=i.notes?i.notes.length:0,e.notes=t,i.callback(null,e)}i.$$phase||i.$apply()},i.getAllNotes=function(){window.spinner.show(),window.notesAPI.getAll((e,s)=>{if(e)throw e;s.length?(e=s.map(e=>e.instanceId),postMaster.controlPluginAPI.appAPI.getPluginInstancesByIds(e,function(e,t){if(e)throw e;const n=t.data;let o=[];s.forEach(t=>{var e=n.find(e=>e.data.instanceId===t.instanceId);e&&(t.pluginId=e.data._buildfire.pluginType.result[0].token,t.folderName=e.data._buildfire.pluginType.result[0].folderName,t.title=e.data.title,t.iconUrl=e.data.iconUrl,t.show=!0,o.push(t))}),i.notes=o,window.spinner.hide(),i.$$phase||i.$apply()})):(i.notes=[],window.spinner.hide(),i.$$phase||i.$apply())})},i.getItemNotes=function(){window.spinner.show(),window.notesAPI.getAllFromItem(i.tempNoteData.itemId,(e,t)=>{if(e)throw e;i.notes=t,i.notesCopy=JSON.parse(JSON.stringify(t)),window.spinner.hide(),i.$$phase||i.$apply()})},i.deleteNote=function(t,n,o){var e,s;window.notesAPI.delete(t,n,o,()=>{}),i.pluginOpen?i.notes=i.notes.filter(e=>e.id!=t):(e=i.notes.findIndex(e=>e.instanceId===o),s=i.notes[e].content.findIndex(e=>e.itemId===n),i.notes[e].content[s].notes=i.notes[e].content[s].notes.filter(e=>e.id!=t),0===i.notes[e].content[s].notes.length&&(i.notes[e].content.splice(s,1),0===i.notes[e].content.length&&i.notes.splice(e,1))),i.$$phase||i.$apply()},i.addNote=function(){var e=i.settings.includeTime&&i.tempNoteData.timeIndex||!1,e={itemId:i.tempNoteData.itemId,imageUrl:i.tempNoteData.imageUrl,title:i.tempNoteData.title,timeIndex:e,instanceId:i.instanceId};window.notesAPI.add(e,e=>{})},i.getItemTitle=function(e){if(!e)return"";e=e.title||"";return t.trustAsHtml(e)},i.editNote=function(e,t,n){window.notesAPI.edit(e,t,n,()=>{i.fetchNotes()})},i.openItem=function(e,t,n){window.notesAPI.loadNote(e,t,n,()=>i.close())},i.toggle=function(e){i.notes[e].show=!i.notes[e].show,i.$$phase||i.$apply()},i.fetchNotes=function(){i.notesShown&&(i.pluginOpen?i.getItemNotes():i.getAllNotes())},i.seekTo=function(e,t,n){window.notesAPI.seekTo(e,t,n,()=>i.close())},i.$watch("notesShown",()=>{i.notes=[],i.fetchNotes()},!0),i.$watch("notes",()=>{i.pluginOpen&&10<i.notes.length&&i.resetPosition()},!0),i.notes_empty=window._appRoot+"media/ic_bookmark_empty.svg",i.resetPosition=function(){document.getElementsByClassName("notes-in-plugin")[0].classList.replace("pos-static","pos-fixed"),setTimeout(()=>{document.getElementsByClassName("notes-in-plugin")[0].classList.replace("pos-fixed","pos-static")},100)}}]).filter("cropImg",function(){return function(e){return e?imageTools.cropImage(e,{size:"xs",aspect:"1:1"}):window._appRoot+"media/ic_no_img.png"}}).filter("timeFormat",function(){return function(e){var t=new Date(0,0,0,0,0,0,0);return t.setSeconds(e),t}});
"use strict";$app.factory("StringResource",["$q",function(t){var e=new DatastoreAPI(appContext.currentApp.appId,"stringResources",1,0,appContext.currentApp.keys.datastoreKey),r=n();function n(){var r=t.defer();return e.get({},function(t,e){t||!e?r.reject(t):r.resolve(e.data)}),r.promise}return{getData:function(t){return r=t?n():r}}}]);
"use strict";var authAPI={authCtrlScope:null,userProfileCtrlScope:null,init:function(e){this.context=e},refreshAndTriggerUpdate:function(n){n=n||{};var e=authAPI.getCurrentUser();e&&authAPI.getUserByAccessToken({accessToken:e.accessToken},function(e,t){t&&(authAPI._setCurrentUser(t),authAPI.triggerOnUpdate(t,n.updateType,n.isProfileTagUpdate))})},initRefresh:function(){function e(){let o=authAPI.getCurrentUser();o&&authAPI.getUserByAccessToken({accessToken:o.accessToken},function(e,t){var n,s;t&&(n={isActive:o.isActive,appTags:o.tags?o.tags[window.currentAppId]:null},s={isActive:t.isActive,appTags:t.tags?t.tags[window.currentAppId]:null},authAPI._setCurrentUser(t),JSON.stringify(n)!==JSON.stringify(s)&&(console.log("user update found during sync"),authAPI.triggerOnUpdate(t)))})}bfUtils.isApp&&(setTimeout(e,3e3),setInterval(e,3e5)),authAPI.session.init()},getUserByAccessToken:function(e,o){e={id:1,method:"users/getUserByAccessToken",params:{accessToken:e.accessToken,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){e?e.error?1311===e.error.code?(authAPI.getAuthSettings(null,function(e,t){e?console.error(e):t&&t.data&&t.data.sessionSettings&&(t=(e=t.data.sessionSettings.kickedOutDialogOptions||{}).content||"Please login again to continue",richModal.display({title:e.title||"You've been kicked out of your session",richContent:"<p id=\"kickedOutDialog\" style='font-size:2rem'>".concat(t,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:e.dismissBtn||"OK",handler:function(){}}}))}),authAPI.logout(),o(null,null)):1309===e.error.code?authAPI.logout():(console.error(e.error),o(e.error,null)):o(null,e.result):o(null,null)}).error(function(e,t,n,s){console.error(e),o(e,null)})},login:function(e,n){var t=this.getCurrentUser();t?(n&&n(null,t),authAPI.triggerOnLogin(t)):(t=function(){authAPI.authCtrlScope.loginOptions=e,authAPI.authCtrlScope.showLogin(function(e,t){!e&&t&&(authAPI._setCurrentUser(t),authAPI.session.start(),authAPI.triggerOnLogin(t),authAPI._checkGDPR(t),authAPI.checkForceUpdate({user:t}),authAPI.authCtrlScope.hideLogin(),authAPI.authCtrlScope.$$phase||authAPI.authCtrlScope.$apply()),n&&n(e,t)}),authAPI.authCtrlScope.$$phase||authAPI.authCtrlScope.$apply()},authAPI.authCtrlScope?t():setTimeout(t,250))},_setCurrentUser:function(e){window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&(e?localStorage.setItem(window.appContext.currentApp.appId+"-AUTH_CURRENT_USER",JSON.stringify(e)):localStorage.removeItem(window.appContext.currentApp.appId+"-AUTH_CURRENT_USER"))},secondaryUserLookup:function(){return null},getCurrentUser:function(e,t){"function"==typeof e&&(t=e);e=this.secondaryUserLookup();if(e||window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&(e=localStorage.getItem(window.appContext.currentApp.appId+"-AUTH_CURRENT_USER"),e=JSON.parse(e)),e&&e.userToken||(e=null),!t)return e;t(null,e)},_checkGDPR:function(t){t&&termsAPI.getKeys(function(e,n){if(e)return console.error(e);e=siteConfig.endPoints.crmHost+"/documents/"+n.join(",")+"/check?userKey="+encodeURIComponent(t.email||t.username);(bfUtils.isAppHtml5Version||bfUtils.isMobileDevice||bfUtils.isPwaAndroid||bfUtils.isHtml5iOS)&&window.appContext&&1==window.appContext.liveMode&&bfUtils.http.get(e).success(function(t){if(t)for(let e=0;e<n.length;e++)if(t[n[e]]&&!t[n[e]].isAccepted){window.location.hash="gdpr";break}}).error(function(e){console.error(e)})})},logout:function(){this._setCurrentUser(null),window.localStorage.removeItem("SSO_USER"),authAPI.session.end(),authAPI.triggerOnLogout(null),authAPI.authCtrlScope&&authAPI.authCtrlScope.changePasswordShown&&authAPI.authCtrlScope.hideLogin()},trackRegister:function(e){var t;window.appContext&&window.appContext.liveMode&&((t=new AnalyticsAPI(authAPI.context)).setUserProperties({email:e.email,username:e.username,firstName:e.firstName,lastName:e.lastName}),t.trackAction("app/userRegistered"),(t=localStorage.getItem("HISTORY_USERS"))?(t=JSON.parse(t)).length&&-1==t.indexOf(e._id)&&(t.push(e._id),localStorage.setItem("HISTORY_USERS",JSON.stringify(t))):localStorage.setItem("HISTORY_USERS",JSON.stringify([e._id])))},onLogin:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_LOGIN",e,!1)},onLogout:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_LOGOUT",e,!1)},onUpdate:function(e){document.addEventListener("AUTH_CURRENT_USER_ON_UPDATE",e,!1)},triggerOnUpdate:function(e,t,n){e=e||authAPI.getCurrentUser();n=new CustomEvent("AUTH_CURRENT_USER_ON_UPDATE",{detail:{user:e,updateType:t,isProfileTagUpdate:n}});document.dispatchEvent(n)},triggerOnLogin:function(e){e=new CustomEvent("AUTH_CURRENT_USER_ON_LOGIN",{detail:e});document.dispatchEvent(e)},triggerOnLogout:function(){var e=new CustomEvent("AUTH_CURRENT_USER_ON_LOGOUT",{detail:null});document.dispatchEvent(e)},openProfile:function(e,t){if(t=t||{},e)return n(e);e=this.getCurrentUser();if(e&&e._id)return n(e._id);function n(e){t.editingMode?authAPI.userProfileCtrlScope.openEditProfile(e):authAPI.userProfileCtrlScope.open(e)}this.login({},function(e,t){!e&&t&&t._id&&n(t._id)})},getUserProfile:function(t,o){if(!t||!t.userId)throw new Error("userId have not been provided to getUserInfo");var n=null,e={id:1,method:"users/getPublicUser",params:{userId:t.userId,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?(n=e.result,e={id:1,method:"users/getUserProfile",params:{userId:t.userId}},e=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e)),bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?(n=angular.extend({},e.result,n),o(null,n||null)):o(null,n))}).error(function(e,t,n,s){o&&o(e,null)})):o(null,null))}).error(function(e,t,n,s){console.error(e),o&&o(e,null)})},getUserProfiles:function(e,o){if(!e||!e.userIds)throw new Error("userIds have not been provided to getUsersInfo");if(!Array.isArray(e.userIds))throw new Error("userIds param must be of type Array");if(!e.userIds.length)throw new Error("userIds param must contain at least one id");if(50<e.userIds.length)throw new Error("userIds param must not exceed 50 id");e={id:1,method:"users/getPublicUsers",params:{userIds:e.userIds,externalAppId:window.appContext.currentApp.appId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?o(null,e.result):o(null,null))}).error(function(e,t,n,s){console.error(e),o&&o(e,null)})},getUsersByEmail:function(n,o){if(!n||!n.emails)throw new Error("No emails have not been provided to getUserByEmail");function t(t){var e={id:1,method:"users/getUsersProfilesByEmail",params:{emails:n.emails}},e=window.siteConfig.endPoints.socialHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?function(e,t){for(var n=0;n<e.length;n++)for(var s=0;s<t.length;s++)e[n].email==t[s].email&&(e[n].phone=t[s].phone);o(null,e)}(t,e.result):o(null,t))}).error(function(e,t,n,s){console.error(e),o&&o(e,null)})}var e={id:1,method:"users/getUsersByEmail",params:{emails:n.emails,externalAppId:window.currentAppId}},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){o&&(e&&e.result?t(e.result):o(null,null))}).error(function(e,t,n,s){console.error(e),o&&o(e,null)})},getUserPictureUrl:function(e){var t=null,n=null;if((e=e||{}).userId&&(t="userId",n=e.userId),e.email&&(t="email",n=e.email),e.username&&(t="username",n=e.username),!t||!n)throw Error("Invalid user picture params");return n=encodeURIComponent(n),window.siteConfig.endPoints.authHost+"/src/server.js/user/picture?"+t+"="+n+"&externalAppId="+encodeURIComponent(window.currentAppId)},getAuthSettings:function(e,n){var t;window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.keys&&window.appContext.currentApp.appId?authAPI.authSettings?n(null,{data:authAPI.authSettings}):(t={appId:window.appContext.currentApp.appId,pluginId:"authSettings",instanceId:"authSettings",liveMode:window.appContext.liveMode,writeKey:window.appContext.currentApp.keys.datastoreKey},new DatastoreAPI(t).get({tag:"authSettings"},function(e,t){t&&t.data&&(authAPI.authSettings=t.data),n(e,t)})):n("missing currentApp parameters")},keepSessionAlive:function(e,t){e=new CustomEvent("sessionActivity",{detail:{data:e}});document.dispatchEvent(e),t(null,!0)},fakeTimeOutDialog:function(e){var t=document.getElementById("alertDialog");let n=0;richModal.isVisible()&&!t&&(n=1e3,richModal.clearAll()),t?(document.getElementById("modalTitle").innerText=e.title,document.getElementsByClassName("action-button")[0].innerText=e.continueBtn):(richModal.display({title:e.title||"Your session is about to expire",richContent:"<p id='alertDialog' style='font-size:50px; text-align:center' class='dangerTheme'>00:10</p>",showDismissButton:!1,forceShow:!0,action:{title:e.continueBtn||"CONTINUE",handler:function(){}}}),setTimeout(function(){let t=10,n=setInterval(()=>{var e;document.getElementById("alertDialog")?(e=10<t--?t:"0".concat(t),document.getElementById("alertDialog").innerText="00:".concat(e),t<=0&&clearInterval(n)):clearInterval(n)},1e3)},n))},fakeExpiredDialog:function(e){let t=document.getElementById("expiredDialog");var n;richModal.isVisible()&&!t&&richModal.clearAll(),t?(document.getElementById("modalTitle").innerText=e.title,document.getElementsByClassName("action-button")[0].innerText=e.dismissBtn,t.innerText=e.content):(n=e.content||"Please login again to continue",richModal.display({title:e.title||"Your session is expired due to inactivity",richContent:"<p id=\"expiredDialog\" style='font-size:2rem'>".concat(n,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:e.dismissBtn||"OK",handler:function(){}}}))},fakeKickedOutDialog:function(e){let t=document.getElementById("kickedOutDialog");var n;richModal.isVisible()&&!t&&richModal.clearAll(),t?(document.getElementById("modalTitle").innerText=e.title,document.getElementsByClassName("action-button")[0].innerText=e.dismissBtn,t.innerText=e.content):(n=e.content||"Please login again to continue",richModal.display({title:e.title||"You've been kicked out of your session",richContent:"<p id=\"kickedOutDialog\" style='font-size:2rem'>".concat(n,"</p>"),showDismissButton:!1,forceShow:!0,action:{title:e.dismissBtn||"OK",handler:function(){}}}))},session:{sessionExpires:!1,idleTimeSeconds:null,lastIdleTimeUpdateOn:null,stopWatchInterval:null,updateIdleTimeInterval:null,init:function(){authAPI.getAuthSettings(null,function(e,t){if(!e&&t&&!bfUtils.isEmulatorCP&&bfUtils.isApp&&t.data&&t.data.sessionSettings&&(t.data.sessionSettings.expireWhenIdleFor&&t.data.sessionSettings.expireWhenIdleFor.isActive||t.data.sessionSettings.expireWhenAppClose)){authAPI.getCurrentUser()&&authAPI.logout(),authAPI.session.sessionExpires=t.data.sessionSettings.expireWhenIdleFor&&t.data.sessionSettings.expireWhenIdleFor.isActive;let n=()=>{null===authAPI.session.stopWatchInterval&&authAPI.session._resetIdleTime()};document.addEventListener("sessionActivity",n,!1),function(){function e(){t||(t=!0,setTimeout(function(){t=!1},1e3),setTimeout(n))}var t=!1;document.addEventListener("click",e),document.addEventListener("touchstart",e)}()}})},start:function(){authAPI.getAuthSettings(null,function(e,s){if(e)console.error(e);else if(!bfUtils.isEmulatorCP&&bfUtils.isApp&&s&&s.data&&s.data.sessionSettings&&s.data.sessionSettings.expireWhenIdleFor&&s.data.sessionSettings.expireWhenIdleFor.isActive){const r=60*s.data.sessionSettings.expireWhenIdleFor.timeInMinutes,a=s.data.sessionSettings.expireWhenIdleFor.showTimeoutDialog;let t=s.data.sessionSettings.expireWhenIdleFor.alertDialogOptions||{},n=s.data.sessionSettings.expireWhenIdleFor.expiredDialogOptions||{};var o=!1;authAPI.session.lastIdleTimeUpdateOn=new Date,authAPI.session.idleTimeSeconds=0;var i=function(){var e=n.content||"Please login again to continue";richModal.display({title:n.title||"Your session is expired due to inactivity",richContent:"<p style='font-size:2rem'>".concat(e,"</p>"),showDismissButton:!1,action:{title:n.dismissBtn||"OK",handler:function(){}}})};authAPI.session.updateIdleTimeInterval=setInterval(function(){var e=new Date;if(authAPI.session.idleTimeSeconds+=(e.getTime()-authAPI.session.lastIdleTimeUpdateOn.getTime())/1e3,authAPI.session.lastIdleTimeUpdateOn=e,authAPI.session.idleTimeSeconds>5+r&&(console.error("abnormally forced logout"),authAPI.session._clean(),authAPI.logout()),a&&!o&&authAPI.session.idleTimeSeconds>r-60){o=!0;let e=0;richModal.isVisible()&&(e=1e3,richModal.clearAll());richModal.display({title:t.title||"Your session is about to expire",richContent:"<p id='logout-timer' style='font-size:50px; text-align:center' class='dangerTheme'>01:00</p>",showDismissButton:!1,action:{title:t.continueBtn||"CONTINUE",handler:function(){o=!1,authAPI.session._resetIdleTime(),console.log("login session extended - continue")}}}),setTimeout(function(){let n=(new Date).getTime()/1e3+60;authAPI.session.stopWatchInterval=setInterval(()=>{var e,t;document.getElementById("logout-timer")?(t=9<(e=Math.round(n-(new Date).getTime()/1e3))?e:"0".concat(e),document.getElementById("logout-timer").innerText="00:".concat(t),e<=0&&(o=!1,authAPI.session._clean(),richModal.close(),setTimeout(function(){i(),authAPI.logout()},1e3),console.log("login session terminated - continue"))):(o=!1,authAPI.session._resetIdleTime(),console.log("login session extended - closed"))},1e3)},e)}else!a&&authAPI.session.idleTimeSeconds>r&&(i(),console.log("login session terminated without warning"),authAPI.session._clean(),authAPI.logout())},3e3)}})},end:function(){authAPI.session._clean()},_clean:function(){authAPI.session.stopWatchInterval&&(clearInterval(authAPI.session.stopWatchInterval),authAPI.session.stopWatchInterval=null),authAPI.session.updateIdleTimeInterval&&(clearInterval(authAPI.session.updateIdleTimeInterval),authAPI.session.updateIdleTimeInterval=null),authAPI.session.idleTimeSeconds=0},_resetIdleTime:function(){authAPI.session.idleTimeSeconds=0,authAPI.session.stopWatchInterval&&(clearInterval(authAPI.session.stopWatchInterval),authAPI.session.stopWatchInterval=null)}},changePassword:function(e,o){let t={},n=authAPI.getCurrentUser();if(!(window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.appId&&n))return console.error("Error",{code:"MissedData",message:"Missed context's data"}),o({code:"MissedData",message:"Missed context's data"},null);t={appId:window.appContext.currentApp.appId,accessToken:n.accessToken,currentPassword:e.oldPassword,newPassword:e.newPassword,passwordStrength:e.passwordStrength},window.bfUtils.http.post(window.siteConfig.endPoints.appHost+"/api/auth/user/changePassword",t,{headers:{"Content-Type":"application/json"}}).success(function(e){n.accessToken=e.accessToken,authAPI._setCurrentUser(n),o(null,null)}).error(function(e,t,n,s){o(e,null),console.error("Error",e,t)})},validateProfileImage:function(e){var t=e.file;let s=e.type;if(!t)return!1;if(t.type&&["image/jpeg","image/png","image/jpg"].indexOf(t.type)<0)return e.stringResource.getData().then(function(e){var t="coverPhoto"===s?"coverImageTypeInvalid":"profileImageTypeInvalid",n=("coverPhoto"===s?"Cover":"Profile")+" photo does not support this file type.",n={forceShow:!0,richContent:'<p class="padding-top-fifteen">'.concat(e[t]||n,"</p>"),dismissButtonText:"OK"};richModal.display(n)}),!1;return!(t.size&&1e7<t.size)||(e.stringResource.getData().then(function(e){var t="coverPhoto"===s?"coverPhotoLess10mb":"profilePhotoLess10mb",n=("coverPhoto"===s?"Cover":"Profile")+" photo must be less than 10mb.",n={forceShow:!0,richContent:'<p class="padding-top-fifteen">'.concat(e[t]||n,"</p>"),dismissButtonText:"OK"};richModal.display(n)}),!1)},uploadProfileImage:function(e,o){var t,n=authAPI.getCurrentUser();n?(t=window.siteConfig.endPoints.authHost+"/src/server.js?method=users/uploadImage",e.file?e.uploader.upload({url:t,data:{file:e.file,userToken:n.userToken,externalAppId:window.currentAppId}}).progress(function(e){e=parseInt(100*e.loaded/e.total);console.log("progress: "+e+"%")}).success(function(e,t,n,s){console.log("file "+s.data.file.name+" uploaded."),o&&o(null,e)}).error(function(e){o&&o(e,null)}):o&&o(null,null)):o&&o("Invalid user",null)},checkForceUpdate:function(s,e){if(!bfUtils.isEmulatorCP&&bfUtils.isApp){let n=!1;AppearanceAPI.prototype.getAppearance(null,function(e,t){return e?console.error(e):void(t&&t.customRegistration&&t.customRegistration.active&&t.customRegistration.singlePage&&t.customRegistration.singlePage.formControls&&(t.customRegistration.singlePage.formControls.forEach(t=>{var e;if(t.active&&t.settings.required&&"registrationOnly"!==t.settings.displayOn&&!1!==t.settings.allowEditingInProfile)if("custom"!==t.type)switch(t.id){case"fullName":(t.settings.displayNameEnabled&&!s.user.displayName||t.settings.firstNameEnabled&&!s.user.firstName||t.settings.lastNameEnabled&&!s.user.lastName)&&(n=!0);break;case"address":(!t.settings.showFullAddress||s.user.userProfile&&s.user.userProfile.address&&s.user.userProfile.address.fullAddress)&&(!t.settings.showFullAddress||!t.settings.showAptNo||s.user.userProfile&&s.user.userProfile.address&&s.user.userProfile.address.customFields&&s.user.userProfile.address.customFields.aptNo)&&(!t.settings.showZipCode||s.user.userProfile&&s.user.userProfile.address&&s.user.userProfile.address.customFields&&s.user.userProfile.address.customFields.zipCode)||(n=!0);break;case"bio":s.user.userProfile&&s.user.userProfile.bio||(n=!0);break;case"telephone":s.user.userProfile&&s.user.userProfile.tel||(n=!0);break;case"birthDate":s.user.userProfile&&s.user.userProfile.birthDate||(n=!0);break;case"profilePicture":s.user.imageUrl||(n=!0)}else"custom"===t.type&&(s.user.userProfile&&s.user.userProfile.customTypeFields&&((e=s.user.userProfile.customTypeFields.find(e=>e.id===t.id))&&e.value||e&&e.values&&0<e.values.length)||(n=!0))}),n&&(t=s.user?s.user._id:null,authAPI.openProfile(t,{editingMode:!0}))))})}},searchUsers:function(e,o){e=e||{};var t=authAPI.getCurrentUser();if(t&&t.accessToken){const n={externalAppId:window.currentAppId,accessToken:t.accessToken};e.searchText&&(n.searchText=e.searchText),e.sort&&(n.sort=e.sort),e.limit&&(n.limit=e.limit),e.skip&&(n.skip=e.skip),e.page&&(n.page=e.page),e.pageSize&&(n.pageSize=e.pageSize);e={id:1,method:"users/searchUsers",params:n},e=window.siteConfig.endPoints.authHost+"/src/server.js?callback=JSON_CALLBACK&data="+encodeURIComponent(JSON.stringify(e));window.bfUtils.http.jsonp(e,{bypassInterceptorForStatus:404}).success(function(e){e&&e.result?o(null,e.result):o(null,null)}).error(function(e,t,n,s){console.error(e),o(e,null)})}else o(new Error("Login is required"),null)}};authAPI.initRefresh();
"use strict";let termsAPI={termsConditionsKey:"bf_terms_and_conditions",privacyPolicyKey:"bf_privacy_policy",getKeys:function(e){let i=[],o=this;authAPI.getAuthSettings(null,function(t,n){return t?e(t,null):void(n&&n.data&&n.data.termsConditionsAndPrivacyPolicy&&n.data.termsConditionsAndPrivacyPolicy.custom&&n.data.termsConditionsAndPrivacyPolicy.custom.active?(t=n.data.termsConditionsAndPrivacyPolicy.custom,i=o._checkKeys(t),e(null,i)):n&&n.data&&!n.data.termsConditionsAndPrivacyPolicy&&window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)?AppearanceAPI.prototype.getAppearance(null,function(t,n){return t?e(t,null):(i=n&&n.customRegistration&&n.customRegistration.singlePage&&n.customRegistration.active?(n=n.customRegistration.singlePage.formControls.find(function(t){return t&&"termsConditionsAndPrivacyPolicy"===t.id}),o._checkKeys(n)):[o.termsConditionsKey,o.privacyPolicyKey],void e(null,i))}):(i=[o.termsConditionsKey,o.privacyPolicyKey],e(null,i)))})},_checkKeys:function(t){let n=[];return t&&t.settings&&t.active&&t.settings.termsAndConditionsDocumentKey?n.push(t.settings.termsAndConditionsDocumentKey):n.push(this.termsConditionsKey),t&&t.settings&&t.active&&t.settings.privacyPolicyDocumentKey?n.push(t.settings.privacyPolicyDocumentKey):n.push(this.privacyPolicyKey),n},getGdprLinks:function(i,o){let s=this,r=[],c,a,p=null,u=null,d={id:"termsAndConditions",isCustom:!1,preLinkText:"I accept the",linkText:"Terms of use",validate:function(t){this.error=null,t||(this.error="You have to agree to the terms/policies")},open:function(){var t=s.termsConditionsKey;i.openGDPRContent({key:t})}},l={id:"privacyPolicy",isCustom:!1,preLinkText:"I accept the",linkText:"Privacy policy",validate:function(t){this.error=null,t||(this.error="You have to agree to the terms/policies")},open:function(){var t=s.privacyPolicyKey;i.openGDPRContent({key:t})}},y={id:"appTerms",isCustom:!1,preLinkText:"I accept the",linkText:"App terms",validate:function(t){this.error=null,t||(this.error="You have to agree to the terms/policies")},open:function(){window.open(appContext.currentApp.config.TermsOfUse,"_system")}};a=!!(appContext&&appContext.currentApp&&appContext.currentApp.config&&appContext.currentApp.config.TermsOfUse)&&(appContext.currentApp.config.TermsOfUse.indexOf("appdocumentation.com")<0&&appContext.currentApp.config.TermsOfUse.indexOf("buildfire.com")<0),authAPI.getAuthSettings(null,function(t,n){return t?o(t,null):void(n&&n.data&&n.data.termsConditionsAndPrivacyPolicy&&n.data.termsConditionsAndPrivacyPolicy.custom&&n.data.termsConditionsAndPrivacyPolicy.custom.active?(c=n&&n.data&&n.data.termsConditionsAndPrivacyPolicy.custom,e(c)):n&&n.data&&!n.data.termsConditionsAndPrivacyPolicy&&window.appContext&&window.appContext.currentApp&&window.appContext.currentApp.config&&-1<["enterprise","professional"].indexOf(window.appContext.currentApp.config.type)?AppearanceAPI.prototype.getAppearance(null,function(t,n){return t?o(t,null):(n&&n.customRegistration&&n.customRegistration.singlePage&&n.customRegistration.active&&(c=n.customRegistration.singlePage.formControls.find(function(t){return t&&"termsConditionsAndPrivacyPolicy"===t.id})),void e(c))}):e());function e(n){n&&n.options&&n.active?(p=n.settings&&n.settings.termsAndConditionsDocumentKey,r.push({id:"customTermsAndConditions",name:"termsAndConditions",isCustom:!0,preLinkText:n.options.fieldsLabels.iAccept,linkText:n.options.fieldsLabels.termsAndConditions,validate:function(t){this.error=null,t||(this.error=n.options.errorMessages.termsAndConditionsAcceptRequired)},open:function(){var t=p||s.termsConditionsKey;i.openGDPRContent({key:t})}}),u=n.settings&&n.settings.privacyPolicyDocumentKey,r.push({id:"customPrivacyPolicy",name:"privacyPolicy",isCustom:!0,preLinkText:n.options.fieldsLabels.iAccept,linkText:n.options.fieldsLabels.privacyPolicy,validate:function(t){this.error=null,t||(this.error=n.options.errorMessages.termsAndConditionsAcceptRequired)},open:function(){var t=u||s.privacyPolicyKey;i.openGDPRContent({key:t})}})):(r.push(d),r.push(l)),a&&r.push(y);var t={gdprLinks:r,customTermsAndConditions:{key:p},customPrivacyPolicy:{key:u}};o(null,t)}})}};
"use strict";$app.controller("modalCtrl",["$scope","$dialog","$data",function(l,o,e){l.modal={},l.modal.body=e.body,l.modal.title=e.title||"Confirm",l.modal.okText=e.okText||"OK",l.modal.cancelText=e.cancelText||"Cancel",l.modal.disableCancel=e.disableCancel||!1,l.close=function(){o.close(!1)},l.confirm=function(){o.close(!0)}}]);
"use strict";setTimeout(function(){if(sessionStorage.getItem("notification"))try{var n=JSON.parse(sessionStorage.getItem("notification"));LocalNotificationsAPI.navToPlugin(n)}finally{sessionStorage.removeItem("notification")}},2e3);var LocalNotificationsAPI=function(){var o={},a="Cordova notification plugin not installed";function e(n){this.context=n,this.localNotificationChannel=null,"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.firebase&&cordova.plugins.firebase.messaging&&bfUtils.isAndroid&&7<device.version&&cordova.plugins.firebase.messaging.listChannels().then(n=>{let t=n.find(n=>"local-notifications"===n.id);t=t||cordova.plugins.firebase.messaging.createChannel({id:"local-notifications",name:"Local Notifications",importance:5}),this.localNotificationChannel=t})}function c(n){return o.hasOwnProperty(n)}function l(n){c(n)&&(clearTimeout(o[n]),delete o[n])}function i(){return"undefined"!=typeof cordova}return e.prototype={schedule:function(n,t){var a=Math.floor(1e9*Math.random()),i=new Date;e.isPluginAvailable()?(n.badge=0,n.at?n.at=Date.parse(n.at):n.at=new Date(i.getTime()+1e3),n.id=a,n.data={actionItem:n.actionItem,pluginData:n.data,returnInstanceId:n.returnToPluginInstanceId||this.context.instanceId,launchInstanceId:this.context.instanceId,pluginId:this.context.pluginId,analyticsData:n.analyticsData},this.localNotificationChannel&&this.localNotificationChannel.id&&(n.channel=this.localNotificationChannel.id),cordova.plugins.notification.local.schedule(n),t(null,{id:n.id})):(i=Math.abs(Date.parse(n.at)-Date.now()))<-2e3||(n.data={actionItem:n.actionItem,pluginData:n.data,returnInstanceId:n.returnToPluginInstanceId||this.context.instanceId,launchInstanceId:this.context.instanceId,pluginId:this.context.pluginId,analyticsData:n.analyticsData},i=setTimeout(function(){c(a)&&(e.notificationModal(n),l(a))},i),o[a]=i,t(null,{id:a}))},cancel:function(n,t){e.isPluginAvailable()?(cordova.plugins.notification.local.cancel(n),t(null,{id:n})):i()?t(new Error(a),null):(l(n),t(null,{id:n}))},checkPermission:function(n,t){if(i())return e.isPluginAvailable()?void cordova.plugins.notification.local.hasPermission(function(n){t&&t(null,n)}):(t&&t(new Error(a),!1),void console.warn(a));t&&t(null,!0)},requestPermission:function(n,t){if(i())return e.isPluginAvailable()?void cordova.plugins.notification.local.hasPermission(function(n){n?t&&t(null,!0):cordova.plugins.notification.local.registerPermission(function(n){n?t&&t(null,!0):(console.warn("Permission not granted for local notifications"),t&&t(null,!1))})}):(t&&t(new Error(a),!1),void console.warn(a));t&&t(null,!0)}},e.isPluginAvailable=function(){var n=!0;return n=!("undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.notification&&cordova.plugins.notification.local)?!1:n},e.getPlatform=function(){return device.platform?device.platform.toLowerCase():""},e.notificationModal=function(t){var n;t&&(t.title||t.text)&&(n={data:{title:t.title,body:t.text}},window.openDialog(n,function(n){n&&e.navToPlugin(t)}))},e.navToPlugin=function(o){var n=postMaster.launcherPluginAPI?0:1500;setTimeout(function(){var n,t,a,i;postMaster.launcherPluginAPI&&(t=2e3,i=(a={doNothing:0,sendToLauncher:1,sendToPlugin:2}).sendToPlugin,"object"!=typeof o.data&&(o.data=JSON.parse(o.data)),o.data.actionItem&&ActionItemsAPI.prototype.execute(o.data.actionItem,function(n,t){}),"home"==(n=o.data.returnInstanceId?o.data.returnInstanceId.toLowerCase():"")||"none"==n?i=a.doNothing:postMaster.launcherPluginAPI&&postMaster.launcherPluginAPI.context&&postMaster.launcherPluginAPI.context.instanceId==n&&(i=a.sendToLauncher),i!==a.doNothing&&(a===a.sendToLauncher?(t=500,postMaster.launcherPluginAPI.navigation.navigateHome()):(i=a.sendToPlugin,postMaster.widgetPluginAPI&&postMaster.widgetPluginAPI.context&&postMaster.widgetPluginAPI.context.instanceId==o.data.returnInstanceId?t=500:postMaster.launcherPluginAPI.navigation.navigateToPluginInstance({instanceId:o.data.returnInstanceId})),setTimeout(function(){var n=new Packet(null,"notifications.localNotification.onClick",o.data.pluginData);(i===a.sendToLauncher?postMaster.launcherPluginAPI:postMaster.widgetPluginAPI).sendMessage(null,n)},t)))},n)},e.sendAnalytics=function(n){n&&n.data&&("object"!=typeof n.data&&(n.data=JSON.parse(n.data)),n.data&&n.data.analyticsData&&n.data.analyticsData.eventName&&new AnalyticsAPI(window.appContext.currentApp.appId,n.data.pluginId,n.data.launchInstanceId,window.appContext.liveMode).trackAction(n.data.analyticsData.eventName,n.data.analyticsData.metaData))},e.onTrigger=n=>{console.log("*** notification trigger ***"),LocalNotificationsAPI.sendAnalytics(n),"ios"==LocalNotificationsAPI.getPlatform()&&LocalNotificationsAPI.notificationModal(n)},e.onClick=n=>{console.log("*** notification click ***"),LocalNotificationsAPI.sendAnalytics(n),LocalNotificationsAPI.navToPlugin(n)},e}();bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},function(){LocalNotificationsAPI.isPluginAvailable()&&(cordova.plugins.notification.local.on("trigger",LocalNotificationsAPI.onTrigger),cordova.plugins.notification.local.on("click",LocalNotificationsAPI.onClick))});
"use strict";function LocalStorageAPI(e){this.instanceId=e.instanceId,this.collectionKey=siteConfig.scope+"-"+this.instanceId+"-storage";e=localStorage.getItem(this.collectionKey);if(e)try{this.collection=JSON.parse(e)}catch(e){console.error(e),this.collection={}}else this.collection={}}LocalStorageAPI.prototype={setItem:function(t,l){if(t&&t.key&&t.value)if(void 0===t.value)delete this.collection[t.key];else try{let e=JSON.parse(JSON.stringify(this.collection));if(e[t.key]=t.value,e=JSON.stringify(e),e&&2048<e.length){var o="localStorage for a plugin instance may not exceed 2048 characters. consider using other buildfire storage options";return console.error(o),void l(new Error(o))}this.collection[t.key]=t.value,localStorage.setItem(this.collectionKey,JSON.stringify(this.collection)),l(null,!0)}catch(e){console.error(e),l(e,null)}else l(new Error("invalid parameters. Expected Key/Value object"))},getItem:function(e,t){(e=e&&e.key?e.key:e)&&t?t(null,void 0===(e=this.collection[e])?null:e):t(new Error("invalid parameters. Expected Key and Callback"))},removeItem:function(e,t){(e=e&&e.key?e.key:e)&&t?(delete this.collection[e],localStorage.setItem(this.collectionKey,JSON.stringify(this.collection)),t(null,!0)):t(new Error("invalid parameters. Expected Key and Callback"))},clear:function(e,t){localStorage.removeItem(this.collectionKey),t(null,!0)},getCollection:function(e,t){t(null,this.collection)}};
"use strict";var validator={validatePassword:function(t,a){if(a&&a.simplePasswordValidation)return t&&6<=t.length&&t.length<=60;if(!t||t.length<8||60<t.length)return!1;var e=/[A-Z]/.test(t),r=/[a-z]/.test(t),a=/\d/.test(t),t=/\W/.test(t);return e&&r&&a&&t},validateEmail:function(t){return!!t&&/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,24}$/.test(t)},passwordPattern:{test:function(t){return validator.validatePassword(t)}}};
"use strict";function PushNotificationsAPI(t){this.context=t}PushNotificationsAPI.prototype={schedule:function(t,o){var i;t&&t.text&&t.title?this.context&&this.context.instanceId?(t.groupName||(t.groupName=""),!(i={groupID:PushNotificationsAPI._getGroupID(this.context,t.groupName),users:t.users,userTags:t.userTags,title:t.title,message:t.text,sendAfter:t.at,source:"plugin",richMessage:t.inAppMessage||void 0,deviceIdCreatedBy:"undefined"!=typeof push&&push.deviceId?push.deviceId:null,sendToSelf:!0})===t.sendToSelf&&(i.sendToSelf=!1),i.sourceId=window.appContext.currentApp.appId+"_"+this.context.instanceId+"_"+i.source,!1!==t.actionItem&&(t.actionItem?i.actionItem=t.actionItem:i.actionItem={title:"View",action:"linkToApp",instanceId:this.context.instanceId,queryString:t.queryString}),authAPI.getCurrentUser(function(t,e){i.authCreatedBy=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/notification/",i).success(function(t){o&&o(null,t)}).error(function(t,e,i,n){o&&o(t)})})):o&&o("instanceId is null, unable to build groupID"):o&&o("text or title is empty")},cancel:function(i,o){var n;i?this.context&&this.context.instanceId?((n={source:"plugin"}).sourceId=window.appContext.currentApp.appId+"_"+this.context.instanceId+"_"+n.source,authAPI.getCurrentUser(function(t,e){n.authCanceledBy=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/notification/"+i+"/cancel",n).success(function(t){o&&o(null,!0)}).error(function(t,e,i,n){o&&o(t)})})):o&&o("instanceId is null, unable to build groupID"):o&&o("id is empty")},subscribe:function(t,e){(t=t||{}).groupName||(t.groupName=""),this.context&&this.context.instanceId?(t=PushNotificationsAPI._getGroupID(this.context,t.groupName),PushNotificationsAPI._subscribe({groupID:t},e)):e&&e("instanceId is null, unable to build groupID")},unsubscribe:function(t,e){(t=t||{}).groupName||(t.groupName=""),this.context&&this.context.instanceId?(t=PushNotificationsAPI._getGroupID(this.context,t.groupName),PushNotificationsAPI._unsubscribe({groupID:t},e)):e&&e("instanceId is null, unable to build groupID")}},PushNotificationsAPI._getGroupID=function(t,e){return window.appContext.currentApp.appId+"_"+t.instanceId+"_"+e},PushNotificationsAPI._unsubscribe=function(i,o){window.push&&window.push.deviceId&&window.push.platform?(i=i||{}).groupID?authAPI.getCurrentUser(function(t,e){i.deviceID=push.deviceId,i.os=window.push.platform?window.push.platform.toLowerCase():"",i.authUserId=e&&e._id?e._id.toString():null,bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/unsubscribe/",i).success(function(t){o&&o(null,!0)}).error(function(t,e,i,n){o&&o(t)})}):o("groupID is not specified"):o&&o("Device not ready to get the deviceId")},PushNotificationsAPI._getSubscriptions=function(e){var t,i;window.push&&window.push.deviceId&&window.push.platform?(t=window.siteConfig.endPoints.pushV2,i=window.appContext.currentApp.appId,t="".concat(t,"/api/app/").concat(i,"/subscriptions/"),i={deviceID:push.deviceId,os:window.push.platform?window.push.platform.toLowerCase():""},bfUtils.http.post(t,i).success(t=>e(null,t)).catch(t=>e(t,null))):e&&e("Device not ready to get the deviceId")},PushNotificationsAPI._subscribe=function(o,s){window.push&&window.push.deviceId&&window.push.platform?((o=o||{}).groupID||(o.groupID=""),authAPI.getCurrentUser(function(t,e){var i=window.push.platform?window.push.platform.toLowerCase():"",n="undefined"!=typeof PushNotification&&void 0!==PushNotification.listChannels,n="android"===i&&n||"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.firebase&&cordova.plugins.firebase.messaging;o.deviceID=push.deviceId,o.os=i,o.authUserId=e&&e._id?e._id.toString():null,o.device="undefined"!=typeof device?device:null,o.deliveryMethod=n?"FCM":null;n=localStorage.getItem("currentPushDeviceID");n&&n!==push.deviceId&&(o.oldDeviceID=n),bfUtils.http.post(window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscribe/",o).success(function(t){localStorage.setItem("currentPushDeviceID",push.deviceId),s&&s(null,!0)}).error(function(t,e,i,n){s&&s(t)})})):s&&s("Device not ready to get the deviceId")},authAPI.onLogin(function(){setTimeout(function(){PushNotificationsAPI._subscribe()},2e3)}),authAPI.onLogout(function(){setTimeout(function(){PushNotificationsAPI._subscribe()},2e3)});
"use strict";function FirebaseAPI(n){this.context=n}FirebaseAPI.prototype={createCustomToken:function(i,o){var a=this;function s(t){FirebaseAPI._getUser({instanceId:a.context.instanceId,appId:window.appContext.currentApp.appId,integrationToken:i.integrationToken},function(n,e){if(!e||i&&i.forceLogin){let n=null;n="cp"===siteConfig.scope?"/api/user/firebase/cp/login":"/api/user/firebase/login",bfUtils.http.post(window.siteConfig.endPoints.appHost+n,{authUserId:t._id,authAccessToken:t.accessToken,pluginTypesToken:a.context.pluginId,appId:window.appContext.currentApp.appId,instanceId:a.context.instanceId,integrationToken:i.integrationToken}).success(function(n){FirebaseAPI._setUser({instanceId:a.context.instanceId,appId:window.appContext.currentApp.appId,integrationToken:i.integrationToken},n),o&&o(null,n)}).error(function(n,e,t,i){401!=e&&403!=e||"cp"===siteConfig.scope?o&&o(n):(authAPI.logout(),authAPI.login({},function(n,e){e?s(e):o&&o(null,null)}))})}else o&&o(null,e)})}authAPI.getCurrentUser(function(n,e){e?s(e):authAPI.login({},function(n,e){e?s(e):o&&o(null,null)})})}},function(){var o={};FirebaseAPI._getUser=function(n,e){var t=n.appId+"_"+n.instanceId+"_"+n.integrationToken,i=o[t],n=new Date;n.setMinutes(n.getMinutes()-60),i&&i.createdOn>n?e(null,i.value):(o[t]=void 0,e(null,null))},FirebaseAPI._setUser=function(n,e){n=n.appId+"_"+n.instanceId+"_"+n.integrationToken;o[n]={createdOn:new Date,value:e}},authAPI.onLogout(function(){o={}})}();
"use strict";function PublicFilesAPI(e){this.context=e,this.currentUser=null}PublicFilesAPI.prototype={getFileUrl:function(i,s){const o=this.context.appId;authAPI.getCurrentUser(function(e,t){if(e)return s(e);let n;t&&(n=t.accessToken);var e=i["fileId"],t=new XMLHttpRequest;t.addEventListener("readystatechange",function(){4===this.readyState&&s(null,JSON.parse(this.responseText))}),t.addEventListener("error",function(e){s(e)}),t.open("GET","".concat(window.siteConfig.endPoints.publicFilesHost,"/file/").concat(e,"/?appId=").concat(o,"&returnUrl=true")),t.setRequestHeader("Authorization",n),t.setRequestHeader("x-scope",window.siteConfig.scope),t.send()})},modifyPermissions:function(s,o){const r=this.context.appId;authAPI.getCurrentUser(function(e,t){if(e)return o(e);let n;t&&(n=t.accessToken);var{fileId:i,permissions:e}=s,t=JSON.stringify({permissions:e,appId:r}),e=new XMLHttpRequest;e.addEventListener("readystatechange",function(){4===this.readyState&&o(null,JSON.parse(this.responseText))}),e.addEventListener("error",function(e){o(e)}),e.open("PATCH","".concat(window.siteConfig.endPoints.publicFilesHost,"/file/").concat(i)),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",n),e.setRequestHeader("x-scope",window.siteConfig.scope),e.send(t)})},deleteFile:function(i,s){authAPI.getCurrentUser(function(e,t){if(e)return s(e);let n;t&&(n=t.accessToken);var e=i["fileId"],t=new XMLHttpRequest;t.addEventListener("readystatechange",function(){4===this.readyState&&s(null,JSON.parse(this.responseText))}),t.addEventListener("error",function(e){s(e)}),t.open("DELETE","".concat(window.siteConfig.endPoints.publicFilesHost,"/file/").concat(e)),t.setRequestHeader("x-scope",window.siteConfig.scope),t.setRequestHeader("Authorization",n),t.send()})},showDialog:function(e,t){e=e||{};var n=this,i=document.getElementById("publicFiles_input_form");i?i.innerHTML="":((i=document.createElement("form")).setAttribute("id","publicFiles_input_form"),document.body.appendChild(i));var s=document.createElement("input");s.setAttribute("type","file"),s.setAttribute("style","display:none"),s.setAttribute("id","publicFilesHiddenInput"+(new Date).toISOString()),i.appendChild(s),e&&e.allowMultipleFilesUpload&&(s.setAttribute("multiple",""),s.setAttribute("name","files[]")),e&&e.filter&&(s.accept=e.filter.join(",")),s.addEventListener("change",function(){n.uploadFiles(this.files,e,t)},!1),s.click()},uploadFilesManually:function(e,t){this.uploadFiles(e.files,e,t)},uploadFiles:function(n,a,i){var s=[],o=[],l=this;i||"function"!=typeof a||(i=a,a={}),a=a||{};var u=new AnalyticsAPI(l.context.appId,l.context.pluginId,l.context.instanceId,window.appContext.liveMode);authAPI.getCurrentUser(function(e,t){return e?i(e):t&&t.accessToken?(l.currentUser=t,void function(e){for(var t=0;t<e.length;t++){var n={fileId:t,filename:e[t].name};e[t].fileId=t,o.push(n),s.push(function(o,r){return new Promise(function(n,e){var t,i,s=!0;a.filter&&!function(e,t){for(var n=0;n<=t.length;n++)if(t[n]==e.type||function(e,t){if("string"!=typeof t||t.indexOf("/")<0)return!1;if("string"!=typeof e||e.indexOf("/")<0)return!1;var[n,i]=e.split("/"),[e,t]=t.split("/"),e=n===e,t="*"===i||i===t;return e&&t}(t[n],e.type))return!0;return!1}(o,a.filter)&&(r.status="failed",r.error="invalid File Format",l._onComplete&&l._onComplete(r),s=!1,n(r)),1073741824<o.size&&(r.status="failed",r.error="invalid File Size",l._onComplete&&l._onComplete(r),s=!1,n(r)),s&&((t=new FormData).append("pluginId",l.context.pluginId),t.append("instanceId",l.context.instanceId),t.append("appId",l.context.appId),a.permissions&&t.append("permissions",JSON.stringify(a.permissions)),l.currentUser&&l.currentUser.accessToken&&t.append("accessToken",l.currentUser.accessToken),t.append("file",o),i=new XMLHttpRequest,s=function(e){e.lengthComputable&&(e=Math.round(100*e.loaded/e.total),r.percentage=e,l._onProgress&&l._onProgress(r))},bfUtils.isMobileDevice?i.upload.onprogress=s:i.upload.addEventListener("progress",s,!1),i.onload=function(){var e,t=null;if(i.responseText)try{t=JSON.parse(i.responseText)}catch(e){}200==i.status?(r.url=t.url,r.size=t.size,r.type=t.type,r.fileId=t.fileId,r.status="success",e={data:{url:t.url,size:t.size,type:t.type},_buildfire:{aggregationValue:t.size}},"app"==window.siteConfig.scope?u.trackAction("app/publicFilesUpload",e):u.trackAction("cp/publicFilesUpload",e)):(r.status="failed",t.message?r.error=t.message:r.error="An error has occurred"),l._onComplete&&l._onComplete(r),n(r)},i.onerror=function(){r.status="failed",l._onComplete&&l._onComplete(r),n(r)},i.timeout=48e4,i.open("POST",window.siteConfig.endPoints.publicFilesHost+"/file/upload/"),i.setRequestHeader("x-scope",window.siteConfig.scope),i.send(t))})}(e[t],n))}Promise.all(s).then(function(e){i(null,e)}).catch(()=>{i(!0,null)})}(n)):i(new Error("Login is required"))})},onProgress:function(e){this._onProgress=e},onComplete:function(e){this._onComplete=e}};
"use strict";const imagePreviewerAPI={show(e,t){this.initialized||this.renderHTML();let o=document.querySelectorAll(".pswp")[0];t=t||Function.prototype;let s={index:0<=e.index?e.index:0,history:!1,counterEl:!1,captionEl:!1,fullscreenEl:!1,zoomEl:!1,arrowEl:!1,preloaderEl:!1,shareEl:!1,tapToToggleControls:!1,correctOrientation:!0,clickToCloseNonZoomable:!1,closeOnScroll:!1},i=window.PhotoSwipeUI_Default;if(e&&e.images&&e.images.length){e.images[0]&&e.images[0].name&&(e.images=e.images.map(e=>e.name));let n=[];window.spinner.show(),e.images.forEach(t=>{var e=new Promise(e=>{let n=new Image;n.onload=()=>e(n),n.src="".concat(window.siteConfig.endPoints.cloudImageHost,"/").concat(t)});n.push(e)}),Promise.all(n).then(e=>{let n=[];e.forEach(i=>{n.push(new Promise(s=>{EXIF.getData(i,function(){var e=EXIF.getTag(this,"Orientation");let{src:n,naturalHeight:t,naturalWidth:o}=i;n=n.replace(/q1/,"n"),s(3===e||6===e?{src:imageTools.cropImage(n,{width:o,height:t}),msrc:imageTools.cropImage(n,{width:Math.round(o/3),height:Math.round(t/3)}),w:t,h:o}:{src:imageTools.cropImage(n,{width:o,height:t}),msrc:imageTools.cropImage(n,{width:Math.round(o/3),height:Math.round(t/3)}),w:o,h:t})})}))}),Promise.all(n).then(e=>{window.pswp=new PhotoSwipe(o,i,e,s),window.pswp.listen("close",t),window.pswp.init(),window.spinner.hide()})})}},renderHTML(){let e=document.createElement("div");e.style.position="relative",e.style.zIndex=99999999,e.innerHTML='\n    \x3c!-- Root element of PhotoSwipe. Must have class pswp. --\x3e\n    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">\n\n        \x3c!-- Background of PhotoSwipe.\n             It\'s a separate element as animating opacity is faster than rgba(). --\x3e\n        <div class="pswp__bg"></div>\n\n        \x3c!-- Slides wrapper with overflow:hidden. --\x3e\n        <div class="pswp__scroll-wrap">\n\n            \x3c!-- Container that holds slides.\n                PhotoSwipe keeps only 3 of them in the DOM to save memory.\n                Don\'t modify these 3 pswp__item elements, data is added later on. --\x3e\n            <div class="pswp__container">\n                <div class="pswp__item"></div>\n                <div class="pswp__item"></div>\n                <div class="pswp__item"></div>\n            </div>\n\n            \x3c!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. --\x3e\n            <div class="pswp__ui pswp__ui--hidden">\n\n                <div class="pswp__top-bar" style="background: transparent !important; padding-top: env(safe-area-inset-top); padding-top: const(safe-area-inset-top);">\n\n                    \x3c!--  Controls are self-explanatory. Order can be changed. --\x3e\n\n                    <div class="pswp__counter"></div>\n\n                    <span class="glyphicon glyphicon-remove pswp__button pswp__button--close" title="Close (Esc)" style="color: #FFF !important;font-size: 20pt;padding: 15px;width:55px;height:55px">\n                    </span>\n\n                    <button class="pswp__button pswp__button--share" title="Share"></button>\n\n                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>\n\n                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>\n\n                    \x3c!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR --\x3e\n                    \x3c!-- element will get class pswp__preloader--active when preloader is running --\x3e\n                    <div class="pswp__preloader">\n                        <div class="pswp__preloader__icn">\n                          <div class="pswp__preloader__cut">\n                            <div class="pswp__preloader__donut"></div>\n                          </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">\n                    <div class="pswp__share-tooltip"></div>\n                </div>\n\n                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">\n                </button>\n\n                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">\n                </button>\n\n                <div class="pswp__caption">\n                    <div class="pswp__caption__center"></div>\n                </div>\n\n            </div>\n\n        </div>\n\n    </div>\n    ',(0<=window.location.pathname.toLowerCase().indexOf("plugintester")?document.getElementById("app"):document.body).appendChild(e),this.initialized=!0}};
"use strict";function searchEngineAPI(e){this.context=e}searchEngineAPI.prototype={_sendRequest:function(e,i,t,n){var s="",a=new XMLHttpRequest,i=window.siteConfig.endPoints.searchEngineHost+"/search_engine/"+i;if("GET"===(e=e.toUpperCase())&&t){var d,g="?";for(d in t)t.hasOwnProperty(d)&&(g+=d+"="+encodeURIComponent(t[d])+"&");i+=g=g.slice(0,-1)}else s=JSON.stringify(t);a.open(e,i,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("app_id",this.context.appId),a.setRequestHeader("x-api-key","GpzNPRVIld3WxoKDAXJZM7cjoUA5p0rS6pqYkCqy"),a.onreadystatechange=function(){var e=null;try{e=JSON.parse(a.responseText)}catch(e){}4==a.readyState&&(200===a.status?n&&n(null,e):n&&n(e))},a.send(s)},search:function(e,t){var n,i=this;function s(){i._sendRequest("POST","search",n,function(e,i){t&&t(e,i)})}e?(n={instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag,page_index:e.pageIndex,page_size:e.pageSize,search_text:e.searchText,pre_highlight_tag:e.preHighlightTag,post_highlight_tag:e.postHighlightTag},e.linkedUser?window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,n.user_id?s():t&&t({message:"no user found"})}):s()):t&&t("invalid params",null)},insert:function(e,t){var n,i=this;function s(){i._sendRequest("POST","",n,function(e,i){t&&t(e,i)})}e?e.tag?e.title?(n={instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag,title:e.title,description:e.description,keywords:e.keywords,image_url:e.imageUrl,data:e.data},e.linkedUser?window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,n.user_id?s():t&&t({message:"no user found"})}):s()):t&&t({message:"Missing params title"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"invalid params"},null)},save:function(e,t){var n,i=this;function s(){i._sendRequest("POST","save",n,function(e,i){t&&t(e,i)})}e?e.key?e.tag?e.title?(n={instance_id:this.context.instanceId,plugin_id:this.context.pluginId,key:e.key,tag:e.tag,title:e.title,description:e.description,keywords:e.keywords,image_url:e.imageUrl,data:e.data},e.linkedUser?window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,n.user_id?s():t&&t({message:"no user found"})}):s()):t&&t({message:"Missing params title"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"Missing params key"},null):t&&t({message:"invalid params"},null)},update:function(e,t){var n,i=this;function s(){i._sendRequest("PUT","",n,function(e,i){t&&t(e,i)})}e?e.id?e.tag?e.title?(n={id:e.id,instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag,title:e.title,description:e.description,keywords:e.keywords,image_url:e.imageUrl,data:e.data},e.linkedUser?window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,n.user_id?s():t&&t({message:"no user found"})}):s()):t&&t({message:"Missing params title"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"Missing params id"},null):t&&t({message:"invalid params"},null)},delete:function(e,t){var n,s=this;e?e.id?e.tag?(n={id:e.id,instance_id:this.context.instanceId,plugin_id:this.context.pluginId,tag:e.tag},window.authAPI.getCurrentUser(function(e,i){n.user_id=i&&i._id?i._id.toString():null,s._sendRequest("DELETE","",n,function(e,i){t&&t(e,i)})})):t&&t({message:"Missing params tag"},null):t&&t({message:"Missing params id"},null):t&&t({message:"invalid params"},null)},get feeds(){var n=this;return{insert:function(e,t){var i;e?e.tag?e.title?e.feedType?e.feedConfig&&e.feedConfig.url?(e.feedItemConfig||(e.feedItemConfig={}),i={instance_id:n.context.instanceId,plugin_id:n.context.pluginId,tag:e.tag,title:e.title,description:e.description,feed_type:e.feedType,feed_config:{url:e.feedConfig.url},feed_item_config:{unique_key:e.feedItemConfig.uniqueKey,title_key:e.feedItemConfig.titleKey,description_key:e.feedItemConfig.descriptionKey,url_key:e.feedItemConfig.urlKey,publish_date_key:e.feedItemConfig.publishDateKey,image_url_key:e.feedItemConfig.imageUrlKey}},n._sendRequest("POST","feeds",i,function(e,i){t&&t(e,i)})):t&&t({message:"Missing params feedConfig.url"},null):t&&t({message:"Missing params feedType"},null):t&&t({message:"Missing params title"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"invalid params"},null)},delete:function(e,t){var i;e?e.tag?e.feedId?(i={instance_id:n.context.instanceId,plugin_id:n.context.pluginId,tag:e.tag,feed_id:e.feedId,remove_feed_data:e.removeFeedData},n._sendRequest("DELETE","feeds",i,function(e,i){t&&t(e,i)})):t&&t({message:"Missing params feedId"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"invalid params"},null)},get:function(e,t){var i;e?e.tag?e.feedType?(i={instance_id:n.context.instanceId,plugin_id:n.context.pluginId,tag:e.tag,feed_type:e.feedType},n._sendRequest("GET","feeds",i,function(e,i){t&&t(e,i)})):t&&t({message:"Missing params feedType"},null):t&&t({message:"Missing params tag"},null):t&&t({message:"invalid params"},null)}}}};
"use strict";function CreditsAPI(e){if(this.context=e,!this.context)throw Error("invalid creditsSystem context");this.context.apiKeys&&(this.secretKey=this.context.apiKeys.creditsSystemSecretKey)}CreditsAPI.prototype={_sendRequest:function(e,n,t,s){var i="",r=void 0,c=void 0;t.public_key&&(r=t.public_key),t.secret_key&&(c=t.secret_key),delete t.public_key,delete t.secret_key;var a=new XMLHttpRequest,n=window.siteConfig.endPoints.creditSystemHost+"/credit_system/"+n;if("GET"===(e=e.toUpperCase())&&t){var o,u="?";for(o in t)t.hasOwnProperty(o)&&(u+=o+"="+encodeURIComponent(t[o])+"&");n+=u=u.slice(0,-1)}else i=JSON.stringify(t);a.open(e,n,!0),a.setRequestHeader("Content-Type","application/json"),r&&a.setRequestHeader("public_key",r),c&&a.setRequestHeader("secret_key",c),a.setRequestHeader("x-api-key","ZBtYjI3ZlNaKdhWApTjIF3NYaynO4snJ1zikGTDr"),a.onreadystatechange=function(){var e=null;try{e=JSON.parse(a.responseText)}catch(e){}4==a.readyState&&(200===a.status?s&&s(null,e):s&&s(e))},a.send(i)},updateMerchant:function(s,i){var r=this;appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,json_config:s.jsonConfig};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("PUT","merchants",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})})},purchaseBundle:function(r,c){var a=this;function s({sessionId:s,transactionId:i}){i?s?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,payment_provider:r.paymentProvider,transaction_id:i,stripe:{session_id:s},bundle_id:r.bundleId,access_token:r.access_token};window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?a._sendRequest("POST","credits/purchase",t,function(e,n){c&&c(e,n)}):c&&c({message:"no logged in user"})})}):c&&c("Missing sessionId parameter in purchase",null):c&&c("Missing transactionId parameter in purchase",null)}r?r.bundleId?window.authAPI.getCurrentUser(function(e,n){r.access_token=n&&n.accessToken?n.accessToken.toString():null,r.access_token?(r.paymentProvider="stripe",appApiKeys.get(function(e,n){n={public_key:n.creditsSystemPublicKey,payment_provider:r.paymentProvider,bundle_id:r.bundleId,memo:r.memo,x_ref_1:r.xRef1,x_ref_2:r.xRef2,x_ref_3:r.xRef3,access_token:r.access_token};a._sendRequest("POST","credits/transactions",n,function(e,t){if(e)c(e);else if(t&&t.transactionId&&t.stripe&&t.stripe.clientReferenceId){let e=new StripeAPI(a.context);e.purchase({items:[{sku:t.stripe.skuId}],clientReferenceId:t.stripe.clientReferenceId},function(e,n){e||s({transactionId:t.transactionId,sessionId:n.id})})}else c({message:"missing stripe data in transaction"})})})):c&&c({message:"no logged in user"})}):c&&c("Missing bundleId parameter",null):c&&c("invalid params",null)},getMerchant:function(e,s){var i=this;appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,secret_key:i.secretKey};i._sendRequest("GET","merchants",t,function(e,n){s&&s(e,n)})})},getBundles:function(e,s){var i=this;appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,secret_key:i.secretKey};i._sendRequest("GET","bundles",t,function(e,n){s&&s(e,n)})})},deleteBundle:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,bundle_id:s.bundleId};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("DELETE","bundles",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},insertBundle:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,name:s.name,stripe_product_id:s.stripeProductId,description:s.description,credit_amount:s.creditAmount,user_token:s.userToken,image_url:s.imageUrl};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("POST","bundles",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},updateBundle:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,name:s.name,stripe_product_id:s.stripeProductId,description:s.description,credit_amount:s.creditAmount,bundle_id:s.bundleId,user_token:s.userToken,image_url:s.imageUrl};window.authAPI.getCurrentUser(function(e,n){t.user_token=n&&n._id?n._id.toString():null,t.user_token?r._sendRequest("PUT","bundles",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},adjustCredits:function(s,i){var r=this;s?s.userToken?s.creditAmount?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,user_token:s.userToken,credit_amount:s.creditAmount,memo:s.memo,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3};window.authAPI.getCurrentUser(function(e,n){t.created_by_user_token=n&&n._id?n._id.toString():null,t.created_by_user_token?r._sendRequest("POST","credits/adjust",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid creditAmount",null):i&&i("invalid userToken",null):i&&i("invalid params",null)},consumeCredits:function(s,i){var r=this;s?s.creditAmount?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,credit_amount:s.creditAmount,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3,memo:s.memo};window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?r._sendRequest("POST","credits/consume",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("Missing creditAmount parameter",null):i&&i("invalid params",null)},transferCredits:function(s,i){var r=this;s?s.creditAmount?s.receiverUserToken||s.receiverUserEmail?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,credit_amount:s.creditAmount,receiver_user_token:s.receiverUserToken,receiver_user_email:s.receiverUserEmail,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3};window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?r._sendRequest("POST","credits/transfer",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("Missing (receiverUserToken or receiverUserEmail) parameter",null):i&&i("Missing creditAmount parameter",null):i&&i("invalid params",null)},searchTransactions:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey,secret_key:r.secretKey,users_tokens:s.usersTokens,page_size:s.pageSize,page_index:s.pageIndex,from_date:s.fromDate,to_date:s.toDate,x_ref_1:s.xRef1,x_ref_2:s.xRef2,x_ref_3:s.xRef3};window.authAPI.getCurrentUser(function(e,n){!t.public_key||(t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token)?r._sendRequest("POST","credits/transactions/search",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},getUser:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={public_key:n.creditsSystemPublicKey};s.secretKey&&(t.secret_key=s.secretKey),window.authAPI.getCurrentUser(function(e,n){t.access_token=n&&n.accessToken?n.accessToken.toString():null,t.access_token?r._sendRequest("GET","credits/user",t,function(e,n){i&&i(e,n)}):i&&i({message:"no logged in user"})})}):i&&i("invalid params",null)},searchUsers:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t={secret_key:r.secretKey,users_tokens:s.usersTokens,page_size:s.pageSize,page_index:s.pageIndex};r._sendRequest("POST","credits/users",t,function(e,n){i&&i(e,n)})}):i&&i("invalid params",null)},getTransactionsLogs:function(s,i){var r=this;s?appApiKeys.get(function(e,n){var t;s.creditTransactionId?(t={secret_key:r.secretKey},r._sendRequest("GET","credits/transaction/"+s.creditTransactionId+"/logs",t,function(e,n){i&&i(e,n)})):i&&i("Missing creditTransactionId parameter",null)}):i&&i("invalid params",null)}};
"use strict";function StripeAPI(e){if(this.context=e,!this.context)throw Error("stripeAPI: invalid context")}StripeAPI.prototype={_sendRequest:function(e,t,n,i,s){var c="",o=new XMLHttpRequest,t=window.siteConfig.endPoints.stripeHost+"/stripe/"+t;if("GET"===(e=e.toUpperCase())&&n){var a="?";for(u in n)n.hasOwnProperty(u)&&void 0!==n[u]&&(a+=u+"="+encodeURIComponent(n[u])+"&");t+=a=a.slice(0,-1)}else c=JSON.stringify(n);if(o.open(e,t,!0),o.setRequestHeader("Content-Type","application/json"),i)for(var u in i)i.hasOwnProperty(u)&&o.setRequestHeader(u,i[u]);o.onreadystatechange=function(){var e=null;try{e=JSON.parse(o.responseText)}catch(e){}4==o.readyState&&(200===o.status?s&&s(null,e):s&&s(e))},o.send(c)},_loadScript:function(e,t){var n=document.createElement("script");if(n.type="text/javascript",n.readyState?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=null,t&&t())}:n.onload=function(){t&&t()},n.src=e.url,e.attr)for(var i in e.attr)n.setAttribute(i,e.attr[i]);for(var s=document.getElementsByTagName("script"),c=s.length;c--;)if(s[c].src==e.url)return t&&t(),!0;document.getElementsByTagName("head")[0].appendChild(n)},_guid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},_openStripeCheckout:function({items:e,successUrl:t,cancelUrl:n,submitType:i,customerEmail:s,sessionId:c,clientReferenceId:o,domain:a,events:u},l){var r=this,p=null,d=!1,m=null,y=!1;function f(){window.richModal&&window.richModal.close()}function _(e){e=e||{},clearInterval(p),!e.invokeDismiss&&void 0!==e.invokeDismiss||f(),m&&m.close(),u&&"function"==typeof u.onClose&&u.onClose()}function K(){r._sendRequest("GET","checkout/sessions",{session_id:c,client_reference_id:o},{"x-api-key":r.context.apiKeys.awsApiPublicKey},function(e,t){t&&(y||(y=!0,_(),l&&l(e,t)))})}var w=a+"/payments/checkout?stripeKey="+r.context.apiKeys.stripePublicKey;function x(){(m=window.open(w,"_blank","location=no")).addEventListener("exit",function(){f()}),m.addEventListener("close",function(){f()}),p=setInterval(function(){m&&m.closed&&_(),"visible"==window.document.visibilityState?K():d||(d=!0,setTimeout(function(){d=!1,K()},6e4))},5e3),setTimeout(function(){_()},9e5)}c&&(w+="&sessionId="+encodeURIComponent(c)),o&&(w+="&clientReferenceId="+encodeURIComponent(o)),t&&(w+="&successUrl="+encodeURIComponent(t)),n&&(w+="&cancelUrl="+encodeURIComponent(n)),i&&(w+="&submitType="+encodeURIComponent(i)),s&&(w+="&customerEmail="+encodeURIComponent(s)),e&&(w+="&items="+encodeURIComponent(JSON.stringify(e))),window.bfUtils.isApp&&window.richModal.display({title:"",showDismissButton:!1,richContent:"<div style='text-align:center;'>Payment in progress <br/> Please wait...</div>",action:{title:"Cancel",handler:function(){_({invokeDismiss:!1})}}}),u&&"function"==typeof u.onProgress&&u.onProgress(x),x()},_openStripeConnect:function({accessToken:e,accountLinkUrl:t,events:n},i){let s=this,c=null,o=!1,a=null,u=!1;function l(e){e=e||{},clearInterval(c),(e.invokeDismiss||void 0===e.invokeDismiss)&&window.richModal&&window.richModal.close(),a&&a.close(),n&&"function"==typeof n.onClose&&n.onClose()}function r(){s._sendRequest("GET","connect/account",{access_token:e},{"x-api-key":s.context.apiKeys.awsApiPublicKey},function(e,t){t&&t.is_active&&(u||(u=!0,l(),i&&i(e,t)))})}const p=t;function d(){a=window.open(p,"_blank","location=no"),c=setInterval(function(){a&&a.closed&&l(),"visible"==window.document.visibilityState?r():o||(o=!0,setTimeout(function(){o=!1,r()},6e4))},1e4),setTimeout(function(){l()},18e5)}n&&"function"==typeof n.onProgress&&n.onProgress(d),window.bfUtils.isApp&&window.richModal.display({title:"",showDismissButton:!1,richContent:"<div style='text-align:center;'>Stripe Connect in progress <br/> Please wait...</div>",action:{title:"Cancel",handler:function(){l({invokeDismiss:!1})}}}),!1===s.openPaymentWindow||d()},_checkApiKeys:function(n){var i=this;function e(){appApiKeys.get(function(e,t){i.context.apiKeys=t,n&&n()})}i.context.apiKeys&&i.context.apiKeys.awsApiPublicKey?n&&n():!window.appContext.currentApp.apiKeys||0===Object.keys(window.appContext.currentApp.apiKeys).length&&window.appContext.currentApp.apiKeys.constructor===Object?e():(i.context.apiKeys=window.appContext.currentApp.apiKeys,n&&n())},pay:function(e,n){var i=this;i._checkApiKeys(function(){i.context.apiKeys.stripePublicKey?i._loadScript({url:"https://checkout.stripe.com/checkout.js"},function(){var t=StripeCheckout.configure({key:i.context.apiKeys.stripePublicKey,image:"https://stripe.com/img/documentation/checkout/marketplace.png",locale:"auto",token:function(e){t.close(),n&&n(null,{sourceToken:e})}});t.open({}),window.addEventListener("popstate",function(){t.close()})}):n&&n("Missing stripePublicKey in context",null)})},charge:function(c,o){var a=this;a._checkApiKeys(function(){if(a.context.apiKeys.stripePublicKey)if(c)if(a.openPaymentWindow=c.openPaymentWindow,c.items&&0!=c.items.length){for(var t=[],n=0;n<c.items.length;n++){if(!c.items[n].name)return void(o&&o("Missing name in items index "+n,null));if(!c.items[n].amount)return void(o&&o("Missing amount in items index "+n,null));let e={name:c.items[n].name,description:c.items[n].description||void 0,amount:c.items[n].amount,currency:c.items[n].currency||"usd",quantity:c.items[n].quantity||1};c.items[n].taxBehavior&&(e.tax_behavior=c.items[n].taxBehavior),t.push(e)}var i=window.siteConfig.endPoints.appHost,s="app_id_"+a.context.appId+"_ref_id_"+a._guid(),e={type:"line_items",mode:"payment",line_items:t,client_reference_id:s,success_url:i+"/payments/success",cancel_url:i+"/payments/cancel"};c.submitType&&(e.submit_type=c.submitType),c.customerId&&(e.customer_id=c.customerId),c.customerEmail&&(e.customer_email=c.customerEmail),c.captureMethod&&(e.payment_intent_data={capture_method:c.captureMethod}),c.automaticTax&&(e.automatic_tax={enabled:c.automaticTax}),a._sendRequest("POST","checkout/sessions",e,{"x-api-key":a.context.apiKeys.awsApiPublicKey},function(e,t){e?o&&o(e,t):(t=t.sessionId,a._openStripeCheckout({sessionId:t,clientReferenceId:s,domain:i,events:c.events},function(e,t){o&&o(e,t)}))})}else o&&o("Missing items",null);else o&&o("invalid params",null);else o&&o("Missing stripePublicKey in context",null)})},subscribe:function(c,o){var a=this;a._checkApiKeys(function(){if(a.context.apiKeys.stripePublicKey)if(a.context.apiKeys.awsApiPublicKey)if(c)if(a.openPaymentWindow=c.openPaymentWindow,c.items&&0!=c.items.length){for(var e=[],t=0;t<c.items.length;t++){if(!c.items[t].planId)return void(o&&o("Missing planId in items index "+t,null));e.push({plan_id:c.items[t].planId,quantity:c.items[t].quantity||1})}var n=window.siteConfig.endPoints.appHost,i="app_id_"+a.context.appId+"_ref_id_"+a._guid(),s={type:"subscription",subscription_data:e,client_reference_id:i,success_url:n+"/payments/success",cancel_url:n+"/payments/cancel"};c.trialPeriodDays&&(s.trial_period_days=c.trialPeriodDays),c.customerId&&(s.customer_id=c.customerId),c.customerEmail&&(s.customer_email=c.customerEmail),c.metadata&&(s.metadata=c.metadata),c.automaticTax&&(s.automatic_tax={enabled:c.automaticTax}),a._sendRequest("POST","checkout/sessions",s,{"x-api-key":a.context.apiKeys.awsApiPublicKey},function(e,t){e?o&&o(e,t):(t=t.sessionId,a._openStripeCheckout({sessionId:t,clientReferenceId:i,domain:n,events:c.events},function(e,t){o&&o(e,t)}))})}else o&&o("Missing items",null);else o&&o("invalid params",null);else o&&o("Missing awsApiPublicKey in context",null);else o&&o("Missing stripePublicKey in context",null)})},purchase:function(a,u){var l=this;l._checkApiKeys(function(){if(l.context.apiKeys.stripePublicKey)if(l.context.apiKeys.awsApiPublicKey)if(a)if(a.items&&0!=a.items.length){const c=[];let t=!1,n=!1;for(let e=0;e<a.items.length;e++)a.items[e].sku?t=!0:a.items[e].price&&(n=!0);if(t||n)if(t&&n)u&&u("You can't use sku and price together in a request",null);else{for(let e=0;e<a.items.length;e++){if(!a.items[e].sku&&!a.items[e].price)return void(u&&u("Missing property, one of sku or price is required in items index "+e,null));const o={quantity:a.items[e].quantity||1};t?o.sku=a.items[e].sku:o.price=a.items[e].price,c.push(o)}var i=window.siteConfig.endPoints.appHost,s="app_id_"+l.context.appId+"_ref_id_"+l._guid();a.clientReferenceId&&(s=a.clientReferenceId);let e={};n?(e={type:"purchase",mode:"payment",line_items:c,client_reference_id:s,success_url:i+"/payments/success",cancel_url:i+"/payments/cancel"},a.submitType&&(e.submit_type=a.submitType),a.customerId&&(e.customer_id=a.customerId),a.customerEmail&&(e.customer_email=a.customerEmail),a.automaticTax&&(e.automatic_tax={enabled:a.automaticTax}),l._sendRequest("POST","checkout/sessions",e,{"x-api-key":l.context.apiKeys.awsApiPublicKey},function(e,t){e?u&&u(e,t):l._openStripeCheckout({sessionId:t.sessionId,clientReferenceId:s,domain:i,events:a.events},function(e,t){u&&u(e,t)})})):(e={items:c,clientReferenceId:s,successUrl:i+"/payments/success",cancelUrl:i+"/payments/cancel",submitType:a.submitType,customerEmail:a.customerEmail,domain:i,events:a.events},l._openStripeCheckout(e,function(e,t){u&&u(e,t)}))}else u&&u("One of sku or price field is required for items",null)}else u&&u("Missing items",null);else u&&u("invalid params",null);else u&&u("Missing awsApiPublicKey in context",null);else u&&u("Missing stripePublicKey in context",null)})},getSubscription:function(t,n){var i=this;i._checkApiKeys(function(){var e;i.context.apiKeys.awsApiPublicKey?t?t.subscriptionId?(e={subscription_id:t.subscriptionId},i._sendRequest("GET","customer/subscription",e,{"x-api-key":i.context.apiKeys.awsApiPublicKey},function(e,t){n&&n(e,t)})):n&&n("Missing params subscriptionId",null):n&&n("invalid params",null):n&&n("Missing awsApiPublicKey in context",null)})},cancelSubscription:function(t,n){var i=this;i._checkApiKeys(function(){var e;i.context.apiKeys.awsApiPublicKey?t?t.subscriptionId?t.customerId?(e={subscription_id:t.subscriptionId,customer_id:t.customerId},i._sendRequest("DELETE","customer/subscription",e,{"x-api-key":i.context.apiKeys.awsApiPublicKey},function(e,t){n&&n(e,t)})):n&&n("Missing params customerId",null):n&&n("Missing params subscriptionId",null):n&&n("invalid params",null):n&&n("Missing awsApiPublicKey in context",null)})},addCustomer:function(e,n){var t=this;t._checkApiKeys(function(){t.context.apiKeys.awsApiPublicKey?e?e.email?t._sendRequest("POST","customer",e,{"x-api-key":t.context.apiKeys.awsApiPublicKey},function(e,t){n&&n(e,t)}):n&&n("Missing params email",null):n&&n("invalid params",null):n&&n("Missing awsApiPublicKey in context",null)})},addCustomerCard:function(s,c){var o=this;o._checkApiKeys(function(){var n,i,e;o.context.apiKeys.stripePublicKey?o.context.apiKeys.awsApiPublicKey?s?s.customerId?(n=window.siteConfig.endPoints.appHost,e={type:"setup",client_reference_id:i="app_id_"+o.context.appId+"_ref_id_"+o._guid(),customer_id:s.customerId,success_url:n+"/payments/success",cancel_url:n+"/payments/cancel"},s.customerEmail&&(e.customer_email=s.customerEmail),o._sendRequest("POST","checkout/sessions",e,{"x-api-key":o.context.apiKeys.awsApiPublicKey},function(e,t){e?c&&c(e,t):(t=t.sessionId,o._openStripeCheckout({sessionId:t,clientReferenceId:i,domain:n},function(e,t){e?c&&c(e,null):t?(t={customer_id:s.customerId,setup_intent:t.setup_intent},o._sendRequest("POST","customer/card",t,{"x-api-key":o.context.apiKeys.awsApiPublicKey},function(e,t){c&&c(e,t)})):c&&c(null,null)}))})):c&&c("Missing params customerId",null):c&&c("invalid params",null):c&&c("Missing awsApiPublicKey in context",null):c&&c("Missing stripePublicKey in context",null)})},capturePayment:function(t,n){let i=this;i._checkApiKeys(function(){if(i.context.apiKeys.awsApiPublicKey)if(t)if(t.paymentIntentsId){let e={payment_intents_id:t.paymentIntentsId};t.amountToCapture&&(e.amount_to_capture=t.amountToCapture),i._sendRequest("POST","payment/capture",e,{"x-api-key":i.context.apiKeys.awsApiPublicKey},function(e,t){n&&n(e,t)})}else n&&n("Missing params paymentIntentsId",null);else n&&n("invalid params",null);else n&&n("Missing awsApiPublicKey in context",null)})},cancelPayment:function(t,n){let i=this;i._checkApiKeys(function(){if(i.context.apiKeys.awsApiPublicKey)if(t)if(t.paymentIntentsId){let e={payment_intents_id:t.paymentIntentsId};t.cancellationReason&&(e.cancellation_reason=t.cancellationReason),i._sendRequest("POST","payment/cancel",e,{"x-api-key":i.context.apiKeys.awsApiPublicKey},function(e,t){n&&n(e,t)})}else n&&n("Missing params paymentIntentsId",null);else n&&n("invalid params",null);else n&&n("Missing awsApiPublicKey in context",null)})},refundPayment:function(t,n){let i=this;i._checkApiKeys(function(){if(i.context.apiKeys.awsApiPublicKey)if(t)if(t.paymentIntentsId){let e={payment_intents_id:t.paymentIntentsId};t.amount&&(e.amount=t.amount),t.reason&&(e.reason=t.reason),t.metadata&&(e.metadata=t.metadata),i._sendRequest("POST","payment/refund",e,{"x-api-key":i.context.apiKeys.awsApiPublicKey},function(e,t){n&&n(e,t)})}else n&&n("Missing params paymentIntentsId",null);else n&&n("invalid params",null);else n&&n("Missing awsApiPublicKey in context",null)})},get connect(){let c=this;return{account:function(i,s){c._checkApiKeys(function(){if(c.context.apiKeys.awsApiPublicKey){var e=window.siteConfig.endPoints.appHost;let n={return_url:e+"/stripe/connect/return",refresh_url:e+"/stripe/connect/reauth",account_type:"express"};i.email&&(n.email=i.email),i.metadata&&(n.metadata=i.metadata),window.authAPI.getCurrentUser(function(e,t){n.access_token=t&&t.accessToken?t.accessToken.toString():null,n.access_token?c._sendRequest("POST","connect/account",n,{"x-api-key":c.context.apiKeys.awsApiPublicKey},function(e,t){e?s&&s(e,t):t?t.is_active?s(null,t):(t=t.account_link_url,c._openStripeConnect({accessToken:n.access_token,accountLinkUrl:t,events:i.events},function(e,t){e?s&&s(e,null):s&&s(null,t)})):s("Something went wrong!")}):s&&s({message:"no logged in user"})})}else s&&s("Missing awsApiPublicKey in context",null)})},deleteAccount:function(e,i){c._checkApiKeys(function(){if(c.context.apiKeys.awsApiPublicKey){window.siteConfig.endPoints.appHost;let n={};window.authAPI.getCurrentUser(function(e,t){n.access_token=t&&t.accessToken?t.accessToken.toString():null,n.access_token?c._sendRequest("DELETE","connect/account",n,{"x-api-key":c.context.apiKeys.awsApiPublicKey},function(e,t){i&&i(e,t)}):i&&i({message:"no logged in user"})})}else i&&i("Missing awsApiPublicKey in context",null)})}}}};
"use strict";var userTagsAPI={assignUserTags:function(e,r){if(e&&e.tags&&e.tags.length){for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!n)return void r("tag is null or undefined",null);if(-1<n.indexOf(","))return void r("tag (".concat(n,") error. cannot contain commas"),null);if(0!==n.indexOf("$$"))return void r("tag (".concat(n,") error. must begin with $$"),null);if(n.length<5)return void r("tag (".concat(n,") error. length must be 5 at least"),null)}authAPI.getCurrentUser(function(n,t){n?(console.log(n),r(n,null)):t?userTags.assignUserTags(e.tags.join(","),{},r):r("no current user",null)})}else r("no tags found",null)}};
"use strict";var richModal=function(){var g=document.createElement("div");g.id="richModal",g.className="hidden";var e=document.createElement("div");e.className="focus-screen hidden",g.appendChild(e),document.body.appendChild(g);let p=["default","primary","success","info","warning","danger"];var f=null,b=[];function y(){try{if(f)return;var e=!(null==b||!b.length)&&b[0].options.forceShow;if(0<=window.location.hash.indexOf("accessCode")&&!e)return setTimeout(y,5e3);var t=document.getElementsByClassName("login-holder")[0];if(t&&-1===t.className.indexOf("ng-hide")&&!e)return setTimeout(y,5e3);var n=(f=b.shift()).options,i=f.callback;document.getElementById("richModal").className="";var o=document.getElementsByClassName("focus-screen")[0];o.className="focus-screen animated fadeInScreen",o.onclick=function(){n&&n.forceAction||(C(),i&&i(null,{buttonType:null}))};var a,l,s,c=document.createElement("div");c.className="detail-modal animated fadeInUp backgroundColorTheme",n.title&&((a=document.createElement("h1")).id="modalTitle",a.innerHTML=n.title,n.design&&(s="",n.design.title&&n.design.title.align&&(s+="text-align: "+n.design.title.align+" !important;"),n.design.textColor&&(s+="color: "+n.design.textColor+" !important;"),a.setAttribute("style",s)),c.appendChild(a)),n.subtitle&&((l=document.createElement("span")).className="subtitle",l.innerHTML=n.subtitle,n.design&&(s="",n.design.subtitle&&n.design.subtitle.align&&(s+="text-align: "+n.design.subtitle.align+" !important;"),n.design.textColor&&(s+="color: "+n.design.textColor+" !important;"),l.setAttribute("style",s)),c.appendChild(l));var d=document.createElement("div");d.className="rich-content bodyTextTheme",n.isContentHTML||void 0===n.isContentHTML?d.innerHTML=n.richContent||"":d.innerText=n.richContent||"",c.appendChild(d);var r,m=document.createElement("div");m.className="button-container",c.appendChild(m),!n.showDismissButton&&void 0!==n.showDismissButton||((r=document.createElement("button")).className=n.action?"dismiss-button primaryTheme":"dismiss-button dismiss-large primaryTheme",r.innerHTML=n.dismissButtonText||"Dismiss",r.onclick=function(){C(),i&&i(null,{buttonType:"dismiss"})},m.appendChild(r));var u="";n.design&&(n.design.fullScreen&&g.classList.add("fullScreen"),n.design.backgroundColor&&(u+="background : "+n.design.backgroundColor+" !important;"),n.design.textColor&&(u+="color : "+n.design.textColor+" !important"),c.setAttribute("style",u),r.setAttribute("style",u))}catch(e){console.error("Failed to render rich modal",e)}if(n.action&&!n.action.length&&(n.action=[n.action]),n.action)for(let t=0;t<n.action.length;t++){let e=n.action[t];try{var h=document.createElement("button");if(e.type||(e.type="primary"),!p.includes(e.type))return i("Invalid button type");h.className="action-button ".concat(e.type,"Theme"),!1===n.showDismissButton&&(h.className="action-button ".concat(e.type,"Theme action-button-large")),h.innerHTML=e.title||"[ Click ]",h.onclick=function(){e.handler?e.handler():((new ActionItemsAPI).execute(e,function(e,t){}),i&&i(null,{buttonType:"action",value:e})),e.preventAutoClose||C()},n.design&&u&&h.setAttribute("style",u),m.appendChild(h)}catch(e){console.error("Failed to bind action to rich modal",e)}}document.getElementById("richModal").appendChild(c)}function C(){var e=document.getElementsByClassName("focus-screen")[0];e&&(e.className="focus-screen animated fadeOutScreen");var t=document.getElementsByClassName("detail-modal")[0];t&&(t.className="detail-modal animated fadeOut");var n=document.getElementById("richModal");setTimeout(function(){t&&t.remove(),f=null,0<b.length?setTimeout(y,300):n&&(n.className="hidden")},700)}return{display:function(e,t){b.push({options:e,callback:t}),y()},close:function(){C()},isVisible:function(){return!(0<=document.getElementById("richModal").className.indexOf("hidden"))},clearAll:function(){b=[],C()}}}();
"use strict";const push={get instance(){return window.plugins&&window.plugins.pushNotification?_oldPush:"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.firebase&&cordova.plugins.firebase.messaging?push_firebase:push_phonegap},init(){return window.push=this,window.plugins&&window.plugins.pushNotification?(console.log("running old plugin for push notification"),_oldPush.init()):"undefined"!=typeof cordova&&cordova.plugins&&cordova.plugins.firebase&&cordova.plugins.firebase.messaging?push_firebase.init():(console.log("running new plugin phonegap-plugin-push"),void push_phonegap.init())},get deviceId(){return this.instance.deviceId},get platform(){return"undefined"!=typeof device&&device.platform&&device.platform.toLowerCase()||""},get getBadgeNumber(){return this.instance.getBadgeNumber},get decrementBadge(){return this.instance.decrementBadge},get clearBadge(){return this.instance.clearBadge},get displayMessage(){return this.instance.displayMessage},getNotificationData:function(e,i,n,t){window.bfUtils.http.jsonp(e,i).success(function(e){e=e&&e.result[0]?e.result[0]:{actionItem:!1};n=Object.assign(n,e),t(null,n)}).catch(t)},displayMessage(e,i){i=i||{};push.trackPushNotifications({eventName:"push_notification/viewed",payload:e}),console.log("pushNotifications#displayMessage L152",e),localStorage.payload=JSON.stringify(e);try{var n=e._id||e.notificationId||e.additionalData.notificationId;if(console.log("Checking message type",e.messageType,e),e.additionalData&&"social"===e.additionalData.messageType)return e.title="Alert",e.richContent=e.message,richModal.display(e),void console.log("Got social notification",e);var t=window.siteConfig.endPoints.push+"/src/server.js?callback=JSON_CALLBACK",o={params:{data:{method:"notifications/get",params:{appID:window.appContext.currentApp.appId.toString(),notificationID:n}}}};push.getNotificationData(t,o,e,function(e,i){if(e)return console.error(e);e=Object.assign({},i);i.actionItem&&(e.action={title:i.actionItem&&i.actionItem.title?i.actionItem.title:"View",handler:function(){var e=new ActionItemsAPI;push.trackPushNotifications({eventName:"push_notification/clicked",payload:i}),window.closeSideMenu&&window.closeSideMenu(),e.execute(i.actionItem,function(e,i){console.info("Action Taken!")})}}),e.richContent=e.richMessage||e.message,e.subtitle="Sent "+moment(e.sendAfter).fromNow(),richModal.display(e)})}catch(e){console.error("Failed to parse push notification",e)}},notificationsTracked:{},trackPushNotifications:function(e){var i,n,t;"undefined"!=typeof device&&"undefined"!=typeof AnalyticsAPI&&e&&e.payload&&e.eventName&&((i=e.payload._id||e.payload.notificationId||e.payload.additionalData.notificationId)&&(push.notificationsTracked||(push.notificationsTracked={}),(n=(n=push.notificationsTracked[i])||(push.notificationsTracked[i]={events:[]})).events||(n.events=[]),-1<n.events.indexOf(e.eventName)||(n.events.push(e.eventName),t=device.platform?device.platform.toLowerCase():"",new AnalyticsAPI(window.appContext.currentApp.appId,"push_notification",i,void 0,t).trackAction(e.eventName))))}},push_firebase={deviceId:null,init(){if("undefined"==typeof cordova||!cordova.plugins&&!cordova.plugins.firebase||!cordova.plugins.firebase.messaging)return console.error("FCM plugin not installed");cordova.plugins.firebase.messaging.requestPermission();var e=()=>cordova.plugins.firebase.messaging.getToken().then(e=>this.registerToken(e));cordova.plugins.firebase.messaging.onTokenRefresh(e),e();e=()=>{this.getBadgeNumber(function(e,i){e||document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:i}))})};e(),document.addEventListener("deviceAppResumed",e,!1),cordova.plugins.firebase.messaging.onMessage(e=>this.notificationTriggerHandler(e)),cordova.plugins.firebase.messaging.onBackgroundMessage(e=>this.notificationClickHandler(e))},registerToken(e){if(console.log("registerToken: "+e),this.deviceId=e,!window.appContext||!window.appContext.currentApp)return console.error("invalid appContext cant register device");const i={params:{data:{method:"groups/subscriptions/add",params:{groupID:"",appID:window.appContext.currentApp.appId,deviceId:this.deviceId,os:device.platform?device.platform.toLowerCase():"",deliveryMethod:"FCM",device:device}}}};e=localStorage.getItem("currentPushDeviceID");e&&e!==this.deviceId&&(i.params.data.params.olddeviceId=e);var n=()=>{bfUtils.http&&bfUtils.http.jsonp(window.siteConfig.endPoints.push+"/src/server.js?callback=JSON_CALLBACK",i).success(()=>{console.log("device is now subscribed to PNs"),localStorage.setItem("currentPushDeviceID",this.deviceId)}).error(e=>{console.error(e)})};setTimeout(function(){PushNotificationsAPI._subscribe(null,e=>{e&&(console.error(e),setTimeout(n,2e3))})},2e3)},notificationTriggerHandler(e){if(console.warn("***** notificationTriggerHandler *****"),e.meta)return LocalNotificationsAPI.onTrigger(e);var i=new CustomEvent("pushNotificationsOnReceived",{detail:e});document.dispatchEvent(i);let n=this.normalizePayload(e);n.count&&n.additionalData&&n.additionalData.foreground?cordova.plugins.firebase.messaging.getBadge().then(i=>{n.count!=i&&cordova.plugins.firebase.messaging.setBadge(parseInt(n.count)).then(()=>{this.decrementBadge(),console.log("push badge updated from notification",{localCount:i,remoteCount:n.count})},e=>{this.decrementBadge(),console.log("push badge failed to update from notification",{err:e,localCount:i,remoteCount:n.count})})},e=>{console.log("failed getting local badge",{err:e,remoteCount:n.count})}):this.decrementBadge();e={};n.additionalData&&"social"==n.additionalData.messageType?e.buttons=["Dismiss"]:e.buttons=["Dismiss","Show Details"],push.displayMessage(n,e)},notificationClickHandler(e){return console.warn("***** notificationClickHandler *****"),e.meta?LocalNotificationsAPI.onClick(e):(e.foreground=!1,this.notificationTriggerHandler(e))},getBadgeNumber(i){if(!this.deviceId)return i("push_firebase not initialized",null);cordova.plugins.firebase.messaging.getBadge().then(e=>i(null,e))},decrementBadge:function(i){var e,n;this.deviceId?(e=device.platform?device.platform.toLowerCase():"",n=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/badges/decrease",window.bfUtils.http.post(n,{deviceID:this.deviceId,os:e,value:1}).success(function(e){console.log("push badge decremented",e)}).error(function(e,i){console.error("error decrementing badge",{data:e,status:i})}),cordova.plugins.firebase.messaging.getBadge().then(function(e){e?cordova.plugins.firebase.messaging.setBadge(e-1).then(function(){document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:e-1})),i&&i(null,e-1)},function(e){i&&i(e)}):i&&i(null,e)},function(e){i&&i(e)})):i&&i("push not initialized")},clearBadge:function(i){if(!this.deviceId)return push._instance?push.clearBadge(i):i("push not initialized");var e=device.platform?device.platform.toLowerCase():"",n=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/badges/update";window.bfUtils.http.post(n,{deviceID:this.deviceId,os:e,value:0}).success(function(e){console.log("push badge decremented",e)}).error(function(e,i){console.error("error decrementing badge",{data:e,status:i})}),cordova.plugins.firebase.messaging.setBadge(0).then(function(){document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:0})),i&&i(null,0)},function(e){i&&i(e)})},normalizePayload:function(e){var{sound:i,badge:n,alert:t}=e.aps||e,{title:o,body:a}=t||e,{notificationId:s,messageFrom:r,messageType:t}=e;return{additionalData:{notificationId:s,messageType:t,messageFrom:r,foreground:!1!==e.foreground},title:o,sound:i,count:-1<["number","string"].indexOf(typeof n)?parseInt(n):null,message:a}}};var push_phonegap={pushNotification:null,deviceId:null,platform:null,unseen:0,notificationHandler:null,_instance:null,init:function(){var e;try{if(!window.PushNotification)return void console.error("PushNotification plugin not installed");var i=(e={android:{},ios:{}},"android"==device.platform.toLowerCase()?e.android={senderID:"515869937012"}:e.ios={alert:"true",badge:"true",sound:"true"},e);push_phonegap._instance=PushNotification.init(i),push_phonegap._instance.on("registration",function(e){push_phonegap.registerToken(e.registrationId),console.log("push notification registered...")}),push_phonegap._instance.on("notification",function(n){var e=new CustomEvent("pushNotificationsOnReceived",{detail:n});document.dispatchEvent(e),n.count&&n.additionalData&&n.additionalData.foreground?push_phonegap._instance.getApplicationIconBadgeNumber(function(i){n.count!=i&&push_phonegap._instance.setApplicationIconBadgeNumber(function(){push_phonegap.decrementBadge(),console.log("push badge updated from notification",{localCount:i,remoteCount:n.count})},function(e){push_phonegap.decrementBadge(),console.log("push badge failed to update from notification",{err:e,localCount:i,remoteCount:n.count})},parseInt(n.count))},function(e){console.log("failed getting local badge",{err:e,remoteCount:n.count})}):push_phonegap.decrementBadge();e={};"social"==n.additionalData.messageType?e.buttons=["Dismiss"]:e.buttons=["Dismiss","Show Details"],push.displayMessage(n,e)}),push_phonegap._instance.on("error",function(e){console.error(e.message),push_phonegap.err=e;e=new CustomEvent("PUSH_ON_REGISTRATION",{detail:null});document.dispatchEvent(e)}),push_phonegap.getBadgeNumber(function(e,i){e||document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:i}))});var n=function(){push_phonegap.getBadgeNumber(function(e,i){e||document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:i}))})};document.addEventListener("deviceAppResumed",n,!1),n()}catch(e){console.error("There was an error on this page.\n\nError description: "+e.message+"\n\n")}},decrementBadge:function(i){var e,n;push_phonegap._instance?(e=device.platform?device.platform.toLowerCase():"",n=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/badges/decrease",window.bfUtils.http.post(n,{deviceID:push_phonegap.deviceId,os:e,value:1}).success(function(e){console.log("push badge decremented",e)}).error(function(e,i){console.error("error decrementing badge",{data:e,status:i})}),push_phonegap._instance.getApplicationIconBadgeNumber(function(e){e?push_phonegap._instance.setApplicationIconBadgeNumber(function(){document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:e-1})),i&&i(null,e-1)},function(e){i&&i(e)},e-1):i&&i(null,e)},function(e){i&&i(e)})):i&&i("push_phonegap not initialized")},getBadgeNumber:function(i){push_phonegap._instance?push_phonegap._instance.getApplicationIconBadgeNumber(function(e){i&&i(null,e)},function(e){i&&i(e)}):i&&i("push_phonegap not initialized")},clearBadge:function(i){var e,n;push_phonegap._instance?(e=device.platform?device.platform.toLowerCase():"",n=window.siteConfig.endPoints.pushV2+"/api/app/"+window.appContext.currentApp.appId+"/subscriptions/badges/update",window.bfUtils.http.post(n,{deviceID:push_phonegap.deviceId,os:e,value:0}).success(function(e){console.log("push badge cleared",e)}).error(function(e,i){console.error("error clearing badge",{data:e,status:i})}),push_phonegap._instance.setApplicationIconBadgeNumber(function(){document.dispatchEvent(new CustomEvent("appBadgeNumberUpdated",{detail:0})),i&&i(null,0)},function(e){i&&i(e)},0)):i&&i("push_phonegap not initialized")},registerToken:function(e){var i,n,t;console.log("registerToken: "+e),push_phonegap.deviceId=e,window.appContext&&window.appContext.currentApp?(n="undefined"!=typeof PushNotification&&void 0!==PushNotification.listChannels,n=device.platform&&"android"===device.platform.toLowerCase()&&n,i={params:{data:{method:"groups/subscriptions/add",params:{groupID:"",appID:window.appContext.currentApp.appId,deviceId:push_phonegap.deviceId,os:device.platform?device.platform.toLowerCase():"",deliveryMethod:n?"FCM":null,device:device}}}},(n=localStorage.getItem("currentPushDeviceID"))&&n!==e&&(i.params.data.params.oldDeviceID=n),t=function(){bfUtils.http&&bfUtils.http.jsonp(window.siteConfig.endPoints.push+"/src/server.js?callback=JSON_CALLBACK",i).success(function(){console.log("device is now subscribed to PNs"),localStorage.setItem("currentPushDeviceID",e)}).error(function(e){console.error(e)})},setTimeout(function(){PushNotificationsAPI._subscribe(null,function(e){e&&(console.error(e),setTimeout(t,2e3))})},2e3)):console.error("invalid appContext cant register device")}},_oldPush={pushNotification:null,unseen:0,notificationHandler:null,init:function(){console.warn("window.plugins.pushNotification is used for old builds, it's no longer used for new build");try{if(void 0===window.plugins||void 0===window.plugins.pushNotification)return void console.warn("window.plugins.pushNotification is not defined");_oldPush.pushNotification=window.plugins.pushNotification,push.platform=device.platform.toLowerCase(),push.prepareDOM(),"android"==device.platform.toLowerCase()?_oldPush.notificationHandler=new pushAndroidNotificationHandler(_oldPush.pushNotification):_oldPush.notificationHandler=new pushiOSNotificationHandler(_oldPush.pushNotification),_oldPush.notificationHandler.onRegistered=push.registerToken,_oldPush.notificationHandler.register()}catch(e){console.error("There was an error on this page.\n\nError description: "+e.message+"\n\n")}}};function pushAndroidNotificationHandler(e){this.pushNotification=e,this.androidSenderID="515869937012"}function pushiOSNotificationHandler(e){this.pushNotification=e}pushAndroidNotificationHandler.prototype={register:function(){navigator.onLine?this.pushNotification.register(this.successHandler,this.errorHandler,{senderID:this.androidSenderID,ecb:"_oldPush.notificationHandler.onNotification"}):console.warn("offline: not attempting to register push notifications")},onRegistered:function(e){push.deviceId=e},onNotification:function(e){var i=new CustomEvent("pushNotificationsOnReceived",{detail:e});switch(document.dispatchEvent(i),e.event){case"registered":0<e.regid.length&&this.onRegistered(e.regid);break;case"message":push.decrementBadge(),e.foreground||e.coldstart;var n={};"social"==e.payload.messageType?n.buttons=["Dismiss"]:n.buttons=["Dismiss","Show Details"],push.displayMessage(e.payload,n);break;case"error":console.error("An error occurred: "+e.msg);break;default:console.error("EVENT -> Unknown, an event was received and we do not know what it is")}},successHandler:function(e){},errorHandler:function(e){console.error("error:"+e)}},pushiOSNotificationHandler.prototype={onRegistered:function(e){push.deviceId=e},register:function(){if(navigator.onLine)try{this.pushNotification.register(this.onRegistered,this.errorHandler,{badge:"true",sound:"true",alert:"true",ecb:"_oldPush.notificationHandler.onNotification"})}catch(e){console.error("There was an error on this page.\n\nError description: "+e.message+"\n\n")}else console.warn("offline: not attempting to register push notifications")},onNotification:function(e){var i=new CustomEvent("pushNotificationsOnReceived",{detail:e});document.dispatchEvent(i),e?(i={},"social"==e.messageType?i.buttons=["Dismiss"]:i.buttons=["Dismiss","Show Details"],e.alert&&(push.decrementBadge(),push.displayMessage(e,i))):window.location.hash="/pushHistory",e.sound},tokenHandler:function(e){push.deviceId=e},successHandler:function(e){this.onRegistered(e)},errorHandler:function(e){console.error("ios error:"+e)}},bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},function(){window.plugins&&window.plugins.pushNotification?(console.log("running old plugin for push notification"),_oldPush.init()):(console.log("running new plugin phonegap-plugin-push"),push.init())}),window.testNotification=function(){push.displayMessage({message:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />Lorem ipsum dolor sit amet, consectetur adipisicing elit. Corrupti officiis perferendis expedita rerum delectus dolor neque veniam necessitatibus fuga cum voluptatibus placeat, totam voluptate, nisi reprehenderit odio porro cumque ipsa.<br /><br />",title:"Notification Title",alert:"This is the alert, not sure what it means",messageType:null,additionalData:{notificationId:"5b5f9bbe39003904daa4f093",coldstart:!0,foreground:!0}},{buttons:["Dismiss","Show Details"]})};
"use strict";class BleCentralAPI{constructor(){if(this.mockMode=void 0===window.ble,this.mockMode)return console.warn("mock bleCentral interaction");this.ble=window.ble}onDeviceDiscovered(e){e=new Packet(null,"services.bluetooth.bleCentral.triggerOnDeviceDiscovered",e,null);postMaster.broadcast(e)}onDeviceConnected(e){e=new Packet(null,"services.bluetooth.bleCentral.triggerOnDeviceConnected",e,null);postMaster.broadcast(e)}onDeviceDisconnected(e){e=new Packet(null,"services.bluetooth.bleCentral.triggerOnDeviceDisconnected",e,null);postMaster.broadcast(e)}onNotification(e){e=new Packet(null,"services.bluetooth.bleCentral.triggerOnNotification",e,null);postMaster.broadcast(e)}onStateNotification(e){e=new Packet(null,"services.bluetooth.bleCentral.triggerOnStateNotification",e,null);postMaster.broadcast(e)}scan(r,n){if(this.mockMode)return console.warn("bleCentral mock scan!");(r=r||{}).services||(r.services=[]),r.seconds||(r.seconds=5),permissionRequestsAPI.queueRequest("background_location",this,()=>{var e=1e3*r.seconds;setTimeout(()=>{n&&n(null,{status:"complete"})},e),this.ble&&this.ble.scan(r.services,r.seconds,this.onDeviceDiscovered,e=>{(n||console.error)(e)})})}startScan(e,r){if(this.mockMode)return console.warn("bleCentral mock startScan!");(e=e||{}).services||(e.services=[]),permissionRequestsAPI.queueRequest("background_location",this,()=>{this.ble&&this.ble.startScan(e.services,this.onDeviceDiscovered,e=>{(r||console.error)(e)})})}startScanWithOptions(r,n){if(this.mockMode)return console.warn("bleCentral mock startScanWithOptions!");(r=r||{}).services||(r.services=[]),r.reportDuplicates||(r.reportDuplicates=!1),permissionRequestsAPI.queueRequest("background_location",this,()=>{var e={reportDuplicates:r.reportDuplicates};this.ble&&this.ble.startScanWithOptions(r.services,e,this.onDeviceDiscovered,e=>{(n||console.error)(e)})})}stopScan(r){if(this.mockMode)return console.warn("bleCentral mock stopScan!");this.ble&&this.ble.stopScan(function(){r&&r(null,!0)},function(e){r&&r(e,null)})}connect(e,r){if(!e||!e.device_id){var n=new Error("No device_id provided to bleCentral.connect!");return(r||console.error)(n)}if(this.mockMode)return console.warn("bleCentral mock connect!");this.ble&&this.ble.connect(e.device_id,e=>{r&&r(null,e),this.onDeviceConnected(e)},e=>{this.onDeviceDisconnected(e)})}autoConnect(e,r){if(!e||!e.device_id){var n=new Error("No device_id provided to bleCentral.autoConnect!");return(r||console.error)(n)}if(this.mockMode)return console.warn("bleCentral mock connect!");this.ble&&this.ble.autoConnect(e.device_id,e=>{this.onDeviceConnected(e)},e=>{this.onDeviceDisonnected(e)})}disconnect(e,r){if(!e||!e.device_id){var n=new Error("No device_id provided to bleCentral.disconnect!");return(r||console.error)(n)}if(this.mockMode)return console.warn("bleCentral mock connect!");this.ble&&this.ble.disconnect(e.device_id,e=>{r&&r(null,e),this.onDeviceDisconnected(e)},e=>{r&&r(e,null)})}connectedPeripheralsWithServices(e,r){if(!r){var n=new Error("No callback provided to bleCentral.connectedPeripheralsWithServices!");return console.error(n)}if(!e||!e.services||!e.services.length){n=new Error("No services provided to bleCentral.connectedPeripheralsWithServices!");return r(n,null)}if(this.mockMode)return console.warn("bleCentral mock connectedPeripheralsWithServices!"),r(null,[]);this.ble&&this.ble.connectedPeripheralsWithServices(e.services,function(e){r(null,e)},function(e){r(e,null)})}peripheralsWithIdentifiers(e,r){if(!r){var n=new Error("No callback provided to bleCentral.peripheralsWithIdentifiers!");return console.error(n)}if(!e||!e.identifiers){n=new Error("No identifiers provided to bleCentral.peripheralsWithIdentifiers!");return r(n,null)}if(this.mockMode)return console.warn("bleCentral mock peripheralsWithIdentifiers!"),r(null,[]);this.ble&&this.ble.connectedPeripheralsWithServices(e.services,function(e){r&&r(null,e)},function(e){r&&r(e,null)})}read(e,n){if("function"!=typeof n)return console.error(new Error("No callback provided to bleCentral.read!"));if(!e)return n(new Error("No options provided to bleCentral.read!"),null);var{device_id:r,service_uuid:t,characteristic_uuid:o}=e;if(!r||!t||!o){e=new Error("Invalid device info provided to bleCentral.read: ".concat(JSON.stringify(e)));return(n||console.error)(e,null)}if(this.mockMode)return console.warn("bleCentral mock read!"),n(null,null);this.ble&&this.ble.read(r,t,o,e=>{try{var r=this.bufferToArray(e);n(null,r)}catch(e){n(e,null)}},e=>{n(e,null)})}write(e,r){if(!e){var n=new Error("No options provided to bleCentral.write!");return(r||console.error)(n,null)}var{device_id:t,service_uuid:o,characteristic_uuid:i,data:n}=e;if(!t||!o||!i){var l=new Error("Invalid device info provided to bleCentral.write: ".concat(JSON.stringify(e)));return(r||console.error)(l,null)}if("object"!=typeof n||"number"!=typeof n.length){l=new Error("Invalid data provided to bleCentral.write: Must be an array!",n);return(r||console.error)(l,null)}if(this.mockMode)return console.warn("bleCentral mock write!"),void(r&&r(null,null));let c=null;try{c=this.arrayToBuffer(n)}catch(e){return(r||console.error)(e,null)}this.ble&&this.ble.write(e.device_id,e.service_uuid,e.characteristic_uuid,c,function(e){r&&r(null,e)},function(e){r&&r(e,null)})}writeWithoutResponse(e,r){if(!e){var n=new Error("No options provided to bleCentral.writeWithoutResponse!");return(r||console.error)(n,null)}var{device_id:t,service_uuid:o,characteristic_uuid:i,data:n}=e;if(!t||!o||!i){var l=new Error("Invalid device info provided to bleCentral.writeWithoutResponse: ".concat(JSON.stringify(e)));return(r||console.error)(l,null)}if("object"!=typeof n||"number"!=typeof n.length){l=new Error("Invalid data provided to bleCentral.writeWithoutResponse: Must be an array!",n);return(r||console.error)(l,null)}if(this.mockMode)return console.warn("bleCentral mock writeWithoutResponse!"),void(r&&r(null,null));let c=null;try{c=this.arrayToBuffer(n)}catch(e){return(r||console.error)(e,null)}this.ble&&this.ble.writeWithoutResponse(t,o,i,c,function(){r&&r(null)},function(e){r&&r(e)})}readRSSI(e,r){if(!e||!e.device_id){var n=new Error("No device_id provided to bleCentral.readRSSI!");return(r||console.error)(n,null)}if(this.mockMode)return console.warn("bleCentral mock readRSSI!"),void(r&&r(null,null));this.ble&&this.ble.readRSSI(e.device_id,function(e){r&&r(null,e)},function(e){r&&r(e,null)})}startNotification(e,r){if(!e){var n=new Error("No options provided to bleCentral.startNotification!");return(r||console.error)(n)}const{device_id:t,service_uuid:o,characteristic_uuid:i}=e;if(!t||!o||!i){e=new Error("Invalid device info provided to bleCentral.startNotification: ".concat(JSON.stringify(e)));return(r||console.error)(e)}if(this.mockMode)return console.warn("bleCentral mock startNotification!"),void(r&&r(null));this.ble&&this.ble.startNotification(t,o,i,e=>{try{var r=this.bufferToArray(e),n={device_id:t,service_uuid:o,characteristic_uuid:i,data:r};this.onNotification(n)}catch(e){console.error(e)}},function(e){r&&r(e)})}stopNotification(e,r){if(!e){var n=new Error("No options provided to bleCentral.stopNotification!");return(r||console.error)(n)}var{device_id:t,service_uuid:o,characteristic_uuid:n}=e;if(!t||!o||!n){e=new Error("Invalid device info provided to bleCentral.stopNotification: ".concat(JSON.stringify(e)));return(r||console.error)(e)}if(this.mockMode)return console.warn("bleCentral mock stopNotification!"),void(r&&r(null));this.ble&&this.ble.stopNotification(t,o,n,function(e){r&&r(null,e)},function(e){r&&r(e,null)})}startStateNotifications(r){if(this.mockMode)return console.warn("bleCentral mock startStateNotifications!"),void(r&&r(null,null));this.ble&&this.ble.startStateNotifications(function(e){r&&r(null,e)},function(e){r&&r(e,null)})}stopStateNotifications(r){if(this.mockMode)return console.warn("bleCentral mock stopStateNotifications!"),void(r&&r(null,null));this.ble&&this.ble.stopStateNotifications(function(e){r&&r(null,e)},function(e){r&&r(e,null)})}isConnected(e,r){if(!r)return console.error(new Error("No callback provided to bleCentral.isConnected!"));if(!e||!e.device_id){var n=new Error("No device_id provided to bleCentral.isConnected!");return r(n,null)}if(this.mockMode)return console.warn("bleCentral mock isConnected!"),r(null,null);this.ble&&this.ble.isConnected(e.device_id,function(e){r(null,e)},function(e){r(e,null)})}isEnabled(e){return e?this.mockMode?(console.warn("bleCentral mock isEnabled!"),e(null,null)):void(this.ble&&this.ble.isEnabled(function(){e(null,!0)},function(){e(null,!1)})):console.error(new Error("No callback provided to bleCentral.isEnabled!"))}isLocationEnabled(r){if(this.mockMode)return console.warn("bleCentral mock isLocationEnabled!"),void(r&&r(null,null));this.ble&&this.ble.isLocationEnabled(function(e){r&&r(null,e)},function(e){r&&r(e,null)})}showBluetoothSettings(r){return bfUtils.isIOS?(r||console.warn)("bleCentral.showBluetoothSettings is not available on iOS!"):this.mockMode?(console.warn("bleCentral mock showBluetoothSettings!"),void(r&&r(null))):void(this.ble&&this.ble.showBluetoothSettings(function(){r&&r(null)},function(e){r&&r(e)}))}enable(r){return bfUtils.isIOS?(r||console.warn)("bleCentral.enable is not available on iOS!"):this.mockMode?(console.warn("bleCentral mock enable!"),void(r&&r(null,null))):void(this.ble&&this.ble.enable(function(e){r&&r(null,e)},function(e){r&&r(e,null)}))}bondedDevices(r){return r?this.mockMode?(console.warn("bleCentral mock enable!"),r(null,null)):void(this.ble&&this.ble.bondedDevices(function(e){r(null,e)},function(e){r(e,null)})):console.error(new Error("No callback provided to bleCentral.bondedDevices!"))}requestMtu(e,r){if(!e||!e.device_id){var n=new Error("No device_id provided to bleCentral.requestMtu!");return(r||console.error)(n,null)}if(this.mockMode)return console.warn("bleCentral mock requestMtu!"),void(r&&r(null,null));e.mtu=e.mtu||100,this.ble&&this.ble.requestMtu(e.device_id,e.mtu,function(e){r&&r(null,e)},function(e){r&&r(e,null)})}refreshDeviceCache(e,r){if(!e||!e.device_id){var n=new Error("No device_id provided to bleCentral.refreshDeviceCache!");return(r||console.error)(n,null)}if(this.mockMode)return console.warn("bleCentral mock refreshDeviceCache!"),void(r&&r(null,null));this.ble&&this.ble.refreshDeviceCache(e.device_id,e.timeoutMillis,function(e){r&&r(null,e)},function(e){r&&r(e,null)})}get arrayTypes(){return{Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array}}bufferToArray(e,r="Uint8"){return this.arrayTypes[r]||(console.error("Invalid array type! Defaulting to Uint8Array."),r="Uint8"),Array.from(new this.arrayTypes[r](e))}arrayToBuffer(e,r="Uint8"){return this.arrayTypes[r]||(console.error("Invalid array type! Defaulting to Uint8Array."),r="Uint8"),new this.arrayTypes[r](e).buffer}}
"use strict";function ComponentUIAPI(e){this.context=e,this.DRAWER_UI_ID="bottomDrawerContainer",this.SNACKBAR_UI_ID="snackbarhero",this.timeOutId=null,this.init()}ComponentUIAPI.prototype={init:function(){},sanitize:function(e,l,i){window.bfUtils.sanitize({data:e},(e,t)=>e?(i&&i(e,null),console.error(e)):(l.innerHTML+=t,void(i&&i(null,null))))},closeDrawer:function(e,t){e=e||{};let l=document.getElementById(this.DRAWER_UI_ID);l&&(this.scrollBooster&&(this.scrollBooster.destroy(),this.scrollBooster=null),e.force?l.remove():(l.classList.add("closing"),setTimeout(function(){l.remove()},300)))},openDrawer:function(c,n){let o=this,a=!0,r=!1,d=[],u=[],m=(c=c||{}).multiSelection?"block":"none",h=[],b=null,p=null;c.isHTML=!1!==c.isHTML,c.multiSelectionActionButton=c.multiSelectionActionButton||{},c.multiSelectionActionButton.text=c.multiSelectionActionButton.text||"OK",c.multiSelectionActionButton.type=c.multiSelectionActionButton.type||"primary",c.allowSelectAll=!1!==c.allowSelectAll,c.enableFilter=!1!==c.enableFilter,c.autoUseImageCdn=!1!==c.autoUseImageCdn;let e=document.createElement("div");e.id=this.DRAWER_UI_ID,e.className="bottom-drawer-container",e.innerHTML='<div class="bottom-drawer-backdrop"></div><div class="bottom-drawer-holder"><div class="bottom-drawer backgroundColorTheme bodyTextTheme"></div></div>';let y=e.querySelector(".bottom-drawer");e.querySelector(".bottom-drawer-backdrop").onclick=()=>{this.closeDrawer(),c.triggerCallbackOnUIDismiss&&n(null,null)},c.height&&(y.style.height=c.height),"undefined"!=typeof globalEvents&&(window.addEventListener(globalEvents.TABCHANGE.CONTENT,()=>{this.closeDrawer()}),window.addEventListener(globalEvents.TABCHANGE.PURCHASE,()=>{this.closeDrawer()}));var S=function(e){return a?-1<d.indexOf(e):-1===u.indexOf(e)};if(c.listItems&&c.listItems.forEach(e=>{e.selected&&d.push(e)}),c.header){let n=document.createElement("div");if(n.className="bottom-drawer-header titleBarBackgroundTheme",n.innerHTML='<div id="headerText" class="titleBarTextAndIcons"></div><div id="selectAllDiv" class="titleBarTextAndIcons">\n\t\t\t<span id="closeSearch" class="material-icons titleBarTextAndIcons">close</span>\n\t\t\t<div id="checkboxSelectAll" class="checkbox margin-top-zero">\n\t\t\t<input id="selectAllCheckbox" type="checkbox">\n\t\t\t<label style="padding:0" for="selectAllCheckbox"></label>\n\t\t    </div>\n\t\t\t<div id="drawerSearch" class="form-outline"><input type="search" onclick="window.keyboardResize()"class="form-control titleBarTextAndIcons" placeholder="'.concat("Search",'" aria-label="Search" disabled></div>\n\t\t\t<span id="searchIcon" class="material-icons titleBarTextAndIcons">search</span>\n\t\t\t</div>'),c.isHTML?this.sanitize(c.header,n.children[0]):n.children[0].innerText=c.header,c.multiSelection&&c.allowSelectAll){n.querySelector("#checkboxSelectAll").style.display="block";let t=n.querySelector("#selectAllCheckbox");t.onclick=function(){let e=y.querySelectorAll("input[type=checkbox]");a=!t.checked,d=[],u=[],t.checked?c.listItems&&(d=c.listItems.slice(),v(c.listItems.length),e.forEach(e=>{e.checked=!0})):(d=[],v(),e.forEach(e=>{e.checked=!1}))}}if(c.enableFilter){let t={},e=n.querySelector("#closeSearch"),l=n.querySelector("#searchIcon"),i=n.querySelector("#drawerSearch"),s=i.children[0];l.style.display="block",l.onclick=function(){i.classList.add("show-drawer-search"),i.classList.remove("hide-drawer-search"),s.disabled=!1,window.keyboardResize(),s.focus(),n.querySelector("#checkboxSelectAll").style.display="none",n.children[0].classList.add("hide-header-text"),n.children[0].classList.remove("show-header-text"),e.style.display="block"},e.onclick=function(){i.classList.add("hide-drawer-search"),i.classList.remove("show-drawer-search"),n.children[0].classList.remove("hide-header-text"),n.children[0].classList.add("show-header-text"),n.querySelector("#checkboxSelectAll").style.display=c.allowSelectAll&&c.multiSelection?"block":"none",n.children[0].style.display="block",e.style.display="none",i.children[0].value&&(g({target:{value:""}}),s.value=""),s.disabled=!0},s.onkeydown=function({target:e}){t&&clearTimeout(t),t=setTimeout(()=>g({target:e}),500)}}y.appendChild(n)}window.stringResource&&c.header&&window.stringResource.getData().then(function(e){y.querySelector("#drawerSearch").children[0].placeholder=e.appSearch||"Search"});const g=({target:e})=>{if(h&&b){var t;let i=!0,s=!1;const l=e["value"],n=l?l.toLowerCase().split(/[\s-_():,/\\|]+/g):[];0<n.length?(t=h.filter(e=>{i=!0,s=!1;let l=(e.text+" "+(e.secondaryText||"")).toLowerCase().split(/<[^>]+>|[\s-_():,/\\|]+/g);return n.forEach(t=>{t&&(l.forEach(e=>{e.startsWith(t)&&(s=!0)}),i=!(!s||!i),s=!1)}),i}),b.innerHTML="",b.scrollTop=0,f(t,b),k(t)):(b.innerHTML="",b.scrollTop=0,f(h,b),k(h))}};function v(e){let t=y.querySelector("#drawerButton");e?(y.querySelector("#buttonBadge").innerHTML=e,t.classList.remove("disabled-drawer-button"),t.disabled=!1):(y.querySelector("#buttonBadge").innerHTML="",t.classList.add("disabled-drawer-button"),t.disabled=!0)}function f(i,e){let s={};e?s=e:(s=document.createElement("ul"),s.classList.add("action-list"),s.onclick=function(t){let l=t.target;for(;"LI"!==l.nodeName;){if("UL"===l.nodeName)return void console.log("Wrong Click");l=l.parentElement}if(c.multiSelection){let e=l.querySelector("input[type=checkbox]");"checkbox"!=t.target.type&&(e.checked=!e.checked),function(e,t){{var l;t?(a?d.push(e):(l=u.indexOf(e),u.splice(l,1)),v(Number(y.querySelector("#buttonBadge").innerHTML)+1)):(a?(l=d.indexOf(e),d.splice(l,1)):u.push(e),v(Number(y.querySelector("#buttonBadge").innerHTML)-1))}}(l.item,e.checked)}else n(null,l.item)});let t=0;function l(){for(var l=t;l<t+50&&!(i.length-1<l);l++)if(i[l]&&i[l].text){let e=document.createElement("li"),t="";t=!c.autoUseImageCdn||!i[l].imageUrl||i[l].imageUrl.includes("cloudimg.io")||0!==i[l].imageUrl.indexOf("http")||i[l].imageUrl.includes("localhost")?i[l].imageUrl:imageTools.cropImage(i[l].imageUrl,{size:"xs",aspect:"1:1"}),e.innerHTML='<div class="item-icon">\n\t\t\t\t\t\t<img style="display:'.concat(t?"block":"none",'" src="').concat(t||"",'" onerror="this.style.display=\'none\'"></div>\n\t\t\t\t\t\t<div class="action-item-texts">\n\t\t\t\t\t\t<div style="font-weight: bold"></div>\n\t\t\t\t\t\t<div></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style="display: ').concat(m,' ; margin-left: auto" class="checkbox checkbox-primary margin-top-zero ').concat(i[l].secondaryText?"drawer-checkboxes":"",'"><input type="checkbox"><label style="padding:0"></label></div>'),c.isHTML?(o.sanitize(i[l].text,e.children[1].children[0]),o.sanitize(i[l].secondaryText,e.children[1].children[1])):(e.children[1].children[0].innerText=i[l].text,e.children[1].children[1].innerText=i[l].secondaryText||""),c.multiSelection&&(e.querySelector("input[type=checkbox]").checked=S(i[l])||!1),e.item=i[l],s.appendChild(e)}t+=50,console.log("Load Other Items")}if(p&&s.removeEventListener("scroll",p),p=function(){s.scrollTop+s.clientHeight+1e3>=s.scrollHeight&&l()},s.addEventListener("scroll",p),l(),!e){for(let e=0;e<i.length;e++)if(i[e].imageUrl){r=!0;break}return r&&s.classList.add("has-images"),s}}if(c.content){let e=document.createElement("div");e.className="drawer-content",c.listItems||c.tabs||e.classList.add("scrollable-content"),c.isHTML?this.sanitize(c.content,e,()=>{c.onContentRender&&setTimeout(()=>{c.onContentRender()},0)}):e.innerText=c.content,y.appendChild(e)}if(c.listItems)h=c.listItems,b=f(c.listItems),y.appendChild(b);else if(c.tabs&&!c.multiSelection){let e=document.createElement("div");e.className="md-tabs-scroll";let i=document.createElement("div");i.classList.add("md-tabs");for(let l=0;l<c.tabs.length;l++){let e=document.createElement("div"),t=document.createElement("div");t.classList.add("active-indicator","titleBarBackgroundTheme"),e.classList.add("btn-tab-drawer-"+l,"md-tab"),0===l&&e.classList.add("active"),c.isHTML?this.sanitize(c.tabs[l].text,e):e.innerText=c.tabs[l].text,e.appendChild(t),i.appendChild(e)}e.appendChild(i);let l=0,s=[],n=e.querySelectorAll(".md-tab");n.forEach(function(t){t.setAttribute("data-tabindex",l),t.onclick=function(){n.forEach(function(e){e.classList.remove("active")}),t.classList.add("active");var e=t.getAttribute("data-tabindex");s.forEach(function(e){e.classList.add("hide")}),s[e].classList.remove("hide"),s[e].items?(h=s[e].items,b=s[e],c.header&&g({target:{value:document.querySelector("#drawerSearch").children[0].value}})):(h=null,b=null,y.querySelector(".empty-items")&&(y.querySelector(".empty-items").style.display="none"))},l++}),y.appendChild(e);for(let t=0;t<c.tabs.length;t++){if(c.tabs[t].listItems){let e=f(c.tabs[t].listItems);e.items=c.tabs[t].listItems,0===t&&(h=c.tabs[t].listItems,b=e),s.push(e)}else{let e=document.createElement("div");e.className="drawer-content",c.isHTML?this.sanitize(c.tabs[t].content,e):e.innerText=c.tabs[t].content,s.push(e)}0<t&&s[t].classList.add("hide"),y.appendChild(s[s.length-1])}}function k(e){if(!y.querySelector(".empty-items")){let e=document.createElement("IMG");e.src=window._appRoot+"media/ic_bookmark_empty.svg",e.classList.add("empty-items"),y.appendChild(e)}e&&0===e.length?y.querySelector(".empty-items").style.display="block":y.querySelector(".empty-items").style.display="none"}if((c.listItems||c.tabs&&c.tabs[0]&&c.tabs[0].listItems)&&k(c.listItems||c.tabs&&c.tabs[0]&&c.tabs[0].listItems),c.multiSelection){let e=document.createElement("DIV");e.id="drawerButtonDiv";let t=document.createElement("BUTTON");t.id="drawerButton",t.type="button",t.classList.add("btn","btn-".concat(c.multiSelectionActionButton.type)),t.innerHTML='<span class="btn-'.concat(c.multiSelectionActionButton.type,'"></span><span id="buttonBadge" class="badge btn-').concat(c.multiSelectionActionButton.type,'"></span>'),c.isHTML?this.sanitize(c.multiSelectionActionButton.text,t.children[0]):t.children[0].innerText=c.multiSelectionActionButton.text,e.appendChild(t),y.appendChild(e),y.querySelector("#drawerButton").onclick=()=>{this.closeDrawer(),n(null,(a||u.forEach(e=>{e=d.indexOf(e);d.splice(e,1)}),d))},v(d.length)}this.closeDrawer({force:!0}),(document.querySelector("#emulatorContainer #app")||document.body).appendChild(e),!c.tabs||c.multiSelection||c.listItems||setTimeout(()=>{this.scrollBooster=new ScrollBooster({viewport:e.querySelector(".md-tabs-scroll"),content:e.querySelector(".md-tabs"),scrollMode:"native",direction:"horizontal"}),setTimeout(()=>{this.scrollBooster&&this.scrollBooster.updateMetrics()},1e3),setTimeout(()=>{this.scrollBooster&&this.scrollBooster.updateMetrics()},3e3)},0)},showToastMessage:function(e,t){e=e||{};let l=document.getElementById(this.SNACKBAR_UI_ID),i=l.querySelector(".snackbar-message");i.innerText=e.text;let s=l.querySelector(".snackbar");e.type||(e.type="info"),s.className="snackbar ".concat(e.type+"BackgroundTheme");let n=l.querySelector(".snackbar-actions"),c=n.querySelector(".snackbar-action");e.action&&e.action.title?(c.querySelector("span").innerText=e.action.title,c.classList.remove("hide"),c.onclick=function(){t&&t(null,e.action)}):c.classList.add("hide"),e.hideDismiss?n.querySelector(".dismiss").classList.add("hide"):(n.querySelector(".dismiss").classList.remove("hide"),n.querySelector(".dismiss").onclick=()=>{this.closeToastMessage({force:!0})}),l.classList.remove("hide"),l.querySelector(".snackbar").classList.add("open"),this.closeToastMessage(e)},closeToastMessage:function(e,t){(e=e||{}).duration||(e.duration=8e3);let l=document.getElementById(this.SNACKBAR_UI_ID);e.force?(l.querySelector(".snackbar").classList.remove("closing"),l.querySelector(".snackbar").classList.remove("open"),setTimeout(()=>{l.classList.add("hide")},250)):(l.querySelector(".snackbar").classList.add("closing"),this.timeOutId&&clearTimeout(this.timeOutId),this.timeOutId=setTimeout(function(){l.querySelector(".snackbar").classList.remove("closing"),l.querySelector(".snackbar").classList.remove("open"),setTimeout(()=>{l.classList.add("hide")},250),this.timeOutId=null},e.duration))}};
"use strict";var imageTools={get ENUMS(){return{SIZES:{xxs:32,xs:64,s:128,m:200,l:304,xl:416,xxl:600,720:720,1080:1080,1440:1440,1920:1920,2560:2560,3840:3840,get full_width(){return this.findNearest(1)},get half_width(){return this.findNearest(2)},get third_width(){return this.findNearest(3)},get fourth_width(){return this.findNearest(4)},get fifth_width(){return this.findNearest(5)},get sixth_width(){return this.findNearest(6)},findNearest:function(i){for(var t=null,e=0;e<this.VALID_SIZES.length;e++){var n=this.VALID_SIZES[e];if(window.innerWidth/i<this[n]){t=n;break}}return this[t]},VALID_SIZES:["xxs","xs","s","m","l","xl","xxl","720","1080","1440","1920","2560","3840","full_width","half_width","third_width","quarter_width","fifth_width","sixth_width"]},ASPECT_RATIOS:{"1:1":1,"4:3":.75,"16:9":.5625,"9:16":1.77777778,"11:5":.45454545,"4:1":.25,"2.39:1":.41841004,VALID_RATIOS:["1:1","4:3","16:9","9:16","11:5","4:1","2.39:1"]}}},resizeImage:function(t,e,n,r){if(!t)return null;if(t&&t.indexOf&&(-1<t.indexOf("://localhost:")||-1<t.indexOf("cdvfile://"))||-1<t.indexOf("file://"))return t;if(/\..{3,4}(?!.)/g.test(t)&&!/.(png|jpg|jpeg)(?!.)/gi.test(t)){var o=(/.{0,4}(?!.)/g.exec(t)||["Selected"])[0];return console.warn(o+" files are not supported by resizeImage. Returning original URL: "+t),t}if(e){if("object"!=typeof e)throw"options not an object"}else e={width:window.innerWidth};var a=e.disablePixelRation?1:window.devicePixelRatio;a<1&&(a=1),"full"==e.width&&(e.width=window.innerWidth),"full"==e.height&&(e.height=window.innerHeight);{var h,s=window.siteConfig.endPoints.cloudImageHost,o=-1!==t.indexOf("?");let i=s+"/"+t+(o?"&":"?")+"func=bound";if(e.size&&e.aspect){if(this.ENUMS.SIZES.VALID_SIZES.indexOf(e.size)<0){o=this.ENUMS.SIZES.VALID_SIZES.join(", ");return console.warn("Inavlid size. Availible options are "+o+". Returning original url"),t}if(this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.indexOf(e.aspect)<0){var l=this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.join(", ");return console.warn("Inavlid aspect ratio. Availible options are "+l+". Returning original url"),t}e.width=this.ENUMS.SIZES[e.size],e.height=e.width*this.ENUMS.ASPECT_RATIOS[e.aspect]}return e.width&&!e.height?(l=Math.floor(e.width*a),i+="&width="+l):!e.width&&e.height?(h=Math.floor(e.height*a),i+="&height="+h):e.width&&e.height?(h=Math.floor(e.width*a),a=Math.floor(e.height*a),i+="&width="+h+"&height="+a):i=t,this._handleElement(n,i,r),i}},cropImage:function(i,t,e,n){if(!i)return null;if(i&&i.indexOf&&(-1<i.indexOf("://localhost:")||-1<i.indexOf("cdvfile://"))||-1<i.indexOf("file://"))return i;if(/\..{3,4}(?!.)/g.test(i)&&!/.(png|jpg|jpeg)(?!.)/gi.test(i)){var r=(/.{0,4}(?!.)/g.exec(i)||["Selected"])[0];return console.warn(r+" files are not supported by cropImage. Returning original URL: "+i),i}if("object"!=typeof(t=t||{}))throw"options not an object";if(t.size&&t.aspect){if(this.ENUMS.SIZES.VALID_SIZES.indexOf(t.size)<0){var o=this.ENUMS.SIZES.VALID_SIZES.join(", ");return console.warn("Inavlid size. Availible options are "+o+". Returning original url"),i}if(this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.indexOf(t.aspect)<0){var a=this.ENUMS.ASPECT_RATIOS.VALID_RATIOS.join(", ");return console.warn("Inavlid aspect ratio. Availible options are "+a+". Returning original url"),i}t.width=this.ENUMS.SIZES[t.size],t.height=t.width*this.ENUMS.ASPECT_RATIOS[t.aspect]}if("full"==(t=!t.width&&!t.height?{width:"full",height:"full"}:t).width&&(t.width=window.innerWidth),"full"==t.height&&(t.height=window.innerHeight),!t.width||!t.height)return console.warn("cropImage doenst have width or height please fix. returning original url"),i+"?h="+t.height+"&w="+t.width;r=window.devicePixelRatio;t&&t.disablePixelRatio&&(r=t.disablePixelRatio);o=window.siteConfig.endPoints.cloudImageHost,a=-1!==i.indexOf("?"),i=o+"/"+i+(a?"&":"?")+"func=crop",a=Math.floor(t.width*r),r=Math.floor(t.height*r);return this._handleElement(e,i+="&width="+a+"&height="+r,n),i},_handleElement:function(e,n,i){var t;e&&n&&(t=this._getLocalPath(n),"IMG"===e.tagName?(e.style.setProperty("opacity","0","important"),e.src=t,e.onload=function(){e.style.removeProperty("opacity"),i&&i(t)},e.onerror=function(){bfUtils.isApp&&imageCacheAPI.download(n,function(i,t){return i?e.src=n:void(e.src=t)})}):this._handleBgImage(e,t,n,i))},_handleBgImage:function(e,i,n,r){o(e,i);var t=new Image;function o(i,t){if(!t)return i.style.removeProperty("background-image");i.style.setProperty("background-image",'url("'+t+'")',"important")}t.src=i,t.onload=function(){r&&r(i)},t.onerror=function(){if(o(e),!bfUtils.isApp)return o(e,n);imageCacheAPI.download(n,function(i,t){return i?(r&&r(n),o(e,n)):void window.requestAnimationFrame(function(){o(e,t),r&&r(t)})})}},_getLocalPath:function(i){if(!bfUtils.isApp)return i;var t=(t=(i=i.replace(/(http|https):\/\/\S{0,8}.cloudimg.io\//g,"")).match(/(png|jpg|jpeg)/g)[0]||"")?"."+t:"",e=0;if(!i.length)return e;for(var n=0;n<i.length;n++){e=(e<<5)-e+i.charCodeAt(n);e|=0}return"".concat(window._appRoot.replace("app","imageCache/images")).concat(e).concat(t)},isProdImageServer:function(i){return 0==i.indexOf("http://imageserver.prod.s3.amazonaws.com")||0==i.indexOf("https://imageserver.prod.s3.amazonaws.com")||0==i.indexOf("https://s3-us-west-2.amazonaws.com/imageserver.prod")}};
"use strict";function DialogAPI(t){this.context=t,this.componentUI=null}DialogAPI.prototype={confirm:function(n,i){(n=n||{}).message?(n.title||(n.title="Are you sure?"),n.confirmButton||(n.confirmButton={text:"Confirm"}),n.cancelButtonText||(n.cancelButtonText="Cancel"),n.isMessageHTML?window.bfUtils.sanitize({data:n.message},(t,e)=>t?(i&&i(t,null),console.error(t)):void(e&&(n.message=e,this._confirm(n,i)))):(n.isMessageHTML=!1,this._confirm(n,i))):i("invalid parameter, missing message",null)},_confirm:function(n,i){var t={title:n.title,subtitle:n.subtitle,richContent:"".concat(n.message),isContentHTML:n.isMessageHTML,action:{title:n.confirmButton.text,type:n.confirmButton.type||"primary"},dismissButtonText:n.cancelButtonText,forceAction:!0};richModal.display(t,(t,e)=>{if(i)return t?i(t):e&&e.selectedButton?e.selectedButton.text==n.confirmButton.text?i(null,!0):i(null,!1):e&&"action"===e.buttonType?i(null,!0):i(null,!1)})},alert:function(n,i){(n=n||{}).message?(n.title||(n.title="Alert"),n.okButtonText||(n.okButtonText="OK"),n.isMessageHTML?window.bfUtils.sanitize({data:n.message},(t,e)=>t?(i&&i(t,null),console.error(t)):void(e&&(n.message=e,this._alert(n,i)))):(n.isMessageHTML=!1,this._alert(n,i))):i("invalid parameter, missing message",null)},_alert:function(t,e){t={title:t.title,subtitle:t.subtitle,richContent:"".concat(t.message),isContentHTML:t.isMessageHTML,action:{title:t.okButtonText,type:"primary"},showDismissButton:!1};richModal.display(t,t=>e(t))},show:function(n,i){if((n=n||{}).title)return n.actionButtons&&n.actionButtons.length?(n.message||(n.message=""),n.cancelButtonText||(n.cancelButtonText="Cancel"),n.design&&n.design.backgroundColor&&!n.design.textColor?i("'textColor' is required when 'backgroundColor' is present",null):n.design&&n.design.textColor&&!n.design.backgroundColor?i("'backgroundColor' is required when 'textColor' is present",null):void(n.isMessageHTML?window.bfUtils.sanitize({data:n.message},(t,e)=>t?(i&&i(t,null),console.error(t)):void(e&&(n.message=e,this._show(n,i)))):(n.isMessageHTML=!1,this._show(n,i)))):i("`actionButtons` are required",null);i("invalid parameter, missing title",null)},_show:function(t,n){t={title:t.title,subtitle:t.subtitle,richContent:"".concat(t.message),action:t.actionButtons.map(({text:t,type:e})=>{return{title:t,handler:()=>{n(null,{selectedButton:{text:t,type:e}})},type:e}}),showDismissButton:t.showCancelButton,dismissButtonText:t.cancelButtonText||"Cancel",forceAction:t.forceAction,design:t.design,isContentHTML:t.isMessageHTML};richModal.display(t,(t,e)=>t?n(t):(e&&"dismiss"===e.buttonType&&(e.buttonType="cancel"),e&&e.value&&(e.value={text:e.value.title,action:e.value.handler}),n(null,e)))},hide:function(){richModal.close()},toast:function(e,n){if(this.componentUI||(this.componentUI=new ComponentUIAPI(this.context)),(e=e||{}).message&&(e.message=e.message.trim()),e.message){let t={text:e.message,hideDismiss:e.hideDismissButton,duration:e.duration,type:e.type};e.actionButton&&(t.action={title:e.actionButton.text,action:e.actionButton.action}),this.componentUI.showToastMessage(t,(t,e)=>t?n(t):(e&&e.action&&"function"==typeof e.action&&(e.action(),this.componentUI.closeToastMessage({force:!0})),n(t,e)))}else n("invalid parameter, missing message",null)}};
"use strict";const permissionRequestsAPI={appId:"guest",init(){const i=permissionRequestsAPI;appContext&&appContext.currentApp&&appContext.currentApp.appId&&(i.appId=window.appContext.currentApp.appId),bfUtils.isAndroid&&(i.ds=new DatastoreAPI(i.appId,"stringResources",1,0,appContext.currentApp.keys.datastoreKey),i.ds.get({},(e,t)=>e?console.error(e):void(t&&t.data&&t.data.appPermissions?i.appPermissionStrings=t.data.appPermissions:localStorage.getItem("geo-declaration-required")&&(i.appPermissionStrings.background_location={android:{title:"App would like to use Background Location",content:"This app collects location data to enable showing your position on the map, getting directions, estimating travel times and other location based features even when the app is closed or not in use",actionBtn:"OK",isActive:!0}}))))},appPermissionStrings:{},showPermissionDelcaration(e){var{title:t,content:i,actionBtn:s}=this.appPermissionStrings[e].android;richModal.display({title:t,richContent:i,showDismissButton:!1,forceAction:!0,action:{title:s,handler:()=>{this.setDeclarationShown(e),this.executeQueuedRequests(e)}}})},shouldShowDeclaration(e){if(!bfUtils.isAndroid)return!1;if(this.declarationTypes.indexOf(e)<0)return!1;if(!this.appPermissionStrings||!this.appPermissionStrings[e]||!this.appPermissionStrings[e].android)return!1;var t=this.declarationShown(e),e=this.appPermissionStrings[e].android["isActive"];return!t&&e},declarationShown(e){if(this.declarationTypes.indexOf(e)<0)return!1;var e=this.ENUMS[e]["APP_DECLARATION_SHOWN"];return localStorage.getItem("".concat(this.appId).concat(e))},setDeclarationShown(e){var t=this.ENUMS[e]["APP_DECLARATION_SHOWN"];return localStorage.setItem("".concat(this.appId).concat(t),!0),"background_location"===e?this.setDeclarationShown("location"):"camera"===e?this.setDeclarationShown("photo_library"):void 0},queueMap:{},queueRequest(e,t,i){if(!this.shouldShowDeclaration(e))return this.executeRequest(t,i);this.queueMap[e]=this.queueMap[e]||[],this.queueMap[e].push({context:t,method:i}),this.queueMap[e]&&1===this.queueMap[e].length&&this.showPermissionDelcaration(e)},executeRequest(e,t){t.apply(e)},executeQueuedRequests(e){(this.queueMap[e]||[]).forEach(({context:e,method:t})=>{this.executeRequest(e,t)}),this.queueMap[e]=[]},get declarationTypes(){return Object.keys(this.ENUMS)},get ENUMS(){return{background_location:{APP_DECLARATION_SHOWN:"-geo-location-perm-request"},location:{APP_DECLARATION_SHOWN:"-location-perm-request"},camera:{APP_DECLARATION_SHOWN:"-camera-perm-request"},calendar:{APP_DECLARATION_SHOWN:"-calendar-perm-request"},photo_library:{APP_DECLARATION_SHOWN:"-photo_lib-perm-request"},contacts:{APP_DECLARATION_SHOWN:"-contacts-perm-request"},microphone:{APP_DECLARATION_SHOWN:"-microphone-perm-request"}}}};bfUtils.isMobileDevice&&appState.subscribe({state:appState.RUNNING},permissionRequestsAPI.init);
"use strict";function HealthAPI(e){this.context=e}HealthAPI.prototype={get mockMode(){return!(window.hasOwnProperty("navigator")&&navigator.health)},requestAuthorization(e,t){return"function"!=typeof t&&(t=console.error),e&&e.length?this.mockMode?t(null):void navigator.health.requestAuthorization(e,t,t):t("requestAuthorization:: dataTypes must be an array")},query(e,t){return"function"!=typeof t&&(t=console.error),e&&"object"==typeof e?e.dataType&&"string"==typeof e.dataType?!e.startDate||["object","number"].indexOf(typeof e.startDate)<0?t("query:: options.startDate is required and must be an object or a number"):(e.endDate||(e.endDate=new Date),["object","number"].indexOf(typeof e.endDate)<0?t("query:: options.endDate must be an object or a number"):e.limit&&"number"!=typeof e.limit?t("query:: options.limit must be a number"):this.mockMode?t(null):void navigator.health.query(e,e=>t(null,e),t)):t("query:: options.dataType is required and must be a string"):t("query:: options are required")},queryAggregated(e,t){return"function"!=typeof t&&(t=console.error),e&&"object"==typeof e?e.dataType&&"string"==typeof e.dataType?!e.startDate||["object","number"].indexOf(typeof e.startDate)<0?t("query:: options.startDate is required and must be an object or a number"):(e.endDate||(e.endDate=new Date),["object","number"].indexOf(typeof e.endDate)<0?t("query:: options.endDate must be an object or a number"):e.bucket&&"string"!=typeof e.bucket?t("query:: options.bucket must be a number"):e.bucket&&["hour","day","week","month","year"].indexOf(e.bucket)<0?t("query:: invalid value for options.bucket. Accepted values: hour day week month, year"):this.mockMode?t(null):void navigator.health.queryAggregated(e,e=>t(null,e),t)):t("query:: options.dataType is required and must be a string"):t("query:: options are required")}};