tinymce.PluginManager.add("bf_buttons",function(t,e){function n(n){let o=t.selection.getNode(),c="",u="Insert Button/Link",a={text:"Cancel",type:"cancel"},r=n?[a,{text:"Save",name:"Edit Button",type:"custom",primary:!0}]:[a,{text:"Select Action",name:"Select Action",type:"custom",primary:!0}];if(n){u="Edit Button/Link";let t={classes:o.className},e=JSON.stringify(t);c=`?data=${encodeURIComponent(e)}`}else{let t='\n            button[title="Select Action"].tox-button {\n                background-color: #05acf0;\n                border-color: #05acf0;\n            }\n            button[title="Select Action"].tox-button:hover {\n                background-color: #0089d1 !important;\n                border-color: #0089d1 !important;\n            }';buildfire.wysiwyg.injectPluginStyles(t)}t.windowManager.openUrl({title:u,url:`${e}/dialog.html${c}`,width:500,height:500,buttons:r,onAction:(t,e)=>{"Select Action"===e.name?t.sendMessage({message:"getButtonData"}):"Edit Button"===e.name&&t.sendMessage({message:"getButtonData"})},onMessage:(e,c)=>{let u=c.data.content,a=c.mceAction;if(u&&"setButtonData"===a)if(n){let n=-1,i="button"===u.type?"bf-btn-"+u.buttonStyle:"bf-text-"+u.buttonStyle,c=o.className.split(" ");c.forEach((t,e)=>{"button"===u.type?t.includes("bf-btn-")&&(n=e):"link"===u.type&&t.includes("bf-text-")&&(n=e)}),n>-1&&(c[n]=i,o.className=c.join(" ")),e.close(),t.isNotDirty=!1,t.fire("change")}else i(options={},(n,i)=>{if(n)return console.error(n);let o=document.createElement("button"===u.type?"button":"a");o.className="button"===u.type?"bf-btn bf-btn-"+u.buttonStyle:"bf-text-"+u.buttonStyle,o.setAttribute("data-execute",i.stringifiedActionItem),o.setAttribute("onclick",'buildfire.actionItems.execute(JSON.parse(unescape(this.getAttribute("data-execute"))), ()=>{})'),o.innerText=i.actionItem.title,t.insertContent(o.outerHTML+"&nbsp;"),e.close()})}})}function i(t,e){let n={};(t=t||{}).actionItem=t.actionItem||{},buildfire.actionItems.showDialog(t.actionItem,{allowNoAction:!0,showIcon:!1,showTitle:!1},(t,i)=>t?e(t,null):i?(n.actionItem=i,n.stringifiedActionItem=escape(JSON.stringify(i)),void e(null,n)):e("There is no action item",null))}function o(){let e={},n=t.selection.getNode();e.actionItem=JSON.parse(unescape(n.dataset.execute)),i(e,(e,i)=>{if(e)return console.error(e);n.innerText=i.actionItem.title,n.setAttribute("data-execute",i.stringifiedActionItem),t.isNotDirty=!1,t.fire("change")})}return t.ui.registry.addButton("bf_edit_button",{icon:"edit-block",tooltip:"Edit button",onAction:function(){n(!0)}}),t.ui.registry.addButton("bf_edit_button_action",{icon:"link",tooltip:"Edit button action",onAction:function(){o()}}),t.ui.registry.addContextToolbar("editBfButton",{predicate:function(t){let e=t.className;return e.includes("bf-btn")||e.includes("bf-text-")},items:"bf_edit_button | bf_edit_button_action",position:"node",scope:"node"}),t.ui.registry.addMenuItem("bf_insertButtonOrLink",{text:"Insert button/link",onAction:function(){n(!1)}}),t.ui.registry.addMenuItem("bf_editButtonOrLink",{text:"Edit button/link",icon:"edit-block",onAction:function(){n(!0)}}),t.ui.registry.addMenuItem("bf_editButtonOrLinkAction",{text:"Edit button/link action",icon:"link",onAction:function(){o()}}),t.ui.registry.addContextMenu("bf_buttonOrLinkContextMenu",{update:function(t){let e=t.className;return e.includes("bf-btn")||e.includes("bf-text-")?"bf_editButtonOrLink bf_editButtonOrLinkAction":""}}),{getMetadata:function(){return{name:"Buttons Plugin"}}}});