tinymce.PluginManager.add("bf_layouts",function(t,e){let n,o=window.innerHeight>600?600:window.innerHeight-20;function a(a){let i="",r="Select Layout",u={text:"Cancel",type:"cancel"},d=[u,{text:"Insert",name:"Insert Layout",type:"custom",primary:!0}];if(a){r="Edit Layout",d=[u,{text:"Save",name:"Change Layout",type:"custom",primary:!0}];let t={layoutData:JSON.parse(unescape(n.dataset.bfLayout))},e=JSON.stringify(t);i=`?data=${encodeURIComponent(e)}`}t.windowManager.openUrl({title:r,url:`${e}/dialog.html${i}`,width:500,height:o,buttons:d,onAction:(t,e)=>{"Insert Layout"!==e.name&&"Change Layout"!==e.name||t.sendMessage({message:"getLayout"})},onMessage:(e,o)=>{let i=o.data.content,r=o.mceAction;if(i&&"insertLayout"===r){let o=i.cssContent,r=t.dom.doc.body.querySelector("style[data-layout-name="+i.id+"]");if(a){n.id=i.id;let e={};e.id=i.id,e.cssUrl=i.cssUrl,e.htmlUrl=i.htmlUrl;let o=escape(JSON.stringify(e));n.setAttribute("data-bf-layout",o),n.setAttribute("data-layout-name",i.id),t.isNotDirty=!1,t.fire("change")}else{let e=i.htmlContent,n=document.createElement("div");n.id=i.id,n.innerHTML=e,n.querySelectorAll("img").forEach(t=>{t.setAttribute("src",t.src)});let o={};o.id=i.id,o.cssUrl=i.cssUrl,o.htmlUrl=i.htmlUrl;let a=escape(JSON.stringify(o));n.setAttribute("data-bf-layout",a),n.setAttribute("data-layout-name",i.id),t.insertContent(n.outerHTML+"&nbsp;")}if(r)r&&a&&(r.innerHTML=o);else{let e=document.createElement("style");e.setAttribute("data-layout-name",i.id),e.innerHTML=o,t.dom.doc.body.appendChild(e)}e.close()}}})}return t.ui.registry.addButton("bf_edit_layout",{icon:"edit-block",tooltip:"Edit layout",onAction:function(){a(!0)}}),t.ui.registry.addContextToolbar("editBfLayout",{predicate:function(t){return t.dataset.bfLayout&&(n=t),t.dataset.bfLayout},items:"bf_edit_layout",position:"node",scope:"node"}),t.ui.registry.addMenuItem("bf_insertLayout",{text:"Insert layout",onAction:function(){a(!1)}}),t.ui.registry.addMenuItem("bf_editLayout",{text:"Edit layout",icon:"edit-block",onAction:function(){a(!0)}}),t.ui.registry.addMenuItem("bf_copyLayout",{text:"Copy layout",icon:"copy",onAction:function(){t.execCommand("mceSelectNode",!1,n),t.execCommand("Copy")}}),t.ui.registry.addMenuItem("bf_deleteLayout",{text:"Delete layout",icon:"remove",onAction:function(){n.parentNode.removeChild(n),t.isNotDirty=!1,t.fire("change")}}),t.ui.registry.addMenuItem("bf_insertBeforeLayout",{text:"Insert before layout",icon:"chevron-left",onAction:function(){n.insertAdjacentHTML("beforebegin","<p><br></p>")}}),t.ui.registry.addMenuItem("bf_insertAfterLayout",{text:"Insert after layout",icon:"chevron-right",onAction:function(){n.insertAdjacentHTML("afterend","<p><br></p>")}}),t.ui.registry.addContextMenu("bf_customLayouts",{update:function(t){if(t.dataset.bfLayout)return n=t,"bf_editLayout bf_copyLayout bf_deleteLayout bf_insertBeforeLayout bf_insertAfterLayout";for(;t.dataset.bfLayout||"BODY"!==t.nodeName;){if(!(t=t.parentElement)||!t.dataset)return"";if(t.dataset.bfLayout)return n=t,"bf_editLayout bf_copyLayout bf_deleteLayout bf_insertBeforeLayout bf_insertAfterLayout"}return""}}),{getMetadata:function(){return{name:"Layouts Plugin"}}}});