tinymce.PluginManager.add("bf_layouts",function(t,e){let o;function a(a){let n="",i="Select Layout",u={text:"Cancel",type:"cancel"},d=[u,{text:"Insert",name:"Insert Layout",type:"custom",primary:!0}];if(a){i="Edit Layout",d=[u,{text:"Save",name:"Change Layout",type:"custom",primary:!0}];let t={layoutData:JSON.parse(unescape(o.dataset.bfLayout))},e=JSON.stringify(t);n=`?data=${encodeURIComponent(e)}`}t.windowManager.openUrl({title:i,url:`${e}/dialog.html${n}`,width:500,height:600,buttons:d,onAction:(t,e)=>{"Insert Layout"!==e.name&&"Change Layout"!==e.name||t.sendMessage({message:"getLayout"})},onMessage:(e,n)=>{let i=n.data.content,u=n.mceAction;if(i&&"insertLayout"===u){let n=i.cssContent,u=t.dom.doc.body.querySelector("style[data-layout-name="+i.id+"]");if(a){o.id=i.id;let e={};e.id=i.id,e.cssUrl=i.cssUrl,e.htmlUrl=i.htmlUrl;let a=escape(JSON.stringify(e));o.setAttribute("data-bf-layout",a),o.setAttribute("data-layout-name",i.id),t.isNotDirty=!1,t.fire("change")}else{let e=i.htmlContent,o=document.createElement("div");o.id=i.id,o.innerHTML=e,o.querySelectorAll("img").forEach(t=>{t.setAttribute("data-mce-src",t.src)});let a={};a.id=i.id,a.cssUrl=i.cssUrl,a.htmlUrl=i.htmlUrl;let n=escape(JSON.stringify(a));o.setAttribute("data-bf-layout",n),o.setAttribute("data-layout-name",i.id),t.insertContent(o.outerHTML+"&nbsp;")}if(u)u&&a&&(u.innerHTML=n);else{let e=document.createElement("style");e.setAttribute("data-layout-name",i.id),e.innerHTML=n,t.dom.doc.body.appendChild(e)}e.close()}}})}return t.ui.registry.addButton("bf_edit_layout",{icon:"edit-block",tooltip:"Edit layout",onAction:function(){a(!0)}}),t.ui.registry.addContextToolbar("editBfLayout",{predicate:function(t){return t.dataset.bfLayout&&(o=t),t.dataset.bfLayout},items:"bf_edit_layout",position:"node",scope:"node"}),t.ui.registry.addMenuItem("bf_insertLayout",{text:"Insert layout",onAction:function(){a(!1)}}),t.ui.registry.addMenuItem("bf_editLayout",{text:"Edit layout",icon:"edit-block",onAction:function(){a(!0)}}),t.ui.registry.addMenuItem("bf_copyLayout",{text:"Copy layout",icon:"copy",onAction:function(){t.execCommand("mceSelectNode",!1,o),t.execCommand("Copy")}}),t.ui.registry.addMenuItem("bf_deleteLayout",{text:"Delete layout",icon:"remove",onAction:function(){o.parentNode.removeChild(o),t.isNotDirty=!1,t.fire("change")}}),t.ui.registry.addContextMenu("bf_customLayouts",{update:function(t){return t.dataset.bfLayout?(o=t,"bf_editLayout bf_copyLayout bf_deleteLayout"):""}}),{getMetadata:function(){return{name:"Layouts Plugin"}}}});