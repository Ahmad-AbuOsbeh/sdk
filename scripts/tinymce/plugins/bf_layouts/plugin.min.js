tinymce.PluginManager.add("bf_layouts",function(t,e){let a;function n(n){let o="",i="Select Layout",u={text:"Cancel",type:"cancel"},r=[u,{text:"Insert",name:"Insert Layout",type:"custom",primary:!0}];if(n){i="Edit Layout",r=[u,{text:"Save",name:"Change Layout",type:"custom",primary:!0}];let t={layoutData:JSON.parse(unescape(a.dataset.bfLayout))},e=JSON.stringify(t);o=`?data=${encodeURIComponent(e)}`}t.windowManager.openUrl({title:i,url:`${e}/dialog.html${o}`,width:500,height:600,buttons:r,onAction:(t,e)=>{"Insert Layout"!==e.name&&"Change Layout"!==e.name||t.sendMessage({message:"getLayout"})},onMessage:(e,o)=>{let i=o.data.content,u=o.mceAction;if(i&&"insertLayout"===u){let o=i.cssContent,u=document.createElement("style"),r=t.dom.doc.body.querySelectorAll("style[data-layout-name="+i.id+"]");if(n)a.id=i.id,a.setAttribute("data-layout-name",i.id),t.isNotDirty=!1,t.fire("change");else{let e=i.htmlContent,a=document.createElement("div");a.id=i.id,a.innerHTML=e,a.querySelectorAll("img").forEach(t=>{t.setAttribute("data-mce-src",t.src)});let n={};n.htmlUrl=i.htmlUrl;let o=escape(JSON.stringify(n));a.setAttribute("data-bf-layout",o),a.setAttribute("data-layout-name",i.id),t.insertContent(a.outerHTML+"&nbsp;")}0===r.length&&(u.setAttribute("data-layout-name",i.id),u.innerHTML=o,t.dom.doc.body.appendChild(u)),e.close()}}})}return t.ui.registry.addButton("bf_edit_layout",{icon:"edit-block",tooltip:"Edit layout",onAction:function(){n(!0)}}),t.ui.registry.addContextToolbar("editBfLayout",{predicate:function(t){return a=t,t.dataset.bfLayout},items:"bf_edit_layout",position:"node",scope:"node"}),t.ui.registry.addMenuItem("bf_insertLayout",{text:"Insert layout",onAction:function(){n(!1)}}),{getMetadata:function(){return{name:"Layouts Plugin"}}}});